(self.webpackChunkSensors=self.webpackChunkSensors||[]).push([[179],{497:(Em,Vu,Uu)=>{"use strict";function Rn(e){return"function"==typeof e}function gh(e){const i=e(n=>{Error.call(n),n.stack=(new Error).stack});return i.prototype=Object.create(Error.prototype),i.prototype.constructor=i,i}const Tm=gh(e=>function(i){e(this),this.message=i?`${i.length} errors occurred during unsubscription:\n${i.map((n,o)=>`${o+1}) ${n.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=i});function p(e,t){if(e){const i=e.indexOf(t);0<=i&&e.splice(i,1)}}class Je{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:i}=this;if(i)if(this._parentage=null,Array.isArray(i))for(const c of i)c.remove(this);else i.remove(this);const{initialTeardown:n}=this;if(Rn(n))try{n()}catch(c){t=c instanceof Tm?c.errors:[c]}const{_finalizers:o}=this;if(o){this._finalizers=null;for(const c of o)try{an(c)}catch(f){t=t??[],f instanceof Tm?t=[...t,...f.errors]:t.push(f)}}if(t)throw new Tm(t)}}add(t){var i;if(t&&t!==this)if(this.closed)an(t);else{if(t instanceof Je){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(i=this._finalizers)&&void 0!==i?i:[]).push(t)}}_hasParent(t){const{_parentage:i}=this;return i===t||Array.isArray(i)&&i.includes(t)}_addParent(t){const{_parentage:i}=this;this._parentage=Array.isArray(i)?(i.push(t),i):i?[i,t]:t}_removeParent(t){const{_parentage:i}=this;i===t?this._parentage=null:Array.isArray(i)&&p(i,t)}remove(t){const{_finalizers:i}=this;i&&p(i,t),t instanceof Je&&t._removeParent(this)}}Je.EMPTY=(()=>{const e=new Je;return e.closed=!0,e})();const us=Je.EMPTY;function mo(e){return e instanceof Je||e&&"closed"in e&&Rn(e.remove)&&Rn(e.add)&&Rn(e.unsubscribe)}function an(e){Rn(e)?e():e.unsubscribe()}const on={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},or={setTimeout(e,t,...i){const{delegate:n}=or;return n?.setTimeout?n.setTimeout(e,t,...i):setTimeout(e,t,...i)},clearTimeout(e){const{delegate:t}=or;return(t?.clearTimeout||clearTimeout)(e)},delegate:void 0};function zr(e){or.setTimeout(()=>{const{onUnhandledError:t}=on;if(!t)throw e;t(e)})}function Bo(){}const Rs=io("C",void 0,void 0);function io(e,t,i){return{kind:e,value:t,error:i}}let _o=null;function Wr(e){if(on.useDeprecatedSynchronousErrorHandling){const t=!_o;if(t&&(_o={errorThrown:!1,error:null}),e(),t){const{errorThrown:i,error:n}=_o;if(_o=null,i)throw n}}else e()}class Fs extends Je{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,mo(t)&&t.add(this)):this.destination=ju}static create(t,i,n){return new Fa(t,i,n)}next(t){this.isStopped?Pc(function Sl(e){return io("N",e,void 0)}(t),this):this._next(t)}error(t){this.isStopped?Pc(function Ac(e){return io("E",void 0,e)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?Pc(Rs,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Vo=Function.prototype.bind;function _t(e,t){return Vo.call(e,t)}class mh{constructor(t){this.partialObserver=t}next(t){const{partialObserver:i}=this;if(i.next)try{i.next(t)}catch(n){fn(n)}}error(t){const{partialObserver:i}=this;if(i.error)try{i.error(t)}catch(n){fn(n)}else fn(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(i){fn(i)}}}class Fa extends Fs{constructor(t,i,n){let o;if(super(),Rn(t)||!t)o={next:t??void 0,error:i??void 0,complete:n??void 0};else{let c;this&&on.useDeprecatedNextContext?(c=Object.create(t),c.unsubscribe=()=>this.unsubscribe(),o={next:t.next&&_t(t.next,c),error:t.error&&_t(t.error,c),complete:t.complete&&_t(t.complete,c)}):o=t}this.destination=new mh(o)}}function fn(e){on.useDeprecatedSynchronousErrorHandling?function Ra(e){on.useDeprecatedSynchronousErrorHandling&&_o&&(_o.errorThrown=!0,_o.error=e)}(e):zr(e)}function Pc(e,t){const{onStoppedNotification:i}=on;i&&or.setTimeout(()=>i(e,t))}const ju={closed:!0,next:Bo,error:function gr(e){throw e},complete:Bo},Na="function"==typeof Symbol&&Symbol.observable||"@@observable";function Uo(e){return e}function za(e){return 0===e.length?Uo:1===e.length?e[0]:function(i){return e.reduce((n,o)=>o(n),i)}}let xn=(()=>{class e{constructor(i){i&&(this._subscribe=i)}lift(i){const n=new e;return n.source=this,n.operator=i,n}subscribe(i,n,o){const c=function $i(e){return e&&e instanceof Fs||function sa(e){return e&&Rn(e.next)&&Rn(e.error)&&Rn(e.complete)}(e)&&mo(e)}(i)?i:new Fa(i,n,o);return Wr(()=>{const{operator:f,source:y}=this;c.add(f?f.call(c,y):y?this._subscribe(c):this._trySubscribe(c))}),c}_trySubscribe(i){try{return this._subscribe(i)}catch(n){i.error(n)}}forEach(i,n){return new(n=sr(n))((o,c)=>{const f=new Fa({next:y=>{try{i(y)}catch(E){c(E),f.unsubscribe()}},error:c,complete:o});this.subscribe(f)})}_subscribe(i){var n;return null===(n=this.source)||void 0===n?void 0:n.subscribe(i)}[Na](){return this}pipe(...i){return za(i)(this)}toPromise(i){return new(i=sr(i))((n,o)=>{let c;this.subscribe(f=>c=f,f=>o(f),()=>n(c))})}}return e.create=t=>new e(t),e})();function sr(e){var t;return null!==(t=e??on.Promise)&&void 0!==t?t:Promise}const aa=gh(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let ar=(()=>{class e extends xn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(i){const n=new Ns(this,this);return n.operator=i,n}_throwIfClosed(){if(this.closed)throw new aa}next(i){Wr(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const n of this.currentObservers)n.next(i)}})}error(i){Wr(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=i;const{observers:n}=this;for(;n.length;)n.shift().error(i)}})}complete(){Wr(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:i}=this;for(;i.length;)i.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var i;return(null===(i=this.observers)||void 0===i?void 0:i.length)>0}_trySubscribe(i){return this._throwIfClosed(),super._trySubscribe(i)}_subscribe(i){return this._throwIfClosed(),this._checkFinalizedStatuses(i),this._innerSubscribe(i)}_innerSubscribe(i){const{hasError:n,isStopped:o,observers:c}=this;return n||o?us:(this.currentObservers=null,c.push(i),new Je(()=>{this.currentObservers=null,p(c,i)}))}_checkFinalizedStatuses(i){const{hasError:n,thrownError:o,isStopped:c}=this;n?i.error(o):c&&i.complete()}asObservable(){const i=new xn;return i.source=this,i}}return e.create=(t,i)=>new Ns(t,i),e})();class Ns extends ar{constructor(t,i){super(),this.destination=t,this.source=i}next(t){var i,n;null===(n=null===(i=this.destination)||void 0===i?void 0:i.next)||void 0===n||n.call(i,t)}error(t){var i,n;null===(n=null===(i=this.destination)||void 0===i?void 0:i.error)||void 0===n||n.call(i,t)}complete(){var t,i;null===(i=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===i||i.call(t)}_subscribe(t){var i,n;return null!==(n=null===(i=this.source)||void 0===i?void 0:i.subscribe(t))&&void 0!==n?n:us}}class Ei extends ar{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const i=super._subscribe(t);return!i.closed&&t.next(this._value),i}getValue(){const{hasError:t,thrownError:i,_value:n}=this;if(t)throw i;return this._throwIfClosed(),n}next(t){super.next(this._value=t)}}function kc(e){return Rn(e?.lift)}function ri(e){return t=>{if(kc(t))return t.lift(function(i){try{return e(i,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function ei(e,t,i,n,o){return new Cn(e,t,i,n,o)}class Cn extends Fs{constructor(t,i,n,o,c,f){super(t),this.onFinalize=c,this.shouldUnsubscribe=f,this._next=i?function(y){try{i(y)}catch(E){t.error(E)}}:super._next,this._error=o?function(y){try{o(y)}catch(E){t.error(E)}finally{this.unsubscribe()}}:super._error,this._complete=n?function(){try{n()}catch(y){t.error(y)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:i}=this;super.unsubscribe(),!i&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function En(e,t){return ri((i,n)=>{let o=0;i.subscribe(ei(n,c=>{n.next(e.call(t,c,o++))}))})}function Xr(e){return this instanceof Xr?(this.v=e,this):new Xr(e)}function ca(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,t=e[Symbol.asyncIterator];return t?t.call(e):(e=function ds(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],n=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),i={},n("next"),n("throw"),n("return"),i[Symbol.asyncIterator]=function(){return this},i);function n(c){i[c]=e[c]&&function(f){return new Promise(function(y,E){!function o(c,f,y,E){Promise.resolve(E).then(function(A){c({value:A,done:y})},f)}(y,E,(f=e[c](f)).done,f.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const ze=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function ht(e){return Rn(e?.then)}function gt(e){return Rn(e[Na])}function at(e){return Symbol.asyncIterator&&Rn(e?.[Symbol.asyncIterator])}function Yt(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Kt=function hn(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function ln(e){return Rn(e?.[Kt])}function bn(e){return function Bs(e,t,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,n=i.apply(e,t||[]),c=[];return o={},f("next"),f("throw"),f("return"),o[Symbol.asyncIterator]=function(){return this},o;function f(oe){n[oe]&&(o[oe]=function(pe){return new Promise(function(Ie,Ve){c.push([oe,pe,Ie,Ve])>1||y(oe,pe)})})}function y(oe,pe){try{!function E(oe){oe.value instanceof Xr?Promise.resolve(oe.value.v).then(A,z):H(c[0][2],oe)}(n[oe](pe))}catch(Ie){H(c[0][3],Ie)}}function A(oe){y("next",oe)}function z(oe){y("throw",oe)}function H(oe,pe){oe(pe),c.shift(),c.length&&y(c[0][0],c[0][1])}}(this,arguments,function*(){const i=e.getReader();try{for(;;){const{value:n,done:o}=yield Xr(i.read());if(o)return yield Xr(void 0);yield yield Xr(n)}}finally{i.releaseLock()}})}function di(e){return Rn(e?.getReader)}function An(e){if(e instanceof xn)return e;if(null!=e){if(gt(e))return function Dr(e){return new xn(t=>{const i=e[Na]();if(Rn(i.subscribe))return i.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(ze(e))return function Ki(e){return new xn(t=>{for(let i=0;i<e.length&&!t.closed;i++)t.next(e[i]);t.complete()})}(e);if(ht(e))return function hs(e){return new xn(t=>{e.then(i=>{t.closed||(t.next(i),t.complete())},i=>t.error(i)).then(null,zr)})}(e);if(at(e))return Sr(e);if(ln(e))return function mr(e){return new xn(t=>{for(const i of e)if(t.next(i),t.closed)return;t.complete()})}(e);if(di(e))return function Ol(e){return Sr(bn(e))}(e)}throw Yt(e)}function Sr(e){return new xn(t=>{(function Dm(e,t){var i,n,o,c;return function Ba(e,t,i,n){return new(i||(i=Promise))(function(c,f){function y(z){try{A(n.next(z))}catch(H){f(H)}}function E(z){try{A(n.throw(z))}catch(H){f(H)}}function A(z){z.done?c(z.value):function o(c){return c instanceof i?c:new i(function(f){f(c)})}(z.value).then(y,E)}A((n=n.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(i=ca(e);!(n=yield i.next()).done;)if(t.next(n.value),t.closed)return}catch(f){o={error:f}}finally{try{n&&!n.done&&(c=i.return)&&(yield c.call(i))}finally{if(o)throw o.error}}t.complete()})})(e,t).catch(i=>t.error(i))})}function ps(e,t,i,n=0,o=!1){const c=t.schedule(function(){i(),o?e.add(this.schedule(null,n)):this.unsubscribe()},n);if(e.add(c),!o)return c}function Ji(e,t,i=1/0){return Rn(t)?Ji((n,o)=>En((c,f)=>t(n,c,o,f))(An(e(n,o))),i):("number"==typeof t&&(i=t),ri((n,o)=>function Fn(e,t,i,n,o,c,f,y){const E=[];let A=0,z=0,H=!1;const oe=()=>{H&&!E.length&&!A&&t.complete()},pe=Ve=>A<n?Ie(Ve):E.push(Ve),Ie=Ve=>{c&&t.next(Ve),A++;let We=!1;An(i(Ve,z++)).subscribe(ei(t,et=>{o?.(et),c?pe(et):t.next(et)},()=>{We=!0},void 0,()=>{if(We)try{for(A--;E.length&&A<n;){const et=E.shift();f?ps(t,f,()=>Ie(et)):Ie(et)}oe()}catch(et){t.error(et)}}))};return e.subscribe(ei(t,pe,()=>{H=!0,oe()})),()=>{y?.()}}(n,o,e,i)))}function fs(e=1/0){return Ji(Uo,e)}const bo=new xn(e=>e.complete());function ms(e){return e&&Rn(e.schedule)}function Fc(e){return e[e.length-1]}function Wu(e){return Rn(Fc(e))?e.pop():void 0}function jo(e){return ms(Fc(e))?e.pop():void 0}function Ll(e,t=0){return ri((i,n)=>{i.subscribe(ei(n,o=>ps(n,e,()=>n.next(o),t),()=>ps(n,e,()=>n.complete(),t),o=>ps(n,e,()=>n.error(o),t)))})}function je(e,t=0){return ri((i,n)=>{n.add(e.schedule(()=>i.subscribe(n),t))})}function $o(e,t){if(!e)throw new Error("Iterable cannot be null");return new xn(i=>{ps(i,t,()=>{const n=e[Symbol.asyncIterator]();ps(i,t,()=>{n.next().then(o=>{o.done?i.complete():i.next(o.value)})},0,!0)})})}function bi(e,t){return t?function Yp(e,t){if(null!=e){if(gt(e))return function Us(e,t){return An(e).pipe(je(t),Ll(t))}(e,t);if(ze(e))return function _r(e,t){return new xn(i=>{let n=0;return t.schedule(function(){n===e.length?i.complete():(i.next(e[n++]),i.closed||this.schedule())})})}(e,t);if(ht(e))return function Hi(e,t){return An(e).pipe(je(t),Ll(t))}(e,t);if(at(e))return $o(e,t);if(ln(e))return function Xp(e,t){return new xn(i=>{let n;return ps(i,t,()=>{n=e[Kt](),ps(i,t,()=>{let o,c;try{({value:o,done:c}=n.next())}catch(f){return void i.error(f)}c?i.complete():i.next(o)},0,!0)}),()=>Rn(n?.return)&&n.return()})}(e,t);if(di(e))return function vh(e,t){return $o(bn(e),t)}(e,t)}throw Yt(e)}(e,t):An(e)}function bt(...e){const t=jo(e),i=function Vs(e,t){return"number"==typeof Fc(e)?e.pop():t}(e,1/0),n=e;return n.length?1===n.length?An(n[0]):fs(i)(bi(n,t)):bo}function pt(...e){return bi(e,jo(e))}function cn(e={}){const{connector:t=(()=>new ar),resetOnError:i=!0,resetOnComplete:n=!0,resetOnRefCountZero:o=!0}=e;return c=>{let f,y,E,A=0,z=!1,H=!1;const oe=()=>{y?.unsubscribe(),y=void 0},pe=()=>{oe(),f=E=void 0,z=H=!1},Ie=()=>{const Ve=f;pe(),Ve?.unsubscribe()};return ri((Ve,We)=>{A++,!H&&!z&&oe();const et=E=E??t();We.add(()=>{A--,0===A&&!H&&!z&&(y=Vr(Ie,o))}),et.subscribe(We),!f&&A>0&&(f=new Fa({next:qe=>et.next(qe),error:qe=>{H=!0,oe(),y=Vr(pe,i,qe),et.error(qe)},complete:()=>{z=!0,oe(),y=Vr(pe,n),et.complete()}}),An(Ve).subscribe(f))})(c)}}function Vr(e,t,...i){if(!0===t)return void e();if(!1===t)return;const n=new Fa({next:()=>{n.unsubscribe(),e()}});return An(t(...i)).subscribe(n)}function Ti(e,t){return ri((i,n)=>{let o=null,c=0,f=!1;const y=()=>f&&!o&&n.complete();i.subscribe(ei(n,E=>{o?.unsubscribe();let A=0;const z=c++;An(e(E,z)).subscribe(o=ei(n,H=>n.next(t?t(E,H,z,A++):H),()=>{o=null,y()}))},()=>{f=!0,y()}))})}function ro(e,t){return e===t}function zn(e){for(let t in e)if(e[t]===zn)return t;throw Error("Could not find renamed property on target object.")}function _s(e,t){for(const i in t)t.hasOwnProperty(i)&&!e.hasOwnProperty(i)&&(e[i]=t[i])}function jn(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(jn).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const i=t.indexOf("\n");return-1===i?t:t.substring(0,i)}function ti(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const Kp=zn({__forward_ref__:zn});function Pn(e){return e.__forward_ref__=Pn,e.toString=function(){return jn(this())},e}function Gt(e){return ja(e)?e():e}function ja(e){return"function"==typeof e&&e.hasOwnProperty(Kp)&&e.__forward_ref__===Pn}function Nc(e){return e&&!!e.\u0275providers}const Rl="https://g.co/ng/security#xss";class ut extends Error{constructor(t,i){super(function $a(e,t){return`NG0${Math.abs(e)}${t?": "+t:""}`}(t,i)),this.code=t}}function Zt(e){return"string"==typeof e?e:null==e?"":String(e)}function Ir(e,t){throw new ut(-201,!1)}function wo(e,t){null==e&&function Wt(e,t,i,n){throw new Error(`ASSERTION ERROR: ${e}`+(null==n?"":` [Expected=> ${i} ${n} ${t} <=Actual]`))}(t,e,null,"!=")}function Lt(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function lr(e){return{providers:e.providers||[],imports:e.imports||[]}}function Co(e){return Ha(e,Ga)||Ha(e,Yu)}function Ha(e,t){return e.hasOwnProperty(t)?e[t]:null}function Uc(e){return e&&(e.hasOwnProperty(jc)||e.hasOwnProperty(Nl))?e[jc]:null}const Ga=zn({\u0275prov:zn}),jc=zn({\u0275inj:zn}),Yu=zn({ngInjectableDef:zn}),Nl=zn({ngInjectorDef:zn});var kt=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}(kt||{});let wh;function Ur(e){const t=wh;return wh=e,t}function Ju(e,t,i){const n=Co(e);return n&&"root"==n.providedIn?void 0===n.value?n.value=n.factory():n.value:i&kt.Optional?null:void 0!==t?t:void Ir(jn(e))}const Kn=globalThis,wn={},Za="__NG_DI_FLAG__",Hc="ngTempTokenPath",lf=/\n/gm,Qu="__source";let Bl;function ga(e){const t=Bl;return Bl=e,t}function Dh(e,t=kt.Default){if(void 0===Bl)throw new ut(-203,!1);return null===Bl?Ju(e,void 0,t):Bl.get(e,t&kt.Optional?null:void 0,t)}function Ft(e,t=kt.Default){return(function Ku(){return wh}()||Dh)(Gt(e),t)}function It(e,t=kt.Default){return Ft(e,Gc(t))}function Gc(e){return typeof e>"u"||"number"==typeof e?e:0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function td(e){const t=[];for(let i=0;i<e.length;i++){const n=Gt(e[i]);if(Array.isArray(n)){if(0===n.length)throw new ut(900,!1);let o,c=kt.Default;for(let f=0;f<n.length;f++){const y=n[f],E=Zc(y);"number"==typeof E?-1===E?o=y.token:c|=E:o=y}t.push(Ft(o,c))}else t.push(Ft(n))}return t}function qc(e,t){return e[Za]=t,e.prototype[Za]=t,e}function Zc(e){return e[Za]}function oo(e){return{toString:e}.toString()}var Ul=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}(Ul||{}),Qi=function(e){return e[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}(Qi||{});const so={},Nn=[],Xa=zn({\u0275cmp:zn}),nd=zn({\u0275dir:zn}),Wc=zn({\u0275pipe:zn}),cf=zn({\u0275mod:zn}),qo=zn({\u0275fac:zn}),ma=zn({__NG_ELEMENT_ID__:zn}),jl=zn({__NG_ENV_ID__:zn});function Ih(e,t,i){let n=e.length;for(;;){const o=e.indexOf(t,i);if(-1===o)return o;if(0===o||e.charCodeAt(o-1)<=32){const c=t.length;if(o+c===n||e.charCodeAt(o+c)<=32)return o}i=o+1}}function Xc(e,t,i){let n=0;for(;n<i.length;){const o=i[n];if("number"==typeof o){if(0!==o)break;n++;const c=i[n++],f=i[n++],y=i[n++];e.setAttribute(t,f,y,c)}else{const c=o,f=i[++n];id(c)?e.setProperty(t,c,f):e.setAttribute(t,c,f),n++}}return n}function uf(e){return 3===e||4===e||6===e}function id(e){return 64===e.charCodeAt(0)}function $l(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let i=-1;for(let n=0;n<t.length;n++){const o=t[n];"number"==typeof o?i=o:0===i||Hl(e,i,o,null,-1===i||2===i?t[++n]:null)}}return e}function Hl(e,t,i,n,o){let c=0,f=e.length;if(-1===t)f=-1;else for(;c<e.length;){const y=e[c++];if("number"==typeof y){if(y===t){f=-1;break}if(y>t){f=c-1;break}}}for(;c<e.length;){const y=e[c];if("number"==typeof y)break;if(y===i){if(null===n)return void(null!==o&&(e[c+1]=o));if(n===e[c+1])return void(e[c+2]=o)}c++,null!==n&&c++,null!==o&&c++}-1!==f&&(e.splice(f,0,t),c=f+1),e.splice(c++,0,i),null!==n&&e.splice(c++,0,n),null!==o&&e.splice(c++,0,o)}const Ah="ng-template";function rd(e,t,i){let n=0,o=!0;for(;n<e.length;){let c=e[n++];if("string"==typeof c&&o){const f=e[n++];if(i&&"class"===c&&-1!==Ih(f.toLowerCase(),t,0))return!0}else{if(1===c){for(;n<e.length&&"string"==typeof(c=e[n++]);)if(c.toLowerCase()===t)return!0;return!1}"number"==typeof c&&(o=!1)}}return!1}function Ph(e){return 4===e.type&&e.value!==Ah}function Gl(e,t,i){return t===(4!==e.type||i?e.value:Ah)}function km(e,t,i){let n=4;const o=e.attrs||[],c=function hf(e){for(let t=0;t<e.length;t++)if(uf(e[t]))return t;return e.length}(o);let f=!1;for(let y=0;y<t.length;y++){const E=t[y];if("number"!=typeof E){if(!f)if(4&n){if(n=2|1&n,""!==E&&!Gl(e,E,i)||""===E&&1===t.length){if(Zo(n))return!1;f=!0}}else{const A=8&n?E:t[++y];if(8&n&&null!==e.attrs){if(!rd(e.attrs,A,i)){if(Zo(n))return!1;f=!0}continue}const H=Om(8&n?"class":E,o,Ph(e),i);if(-1===H){if(Zo(n))return!1;f=!0;continue}if(""!==A){let oe;oe=H>c?"":o[H+1].toLowerCase();const pe=8&n?oe:null;if(pe&&-1!==Ih(pe,A,0)||2&n&&A!==oe){if(Zo(n))return!1;f=!0}}}}else{if(!f&&!Zo(n)&&!Zo(E))return!1;if(f&&Zo(E))continue;f=!1,n=E|1&n}}return Zo(n)||f}function Zo(e){return 0==(1&e)}function Om(e,t,i,n){if(null===t)return-1;let o=0;if(n||!i){let c=!1;for(;o<t.length;){const f=t[o];if(f===e)return o;if(3===f||6===f)c=!0;else{if(1===f||2===f){let y=t[++o];for(;"string"==typeof y;)y=t[++o];continue}if(4===f)break;if(0===f){o+=4;continue}}o+=c?1:2}return-1}return function od(e,t){let i=e.indexOf(4);if(i>-1)for(i++;i<e.length;){const n=e[i];if("number"==typeof n)return-1;if(n===t)return i;i++}return-1}(t,e)}function df(e,t,i=!1){for(let n=0;n<t.length;n++)if(km(e,t[n],i))return!0;return!1}function ql(e,t){e:for(let i=0;i<t.length;i++){const n=t[i];if(e.length===n.length){for(let o=0;o<e.length;o++)if(e[o]!==n[o])continue e;return!0}}return!1}function kh(e,t){return e?":not("+t.trim()+")":t}function pf(e){let t=e[0],i=1,n=2,o="",c=!1;for(;i<e.length;){let f=e[i];if("string"==typeof f)if(2&n){const y=e[++i];o+="["+f+(y.length>0?'="'+y+'"':"")+"]"}else 8&n?o+="."+f:4&n&&(o+=" "+f);else""!==o&&!Zo(f)&&(t+=kh(c,o),o=""),n=f,c=c||!Zo(n);i++}return""!==o&&(t+=kh(c,o)),t}function mi(e){return oo(()=>{const t=vs(e),i={...t,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===Ul.OnPush,directiveDefs:null,pipeDefs:null,dependencies:t.standalone&&e.dependencies||null,getStandaloneInjector:null,signals:e.signals??!1,data:e.data||{},encapsulation:e.encapsulation||Qi.Emulated,styles:e.styles||Nn,_:null,schemas:e.schemas||null,tView:null,id:""};Oh(i);const n=e.dependencies;return i.directiveDefs=Ja(n,!1),i.pipeDefs=Ja(n,!0),i.id=function Wl(e){let t=0;const i=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,e.consts,e.vars,e.decls,e.encapsulation,e.standalone,e.signals,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery].join("|");for(const o of i)t=Math.imul(31,t)+o.charCodeAt(0)<<0;return t+=2147483648,"c"+t}(i),i})}function ff(e){return kn(e)||er(e)}function Ya(e){return null!==e}function cr(e){return oo(()=>({type:e.type,bootstrap:e.bootstrap||Nn,declarations:e.declarations||Nn,imports:e.imports||Nn,exports:e.exports||Nn,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function Kc(e,t){if(null==e)return so;const i={};for(const n in e)if(e.hasOwnProperty(n)){let o=e[n],c=o;Array.isArray(o)&&(c=o[1],o=o[0]),i[o]=n,t&&(t[o]=c)}return i}function mt(e){return oo(()=>{const t=vs(e);return Oh(t),t})}function ur(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,standalone:!0===e.standalone,onDestroy:e.type.prototype.ngOnDestroy||null}}function kn(e){return e[Xa]||null}function er(e){return e[nd]||null}function tr(e){return e[Wc]||null}function Pr(e,t){const i=e[cf]||null;if(!i&&!0===t)throw new Error(`Type ${jn(e)} does not have '\u0275mod' property.`);return i}function vs(e){const t={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:t,inputTransforms:null,inputConfig:e.inputs||so,exportAs:e.exportAs||null,standalone:!0===e.standalone,signals:!0===e.signals,selectors:e.selectors||Nn,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:Kc(e.inputs,t),outputs:Kc(e.outputs)}}function Oh(e){e.features?.forEach(t=>t(e))}function Ja(e,t){if(!e)return null;const i=t?tr:ff;return()=>("function"==typeof e?e():e).map(n=>i(n)).filter(Ya)}const Di=0,Dt=1,nn=2,si=3,Yr=4,wt=5,hi=6,Qa=7,_i=8,Mo=9,Si=10,Jt=11,_a=12,ld=13,Hs=14,Ri=15,va=16,Wo=17,Eo=18,Jc=19,Lh=20,ao=21,Xo=22,Xl=23,Yl=24,Mn=25,el=1,ud=2,Yo=7,tl=9,vr=11;function Kr(e){return Array.isArray(e)&&"object"==typeof e[el]}function jr(e){return Array.isArray(e)&&!0===e[el]}function Qc(e){return 0!=(4&e.flags)}function ya(e){return e.componentOffset>-1}function eu(e){return 1==(1&e.flags)}function pi(e){return!!e.template}function Rh(e){return 0!=(512&e[nn])}function nl(e,t){return e.hasOwnProperty(qo)?e[qo]:null}let g=Kn.WeakRef??class ec{constructor(t){this.ref=t}deref(){return this.ref}},_=0,x=null,C=!1;function D(e){const t=x;return x=e,t}class S{constructor(){this.id=_++,this.ref=function l(e){return new g(e)}(this),this.producers=new Map,this.consumers=new Map,this.trackingVersion=0,this.valueVersion=0}consumerPollProducersForChange(){for(const[t,i]of this.producers){const n=i.producerNode.deref();if(null!=n&&i.atTrackingVersion===this.trackingVersion){if(n.producerPollStatus(i.seenValueVersion))return!0}else this.producers.delete(t),n?.consumers.delete(this.id)}return!1}producerMayHaveChanged(){const t=C;C=!0;try{for(const[i,n]of this.consumers){const o=n.consumerNode.deref();null!=o&&o.trackingVersion===n.atTrackingVersion?o.onConsumerDependencyMayHaveChanged():(this.consumers.delete(i),o?.producers.delete(this.id))}}finally{C=t}}producerAccessed(){if(C)throw new Error("");if(null===x)return;let t=x.producers.get(this.id);void 0===t?(t={consumerNode:x.ref,producerNode:this.ref,seenValueVersion:this.valueVersion,atTrackingVersion:x.trackingVersion},x.producers.set(this.id,t),this.consumers.set(x.id,t)):(t.seenValueVersion=this.valueVersion,t.atTrackingVersion=x.trackingVersion)}get hasProducers(){return this.producers.size>0}get producerUpdatesAllowed(){return!1!==x?.consumerAllowSignalWrites}producerPollStatus(t){return this.valueVersion!==t||(this.onProducerUpdateValueVersion(),this.valueVersion!==t)}}let re=null;const Me=()=>{};class we extends S{constructor(t,i,n){super(),this.watch=t,this.schedule=i,this.dirty=!1,this.cleanupFn=Me,this.registerOnCleanup=o=>{this.cleanupFn=o},this.consumerAllowSignalWrites=n}notify(){this.dirty||this.schedule(this),this.dirty=!0}onConsumerDependencyMayHaveChanged(){this.notify()}onProducerUpdateValueVersion(){}run(){if(this.dirty=!1,0!==this.trackingVersion&&!this.consumerPollProducersForChange())return;const t=D(this);this.trackingVersion++;try{this.cleanupFn(),this.cleanupFn=Me,this.watch(this.registerOnCleanup)}finally{D(t)}}cleanup(){this.cleanupFn()}}class Se{constructor(t,i,n){this.previousValue=t,this.currentValue=i,this.firstChange=n}isFirstChange(){return this.firstChange}}function Ee(){return Fe}function Fe(e){return e.type.prototype.ngOnChanges&&(e.setInput=Oe),ot}function ot(){const e=Be(this),t=e?.current;if(t){const i=e.previous;if(i===so)e.previous=t;else for(let n in t)i[n]=t[n];e.current=null,this.ngOnChanges(t)}}function Oe(e,t,i,n){const o=this.declaredInputs[i],c=Be(e)||function it(e,t){return e[Ze]=t}(e,{previous:so,current:null}),f=c.current||(c.current={}),y=c.previous,E=y[o];f[o]=new Se(E&&E.currentValue,t,y===so),e[n]=t}Ee.ngInherit=!0;const Ze="__ngSimpleChanges__";function Be(e){return e[Ze]||null}const tt=function(e,t,i){},Qe="svg";function vt(e){for(;Array.isArray(e);)e=e[Di];return e}function Et(e,t){return vt(t[e])}function At(e,t){return vt(t[e.index])}function un(e,t){return e.data[t]}function Pt(e,t){return e[t]}function dn(e,t){const i=t[e];return Kr(i)?i:i[Di]}function Ii(e,t){return null==t?null:e[t]}function dr(e){e[Wo]=0}function So(e){1024&e[nn]||(e[nn]|=1024,ai(e,1))}function Ko(e){1024&e[nn]&&(e[nn]&=-1025,ai(e,-1))}function ai(e,t){let i=e[si];if(null===i)return;i[wt]+=t;let n=i;for(i=i[si];null!==i&&(1===t&&1===n[wt]||-1===t&&0===n[wt]);)i[wt]+=t,n=i,i=i[si]}const Nt={lFrame:m1(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function tc(){return Nt.bindingsEnabled}function Qr(){return null!==Nt.skipHydrationRootTNode}function lt(){return Nt.lFrame.lView}function Bn(){return Nt.lFrame.tView}function ce(e){return Nt.lFrame.contextLView=e,e[_i]}function le(e){return Nt.lFrame.contextLView=null,e}function yr(){let e=Bm();for(;null!==e&&64===e.type;)e=e.parent;return e}function Bm(){return Nt.lFrame.currentTNode}function Jo(e,t){const i=Nt.lFrame;i.currentTNode=e,i.isParent=t}function qs(){return Nt.lFrame.isParent}function fd(){Nt.lFrame.isParent=!1}function lo(){const e=Nt.lFrame;let t=e.bindingRootIndex;return-1===t&&(t=e.bindingRootIndex=e.tView.bindingStartIndex),t}function ol(){return Nt.lFrame.bindingIndex}function ba(){return Nt.lFrame.bindingIndex++}function Io(e){const t=Nt.lFrame,i=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,i}function nc(e,t){const i=Nt.lFrame;i.bindingIndex=i.bindingRootIndex=e,al(t)}function al(e){Nt.lFrame.currentDirectiveIndex=e}function g1(){return Nt.lFrame.currentQueryIndex}function Um(e){Nt.lFrame.currentQueryIndex=e}function fx(e){const t=e[Dt];return 2===t.type?t.declTNode:1===t.type?e[hi]:null}function jm(e,t,i){if(i&kt.SkipSelf){let o=t,c=e;for(;!(o=o.parent,null!==o||i&kt.Host||(o=fx(c),null===o||(c=c[Hs],10&o.type))););if(null===o)return!1;t=o,e=c}const n=Nt.lFrame=bs();return n.currentTNode=t,n.lView=e,!0}function Ef(e){const t=bs(),i=e[Dt];Nt.lFrame=t,t.currentTNode=i.firstChild,t.lView=e,t.tView=i,t.contextLView=e,t.bindingIndex=i.bindingStartIndex,t.inI18n=!1}function bs(){const e=Nt.lFrame,t=null===e?null:e.child;return null===t?m1(e):t}function m1(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function _1(){const e=Nt.lFrame;return Nt.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const Fi=_1;function Bt(){const e=_1();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function gi(){return Nt.lFrame.selectedIndex}function oc(e){Nt.lFrame.selectedIndex=e}function Ni(){const e=Nt.lFrame;return un(e.tView,e.selectedIndex)}function xt(){Nt.lFrame.currentNamespace=Qe}function eo(){!function Bh(){Nt.lFrame.currentNamespace=null}()}let Df=!0;function ou(){return Df}function ll(e){Df=e}function Sf(e,t){for(let i=t.directiveStart,n=t.directiveEnd;i<n;i++){const c=e.data[i].type.prototype,{ngAfterContentInit:f,ngAfterContentChecked:y,ngAfterViewInit:E,ngAfterViewChecked:A,ngOnDestroy:z}=c;f&&(e.contentHooks??=[]).push(-i,f),y&&((e.contentHooks??=[]).push(i,y),(e.contentCheckHooks??=[]).push(i,y)),E&&(e.viewHooks??=[]).push(-i,E),A&&((e.viewHooks??=[]).push(i,A),(e.viewCheckHooks??=[]).push(i,A)),null!=z&&(e.destroyHooks??=[]).push(i,z)}}function gd(e,t,i){au(e,t,3,i)}function Vh(e,t,i,n){(3&e[nn])===i&&au(e,t,i,n)}function su(e,t){let i=e[nn];(3&i)===t&&(i&=8191,i+=1,e[nn]=i)}function au(e,t,i,n){const c=n??-1,f=t.length-1;let y=0;for(let E=void 0!==n?65535&e[Wo]:0;E<f;E++)if("number"==typeof t[E+1]){if(y=t[E],null!=n&&y>=n)break}else t[E]<0&&(e[Wo]+=65536),(y<c||-1==c)&&(Hm(e,i,t,E),e[Wo]=(4294901760&e[Wo])+E+2),E++}function wa(e,t){tt(4,e,t);const i=D(null);try{t.call(e)}finally{D(i),tt(5,e,t)}}function Hm(e,t,i,n){const o=i[n]<0,c=i[n+1],y=e[o?-i[n]:i[n]];o?e[nn]>>13<e[Wo]>>16&&(3&e[nn])===t&&(e[nn]+=8192,wa(y,c)):wa(y,c)}const lu=-1;class cl{constructor(t,i,n){this.factory=t,this.resolving=!1,this.canSeeViewProviders=i,this.injectImpl=n}}function uu(e){return e!==lu}function uo(e){return 32767&e}function jh(e,t){let i=function mx(e){return e>>16}(e),n=t;for(;i>0;)n=n[Hs],i--;return n}let If=!0;function $h(e){const t=If;return If=e,t}const qm=255,Zm=5;let y1=0;const Zs={};function Af(e,t){const i=Wm(e,t);if(-1!==i)return i;const n=t[Dt];n.firstCreatePass&&(e.injectorIndex=t.length,Pf(n.data,e),Pf(t,null),Pf(n.blueprint,null));const o=ac(e,t),c=e.injectorIndex;if(uu(o)){const f=uo(o),y=jh(o,t),E=y[Dt].data;for(let A=0;A<8;A++)t[c+A]=y[f+A]|E[f+A]}return t[c+8]=o,c}function Pf(e,t){e.push(0,0,0,0,0,0,0,0,t)}function Wm(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function ac(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let i=0,n=null,o=t;for(;null!==o;){if(n=Km(o),null===n)return lu;if(i++,o=o[Hs],-1!==n.injectorIndex)return n.injectorIndex|i<<16}return lu}function Hh(e,t,i){!function _x(e,t,i){let n;"string"==typeof i?n=i.charCodeAt(0)||0:i.hasOwnProperty(ma)&&(n=i[ma]),null==n&&(n=i[ma]=y1++);const o=n&qm;t.data[e+(o>>Zm)]|=1<<o}(e,t,i)}function kf(e,t,i){if(i&kt.Optional||void 0!==e)return e;Ir()}function $r(e,t,i,n){if(i&kt.Optional&&void 0===n&&(n=null),!(i&(kt.Self|kt.Host))){const o=e[Mo],c=Ur(void 0);try{return o?o.get(t,n,i&kt.Optional):Ju(t,n,i&kt.Optional)}finally{Ur(c)}}return kf(n,0,i)}function Of(e,t,i,n=kt.Default,o){if(null!==e){if(2048&t[nn]&&!(n&kt.Self)){const f=function du(e,t,i,n,o){let c=e,f=t;for(;null!==c&&null!==f&&2048&f[nn]&&!(512&f[nn]);){const y=Ym(c,f,i,n|kt.Self,Zs);if(y!==Zs)return y;let E=c.parent;if(!E){const A=f[Lh];if(A){const z=A.get(i,Zs,n);if(z!==Zs)return z}E=Km(f),f=f[Hs]}c=E}return o}(e,t,i,n,Zs);if(f!==Zs)return f}const c=Ym(e,t,i,n,Zs);if(c!==Zs)return c}return $r(t,i,n,o)}function Ym(e,t,i,n,o){const c=function Gh(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(ma)?e[ma]:void 0;return"number"==typeof t?t>=0?t&qm:vx:t}(i);if("function"==typeof c){if(!jm(t,e,n))return n&kt.Host?kf(o,0,n):$r(t,i,n,o);try{let f;if(f=c(n),null!=f||n&kt.Optional)return f;Ir()}finally{Fi()}}else if("number"==typeof c){let f=null,y=Wm(e,t),E=lu,A=n&kt.Host?t[Ri][hi]:null;for((-1===y||n&kt.SkipSelf)&&(E=-1===y?ac(e,t):t[y+8],E!==lu&&ts(n,!1)?(f=t[Dt],y=uo(E),t=jh(E,t)):y=-1);-1!==y;){const z=t[Dt];if(es(c,y,z.data)){const H=Ca(y,t,i,f,n,A);if(H!==Zs)return H}E=t[y+8],E!==lu&&ts(n,t[Dt].data[y+8]===A)&&es(c,y,t)?(f=z,y=uo(E),t=jh(E,t)):y=-1}}return o}function Ca(e,t,i,n,o,c){const f=t[Dt],y=f.data[e+8],z=Lf(y,f,i,null==n?ya(y)&&If:n!=f&&0!=(3&y.type),o&kt.Host&&c===y);return null!==z?Qo(t,f,z,y):Zs}function Lf(e,t,i,n,o){const c=e.providerIndexes,f=t.data,y=1048575&c,E=e.directiveStart,z=c>>20,oe=o?y+z:e.directiveEnd;for(let pe=n?y:y+z;pe<oe;pe++){const Ie=f[pe];if(pe<E&&i===Ie||pe>=E&&Ie.type===i)return pe}if(o){const pe=f[E];if(pe&&pi(pe)&&pe.type===i)return E}return null}function Qo(e,t,i,n){let o=e[i];const c=t.data;if(function Uh(e){return e instanceof cl}(o)){const f=o;f.resolving&&function Oi(e,t){const i=t?`. Dependency path: ${t.join(" > ")} > ${e}`:"";throw new ut(-200,`Circular dependency in DI detected for ${e}${i}`)}(function mn(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():Zt(e)}(c[i]));const y=$h(f.canSeeViewProviders);f.resolving=!0;const A=f.injectImpl?Ur(f.injectImpl):null;jm(e,n,kt.Default);try{o=e[i]=f.factory(void 0,c,e,n),t.firstCreatePass&&i>=n.directiveStart&&function v1(e,t,i){const{ngOnChanges:n,ngOnInit:o,ngDoCheck:c}=t.type.prototype;if(n){const f=Fe(t);(i.preOrderHooks??=[]).push(e,f),(i.preOrderCheckHooks??=[]).push(e,f)}o&&(i.preOrderHooks??=[]).push(0-e,o),c&&((i.preOrderHooks??=[]).push(e,c),(i.preOrderCheckHooks??=[]).push(e,c))}(i,c[i],t)}finally{null!==A&&Ur(A),$h(y),f.resolving=!1,Fi()}}return o}function es(e,t,i){return!!(i[t+(e>>Zm)]&1<<e)}function ts(e,t){return!(e&kt.Self||e&kt.Host&&t)}class to{constructor(t,i){this._tNode=t,this._lView=i}get(t,i,n){return Of(this._tNode,this._lView,t,Gc(n),i)}}function vx(){return new to(yr(),lt())}function nr(e){return oo(()=>{const t=e.prototype.constructor,i=t[qo]||Ms(t),n=Object.prototype;let o=Object.getPrototypeOf(e.prototype).constructor;for(;o&&o!==n;){const c=o[qo]||Ms(o);if(c&&c!==i)return c;o=Object.getPrototypeOf(o)}return c=>new c})}function Ms(e){return ja(e)?()=>{const t=Ms(Gt(e));return t&&t()}:nl(e)}function Km(e){const t=e[Dt],i=t.type;return 2===i?t.declTNode:1===i?e[hi]:null}function hu(e){return function Xm(e,t){if("class"===t)return e.classes;if("style"===t)return e.styles;const i=e.attrs;if(i){const n=i.length;let o=0;for(;o<n;){const c=i[o];if(uf(c))break;if(0===c)o+=2;else if("number"==typeof c)for(o++;o<n&&"string"==typeof i[o];)o++;else{if(c===t)return i[o+1];o+=2}}}return null}(yr(),e)}const ul="__parameters__";function Ma(e,t,i){return oo(()=>{const n=function cc(e){return function(...i){if(e){const n=e(...i);for(const o in n)this[o]=n[o]}}}(t);function o(...c){if(this instanceof o)return n.apply(this,c),this;const f=new o(...c);return y.annotation=f,y;function y(E,A,z){const H=E.hasOwnProperty(ul)?E[ul]:Object.defineProperty(E,ul,{value:[]})[ul];for(;H.length<=z;)H.push(null);return(H[z]=H[z]||[]).push(f),E}}return i&&(o.prototype=Object.create(i.prototype)),o.prototype.ngMetadataName=e,o.annotationCls=o,o})}function ho(e,t){e.forEach(i=>Array.isArray(i)?ho(i,t):t(i))}function Ws(e,t,i){t>=e.length?e.push(i):e.splice(t,0,i)}function Po(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function Hr(e,t){const i=[];for(let n=0;n<e;n++)i.push(t);return i}function Rr(e,t,i){let n=gu(e,t);return n>=0?e[1|n]=i:(n=~n,function Lr(e,t,i,n){let o=e.length;if(o==t)e.push(i,n);else if(1===o)e.push(n,e[0]),e[0]=i;else{for(o--,e.push(e[o-1],e[o]);o>t;)e[o]=e[o-2],o--;e[t]=i,e[t+1]=n}}(e,n,t,i)),n}function Wh(e,t){const i=gu(e,t);if(i>=0)return e[1|i]}function gu(e,t){return function E1(e,t,i){let n=0,o=e.length>>i;for(;o!==n;){const c=n+(o-n>>1),f=e[c<<i];if(t===f)return c<<i;f>t?o=c:n=c+1}return~(o<<i)}(e,t,1)}const zf=qc(Ma("Optional"),8),Bf=qc(Ma("SkipSelf"),4);function hl(e){return 128==(128&e.flags)}var ni=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}(ni||{});const Wf=/^>|^->|<!--|-->|--!>|<!-$/g,V1=/(<|>)/,Xf="\u200b$1\u200b";const vu=new Map;let U1=0;const l_="__ngContext__";function Fr(e,t){Kr(t)?(e[l_]=t[Jc],function Qh(e){vu.set(e[Jc],e)}(t)):e[l_]=t}let c_;function ng(e,t){return c_(e,t)}function tp(e){const t=e[si];return jr(t)?t[si]:t}function u_(e){return q1(e[_a])}function d_(e){return q1(e[Yr])}function q1(e){for(;null!==e&&!jr(e);)e=e[Yr];return e}function Ed(e,t,i,n,o){if(null!=n){let c,f=!1;jr(n)?c=n:Kr(n)&&(f=!0,n=n[Di]);const y=vt(n);0===e&&null!==i?null==o?Y1(t,i,y):xu(t,i,y,o||null,!0):1===e&&null!==i?xu(t,i,y,o||null,!0):2===e?function hg(e,t,i){const n=br(e,t);n&&function cg(e,t,i,n){e.removeChild(t,i,n)}(e,n,t,i)}(t,y,f):3===e&&t.destroyNode(y),null!=c&&function Ux(e,t,i,n,o){const c=i[Yo];c!==vt(i)&&Ed(t,e,n,c,o);for(let y=vr;y<i.length;y++){const E=i[y];Sd(E[Dt],E,e,t,n,c)}}(t,e,c,i,o)}}function Td(e,t){return e.createComment(function Jh(e){return e.replace(Wf,t=>t.replace(V1,Xf))}(t))}function yu(e,t,i){return e.createElement(t,i)}function h_(e,t){const i=e[tl],n=i.indexOf(t);Ko(t),i.splice(n,1)}function og(e,t){if(e.length<=vr)return;const i=vr+t,n=e[i];if(n){const o=n[va];null!==o&&o!==e&&h_(o,n),t>0&&(e[i-1][Yr]=n[Yr]);const c=Po(e,vr+t);!function zx(e,t){Sd(e,t,t[Jt],2,null,null),t[Di]=null,t[hi]=null}(n[Dt],n);const f=c[Eo];null!==f&&f.detachView(c[Dt]),n[si]=null,n[Yr]=null,n[nn]&=-129}return n}function sg(e,t){if(!(256&t[nn])){const i=t[Jt];t[Xl]?.destroy(),t[Yl]?.destroy(),i.destroyNode&&Sd(e,t,i,3,null,null),function ip(e){let t=e[_a];if(!t)return ag(e[Dt],e);for(;t;){let i=null;if(Kr(t))i=t[_a];else{const n=t[vr];n&&(i=n)}if(!i){for(;t&&!t[Yr]&&t!==e;)Kr(t)&&ag(t[Dt],t),t=t[si];null===t&&(t=e),Kr(t)&&ag(t[Dt],t),i=t&&t[Yr]}t=i}}(t)}}function ag(e,t){if(!(256&t[nn])){t[nn]&=-129,t[nn]|=256,function X1(e,t){let i;if(null!=e&&null!=(i=e.destroyHooks))for(let n=0;n<i.length;n+=2){const o=t[i[n]];if(!(o instanceof cl)){const c=i[n+1];if(Array.isArray(c))for(let f=0;f<c.length;f+=2){const y=o[c[f]],E=c[f+1];tt(4,y,E);try{E.call(y)}finally{tt(5,y,E)}}else{tt(4,o,c);try{c.call(o)}finally{tt(5,o,c)}}}}}(e,t),function W1(e,t){const i=e.cleanup,n=t[Qa];if(null!==i)for(let c=0;c<i.length-1;c+=2)if("string"==typeof i[c]){const f=i[c+3];f>=0?n[f]():n[-f].unsubscribe(),c+=2}else i[c].call(n[i[c+1]]);null!==n&&(t[Qa]=null);const o=t[ao];if(null!==o){t[ao]=null;for(let c=0;c<o.length;c++)(0,o[c])()}}(e,t),1===t[Dt].type&&t[Jt].destroy();const i=t[va];if(null!==i&&jr(t[si])){i!==t[si]&&h_(i,t);const n=t[Eo];null!==n&&n.detachView(e)}!function s_(e){vu.delete(e[Jc])}(t)}}function lg(e,t,i){return function p_(e,t,i){let n=t;for(;null!==n&&40&n.type;)n=(t=n).parent;if(null===n)return i[Di];{const{componentOffset:o}=n;if(o>-1){const{encapsulation:c}=e.data[n.directiveStart+o];if(c===Qi.None||c===Qi.Emulated)return null}return At(n,i)}}(e,t.parent,i)}function xu(e,t,i,n,o){e.insertBefore(t,i,n,o)}function Y1(e,t,i){e.appendChild(t,i)}function f_(e,t,i,n,o){null!==n?xu(e,t,i,n,o):Y1(e,t,i)}function br(e,t){return e.parentNode(t)}function bu(e,t,i){return g_(e,t,i)}let ug,w_,pg,g_=function Dd(e,t,i){return 40&e.type?At(e,i):null};function dg(e,t,i,n){const o=lg(e,n,t),c=t[Jt],y=bu(n.parent||t[hi],n,t);if(null!=o)if(Array.isArray(i))for(let E=0;E<i.length;E++)f_(c,o,i[E],y,!1);else f_(c,o,i,y,!1);void 0!==ug&&ug(c,n,t,i,o)}function sp(e,t){if(null!==t){const i=t.type;if(3&i)return At(t,e);if(4&i)return m_(-1,e[t.index]);if(8&i){const n=t.child;if(null!==n)return sp(e,n);{const o=e[t.index];return jr(o)?m_(-1,o):vt(o)}}if(32&i)return ng(t,e)()||vt(e[t.index]);{const n=J1(e,t);return null!==n?Array.isArray(n)?n[0]:sp(tp(e[Ri]),n):sp(e,t.next)}}return null}function J1(e,t){return null!==t?e[Ri][hi].projection[t.projection]:null}function m_(e,t){const i=vr+e+1;if(i<t.length){const n=t[i],o=n[Dt].firstChild;if(null!==o)return sp(n,o)}return t[Yo]}function __(e,t,i,n,o,c,f){for(;null!=i;){const y=n[i.index],E=i.type;if(f&&0===t&&(y&&Fr(vt(y),n),i.flags|=2),32!=(32&i.flags))if(8&E)__(e,t,i.child,n,o,c,!1),Ed(t,e,o,y,c);else if(32&E){const A=ng(i,n);let z;for(;z=A();)Ed(t,e,o,z,c);Ed(t,e,o,y,c)}else 16&E?v_(e,t,n,i,o,c):Ed(t,e,o,y,c);i=f?i.projectionNext:i.next}}function Sd(e,t,i,n,o,c){__(i,n,e.firstChild,t,o,c,!1)}function v_(e,t,i,n,o,c){const f=i[Ri],E=f[hi].projection[n.projection];if(Array.isArray(E))for(let A=0;A<E.length;A++)Ed(t,e,o,E[A],c);else{let A=E;const z=f[si];hl(n)&&(A.flags|=128),__(e,t,A,z,o,c,!0)}}function e0(e,t,i){""===i?e.removeAttribute(t,"class"):e.setAttribute(t,"class",i)}function t0(e,t,i){const{mergedAttrs:n,classes:o,styles:c}=i;null!==n&&Xc(e,t,n),null!==o&&e0(e,t,o),null!==c&&function $x(e,t,i){e.setAttribute(t,"style",i)}(e,t,c)}function T_(e){return function C_(){if(void 0===pg&&(pg=null,Kn.trustedTypes))try{pg=Kn.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return pg}()?.createScriptURL(e)||e}class Zn{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${Rl})`}}function fl(e){return e instanceof Zn?e.changingThisBreaksApplicationSecurity:e}function cp(e,t){const i=function Gx(e){return e instanceof Zn&&e.getTypeName()||null}(e);if(null!=i&&i!==t){if("ResourceURL"===i&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${i} (see ${Rl})`)}return i===t}const s0=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var Cu=function(e){return e[e.NONE=0]="NONE",e[e.HTML=1]="HTML",e[e.STYLE=2]="STYLE",e[e.SCRIPT=3]="SCRIPT",e[e.URL=4]="URL",e[e.RESOURCE_URL=5]="RESOURCE_URL",e}(Cu||{});function Da(e){const t=gl();return t?t.sanitize(Cu.URL,e)||"":cp(e,"URL")?fl(e):function kd(e){return(e=String(e)).match(s0)?e:"unsafe:"+e}(Zt(e))}function k_(e){const t=gl();if(t)return T_(t.sanitize(Cu.RESOURCE_URL,e)||"");if(cp(e,"ResourceURL"))return T_(fl(e));throw new ut(904,!1)}function gl(){const e=lt();return e&&e[Si].sanitizer}class Ot{constructor(t,i){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof i?this.__NG_ELEMENT_ID__=i:void 0!==i&&(this.\u0275prov=Lt({token:this,providedIn:i.providedIn||"root",factory:i.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}const Od=new Ot("ENVIRONMENT_INITIALIZER"),Ts=new Ot("INJECTOR",-1),xg=new Ot("INJECTOR_DEF_TYPES");class dc{get(t,i=wn){if(i===wn){const n=new Error(`NullInjectorError: No provider for ${jn(t)}!`);throw n.name="NullInjectorError",n}return i}}function v0(...e){return{\u0275providers:dp(0,e),\u0275fromNgModule:!0}}function dp(e,...t){const i=[],n=new Set;let o;const c=f=>{i.push(f)};return ho(t,f=>{const y=f;Mu(y,c,[],n)&&(o||=[],o.push(y))}),void 0!==o&&O_(o,c),i}function O_(e,t){for(let i=0;i<e.length;i++){const{ngModule:n,providers:o}=e[i];R_(o,c=>{t(c,n)})}}function Mu(e,t,i,n){if(!(e=Gt(e)))return!1;let o=null,c=Uc(e);const f=!c&&kn(e);if(c||f){if(f&&!f.standalone)return!1;o=e}else{const E=e.ngModule;if(c=Uc(E),!c)return!1;o=E}const y=n.has(o);if(f){if(y)return!1;if(n.add(o),f.dependencies){const E="function"==typeof f.dependencies?f.dependencies():f.dependencies;for(const A of E)Mu(A,t,i,n)}}else{if(!c)return!1;{if(null!=c.imports&&!y){let A;n.add(o);try{ho(c.imports,z=>{Mu(z,t,i,n)&&(A||=[],A.push(z))})}finally{}void 0!==A&&O_(A,t)}if(!y){const A=nl(o)||(()=>new o);t({provide:o,useFactory:A,deps:Nn},o),t({provide:xg,useValue:o,multi:!0},o),t({provide:Od,useValue:()=>Ft(o),multi:!0},o)}const E=c.providers;if(null!=E&&!y){const A=e;R_(E,z=>{t(z,A)})}}}return o!==e&&void 0!==e.providers}function R_(e,t){for(let i of e)Nc(i)&&(i=i.\u0275providers),Array.isArray(i)?R_(i,t):t(i)}const Qx=zn({provide:String,useValue:zn});function F_(e){return null!==e&&"object"==typeof e&&Qx in e}function Ds(e){return"function"==typeof e}const hp=new Ot("Set Injector scope."),bg={},b0={};let N_;function Rd(){return void 0===N_&&(N_=new dc),N_}class ns{}class pc extends ns{get destroyed(){return this._destroyed}constructor(t,i,n,o){super(),this.parent=i,this.source=n,this.scopes=o,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,z_(t,f=>this.processProvider(f)),this.records.set(Ts,fc(void 0,this)),o.has("environment")&&this.records.set(ns,fc(void 0,this));const c=this.records.get(hp);null!=c&&"string"==typeof c.value&&this.scopes.add(c.value),this.injectorDefTypes=new Set(this.get(xg.multi,Nn,kt.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const i of this._ngOnDestroyHooks)i.ngOnDestroy();const t=this._onDestroyHooks;this._onDestroyHooks=[];for(const i of t)i()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(t){return this.assertNotDestroyed(),this._onDestroyHooks.push(t),()=>this.removeOnDestroy(t)}runInContext(t){this.assertNotDestroyed();const i=ga(this),n=Ur(void 0);try{return t()}finally{ga(i),Ur(n)}}get(t,i=wn,n=kt.Default){if(this.assertNotDestroyed(),t.hasOwnProperty(jl))return t[jl](this);n=Gc(n);const c=ga(this),f=Ur(void 0);try{if(!(n&kt.SkipSelf)){let E=this.records.get(t);if(void 0===E){const A=function Eu(e){return"function"==typeof e||"object"==typeof e&&e instanceof Ot}(t)&&Co(t);E=A&&this.injectableDefInScope(A)?fc(Sa(t),bg):null,this.records.set(t,E)}if(null!=E)return this.hydrate(t,E)}return(n&kt.Self?Rd():this.parent).get(t,i=n&kt.Optional&&i===wn?null:i)}catch(y){if("NullInjectorError"===y.name){if((y[Hc]=y[Hc]||[]).unshift(jn(t)),c)throw y;return function Vl(e,t,i,n){const o=e[Hc];throw t[Qu]&&o.unshift(t[Qu]),e.message=function Sh(e,t,i,n=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let o=jn(t);if(Array.isArray(t))o=t.map(jn).join(" -> ");else if("object"==typeof t){let c=[];for(let f in t)if(t.hasOwnProperty(f)){let y=t[f];c.push(f+":"+("string"==typeof y?JSON.stringify(y):jn(y)))}o=`{${c.join(", ")}}`}return`${i}${n?"("+n+")":""}[${o}]: ${e.replace(lf,"\n  ")}`}("\n"+e.message,o,i,n),e.ngTokenPath=o,e[Hc]=null,e}(y,t,"R3InjectorError",this.source)}throw y}finally{Ur(f),ga(c)}}resolveInjectorInitializers(){const t=ga(this),i=Ur(void 0);try{const o=this.get(Od.multi,Nn,kt.Self);for(const c of o)c()}finally{ga(t),Ur(i)}}toString(){const t=[],i=this.records;for(const n of i.keys())t.push(jn(n));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new ut(205,!1)}processProvider(t){let i=Ds(t=Gt(t))?t:Gt(t&&t.provide);const n=function C0(e){return F_(e)?fc(void 0,e.useValue):fc(pp(e),bg)}(t);if(Ds(t)||!0!==t.multi)this.records.get(i);else{let o=this.records.get(i);o||(o=fc(void 0,bg,!0),o.factory=()=>td(o.multi),this.records.set(i,o)),i=t,o.multi.push(t)}this.records.set(i,n)}hydrate(t,i){return i.value===bg&&(i.value=b0,i.value=i.factory()),"object"==typeof i.value&&i.value&&function M0(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(i.value)&&this._ngOnDestroyHooks.add(i.value),i.value}injectableDefInScope(t){if(!t.providedIn)return!1;const i=Gt(t.providedIn);return"string"==typeof i?"any"===i||this.scopes.has(i):this.injectorDefTypes.has(i)}removeOnDestroy(t){const i=this._onDestroyHooks.indexOf(t);-1!==i&&this._onDestroyHooks.splice(i,1)}}function Sa(e){const t=Co(e),i=null!==t?t.factory:nl(e);if(null!==i)return i;if(e instanceof Ot)throw new ut(204,!1);if(e instanceof Function)return function w0(e){const t=e.length;if(t>0)throw Hr(t,"?"),new ut(204,!1);const i=function Vc(e){return e&&(e[Ga]||e[Yu])||null}(e);return null!==i?()=>i.factory(e):()=>new e}(e);throw new ut(204,!1)}function pp(e,t,i){let n;if(Ds(e)){const o=Gt(e);return nl(o)||Sa(o)}if(F_(e))n=()=>Gt(e.useValue);else if(function x0(e){return!(!e||!e.useFactory)}(e))n=()=>e.useFactory(...td(e.deps||[]));else if(function y0(e){return!(!e||!e.useExisting)}(e))n=()=>Ft(Gt(e.useExisting));else{const o=Gt(e&&(e.useClass||e.provide));if(!function eb(e){return!!e.deps}(e))return nl(o)||Sa(o);n=()=>new o(...td(e.deps))}return n}function fc(e,t,i=!1){return{factory:e,value:t,multi:i?[]:void 0}}function z_(e,t){for(const i of e)Array.isArray(i)?z_(i,t):i&&Nc(i)?z_(i.\u0275providers,t):t(i)}const Ks=new Ot("AppId",{providedIn:"root",factory:()=>tb}),tb="ng",Fd=new Ot("Platform Initializer"),Js=new Ot("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),fp=new Ot("CSP nonce",{providedIn:"root",factory:()=>function Ta(){if(void 0!==w_)return w_;if(typeof document<"u")return document;throw new ut(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let Sg=(e,t,i)=>null;function _p(e,t,i=!1){return Sg(e,t,i)}class T0{}class D0{}class mc{resolveComponentFactory(t){throw function S0(e){const t=Error(`No component factory found for ${jn(e)}.`);return t.ngComponent=e,t}(t)}}let rs=(()=>{class t{}return t.NULL=new mc,t})();function _c(){return _l(yr(),lt())}function _l(e,t){return new Bi(At(e,t))}let Bi=(()=>{class t{constructor(n){this.nativeElement=n}}return t.__NG_ELEMENT_ID__=_c,t})();function I0(e){return e instanceof Bi?e.nativeElement:e}class G_{}let Ss=(()=>{class t{constructor(){this.destroyNode=null}}return t.__NG_ELEMENT_ID__=()=>function lb(){const e=lt(),i=dn(yr().index,e);return(Kr(i)?i:e)[Jt]}(),t})(),A0=(()=>{var e;class t{}return(e=t).\u0275prov=Lt({token:e,providedIn:"root",factory:()=>null}),t})();class jd{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const P0=new jd("16.2.0"),kg={};function Lg(e,t=null,i=null,n){const o=Qs(e,t,i,n);return o.resolveInjectorInitializers(),o}function Qs(e,t=null,i=null,n,o=new Set){const c=[i||Nn,v0(e)];return n=n||("object"==typeof e?void 0:jn(e)),new pc(c,t||Rd(),n||null,o)}let fo=(()=>{var e;class t{static create(n,o){if(Array.isArray(n))return Lg({name:""},o,n,"");{const c=n.name??"";return Lg({name:c},n.parent,n.providers,c)}}}return(e=t).THROW_IF_NOT_FOUND=wn,e.NULL=new dc,e.\u0275prov=Lt({token:e,providedIn:"any",factory:()=>Ft(Ts)}),e.__NG_ELEMENT_ID__=-1,t})();function Rg(e){return e.ownerDocument.defaultView}function Ia(e){return e instanceof Function?e():e}let Fg=(()=>{var e;class t{constructor(){this.callbacks=new Set,this.deferredCallbacks=new Set,this.renderDepth=0,this.runningCallbacks=!1}begin(){if(this.runningCallbacks)throw new ut(102,!1);this.renderDepth++}end(){if(this.renderDepth--,0===this.renderDepth)try{this.runningCallbacks=!0;for(const n of this.callbacks)n.invoke()}finally{this.runningCallbacks=!1;for(const n of this.deferredCallbacks)this.callbacks.add(n);this.deferredCallbacks.clear()}}register(n){(this.runningCallbacks?this.deferredCallbacks:this.callbacks).add(n)}unregister(n){this.callbacks.delete(n),this.deferredCallbacks.delete(n)}ngOnDestroy(){this.callbacks.clear(),this.deferredCallbacks.clear()}}return(e=t).\u0275prov=Lt({token:e,providedIn:"root",factory:()=>new e}),t})();function bp(e){for(;e;){e[nn]|=64;const t=tp(e);if(Rh(e)&&!t)return e;e=t}return null}function zg(e){return e.ngOriginalError}class yc{constructor(){this._console=console}handleError(t){const i=this._findOriginalError(t);this._console.error("ERROR",t),i&&this._console.error("ORIGINAL ERROR",i)}_findOriginalError(t){let i=t&&zg(t);for(;i&&zg(i);)i=zg(i);return i||null}}const W_=new Ot("",{providedIn:"root",factory:()=>!1});class T extends S{constructor(){super(...arguments),this.consumerAllowSignalWrites=!1,this._lView=null}set lView(t){this._lView=t}onConsumerDependencyMayHaveChanged(){bp(this._lView)}onProducerUpdateValueVersion(){}get hasReadASignal(){return this.hasProducers}runInContext(t,i,n){const o=D(this);this.trackingVersion++;try{t(i,n)}finally{D(o)}}destroy(){this.trackingVersion++}}let I=null;function O(){return I??=new T,I}function R(e,t){return e[t]??O()}function B(e,t){const i=O();i.hasReadASignal&&(e[t]=I,i.lView=e,I=new T)}const V={};function w(e){K(Bn(),lt(),gi()+e,!1)}function K(e,t,i,n){if(!n)if(3==(3&t[nn])){const c=e.preOrderCheckHooks;null!==c&&gd(t,c,i)}else{const c=e.preOrderHooks;null!==c&&Vh(t,c,0,i)}oc(i)}function G(e,t=kt.Default){const i=lt();return null===i?Ft(e,t):Of(yr(),i,Gt(e),t)}function fe(e,t,i,n,o,c,f,y,E,A,z){const H=t.blueprint.slice();return H[Di]=o,H[nn]=140|n,(null!==A||e&&2048&e[nn])&&(H[nn]|=2048),dr(H),H[si]=H[Hs]=e,H[_i]=i,H[Si]=f||e&&e[Si],H[Jt]=y||e&&e[Jt],H[Mo]=E||e&&e[Mo]||null,H[hi]=c,H[Jc]=function j1(){return U1++}(),H[Xo]=z,H[Lh]=A,H[Ri]=2==t.type?e[Ri]:H,H}function _e(e,t,i,n,o){let c=e.data[t];if(null===c)c=function ve(e,t,i,n,o){const c=Bm(),f=qs(),E=e.data[t]=function dt(e,t,i,n,o,c){let f=t?t.injectorIndex:-1,y=0;return Qr()&&(y|=128),{type:i,index:n,insertBeforeIndex:null,injectorIndex:f,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:y,providerIndexes:0,value:o,attrs:c,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,f?c:c&&c.parent,i,t,n,o);return null===e.firstChild&&(e.firstChild=E),null!==c&&(f?null==c.child&&null!==E.parent&&(c.child=E):null===c.next&&(c.next=E,E.prev=c)),E}(e,t,i,n,o),function sl(){return Nt.lFrame.inI18n}()&&(c.flags|=32);else if(64&c.type){c.type=i,c.value=n,c.attrs=o;const f=function ru(){const e=Nt.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();c.injectorIndex=null===f?-1:f.injectorIndex}return Jo(c,!0),c}function Re(e,t,i,n){if(0===i)return-1;const o=t.length;for(let c=0;c<i;c++)t.push(n),e.blueprint.push(n),e.data.push(null);return o}function ke(e,t,i,n,o){const c=R(t,Xl),f=gi(),y=2&n;try{if(oc(-1),y&&t.length>Mn&&K(e,t,Mn,!1),tt(y?2:0,o),y)c.runInContext(i,n,o);else{const A=D(null);try{i(n,o)}finally{D(A)}}}finally{y&&null===t[Xl]&&B(t,Xl),oc(f),tt(y?3:1,o)}}function $e(e,t,i){if(Qc(t)){const n=D(null);try{const c=t.directiveEnd;for(let f=t.directiveStart;f<c;f++){const y=e.data[f];y.contentQueries&&y.contentQueries(1,i[f],f)}}finally{D(n)}}}function rt(e,t,i){tc()&&(function vi(e,t,i,n){const o=i.directiveStart,c=i.directiveEnd;ya(i)&&function Qn(e,t,i){const n=At(t,e),o=Ye(i);let f=16;i.signals?f=4096:i.onPush&&(f=64);const y=yl(e,fe(e,o,null,f,n,t,null,e[Si].rendererFactory.createRenderer(n,i),null,null,null));e[t.index]=y}(t,i,e.data[o+i.componentOffset]),e.firstCreatePass||Af(i,t),Fr(n,t);const f=i.initialInputs;for(let y=o;y<c;y++){const E=e.data[y],A=Qo(t,e,y,i);Fr(A,t),null!==f&&wr(0,y-o,A,E,0,f),pi(E)&&(dn(i.index,t)[_i]=Qo(t,e,y,i))}}(e,t,i,At(i,t)),64==(64&i.flags)&&Ci(e,t,i))}function Ne(e,t,i=At){const n=t.localNames;if(null!==n){let o=t.index+1;for(let c=0;c<n.length;c+=2){const f=n[c+1],y=-1===f?i(t,e):e[f];e[o++]=y}}}function Ye(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=Xe(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):t}function Xe(e,t,i,n,o,c,f,y,E,A,z){const H=Mn+n,oe=H+o,pe=function nt(e,t){const i=[];for(let n=0;n<t;n++)i.push(n<e?null:V);return i}(H,oe),Ie="function"==typeof A?A():A;return pe[Dt]={type:e,blueprint:pe,template:i,queries:null,viewQuery:y,declTNode:t,data:pe.slice().fill(null,H),bindingStartIndex:H,expandoStartIndex:oe,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof c?c():c,pipeRegistry:"function"==typeof f?f():f,firstChild:null,schemas:E,consts:Ie,incompleteFirstPass:!1,ssrId:z}}let yt=e=>null;function zt(e,t,i,n){for(let o in e)if(e.hasOwnProperty(o)){i=null===i?{}:i;const c=e[o];null===n?Xt(i,t,o,c):n.hasOwnProperty(o)&&Xt(i,t,n[o],c)}return i}function Xt(e,t,i,n){e.hasOwnProperty(i)?e[i].push(t,n):e[i]=[t,n]}function Rt(e,t,i,n,o,c,f,y){const E=At(t,i);let z,A=t.inputs;!y&&null!=A&&(z=A[n])?(Cp(e,i,z,n,o),ya(t)&&function ii(e,t){const i=dn(t,e);16&i[nn]||(i[nn]|=64)}(i,t.index)):3&t.type&&(n=function en(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(n),o=null!=f?f(o,t.value||"",n):o,c.setProperty(E,n,o))}function Vn(e,t,i,n){if(tc()){const o=null===n?null:{"":-1},c=function Yn(e,t){const i=e.directiveRegistry;let n=null,o=null;if(i)for(let c=0;c<i.length;c++){const f=i[c];if(df(t,f.selectors,!1))if(n||(n=[]),pi(f))if(null!==f.findHostDirectiveDefs){const y=[];o=o||new Map,f.findHostDirectiveDefs(f,y,o),n.unshift(...y,f),Vi(e,t,y.length)}else n.unshift(f),Vi(e,t,0);else o=o||new Map,f.findHostDirectiveDefs?.(f,n,o),n.push(f)}return null===n?null:[n,o]}(e,i);let f,y;null===c?f=y=null:[f,y]=c,null!==f&&Wn(e,t,i,f,o,y),o&&function Wi(e,t,i){if(t){const n=e.localNames=[];for(let o=0;o<t.length;o+=2){const c=i[t[o+1]];if(null==c)throw new ut(-301,!1);n.push(t[o],c)}}}(i,n,o)}i.mergedAttrs=$l(i.mergedAttrs,i.attrs)}function Wn(e,t,i,n,o,c){for(let A=0;A<n.length;A++)Hh(Af(i,t),e,n[A].type);!function Ln(e,t,i){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+i,e.providerIndexes=t}(i,e.data.length,n.length);for(let A=0;A<n.length;A++){const z=n[A];z.providersResolver&&z.providersResolver(z)}let f=!1,y=!1,E=Re(e,t,n.length,null);for(let A=0;A<n.length;A++){const z=n[A];i.mergedAttrs=$l(i.mergedAttrs,z.hostAttrs),Xi(e,i,t,E,z),Mi(E,z,o),null!==z.contentQueries&&(i.flags|=4),(null!==z.hostBindings||null!==z.hostAttrs||0!==z.hostVars)&&(i.flags|=64);const H=z.type.prototype;!f&&(H.ngOnChanges||H.ngOnInit||H.ngDoCheck)&&((e.preOrderHooks??=[]).push(i.index),f=!0),!y&&(H.ngOnChanges||H.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(i.index),y=!0),E++}!function In(e,t,i){const o=t.directiveEnd,c=e.data,f=t.attrs,y=[];let E=null,A=null;for(let z=t.directiveStart;z<o;z++){const H=c[z],oe=i?i.get(H):null,Ie=oe?oe.outputs:null;E=zt(H.inputs,z,E,oe?oe.inputs:null),A=zt(H.outputs,z,A,Ie);const Ve=null===E||null===f||Ph(t)?null:no(E,z,f);y.push(Ve)}null!==E&&(E.hasOwnProperty("class")&&(t.flags|=8),E.hasOwnProperty("style")&&(t.flags|=16)),t.initialInputs=y,t.inputs=E,t.outputs=A}(e,i,c)}function Ci(e,t,i){const n=i.directiveStart,o=i.directiveEnd,c=i.index,f=function ic(){return Nt.lFrame.currentDirectiveIndex}();try{oc(c);for(let y=n;y<o;y++){const E=e.data[y],A=t[y];al(y),(null!==E.hostBindings||0!==E.hostVars||null!==E.hostAttrs)&&Zi(E,A)}}finally{oc(-1),al(f)}}function Zi(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function Vi(e,t,i){t.componentOffset=i,(e.components??=[]).push(t.index)}function Mi(e,t,i){if(i){if(t.exportAs)for(let n=0;n<t.exportAs.length;n++)i[t.exportAs[n]]=e;pi(t)&&(i[""]=e)}}function Xi(e,t,i,n,o){e.data[n]=o;const c=o.factory||(o.factory=nl(o.type)),f=new cl(c,pi(o),G);e.blueprint[n]=f,i[n]=f,function Jn(e,t,i,n,o){const c=o.hostBindings;if(c){let f=e.hostBindingOpCodes;null===f&&(f=e.hostBindingOpCodes=[]);const y=~t.index;(function Xn(e){let t=e.length;for(;t>0;){const i=e[--t];if("number"==typeof i&&i<0)return i}return 0})(f)!=y&&f.push(y),f.push(i,n,c)}}(e,t,n,Re(e,i,o.hostVars,V),o)}function Ai(e,t,i,n,o,c){const f=At(e,t);!function Pi(e,t,i,n,o,c,f){if(null==c)e.removeAttribute(t,o,i);else{const y=null==f?Zt(c):f(c,n||"",o);e.setAttribute(t,o,y,i)}}(t[Jt],f,c,e.value,i,n,o)}function wr(e,t,i,n,o,c){const f=c[t];if(null!==f)for(let y=0;y<f.length;)hr(n,i,f[y++],f[y++],f[y++])}function hr(e,t,i,n,o){const c=D(null);try{const f=e.inputTransforms;null!==f&&f.hasOwnProperty(n)&&(o=f[n].call(t,o)),null!==e.setInput?e.setInput(t,o,i,n):t[n]=o}finally{D(c)}}function no(e,t,i){let n=null,o=0;for(;o<i.length;){const c=i[o];if(0!==c)if(5!==c){if("number"==typeof c)break;if(e.hasOwnProperty(c)){null===n&&(n=[]);const f=e[c];for(let y=0;y<f.length;y+=2)if(f[y]===t){n.push(c,f[y+1],i[o+1]);break}}o+=2}else o+=2;else o+=4}return n}function pr(e,t,i,n){return[e,!0,!1,t,null,0,n,i,null,null,null]}function Is(e,t){const i=e.contentQueries;if(null!==i)for(let n=0;n<i.length;n+=2){const c=i[n+1];if(-1!==c){const f=e.data[c];Um(i[n]),f.contentQueries(2,t[c],c)}}}function yl(e,t){return e[_a]?e[ld][Yr]=t:e[_a]=t,e[ld]=t,t}function Iu(e,t,i){Um(0);const n=D(null);try{t(e,i)}finally{D(n)}}function Y_(e){return e[Qa]||(e[Qa]=[])}function K_(e){return e.cleanup||(e.cleanup=[])}function Q_(e,t){const i=e[Mo],n=i?i.get(yc,null):null;n&&n.handleError(t)}function Cp(e,t,i,n,o){for(let c=0;c<i.length;){const f=i[c++],y=i[c++];hr(e.data[f],t[f],n,y,o)}}function ta(e,t,i){const n=Et(t,e);!function rg(e,t,i){e.setValue(t,i)}(e[Jt],n,i)}function Aa(e,t){const i=dn(t,e),n=i[Dt];!function z0(e,t){for(let i=t.length;i<e.blueprint.length;i++)t.push(e.blueprint[i])}(n,i);const o=i[Di];null!==o&&null===i[Xo]&&(i[Xo]=_p(o,i[Mo])),xl(n,i,i[_i])}function xl(e,t,i){Ef(t);try{const n=e.viewQuery;null!==n&&Iu(1,n,i);const o=e.template;null!==o&&ke(e,t,o,1,i),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&Is(e,t),e.staticViewQueries&&Iu(2,e.viewQuery,i);const c=e.components;null!==c&&function ev(e,t){for(let i=0;i<t.length;i++)Aa(e,t[i])}(t,c)}catch(n){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),n}finally{t[nn]&=-5,Bt()}}let Ug=(()=>{var e;class t{constructor(){this.all=new Set,this.queue=new Map}create(n,o,c){const f=typeof Zone>"u"?null:Zone.current,y=new we(n,z=>{this.all.has(z)&&this.queue.set(z,f)},c);let E;this.all.add(y),y.notify();const A=()=>{y.cleanup(),E?.(),this.all.delete(y),this.queue.delete(y)};return E=o?.onDestroy(A),{destroy:A}}flush(){if(0!==this.queue.size)for(const[n,o]of this.queue)this.queue.delete(n),o?o.run(()=>n.run()):n.run()}get isQueueEmpty(){return 0===this.queue.size}}return(e=t).\u0275prov=Lt({token:e,providedIn:"root",factory:()=>new e}),t})();function Zd(e,t,i){let n=i?e.styles:null,o=i?e.classes:null,c=0;if(null!==t)for(let f=0;f<t.length;f++){const y=t[f];"number"==typeof y?c=y:1==c?o=ti(o,y):2==c&&(n=ti(n,y+": "+t[++f]+";"))}i?e.styles=n:e.stylesWithoutHost=n,i?e.classes=o:e.classesWithoutHost=o}function Mp(e,t,i,n,o=!1){for(;null!==i;){const c=t[i.index];if(null!==c&&n.push(vt(c)),jr(c)){for(let y=vr;y<c.length;y++){const E=c[y],A=E[Dt].firstChild;null!==A&&Mp(E[Dt],E,A,n)}c[Yo]!==c[Di]&&n.push(c[Yo])}const f=i.type;if(8&f)Mp(e,t,i.child,n);else if(32&f){const y=ng(i,t);let E;for(;E=y();)n.push(E)}else if(16&f){const y=J1(t,i);if(Array.isArray(y))n.push(...y);else{const E=tp(t[Ri]);Mp(E[Dt],E,y,n,!0)}}i=o?i.projectionNext:i.next}return n}function Gr(e,t,i,n=!0){const o=t[Si],c=o.rendererFactory,f=o.afterRenderEventManager;c.begin?.(),f?.begin();try{jg(e,t,e.template,i)}catch(E){throw n&&Q_(t,E),E}finally{c.end?.(),o.effectManager?.flush(),f?.end()}}function jg(e,t,i,n){const o=t[nn];if(256!=(256&o)){t[Si].effectManager?.flush(),Ef(t);try{dr(t),function Mf(e){return Nt.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==i&&ke(e,t,i,2,n);const f=3==(3&o);if(f){const A=e.preOrderCheckHooks;null!==A&&gd(t,A,null)}else{const A=e.preOrderHooks;null!==A&&Vh(t,A,0,null),su(t,0)}if(function Au(e){for(let t=u_(e);null!==t;t=d_(t)){if(!t[ud])continue;const i=t[tl];for(let n=0;n<i.length;n++){So(i[n])}}}(t),tv(t,2),null!==e.contentQueries&&Is(e,t),f){const A=e.contentCheckHooks;null!==A&&gd(t,A)}else{const A=e.contentHooks;null!==A&&Vh(t,A,1),su(t,1)}!function ae(e,t){const i=e.hostBindingOpCodes;if(null===i)return;const n=R(t,Yl);try{for(let o=0;o<i.length;o++){const c=i[o];if(c<0)oc(~c);else{const f=c,y=i[++o],E=i[++o];nc(y,f),n.runInContext(E,2,t[f])}}}finally{null===t[Yl]&&B(t,Yl),oc(-1)}}(e,t);const y=e.components;null!==y&&a2(t,y,0);const E=e.viewQuery;if(null!==E&&Iu(2,E,n),f){const A=e.viewCheckHooks;null!==A&&gd(t,A)}else{const A=e.viewHooks;null!==A&&Vh(t,A,2),su(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),t[nn]&=-73,Ko(t)}finally{Bt()}}}function tv(e,t){for(let i=u_(e);null!==i;i=d_(i))for(let n=vr;n<i.length;n++)s2(i[n],t)}function aA(e,t,i){s2(dn(t,e),i)}function s2(e,t){if(!function Hn(e){return 128==(128&e[nn])}(e))return;const i=e[Dt];if(80&e[nn]&&0===t||1024&e[nn]||2===t)jg(i,e,i.template,e[_i]);else if(e[wt]>0){tv(e,1);const o=e[Dt].components;null!==o&&a2(e,o,1)}}function a2(e,t,i){for(let n=0;n<t.length;n++)aA(e,t[n],i)}class nv{get rootNodes(){const t=this._lView,i=t[Dt];return Mp(i,t,i.firstChild,[])}constructor(t,i){this._lView=t,this._cdRefInjectingView=i,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[_i]}set context(t){this._lView[_i]=t}get destroyed(){return 256==(256&this._lView[nn])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[si];if(jr(t)){const i=t[8],n=i?i.indexOf(this):-1;n>-1&&(og(t,n),Po(i,n))}this._attachedToViewContainer=!1}sg(this._lView[Dt],this._lView)}onDestroy(t){!function Un(e,t){if(256==(256&e[nn]))throw new ut(911,!1);null===e[ao]&&(e[ao]=[]),e[ao].push(t)}(this._lView,t)}markForCheck(){bp(this._cdRefInjectingView||this._lView)}detach(){this._lView[nn]&=-129}reattach(){this._lView[nn]|=128}detectChanges(){Gr(this._lView[Dt],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new ut(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function np(e,t){Sd(e,t,t[Jt],2,null,null)}(this._lView[Dt],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new ut(902,!1);this._appRef=t}}class lA extends nv{constructor(t){super(t),this._view=t}detectChanges(){const t=this._view;Gr(t[Dt],t,t[_i],!1)}checkNoChanges(){}get context(){return null}}class l2 extends rs{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const i=kn(t);return new iv(i,this.ngModule)}}function c2(e){const t=[];for(let i in e)e.hasOwnProperty(i)&&t.push({propName:e[i],templateName:i});return t}class uA{constructor(t,i){this.injector=t,this.parentInjector=i}get(t,i,n){n=Gc(n);const o=this.injector.get(t,kg,n);return o!==kg||i===kg?o:this.parentInjector.get(t,i,n)}}class iv extends D0{get inputs(){const t=this.componentDef,i=t.inputTransforms,n=c2(t.inputs);if(null!==i)for(const o of n)i.hasOwnProperty(o.propName)&&(o.transform=i[o.propName]);return n}get outputs(){return c2(this.componentDef.outputs)}constructor(t,i){super(),this.componentDef=t,this.ngModule=i,this.componentType=t.type,this.selector=function $s(e){return e.map(pf).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!i}create(t,i,n,o){let c=(o=o||this.ngModule)instanceof ns?o:o?.injector;c&&null!==this.componentDef.getStandaloneInjector&&(c=this.componentDef.getStandaloneInjector(c)||c);const f=c?new uA(t,c):t,y=f.get(G_,null);if(null===y)throw new ut(407,!1);const H={rendererFactory:y,sanitizer:f.get(A0,null),effectManager:f.get(Ug,null),afterRenderEventManager:f.get(Fg,null)},oe=y.createRenderer(null,this.componentDef),pe=this.componentDef.selectors[0][0]||"div",Ie=n?function ct(e,t,i,n){const c=n.get(W_,!1)||i===Qi.ShadowDom,f=e.selectRootElement(t,c);return function Ue(e){yt(e)}(f),f}(oe,n,this.componentDef.encapsulation,f):yu(oe,pe,function cA(e){const t=e.toLowerCase();return"svg"===t?Qe:"math"===t?"math":null}(pe)),et=this.componentDef.signals?4608:this.componentDef.onPush?576:528;let qe=null;null!==Ie&&(qe=_p(Ie,f,!0));const $t=Xe(0,null,null,1,0,null,null,null,null,null,null),Ut=fe(null,$t,null,et,null,null,H,oe,f,null,qe);let Sn,go;Ef(Ut);try{const oa=this.componentDef;let Wp,hx=null;oa.findHostDirectiveDefs?(Wp=[],hx=new Map,oa.findHostDirectiveDefs(oa,Wp,hx),Wp.push(oa)):Wp=[oa];const X9=function hA(e,t){const i=e[Dt],n=Mn;return e[n]=t,_e(i,n,2,"#host",null)}(Ut,Ie),Y9=function pA(e,t,i,n,o,c,f){const y=o[Dt];!function fA(e,t,i,n){for(const o of e)t.mergedAttrs=$l(t.mergedAttrs,o.hostAttrs);null!==t.mergedAttrs&&(Zd(t,t.mergedAttrs,!0),null!==i&&t0(n,i,t))}(n,e,t,f);let E=null;null!==t&&(E=_p(t,o[Mo]));const A=c.rendererFactory.createRenderer(t,i);let z=16;i.signals?z=4096:i.onPush&&(z=64);const H=fe(o,Ye(i),null,z,o[e.index],e,c,A,null,null,E);return y.firstCreatePass&&Vi(y,e,n.length-1),yl(o,H),o[e.index]=H}(X9,Ie,oa,Wp,Ut,H,oe);go=un($t,Mn),Ie&&function mA(e,t,i,n){if(n)Xc(e,i,["ng-version",P0.full]);else{const{attrs:o,classes:c}=function sd(e){const t=[],i=[];let n=1,o=2;for(;n<e.length;){let c=e[n];if("string"==typeof c)2===o?""!==c&&t.push(c,e[++n]):8===o&&i.push(c);else{if(!Zo(o))break;o=c}n++}return{attrs:t,classes:i}}(t.selectors[0]);o&&Xc(e,i,o),c&&c.length>0&&e0(e,i,c.join(" "))}}(oe,oa,Ie,n),void 0!==i&&function _A(e,t,i){const n=e.projection=[];for(let o=0;o<t.length;o++){const c=i[o];n.push(null!=c?Array.from(c):null)}}(go,this.ngContentSelectors,i),Sn=function gA(e,t,i,n,o,c){const f=yr(),y=o[Dt],E=At(f,o);Wn(y,o,f,i,null,n);for(let z=0;z<i.length;z++)Fr(Qo(o,y,f.directiveStart+z,f),o);Ci(y,o,f),E&&Fr(E,o);const A=Qo(o,y,f.directiveStart+f.componentOffset,f);if(e[_i]=o[_i]=A,null!==c)for(const z of c)z(A,t);return $e(y,f,e),A}(Y9,oa,Wp,hx,Ut,[vA]),xl($t,Ut,null)}finally{Bt()}return new dA(this.componentType,Sn,_l(go,Ut),Ut,go)}}class dA extends T0{constructor(t,i,n,o,c){super(),this.location=n,this._rootLView=o,this._tNode=c,this.previousInputValues=null,this.instance=i,this.hostView=this.changeDetectorRef=new lA(o),this.componentType=t}setInput(t,i){const n=this._tNode.inputs;let o;if(null!==n&&(o=n[t])){if(this.previousInputValues??=new Map,this.previousInputValues.has(t)&&Object.is(this.previousInputValues.get(t),i))return;const c=this._rootLView;Cp(c[Dt],c,o,t,i),this.previousInputValues.set(t,i),bp(dn(this._tNode.index,c))}}get injector(){return new to(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}function vA(){const e=yr();Sf(lt()[Dt],e)}function yi(e){let t=function u2(e){return Object.getPrototypeOf(e.prototype).constructor}(e.type),i=!0;const n=[e];for(;t;){let o;if(pi(e))o=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new ut(903,!1);o=t.\u0275dir}if(o){if(i){n.push(o);const f=e;f.inputs=B0(e.inputs),f.inputTransforms=B0(e.inputTransforms),f.declaredInputs=B0(e.declaredInputs),f.outputs=B0(e.outputs);const y=o.hostBindings;y&&wA(e,y);const E=o.viewQuery,A=o.contentQueries;if(E&&xA(e,E),A&&bA(e,A),_s(e.inputs,o.inputs),_s(e.declaredInputs,o.declaredInputs),_s(e.outputs,o.outputs),null!==o.inputTransforms&&(null===f.inputTransforms&&(f.inputTransforms={}),_s(f.inputTransforms,o.inputTransforms)),pi(o)&&o.data.animation){const z=e.data;z.animation=(z.animation||[]).concat(o.data.animation)}}const c=o.features;if(c)for(let f=0;f<c.length;f++){const y=c[f];y&&y.ngInherit&&y(e),y===yi&&(i=!1)}}t=Object.getPrototypeOf(t)}!function yA(e){let t=0,i=null;for(let n=e.length-1;n>=0;n--){const o=e[n];o.hostVars=t+=o.hostVars,o.hostAttrs=$l(o.hostAttrs,i=$l(i,o.hostAttrs))}}(n)}function B0(e){return e===so?{}:e===Nn?[]:e}function xA(e,t){const i=e.viewQuery;e.viewQuery=i?(n,o)=>{t(n,o),i(n,o)}:t}function bA(e,t){const i=e.contentQueries;e.contentQueries=i?(n,o,c)=>{t(n,o,c),i(n,o,c)}:t}function wA(e,t){const i=e.hostBindings;e.hostBindings=i?(n,o)=>{t(n,o),i(n,o)}:t}function f2(e){const t=e.inputConfig,i={};for(const n in t)if(t.hasOwnProperty(n)){const o=t[n];Array.isArray(o)&&o[2]&&(i[n]=o[2])}e.inputTransforms=i}function V0(e){return!!fb(e)&&(Array.isArray(e)||!(e instanceof Map)&&Symbol.iterator in e)}function fb(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function bc(e,t,i){return e[t]=i}function Ro(e,t,i){return!Object.is(e[t],i)&&(e[t]=i,!0)}function Tp(e,t,i,n){const o=Ro(e,t,i);return Ro(e,t+1,n)||o}function U0(e,t,i,n,o){const c=Tp(e,t,i,n);return Ro(e,t+2,o)||c}function Fo(e,t,i,n){const o=lt();return Ro(o,ba(),t)&&(Bn(),Ai(Ni(),o,e,t,i,n)),Fo}function Hg(e,t,i,n){return Ro(e,ba(),i)?t+Zt(i)+n:V}function J(e,t,i,n,o,c,f,y){const E=lt(),A=Bn(),z=e+Mn,H=A.firstCreatePass?function ZA(e,t,i,n,o,c,f,y,E){const A=t.consts,z=_e(t,e,4,f||null,Ii(A,y));Vn(t,i,z,Ii(A,E)),Sf(t,z);const H=z.tView=Xe(2,z,n,o,c,t.directiveRegistry,t.pipeRegistry,null,t.schemas,A,null);return null!==t.queries&&(t.queries.template(t,z),H.queries=t.queries.embeddedTView(z)),z}(z,A,E,t,i,n,o,c,f):A.data[z];Jo(H,!1);const oe=D2(A,E,H,e);ou()&&dg(A,E,oe,H),Fr(oe,E),yl(E,E[z]=pr(oe,E,oe,H)),eu(H)&&rt(A,E,H),null!=f&&Ne(E,H,y)}let D2=function S2(e,t,i,n){return ll(!0),t[Jt].createComment("")};function Vt(e){return Pt(function p1(){return Nt.lFrame.contextLView}(),Mn+e)}function U(e,t,i){const n=lt();return Ro(n,ba(),t)&&Rt(Bn(),Ni(),n,e,t,n[Jt],i,!1),U}function xb(e,t,i,n,o){const f=o?"class":"style";Cp(e,i,t.inputs[f],f,n)}function L(e,t,i,n){const o=lt(),c=Bn(),f=Mn+e,y=o[Jt],E=c.firstCreatePass?function KA(e,t,i,n,o,c){const f=t.consts,E=_e(t,e,2,n,Ii(f,o));return Vn(t,i,E,Ii(f,c)),null!==E.attrs&&Zd(E,E.attrs,!1),null!==E.mergedAttrs&&Zd(E,E.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,E),E}(f,c,o,t,i,n):c.data[f],A=I2(c,o,E,y,t,e);o[f]=A;const z=eu(E);return Jo(E,!0),t0(y,A,E),32!=(32&E.flags)&&ou()&&dg(c,o,A,E),0===function Jr(){return Nt.lFrame.elementDepthCount}()&&Fr(A,o),function hd(){Nt.lFrame.elementDepthCount++}(),z&&(rt(c,o,E),$e(c,E,o)),null!==n&&Ne(o,E),L}function P(){let e=yr();qs()?fd():(e=e.parent,Jo(e,!1));const t=e;(function xa(e){return Nt.skipHydrationRootTNode===e})(t)&&function zh(){Nt.skipHydrationRootTNode=null}(),function il(){Nt.lFrame.elementDepthCount--}();const i=Bn();return i.firstCreatePass&&(Sf(i,e),Qc(e)&&i.queries.elementEnd(e)),null!=t.classesWithoutHost&&function Cs(e){return 0!=(8&e.flags)}(t)&&xb(i,t,lt(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function Gm(e){return 0!=(16&e.flags)}(t)&&xb(i,t,lt(),t.stylesWithoutHost,!1),P}function He(e,t,i,n){return L(e,t,i,n),P(),He}let I2=(e,t,i,n,o,c)=>(ll(!0),yu(n,o,function sc(){return Nt.lFrame.currentNamespace}()));function na(e,t,i){const n=lt(),o=Bn(),c=e+Mn,f=o.firstCreatePass?function eP(e,t,i,n,o){const c=t.consts,f=Ii(c,n),y=_e(t,e,8,"ng-container",f);return null!==f&&Zd(y,f,!0),Vn(t,i,y,Ii(c,o)),null!==t.queries&&t.queries.elementStart(t,y),y}(c,o,n,t,i):o.data[c];Jo(f,!0);const y=A2(o,n,f,e);return n[c]=y,ou()&&dg(o,n,y,f),Fr(y,n),eu(f)&&(rt(o,n,f),$e(o,f,n)),null!=i&&Ne(n,f),na}function ia(){let e=yr();const t=Bn();return qs()?fd():(e=e.parent,Jo(e,!1)),t.firstCreatePass&&(Sf(t,e),Qc(e)&&t.queries.elementEnd(e)),ia}function G0(e,t,i){return na(e,t,i),ia(),G0}let A2=(e,t,i,n)=>(ll(!0),Td(t[Jt],""));function Ke(){return lt()}function lv(e){return!!e&&"function"==typeof e.then}function P2(e){return!!e&&"function"==typeof e.subscribe}function ye(e,t,i,n){const o=lt(),c=Bn(),f=yr();return function O2(e,t,i,n,o,c,f){const y=eu(n),A=e.firstCreatePass&&K_(e),z=t[_i],H=Y_(t);let oe=!0;if(3&n.type||f){const Ve=At(n,t),We=f?f(Ve):Ve,et=H.length,qe=f?Ut=>f(vt(Ut[n.index])):n.index;let $t=null;if(!f&&y&&($t=function iP(e,t,i,n){const o=e.cleanup;if(null!=o)for(let c=0;c<o.length-1;c+=2){const f=o[c];if(f===i&&o[c+1]===n){const y=t[Qa],E=o[c+2];return y.length>E?y[E]:null}"string"==typeof f&&(c+=2)}return null}(e,t,o,n.index)),null!==$t)($t.__ngLastListenerFn__||$t).__ngNextListenerFn__=c,$t.__ngLastListenerFn__=c,oe=!1;else{c=R2(n,t,z,c,!1);const Ut=i.listen(We,o,c);H.push(c,Ut),A&&A.push(o,qe,et,et+1)}}else c=R2(n,t,z,c,!1);const pe=n.outputs;let Ie;if(oe&&null!==pe&&(Ie=pe[o])){const Ve=Ie.length;if(Ve)for(let We=0;We<Ve;We+=2){const Sn=t[Ie[We]][Ie[We+1]].subscribe(c),go=H.length;H.push(c,Sn),A&&A.push(o,n.index,go,-(go+1))}}}(c,o,o[Jt],f,e,t,n),ye}function L2(e,t,i,n){try{return tt(6,t,i),!1!==i(n)}catch(o){return Q_(e,o),!1}finally{tt(7,t,i)}}function R2(e,t,i,n,o){return function c(f){if(f===Function)return n;bp(e.componentOffset>-1?dn(e.index,t):t);let E=L2(t,i,n,f),A=c.__ngNextListenerFn__;for(;A;)E=L2(t,i,A,f)&&E,A=A.__ngNextListenerFn__;return o&&!1===E&&f.preventDefault(),E}}function q(e=1){return function rc(e){return(Nt.lFrame.contextLView=function Tf(e,t){for(;e>0;)t=t[Hs],e--;return t}(e,Nt.lFrame.contextLView))[_i]}(e)}function rP(e,t){let i=null;const n=function Lm(e){const t=e.attrs;if(null!=t){const i=t.indexOf(5);if(!(1&i))return t[i+1]}return null}(e);for(let o=0;o<t.length;o++){const c=t[o];if("*"!==c){if(null===n?df(e,c,!0):ql(n,c))return o}else i=o}return i}function bb(e){const t=lt()[Ri][hi];if(!t.projection){const n=t.projection=Hr(e?e.length:1,null),o=n.slice();let c=t.child;for(;null!==c;){const f=e?rP(c,e):0;null!==f&&(o[f]?o[f].projectionNext=c:n[f]=c,o[f]=c),c=c.next}}}function wb(e,t=0,i){const n=lt(),o=Bn(),c=_e(o,Mn+e,16,null,i||null);null===c.projection&&(c.projection=t),fd(),(!n[Xo]||Qr())&&32!=(32&c.flags)&&function Q1(e,t,i){v_(t[Jt],0,t,i,lg(e,i,t),bu(i.parent||t[hi],i,t))}(o,n,c)}function vn(e,t,i){return cv(e,"",t,"",i),vn}function cv(e,t,i,n,o){const c=lt(),f=Hg(c,t,i,n);return f!==V&&Rt(Bn(),Ni(),c,e,f,c[Jt],o,!1),cv}function q0(e,t){return e<<17|t<<2}function Wd(e){return e>>17&32767}function Cb(e){return 2|e}function Dp(e){return(131068&e)>>2}function Mb(e,t){return-131069&e|t<<2}function Eb(e){return 1|e}function H2(e,t,i,n,o){const c=e[i+1],f=null===t;let y=n?Wd(c):Dp(c),E=!1;for(;0!==y&&(!1===E||f);){const z=e[y+1];uP(e[y],t)&&(E=!0,e[y+1]=n?Eb(z):Cb(z)),y=n?Wd(z):Dp(z)}E&&(e[i+1]=n?Cb(c):Eb(c))}function uP(e,t){return null===e||null==t||(Array.isArray(e)?e[1]:e)===t||!(!Array.isArray(e)||"string"!=typeof t)&&gu(e,t)>=0}const qr={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function G2(e){return e.substring(qr.key,qr.keyEnd)}function q2(e,t){const i=qr.textEnd;return i===t?-1:(t=qr.keyEnd=function fP(e,t,i){for(;t<i&&e.charCodeAt(t)>32;)t++;return t}(e,qr.key=t,i),Jg(e,t,i))}function Jg(e,t,i){for(;t<i&&e.charCodeAt(t)<=32;)t++;return t}function Tb(e,t,i){return bl(e,t,i,!1),Tb}function ka(e,t){return bl(e,t,null,!0),ka}function uv(e){!function wl(e,t,i,n){const o=Bn(),c=Io(2);o.firstUpdatePass&&J2(o,null,c,n);const f=lt();if(i!==V&&Ro(f,c,i)){const y=o.data[gi()];if(nM(y,n)&&!K2(o,c)){let E=n?y.classesWithoutHost:y.stylesWithoutHost;null!==E&&(i=ti(E,i||"")),xb(o,y,f,i,n)}else!function MP(e,t,i,n,o,c,f,y){o===V&&(o=Nn);let E=0,A=0,z=0<o.length?o[0]:null,H=0<c.length?c[0]:null;for(;null!==z||null!==H;){const oe=E<o.length?o[E+1]:void 0,pe=A<c.length?c[A+1]:void 0;let Ve,Ie=null;z===H?(E+=2,A+=2,oe!==pe&&(Ie=H,Ve=pe)):null===H||null!==z&&z<H?(E+=2,Ie=z):(A+=2,Ie=H,Ve=pe),null!==Ie&&eM(e,t,i,n,Ie,Ve,f,y),z=E<o.length?o[E]:null,H=A<c.length?c[A]:null}}(o,y,f,f[Jt],f[c+1],f[c+1]=function wP(e,t,i){if(null==i||""===i)return Nn;const n=[],o=fl(i);if(Array.isArray(o))for(let c=0;c<o.length;c++)e(n,o[c],!0);else if("object"==typeof o)for(const c in o)o.hasOwnProperty(c)&&e(n,c,o[c]);else"string"==typeof o&&t(n,o);return n}(e,t,i),n,c)}}(CP,Cc,e,!0)}function Cc(e,t){for(let i=function hP(e){return function W2(e){qr.key=0,qr.keyEnd=0,qr.value=0,qr.valueEnd=0,qr.textEnd=e.length}(e),q2(e,Jg(e,0,qr.textEnd))}(t);i>=0;i=q2(t,i))Rr(e,G2(t),!0)}function bl(e,t,i,n){const o=lt(),c=Bn(),f=Io(2);c.firstUpdatePass&&J2(c,e,f,n),t!==V&&Ro(o,f,t)&&eM(c,c.data[gi()],o,o[Jt],e,o[f+1]=function EP(e,t){return null==e||""===e||("string"==typeof t?e+=t:"object"==typeof e&&(e=jn(fl(e)))),e}(t,i),n,f)}function K2(e,t){return t>=e.expandoStartIndex}function J2(e,t,i,n){const o=e.data;if(null===o[i+1]){const c=o[gi()],f=K2(e,i);nM(c,n)&&null===t&&!f&&(t=!1),t=function vP(e,t,i,n){const o=function Vm(e){const t=Nt.lFrame.currentDirectiveIndex;return-1===t?null:e[t]}(e);let c=n?t.residualClasses:t.residualStyles;if(null===o)0===(n?t.classBindings:t.styleBindings)&&(i=dv(i=Db(null,e,t,i,n),t.attrs,n),c=null);else{const f=t.directiveStylingLast;if(-1===f||e[f]!==o)if(i=Db(o,e,t,i,n),null===c){let E=function yP(e,t,i){const n=i?t.classBindings:t.styleBindings;if(0!==Dp(n))return e[Wd(n)]}(e,t,n);void 0!==E&&Array.isArray(E)&&(E=Db(null,e,t,E[1],n),E=dv(E,t.attrs,n),function xP(e,t,i,n){e[Wd(i?t.classBindings:t.styleBindings)]=n}(e,t,n,E))}else c=function bP(e,t,i){let n;const o=t.directiveEnd;for(let c=1+t.directiveStylingLast;c<o;c++)n=dv(n,e[c].hostAttrs,i);return dv(n,t.attrs,i)}(e,t,n)}return void 0!==c&&(n?t.residualClasses=c:t.residualStyles=c),i}(o,c,t,n),function lP(e,t,i,n,o,c){let f=c?t.classBindings:t.styleBindings,y=Wd(f),E=Dp(f);e[n]=i;let z,A=!1;if(Array.isArray(i)?(z=i[1],(null===z||gu(i,z)>0)&&(A=!0)):z=i,o)if(0!==E){const oe=Wd(e[y+1]);e[n+1]=q0(oe,y),0!==oe&&(e[oe+1]=Mb(e[oe+1],n)),e[y+1]=function sP(e,t){return 131071&e|t<<17}(e[y+1],n)}else e[n+1]=q0(y,0),0!==y&&(e[y+1]=Mb(e[y+1],n)),y=n;else e[n+1]=q0(E,0),0===y?y=n:e[E+1]=Mb(e[E+1],n),E=n;A&&(e[n+1]=Cb(e[n+1])),H2(e,z,n,!0),H2(e,z,n,!1),function cP(e,t,i,n,o){const c=o?e.residualClasses:e.residualStyles;null!=c&&"string"==typeof t&&gu(c,t)>=0&&(i[n+1]=Eb(i[n+1]))}(t,z,e,n,c),f=q0(y,E),c?t.classBindings=f:t.styleBindings=f}(o,c,t,i,f,n)}}function Db(e,t,i,n,o){let c=null;const f=i.directiveEnd;let y=i.directiveStylingLast;for(-1===y?y=i.directiveStart:y++;y<f&&(c=t[y],n=dv(n,c.hostAttrs,o),c!==e);)y++;return null!==e&&(i.directiveStylingLast=y),n}function dv(e,t,i){const n=i?1:2;let o=-1;if(null!==t)for(let c=0;c<t.length;c++){const f=t[c];"number"==typeof f?o=f:o===n&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),Rr(e,f,!!i||t[++c]))}return void 0===e?null:e}function CP(e,t,i){const n=String(t);""!==n&&!n.includes(" ")&&Rr(e,n,i)}function eM(e,t,i,n,o,c,f,y){if(!(3&t.type))return;const E=e.data,A=E[y+1],z=function aP(e){return 1==(1&e)}(A)?tM(E,t,i,o,Dp(A),f):void 0;Z0(z)||(Z0(c)||function oP(e){return 2==(2&e)}(A)&&(c=tM(E,null,i,o,y,f)),function jx(e,t,i,n,o){if(t)o?e.addClass(i,n):e.removeClass(i,n);else{let c=-1===n.indexOf("-")?void 0:ni.DashCase;null==o?e.removeStyle(i,n,c):("string"==typeof o&&o.endsWith("!important")&&(o=o.slice(0,-10),c|=ni.Important),e.setStyle(i,n,o,c))}}(n,f,Et(gi(),i),o,c))}function tM(e,t,i,n,o,c){const f=null===t;let y;for(;o>0;){const E=e[o],A=Array.isArray(E),z=A?E[1]:E,H=null===z;let oe=i[o+1];oe===V&&(oe=H?Nn:void 0);let pe=H?Wh(oe,n):z===n?oe:void 0;if(A&&!Z0(pe)&&(pe=Wh(E,n)),Z0(pe)&&(y=pe,f))return y;const Ie=e[o+1];o=f?Wd(Ie):Dp(Ie)}if(null!==t){let E=c?t.residualClasses:t.residualStyles;null!=E&&(y=Wh(E,n))}return y}function Z0(e){return void 0!==e}function nM(e,t){return 0!=(e.flags&(t?8:16))}function W(e,t=""){const i=lt(),n=Bn(),o=e+Mn,c=n.firstCreatePass?_e(n,o,1,t,null):n.data[o],f=iM(n,i,c,t,e);i[o]=f,ou()&&dg(n,i,f,c),Jo(c,!1)}let iM=(e,t,i,n,o)=>(ll(!0),function ig(e,t){return e.createText(t)}(t[Jt],n));function Ce(e){return jt("",e,""),Ce}function jt(e,t,i){const n=lt(),o=Hg(n,e,t,i);return o!==V&&ta(n,gi(),o),jt}function pn(e,t,i,n,o){const c=lt(),f=function Gg(e,t,i,n,o,c){const y=Tp(e,ol(),i,o);return Io(2),y?t+Zt(i)+n+Zt(o)+c:V}(c,e,t,i,n,o);return f!==V&&ta(c,gi(),f),pn}function Qg(e,t,i,n,o,c,f){const y=lt(),E=function qg(e,t,i,n,o,c,f,y){const A=U0(e,ol(),i,o,f);return Io(3),A?t+Zt(i)+n+Zt(o)+c+Zt(f)+y:V}(y,e,t,i,n,o,c,f);return E!==V&&ta(y,gi(),E),Qg}const tm="en-US";let CM=tm;function Ab(e,t,i,n,o){if(e=Gt(e),Array.isArray(e))for(let c=0;c<e.length;c++)Ab(e[c],t,i,n,o);else{const c=Bn(),f=lt(),y=yr();let E=Ds(e)?e:Gt(e.provide);const A=pp(e),z=1048575&y.providerIndexes,H=y.directiveStart,oe=y.providerIndexes>>20;if(Ds(e)||!e.multi){const pe=new cl(A,o,G),Ie=kb(E,t,o?z:z+oe,H);-1===Ie?(Hh(Af(y,f),c,E),Pb(c,e,t.length),t.push(E),y.directiveStart++,y.directiveEnd++,o&&(y.providerIndexes+=1048576),i.push(pe),f.push(pe)):(i[Ie]=pe,f[Ie]=pe)}else{const pe=kb(E,t,z+oe,H),Ie=kb(E,t,z,z+oe),We=Ie>=0&&i[Ie];if(o&&!We||!o&&!(pe>=0&&i[pe])){Hh(Af(y,f),c,E);const et=function q3(e,t,i,n,o){const c=new cl(e,i,G);return c.multi=[],c.index=t,c.componentProviders=0,WM(c,o,n&&!i),c}(o?G3:H3,i.length,o,n,A);!o&&We&&(i[Ie].providerFactory=et),Pb(c,e,t.length,0),t.push(E),y.directiveStart++,y.directiveEnd++,o&&(y.providerIndexes+=1048576),i.push(et),f.push(et)}else Pb(c,e,pe>-1?pe:Ie,WM(i[o?Ie:pe],A,!o&&n));!o&&n&&We&&i[Ie].componentProviders++}}}function Pb(e,t,i,n){const o=Ds(t),c=function Ld(e){return!!e.useClass}(t);if(o||c){const E=(c?Gt(t.useClass):t).prototype.ngOnDestroy;if(E){const A=e.destroyHooks||(e.destroyHooks=[]);if(!o&&t.multi){const z=A.indexOf(i);-1===z?A.push(i,[n,E]):A[z+1].push(n,E)}else A.push(i,E)}}}function WM(e,t,i){return i&&e.componentProviders++,e.multi.push(t)-1}function kb(e,t,i,n){for(let o=i;o<n;o++)if(t[o]===e)return o;return-1}function H3(e,t,i,n){return Ob(this.multi,[])}function G3(e,t,i,n){const o=this.multi;let c;if(this.providerFactory){const f=this.providerFactory.componentProviders,y=Qo(i,i[Dt],this.providerFactory.index,n);c=y.slice(0,f),Ob(o,c);for(let E=f;E<y.length;E++)c.push(y[E])}else c=[],Ob(o,c);return c}function Ob(e,t){for(let i=0;i<e.length;i++)t.push((0,e[i])());return t}function Yi(e,t=[]){return i=>{i.providersResolver=(n,o)=>function $3(e,t,i){const n=Bn();if(n.firstCreatePass){const o=pi(e);Ab(i,n.data,n.blueprint,o,!0),Ab(t,n.data,n.blueprint,o,!1)}}(n,o?o(e):e,t)}}class Ip{}class XM{}class Lb extends Ip{constructor(t,i,n){super(),this._parent=i,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new l2(this);const o=Pr(t);this._bootstrapComponents=Ia(o.bootstrap),this._r3Injector=Qs(t,i,[{provide:Ip,useValue:this},{provide:rs,useValue:this.componentFactoryResolver},...n],jn(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(t)}get injector(){return this._r3Injector}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(i=>i()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class Rb extends XM{constructor(t){super(),this.moduleType=t}create(t){return new Lb(this.moduleType,t,[])}}class YM extends Ip{constructor(t){super(),this.componentFactoryResolver=new l2(this),this.instance=null;const i=new pc([...t.providers,{provide:Ip,useValue:this},{provide:rs,useValue:this.componentFactoryResolver}],t.parent||Rd(),t.debugName,new Set(["environment"]));this.injector=i,t.runEnvironmentInitializers&&i.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function Fb(e,t,i=null){return new YM({providers:e,parent:t,debugName:i,runEnvironmentInitializers:!0}).injector}let X3=(()=>{var e;class t{constructor(n){this._injector=n,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(n){if(!n.standalone)return null;if(!this.cachedInjectors.has(n)){const o=dp(0,n.type),c=o.length>0?Fb([o],this._injector,`Standalone[${n.type.name}]`):null;this.cachedInjectors.set(n,c)}return this.cachedInjectors.get(n)}ngOnDestroy(){try{for(const n of this.cachedInjectors.values())null!==n&&n.destroy()}finally{this.cachedInjectors.clear()}}}return(e=t).\u0275prov=Lt({token:e,providedIn:"environment",factory:()=>new e(Ft(ns))}),t})();function KM(e){e.getStandaloneInjector=t=>t.get(X3).getOrCreateStandaloneInjector(e)}function ft(e,t,i,n){return sE(lt(),lo(),e,t,i,n)}function Ap(e,t,i,n,o){return function aE(e,t,i,n,o,c,f){const y=t+i;return Tp(e,y,o,c)?bc(e,y+2,f?n.call(f,o,c):n(o,c)):_v(e,y+2)}(lt(),lo(),e,t,i,n,o)}function rE(e,t,i,n,o,c){return function lE(e,t,i,n,o,c,f,y){const E=t+i;return U0(e,E,o,c,f)?bc(e,E+3,y?n.call(y,o,c,f):n(o,c,f)):_v(e,E+3)}(lt(),lo(),e,t,i,n,o,c)}function oE(e,t,i,n,o,c,f){return function cE(e,t,i,n,o,c,f,y,E){const A=t+i;return function Pa(e,t,i,n,o,c){const f=Tp(e,t,i,n);return Tp(e,t+2,o,c)||f}(e,A,o,c,f,y)?bc(e,A+4,E?n.call(E,o,c,f,y):n(o,c,f,y)):_v(e,A+4)}(lt(),lo(),e,t,i,n,o,c,f)}function _v(e,t){const i=e[t];return i===V?void 0:i}function sE(e,t,i,n,o,c){const f=t+i;return Ro(e,f,o)?bc(e,f+1,c?n.call(c,o):n(o)):_v(e,f+1)}function te(e,t){const i=Bn();let n;const o=e+Mn;i.firstCreatePass?(n=function u5(e,t){if(t)for(let i=t.length-1;i>=0;i--){const n=t[i];if(e===n.name)return n}}(t,i.pipeRegistry),i.data[o]=n,n.onDestroy&&(i.destroyHooks??=[]).push(o,n.onDestroy)):n=i.data[o];const c=n.factory||(n.factory=nl(n.type)),y=Ur(G);try{const E=$h(!1),A=c();return $h(E),function YA(e,t,i,n){i>=e.data.length&&(e.data[i]=null,e.blueprint[i]=null),t[i]=n}(i,lt(),o,A),A}finally{Ur(y)}}function ne(e,t,i){const n=e+Mn,o=lt(),c=Pt(o,n);return function vv(e,t){return e[Dt].data[t].pure}(o,n)?sE(o,lo(),t,c.transform,i,c):c.transform(i)}function zb(e){return t=>{setTimeout(e,void 0,t)}}const Tn=class g5 extends ar{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,i,n){let o=t,c=i||(()=>null),f=n;if(t&&"object"==typeof t){const E=t;o=E.next?.bind(E),c=E.error?.bind(E),f=E.complete?.bind(E)}this.__isAsync&&(c=zb(c),o&&(o=zb(o)),f&&(f=zb(f)));const y=super.subscribe({next:o,error:c,complete:f});return t instanceof Je&&t.add(y),y}};function m5(){return this._results[Symbol.iterator]()}class Bb{get changes(){return this._changes||(this._changes=new Tn)}constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const i=Bb.prototype;i[Symbol.iterator]||(i[Symbol.iterator]=m5)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,i){return this._results.reduce(t,i)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,i){const n=this;n.dirty=!1;const o=function Ao(e){return e.flat(Number.POSITIVE_INFINITY)}(t);(this._changesDetected=!function qn(e,t,i){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++){let o=e[n],c=t[n];if(i&&(o=i(o),c=i(c)),c!==o)return!1}return!0}(n._results,o,i))&&(n._results=o,n.length=o.length,n.last=o[this.length-1],n.first=o[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}function v5(e,t,i,n=!0){const o=t[Dt];if(function Z1(e,t,i,n){const o=vr+n,c=i.length;n>0&&(i[o-1][Yr]=t),n<c-vr?(t[Yr]=i[o],Ws(i,vr+n,t)):(i.push(t),t[Yr]=null),t[si]=i;const f=t[va];null!==f&&i!==f&&function rp(e,t){const i=e[tl];t[Ri]!==t[si][si][Ri]&&(e[ud]=!0),null===i?e[tl]=[t]:i.push(t)}(f,t);const y=t[Eo];null!==y&&y.insertView(e),t[nn]|=128}(o,t,e,i),n){const c=m_(i,e),f=t[Jt],y=br(f,e[Yo]);null!==y&&function Bx(e,t,i,n,o,c){n[Di]=o,n[hi]=t,Sd(e,n,i,1,o,c)}(o,e[hi],f,t,y,c)}}let li=(()=>{class t{}return t.__NG_ELEMENT_ID__=b5,t})();const y5=li,x5=class extends y5{constructor(t,i,n){super(),this._declarationLView=t,this._declarationTContainer=i,this.elementRef=n}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(t,i){return this.createEmbeddedViewImpl(t,i)}createEmbeddedViewImpl(t,i,n){const o=function _5(e,t,i,n){const o=t.tView,y=fe(e,o,i,4096&e[nn]?4096:16,null,t,null,null,null,n?.injector??null,n?.hydrationInfo??null);y[va]=e[t.index];const A=e[Eo];return null!==A&&(y[Eo]=A.createEmbeddedView(o)),xl(o,y,i),y}(this._declarationLView,this._declarationTContainer,t,{injector:i,hydrationInfo:n});return new nv(o)}};function b5(){return J0(yr(),lt())}function J0(e,t){return 4&e.type?new x5(t,e,_l(e,t)):null}let Cl=(()=>{class t{}return t.__NG_ELEMENT_ID__=D5,t})();function D5(){return _E(yr(),lt())}const S5=Cl,gE=class extends S5{constructor(t,i,n){super(),this._lContainer=t,this._hostTNode=i,this._hostLView=n}get element(){return _l(this._hostTNode,this._hostLView)}get injector(){return new to(this._hostTNode,this._hostLView)}get parentInjector(){const t=ac(this._hostTNode,this._hostLView);if(uu(t)){const i=jh(t,this._hostLView),n=uo(t);return new to(i[Dt].data[n+8],i)}return new to(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const i=mE(this._lContainer);return null!==i&&i[t]||null}get length(){return this._lContainer.length-vr}createEmbeddedView(t,i,n){let o,c;"number"==typeof n?o=n:null!=n&&(o=n.index,c=n.injector);const y=t.createEmbeddedViewImpl(i||{},c,null);return this.insertImpl(y,o,false),y}createComponent(t,i,n,o,c){const f=t&&!function Es(e){return"function"==typeof e}(t);let y;if(f)y=i;else{const Ve=i||{};y=Ve.index,n=Ve.injector,o=Ve.projectableNodes,c=Ve.environmentInjector||Ve.ngModuleRef}const E=f?t:new iv(kn(t)),A=n||this.parentInjector;if(!c&&null==E.ngModule){const We=(f?A:this.parentInjector).get(ns,null);We&&(c=We)}kn(E.componentType??{});const pe=E.create(A,o,null,c);return this.insertImpl(pe.hostView,y,false),pe}insert(t,i){return this.insertImpl(t,i,!1)}insertImpl(t,i,n){const o=t._lView;if(function Gn(e){return jr(e[si])}(o)){const E=this.indexOf(t);if(-1!==E)this.detach(E);else{const A=o[si],z=new gE(A,A[hi],A[si]);z.detach(z.indexOf(t))}}const f=this._adjustIndex(i),y=this._lContainer;return v5(y,o,f,!n),t.attachToViewContainerRef(),Ws(Vb(y),f,t),t}move(t,i){return this.insert(t,i)}indexOf(t){const i=mE(this._lContainer);return null!==i?i.indexOf(t):-1}remove(t){const i=this._adjustIndex(t,-1),n=og(this._lContainer,i);n&&(Po(Vb(this._lContainer),i),sg(n[Dt],n))}detach(t){const i=this._adjustIndex(t,-1),n=og(this._lContainer,i);return n&&null!=Po(Vb(this._lContainer),i)?new nv(n):null}_adjustIndex(t,i=0){return t??this.length+i}};function mE(e){return e[8]}function Vb(e){return e[8]||(e[8]=[])}function _E(e,t){let i;const n=t[e.index];return jr(n)?i=n:(i=pr(n,t,null,e),t[e.index]=i,yl(t,i)),vE(i,t,e,n),new gE(i,e,t)}let vE=function yE(e,t,i,n){if(e[Yo])return;let o;o=8&i.type?vt(n):function I5(e,t){const i=e[Jt],n=i.createComment(""),o=At(t,e);return xu(i,br(i,o),n,function op(e,t){return e.nextSibling(t)}(i,o),!1),n}(t,i),e[Yo]=o};class Ub{constructor(t){this.queryList=t,this.matches=null}clone(){return new Ub(this.queryList)}setDirty(){this.queryList.setDirty()}}class jb{constructor(t=[]){this.queries=t}createEmbeddedView(t){const i=t.queries;if(null!==i){const n=null!==t.contentQueries?t.contentQueries[0]:i.length,o=[];for(let c=0;c<n;c++){const f=i.getByIndex(c);o.push(this.queries[f.indexInDeclarationView].clone())}return new jb(o)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let i=0;i<this.queries.length;i++)null!==ME(t,i).matches&&this.queries[i].setDirty()}}class xE{constructor(t,i,n=null){this.predicate=t,this.flags=i,this.read=n}}class $b{constructor(t=[]){this.queries=t}elementStart(t,i){for(let n=0;n<this.queries.length;n++)this.queries[n].elementStart(t,i)}elementEnd(t){for(let i=0;i<this.queries.length;i++)this.queries[i].elementEnd(t)}embeddedTView(t){let i=null;for(let n=0;n<this.length;n++){const o=null!==i?i.length:0,c=this.getByIndex(n).embeddedTView(t,o);c&&(c.indexInDeclarationView=n,null!==i?i.push(c):i=[c])}return null!==i?new $b(i):null}template(t,i){for(let n=0;n<this.queries.length;n++)this.queries[n].template(t,i)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class Hb{constructor(t,i=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=i}elementStart(t,i){this.isApplyingToNode(i)&&this.matchTNode(t,i)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,i){this.elementStart(t,i)}embeddedTView(t,i){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,i),new Hb(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const i=this._declarationNodeIndex;let n=t.parent;for(;null!==n&&8&n.type&&n.index!==i;)n=n.parent;return i===(null!==n?n.index:-1)}return this._appliesToNextNode}matchTNode(t,i){const n=this.metadata.predicate;if(Array.isArray(n))for(let o=0;o<n.length;o++){const c=n[o];this.matchTNodeWithReadOption(t,i,k5(i,c)),this.matchTNodeWithReadOption(t,i,Lf(i,t,c,!1,!1))}else n===li?4&i.type&&this.matchTNodeWithReadOption(t,i,-1):this.matchTNodeWithReadOption(t,i,Lf(i,t,n,!1,!1))}matchTNodeWithReadOption(t,i,n){if(null!==n){const o=this.metadata.read;if(null!==o)if(o===Bi||o===Cl||o===li&&4&i.type)this.addMatch(i.index,-2);else{const c=Lf(i,t,o,!1,!1);null!==c&&this.addMatch(i.index,c)}else this.addMatch(i.index,n)}}addMatch(t,i){null===this.matches?this.matches=[t,i]:this.matches.push(t,i)}}function k5(e,t){const i=e.localNames;if(null!==i)for(let n=0;n<i.length;n+=2)if(i[n]===t)return i[n+1];return null}function L5(e,t,i,n){return-1===i?function O5(e,t){return 11&e.type?_l(e,t):4&e.type?J0(e,t):null}(t,e):-2===i?function R5(e,t,i){return i===Bi?_l(t,e):i===li?J0(t,e):i===Cl?_E(t,e):void 0}(e,t,n):Qo(e,e[Dt],i,t)}function bE(e,t,i,n){const o=t[Eo].queries[n];if(null===o.matches){const c=e.data,f=i.matches,y=[];for(let E=0;E<f.length;E+=2){const A=f[E];y.push(A<0?null:L5(t,c[A],f[E+1],i.metadata.read))}o.matches=y}return o.matches}function Gb(e,t,i,n){const o=e.queries.getByIndex(i),c=o.matches;if(null!==c){const f=bE(e,t,o,i);for(let y=0;y<c.length;y+=2){const E=c[y];if(E>0)n.push(f[y/2]);else{const A=c[y+1],z=t[-E];for(let H=vr;H<z.length;H++){const oe=z[H];oe[va]===oe[si]&&Gb(oe[Dt],oe,A,n)}if(null!==z[tl]){const H=z[tl];for(let oe=0;oe<H.length;oe++){const pe=H[oe];Gb(pe[Dt],pe,A,n)}}}}}return n}function Cr(e){const t=lt(),i=Bn(),n=g1();Um(n+1);const o=ME(i,n);if(e.dirty&&function $n(e){return 4==(4&e[nn])}(t)===(2==(2&o.metadata.flags))){if(null===o.matches)e.reset([]);else{const c=o.crossesNgTemplate?Gb(i,t,n,[]):bE(i,t,o,n);e.reset(c,I0),e.notifyOnChanges()}return!0}return!1}function Xd(e,t,i){const n=Bn();n.firstCreatePass&&(CE(n,new xE(e,t,i),-1),2==(2&t)&&(n.staticViewQueries=!0)),wE(n,lt(),t)}function Ps(e,t,i,n){const o=Bn();if(o.firstCreatePass){const c=yr();CE(o,new xE(t,i,n),c.index),function N5(e,t){const i=e.contentQueries||(e.contentQueries=[]);t!==(i.length?i[i.length-1]:-1)&&i.push(e.queries.length-1,t)}(o,e),2==(2&i)&&(o.staticContentQueries=!0)}wE(o,lt(),i)}function Mr(){return function F5(e,t){return e[Eo].queries[t].queryList}(lt(),g1())}function wE(e,t,i){const n=new Bb(4==(4&i));(function Qt(e,t,i,n){const o=Y_(t);o.push(i),e.firstCreatePass&&K_(e).push(n,o.length-1)})(e,t,n,n.destroy),null===t[Eo]&&(t[Eo]=new jb),t[Eo].queries.push(new Ub(n))}function CE(e,t,i){null===e.queries&&(e.queries=new $b),e.queries.track(new Hb(t,i))}function ME(e,t){return e.queries.getByIndex(t)}function Yd(e,t){return J0(e,t)}const Kb=new Ot("Application Initializer");let Jb=(()=>{var e;class t{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((n,o)=>{this.resolve=n,this.reject=o}),this.appInits=It(Kb,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const n=[];for(const c of this.appInits){const f=c();if(lv(f))n.push(f);else if(P2(f)){const y=new Promise((E,A)=>{f.subscribe({complete:E,error:A})});n.push(y)}}const o=()=>{this.done=!0,this.resolve()};Promise.all(n).then(()=>{o()}).catch(c=>{this.reject(c)}),0===n.length&&o(),this.initialized=!0}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Lt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),UE=(()=>{var e;class t{log(n){console.log(n)}warn(n){console.warn(n)}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Lt({token:e,factory:e.\u0275fac,providedIn:"platform"}),t})();const Pu=new Ot("LocaleId",{providedIn:"root",factory:()=>It(Pu,kt.Optional|kt.SkipSelf)||function rk(){return typeof $localize<"u"&&$localize.locale||tm}()});let ty=(()=>{var e;class t{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Ei(!1)}add(){this.hasPendingTasks.next(!0);const n=this.taskId++;return this.pendingTasks.add(n),n}remove(n){this.pendingTasks.delete(n),0===this.pendingTasks.size&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this.hasPendingTasks.next(!1)}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Lt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();class ak{constructor(t,i){this.ngModuleFactory=t,this.componentFactories=i}}let jE=(()=>{var e;class t{compileModuleSync(n){return new Rb(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){const o=this.compileModuleSync(n),f=Ia(Pr(n).declarations).reduce((y,E)=>{const A=kn(E);return A&&y.push(new iv(A)),y},[]);return new ak(o,f)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Lt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();function qE(...e){}class ir{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:i=!1,shouldCoalesceRunChangeDetection:n=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Tn(!1),this.onMicrotaskEmpty=new Tn(!1),this.onStable=new Tn(!1),this.onError=new Tn(!1),typeof Zone>"u")throw new ut(908,!1);Zone.assertZonePatched();const o=this;o._nesting=0,o._outer=o._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(o._inner=o._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(o._inner=o._inner.fork(Zone.longStackTraceZoneSpec)),o.shouldCoalesceEventChangeDetection=!n&&i,o.shouldCoalesceRunChangeDetection=n,o.lastRequestAnimationFrameId=-1,o.nativeRequestAnimationFrame=function Dk(){const e="function"==typeof Kn.requestAnimationFrame;let t=Kn[e?"requestAnimationFrame":"setTimeout"],i=Kn[e?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&t&&i){const n=t[Zone.__symbol__("OriginalDelegate")];n&&(t=n);const o=i[Zone.__symbol__("OriginalDelegate")];o&&(i=o)}return{nativeRequestAnimationFrame:t,nativeCancelAnimationFrame:i}}().nativeRequestAnimationFrame,function Ak(e){const t=()=>{!function Ik(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(Kn,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,nw(e),e.isCheckStableRunning=!0,tw(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),nw(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(i,n,o,c,f,y)=>{try{return ZE(e),i.invokeTask(o,c,f,y)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===c.type||e.shouldCoalesceRunChangeDetection)&&t(),WE(e)}},onInvoke:(i,n,o,c,f,y,E)=>{try{return ZE(e),i.invoke(o,c,f,y,E)}finally{e.shouldCoalesceRunChangeDetection&&t(),WE(e)}},onHasTask:(i,n,o,c)=>{i.hasTask(o,c),n===o&&("microTask"==c.change?(e._hasPendingMicrotasks=c.microTask,nw(e),tw(e)):"macroTask"==c.change&&(e.hasPendingMacrotasks=c.macroTask))},onHandleError:(i,n,o,c)=>(i.handleError(o,c),e.runOutsideAngular(()=>e.onError.emit(c)),!1)})}(o)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!ir.isInAngularZone())throw new ut(909,!1)}static assertNotInAngularZone(){if(ir.isInAngularZone())throw new ut(909,!1)}run(t,i,n){return this._inner.run(t,i,n)}runTask(t,i,n,o){const c=this._inner,f=c.scheduleEventTask("NgZoneEvent: "+o,t,Sk,qE,qE);try{return c.runTask(f,i,n)}finally{c.cancelTask(f)}}runGuarded(t,i,n){return this._inner.runGuarded(t,i,n)}runOutsideAngular(t){return this._outer.run(t)}}const Sk={};function tw(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function nw(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function ZE(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function WE(e){e._nesting--,tw(e)}class Pk{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Tn,this.onMicrotaskEmpty=new Tn,this.onStable=new Tn,this.onError=new Tn}run(t,i,n){return t.apply(i,n)}runGuarded(t,i,n){return t.apply(i,n)}runOutsideAngular(t){return t()}runTask(t,i,n,o){return t.apply(i,n)}}const XE=new Ot("",{providedIn:"root",factory:YE});function YE(){const e=It(ir);let t=!0;return bt(new xn(o=>{t=e.isStable&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks,e.runOutsideAngular(()=>{o.next(t),o.complete()})}),new xn(o=>{let c;e.runOutsideAngular(()=>{c=e.onStable.subscribe(()=>{ir.assertNotInAngularZone(),queueMicrotask(()=>{!t&&!e.hasPendingMacrotasks&&!e.hasPendingMicrotasks&&(t=!0,o.next(!0))})})});const f=e.onUnstable.subscribe(()=>{ir.assertInAngularZone(),t&&(t=!1,e.runOutsideAngular(()=>{o.next(!1)}))});return()=>{c.unsubscribe(),f.unsubscribe()}}).pipe(cn()))}const KE=new Ot(""),iy=new Ot("");let ow,iw=(()=>{var e;class t{constructor(n,o,c){this._ngZone=n,this.registry=o,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,ow||(function kk(e){ow=e}(c),c.addToWindow(o)),this._watchAngularEvents(),n.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{ir.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;0!==this._callbacks.length;){let n=this._callbacks.pop();clearTimeout(n.timeoutId),n.doneCb(this._didWork)}this._didWork=!1});else{let n=this.getPendingTasks();this._callbacks=this._callbacks.filter(o=>!o.updateCb||!o.updateCb(n)||(clearTimeout(o.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(n=>({source:n.source,creationLocation:n.creationLocation,data:n.data})):[]}addCallback(n,o,c){let f=-1;o&&o>0&&(f=setTimeout(()=>{this._callbacks=this._callbacks.filter(y=>y.timeoutId!==f),n(this._didWork,this.getPendingTasks())},o)),this._callbacks.push({doneCb:n,timeoutId:f,updateCb:c})}whenStable(n,o,c){if(c&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(n,o,c),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(n){this.registry.registerApplication(n,this)}unregisterApplication(n){this.registry.unregisterApplication(n)}findProviders(n,o,c){return[]}}return(e=t).\u0275fac=function(n){return new(n||e)(Ft(ir),Ft(rw),Ft(iy))},e.\u0275prov=Lt({token:e,factory:e.\u0275fac}),t})(),rw=(()=>{var e;class t{constructor(){this._applications=new Map}registerApplication(n,o){this._applications.set(n,o)}unregisterApplication(n){this._applications.delete(n)}unregisterAllApplications(){this._applications.clear()}getTestability(n){return this._applications.get(n)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(n,o=!0){return ow?.findTestabilityInTree(this,n,o)??null}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Lt({token:e,factory:e.\u0275fac,providedIn:"platform"}),t})(),Kd=null;const JE=new Ot("AllowMultipleToken"),sw=new Ot("PlatformDestroyListeners"),aw=new Ot("appBootstrapListener");class eT{constructor(t,i){this.name=t,this.token=i}}function nT(e,t,i=[]){const n=`Platform: ${t}`,o=new Ot(n);return(c=[])=>{let f=lw();if(!f||f.injector.get(JE,!1)){const y=[...i,...c,{provide:o,useValue:!0}];e?e(y):function Rk(e){if(Kd&&!Kd.get(JE,!1))throw new ut(400,!1);(function QE(){!function se(e){re=e}(()=>{throw new ut(600,!1)})})(),Kd=e;const t=e.get(rT);(function tT(e){e.get(Fd,null)?.forEach(i=>i())})(e)}(function iT(e=[],t){return fo.create({name:t,providers:[{provide:hp,useValue:"platform"},{provide:sw,useValue:new Set([()=>Kd=null])},...e]})}(y,n))}return function Nk(e){const t=lw();if(!t)throw new ut(401,!1);return t}()}}function lw(){return Kd?.get(rT)??null}let rT=(()=>{var e;class t{constructor(n){this._injector=n,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(n,o){const c=function zk(e="zone.js",t){return"noop"===e?new Pk:"zone.js"===e?new ir(t):e}(o?.ngZone,function oT(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}({eventCoalescing:o?.ngZoneEventCoalescing,runCoalescing:o?.ngZoneRunCoalescing}));return c.run(()=>{const f=function W3(e,t,i){return new Lb(e,t,i)}(n.moduleType,this.injector,function uT(e){return[{provide:ir,useFactory:e},{provide:Od,multi:!0,useFactory:()=>{const t=It(Vk,{optional:!0});return()=>t.initialize()}},{provide:cT,useFactory:Bk},{provide:XE,useFactory:YE}]}(()=>c)),y=f.injector.get(yc,null);return c.runOutsideAngular(()=>{const E=c.onError.subscribe({next:A=>{y.handleError(A)}});f.onDestroy(()=>{ry(this._modules,f),E.unsubscribe()})}),function sT(e,t,i){try{const n=i();return lv(n)?n.catch(o=>{throw t.runOutsideAngular(()=>e.handleError(o)),o}):n}catch(n){throw t.runOutsideAngular(()=>e.handleError(n)),n}}(y,c,()=>{const E=f.injector.get(Jb);return E.runInitializers(),E.donePromise.then(()=>(function MM(e){wo(e,"Expected localeId to be defined"),"string"==typeof e&&(CM=e.toLowerCase().replace(/_/g,"-"))}(f.injector.get(Pu,tm)||tm),this._moduleDoBootstrap(f),f))})})}bootstrapModule(n,o=[]){const c=aT({},o);return function Ok(e,t,i){const n=new Rb(i);return Promise.resolve(n)}(0,0,n).then(f=>this.bootstrapModuleFactory(f,c))}_moduleDoBootstrap(n){const o=n.injector.get(rm);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(c=>o.bootstrap(c));else{if(!n.instance.ngDoBootstrap)throw new ut(-403,!1);n.instance.ngDoBootstrap(o)}this._modules.push(n)}onDestroy(n){this._destroyListeners.push(n)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new ut(404,!1);this._modules.slice().forEach(o=>o.destroy()),this._destroyListeners.forEach(o=>o());const n=this._injector.get(sw,null);n&&(n.forEach(o=>o()),n.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return(e=t).\u0275fac=function(n){return new(n||e)(Ft(fo))},e.\u0275prov=Lt({token:e,factory:e.\u0275fac,providedIn:"platform"}),t})();function aT(e,t){return Array.isArray(t)?t.reduce(aT,e):{...e,...t}}let rm=(()=>{var e;class t{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=It(cT),this.zoneIsStable=It(XE),this.componentTypes=[],this.components=[],this.isStable=It(ty).hasPendingTasks.pipe(Ti(n=>n?pt(!1):this.zoneIsStable),function gn(e,t=Uo){return e=e??ro,ri((i,n)=>{let o,c=!0;i.subscribe(ei(n,f=>{const y=t(f);(c||!e(o,y))&&(c=!1,o=y,n.next(f))}))})}(),cn()),this._injector=It(ns)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(n,o){const c=n instanceof D0;if(!this._injector.get(Jb).done)throw!c&&function Ka(e){const t=kn(e)||er(e)||tr(e);return null!==t&&t.standalone}(n),new ut(405,!1);let y;y=c?n:this._injector.get(rs).resolveComponentFactory(n),this.componentTypes.push(y.componentType);const E=function Lk(e){return e.isBoundToModule}(y)?void 0:this._injector.get(Ip),z=y.create(fo.NULL,[],o||y.selector,E),H=z.location.nativeElement,oe=z.injector.get(KE,null);return oe?.registerApplication(H),z.onDestroy(()=>{this.detachView(z.hostView),ry(this.components,z),oe?.unregisterApplication(H)}),this._loadComponent(z),z}tick(){if(this._runningTick)throw new ut(101,!1);try{this._runningTick=!0;for(let n of this._views)n.detectChanges()}catch(n){this.internalErrorHandler(n)}finally{this._runningTick=!1}}attachView(n){const o=n;this._views.push(o),o.attachToAppRef(this)}detachView(n){const o=n;ry(this._views,o),o.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n);const o=this._injector.get(aw,[]);o.push(...this._bootstrapListeners),o.forEach(c=>c(n))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(n=>n()),this._views.slice().forEach(n=>n.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(n){return this._destroyListeners.push(n),()=>ry(this._destroyListeners,n)}destroy(){if(this._destroyed)throw new ut(406,!1);const n=this._injector;n.destroy&&!n.destroyed&&n.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Lt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();function ry(e,t){const i=e.indexOf(t);i>-1&&e.splice(i,1)}const cT=new Ot("",{providedIn:"root",factory:()=>It(yc).handleError.bind(void 0)});function Bk(){const e=It(ir),t=It(yc);return i=>e.runOutsideAngular(()=>t.handleError(i))}let Vk=(()=>{var e;class t{constructor(){this.zone=It(ir),this.applicationRef=It(rm)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Lt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();let om=(()=>{class t{}return t.__NG_ELEMENT_ID__=jk,t})();function jk(e){return function $k(e,t,i){if(ya(e)&&!i){const n=dn(e.index,t);return new nv(n,n)}return 47&e.type?new nv(t[Ri],t):null}(yr(),lt(),16==(16&e))}class fT{constructor(){}supports(t){return V0(t)}create(t){return new Xk(t)}}const Wk=(e,t)=>t;class Xk{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||Wk}forEachItem(t){let i;for(i=this._itHead;null!==i;i=i._next)t(i)}forEachOperation(t){let i=this._itHead,n=this._removalsHead,o=0,c=null;for(;i||n;){const f=!n||i&&i.currentIndex<mT(n,o,c)?i:n,y=mT(f,o,c),E=f.currentIndex;if(f===n)o--,n=n._nextRemoved;else if(i=i._next,null==f.previousIndex)o++;else{c||(c=[]);const A=y-o,z=E-o;if(A!=z){for(let oe=0;oe<A;oe++){const pe=oe<c.length?c[oe]:c[oe]=0,Ie=pe+oe;z<=Ie&&Ie<A&&(c[oe]=pe+1)}c[f.previousIndex]=z-A}}y!==E&&t(f,y,E)}}forEachPreviousItem(t){let i;for(i=this._previousItHead;null!==i;i=i._nextPrevious)t(i)}forEachAddedItem(t){let i;for(i=this._additionsHead;null!==i;i=i._nextAdded)t(i)}forEachMovedItem(t){let i;for(i=this._movesHead;null!==i;i=i._nextMoved)t(i)}forEachRemovedItem(t){let i;for(i=this._removalsHead;null!==i;i=i._nextRemoved)t(i)}forEachIdentityChange(t){let i;for(i=this._identityChangesHead;null!==i;i=i._nextIdentityChange)t(i)}diff(t){if(null==t&&(t=[]),!V0(t))throw new ut(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let o,c,f,i=this._itHead,n=!1;if(Array.isArray(t)){this.length=t.length;for(let y=0;y<this.length;y++)c=t[y],f=this._trackByFn(y,c),null!==i&&Object.is(i.trackById,f)?(n&&(i=this._verifyReinsertion(i,c,f,y)),Object.is(i.item,c)||this._addIdentityChange(i,c)):(i=this._mismatch(i,c,f,y),n=!0),i=i._next}else o=0,function IA(e,t){if(Array.isArray(e))for(let i=0;i<e.length;i++)t(e[i]);else{const i=e[Symbol.iterator]();let n;for(;!(n=i.next()).done;)t(n.value)}}(t,y=>{f=this._trackByFn(o,y),null!==i&&Object.is(i.trackById,f)?(n&&(i=this._verifyReinsertion(i,y,f,o)),Object.is(i.item,y)||this._addIdentityChange(i,y)):(i=this._mismatch(i,y,f,o),n=!0),i=i._next,o++}),this.length=o;return this._truncate(i),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,i,n,o){let c;return null===t?c=this._itTail:(c=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(Object.is(t.item,i)||this._addIdentityChange(t,i),this._reinsertAfter(t,c,o)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(n,o))?(Object.is(t.item,i)||this._addIdentityChange(t,i),this._moveAfter(t,c,o)):t=this._addAfter(new Yk(i,n),c,o),t}_verifyReinsertion(t,i,n,o){let c=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==c?t=this._reinsertAfter(c,t._prev,o):t.currentIndex!=o&&(t.currentIndex=o,this._addToMoves(t,o)),t}_truncate(t){for(;null!==t;){const i=t._next;this._addToRemovals(this._unlink(t)),t=i}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,i,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const o=t._prevRemoved,c=t._nextRemoved;return null===o?this._removalsHead=c:o._nextRemoved=c,null===c?this._removalsTail=o:c._prevRemoved=o,this._insertAfter(t,i,n),this._addToMoves(t,n),t}_moveAfter(t,i,n){return this._unlink(t),this._insertAfter(t,i,n),this._addToMoves(t,n),t}_addAfter(t,i,n){return this._insertAfter(t,i,n),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,i,n){const o=null===i?this._itHead:i._next;return t._next=o,t._prev=i,null===o?this._itTail=t:o._prev=t,null===i?this._itHead=t:i._next=t,null===this._linkedRecords&&(this._linkedRecords=new gT),this._linkedRecords.put(t),t.currentIndex=n,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const i=t._prev,n=t._next;return null===i?this._itHead=n:i._next=n,null===n?this._itTail=i:n._prev=i,t}_addToMoves(t,i){return t.previousIndex===i||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new gT),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,i){return t.item=i,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class Yk{constructor(t,i){this.item=t,this.trackById=i,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class Kk{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,i){let n;for(n=this._head;null!==n;n=n._nextDup)if((null===i||i<=n.currentIndex)&&Object.is(n.trackById,t))return n;return null}remove(t){const i=t._prevDup,n=t._nextDup;return null===i?this._head=n:i._nextDup=n,null===n?this._tail=i:n._prevDup=i,null===this._head}}class gT{constructor(){this.map=new Map}put(t){const i=t.trackById;let n=this.map.get(i);n||(n=new Kk,this.map.set(i,n)),n.add(t)}get(t,i){const o=this.map.get(t);return o?o.get(t,i):null}remove(t){const i=t.trackById;return this.map.get(i).remove(t)&&this.map.delete(i),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function mT(e,t,i){const n=e.previousIndex;if(null===n)return n;let o=0;return i&&n<i.length&&(o=i[n]),n+t+o}class _T{constructor(){}supports(t){return t instanceof Map||fb(t)}create(){return new Jk}}class Jk{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let i;for(i=this._mapHead;null!==i;i=i._next)t(i)}forEachPreviousItem(t){let i;for(i=this._previousMapHead;null!==i;i=i._nextPrevious)t(i)}forEachChangedItem(t){let i;for(i=this._changesHead;null!==i;i=i._nextChanged)t(i)}forEachAddedItem(t){let i;for(i=this._additionsHead;null!==i;i=i._nextAdded)t(i)}forEachRemovedItem(t){let i;for(i=this._removalsHead;null!==i;i=i._nextRemoved)t(i)}diff(t){if(t){if(!(t instanceof Map||fb(t)))throw new ut(900,!1)}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let i=this._mapHead;if(this._appendAfter=null,this._forEach(t,(n,o)=>{if(i&&i.key===o)this._maybeAddToChanges(i,n),this._appendAfter=i,i=i._next;else{const c=this._getOrCreateRecordForKey(o,n);i=this._insertBeforeOrAppend(i,c)}}),i){i._prev&&(i._prev._next=null),this._removalsHead=i;for(let n=i;null!==n;n=n._nextRemoved)n===this._mapHead&&(this._mapHead=null),this._records.delete(n.key),n._nextRemoved=n._next,n.previousValue=n.currentValue,n.currentValue=null,n._prev=null,n._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,i){if(t){const n=t._prev;return i._next=t,i._prev=n,t._prev=i,n&&(n._next=i),t===this._mapHead&&(this._mapHead=i),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=i,i._prev=this._appendAfter):this._mapHead=i,this._appendAfter=i,null}_getOrCreateRecordForKey(t,i){if(this._records.has(t)){const o=this._records.get(t);this._maybeAddToChanges(o,i);const c=o._prev,f=o._next;return c&&(c._next=f),f&&(f._prev=c),o._next=null,o._prev=null,o}const n=new Qk(t);return this._records.set(t,n),n.currentValue=i,this._addToAdditions(n),n}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,i){Object.is(i,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=i,this._addToChanges(t))}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,i){t instanceof Map?t.forEach(i):Object.keys(t).forEach(n=>i(t[n],n))}}class Qk{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function vT(){return new ay([new fT])}let ay=(()=>{var e;class t{constructor(n){this.factories=n}static create(n,o){if(null!=o){const c=o.factories.slice();n=n.concat(c)}return new t(n)}static extend(n){return{provide:t,useFactory:o=>t.create(n,o||vT()),deps:[[t,new Bf,new zf]]}}find(n){const o=this.factories.find(c=>c.supports(n));if(null!=o)return o;throw new ut(901,!1)}}return(e=t).\u0275prov=Lt({token:e,providedIn:"root",factory:vT}),t})();function yT(){return new bv([new _T])}let bv=(()=>{var e;class t{constructor(n){this.factories=n}static create(n,o){if(o){const c=o.factories.slice();n=n.concat(c)}return new t(n)}static extend(n){return{provide:t,useFactory:o=>t.create(n,o||yT()),deps:[[t,new Bf,new zf]]}}find(n){const o=this.factories.find(c=>c.supports(n));if(o)return o;throw new ut(901,!1)}}return(e=t).\u0275prov=Lt({token:e,providedIn:"root",factory:yT}),t})();const nO=nT(null,"core",[]);let iO=(()=>{var e;class t{constructor(n){}}return(e=t).\u0275fac=function(n){return new(n||e)(Ft(rm))},e.\u0275mod=cr({type:e}),e.\u0275inj=lr({}),t})();function sm(e){return"boolean"==typeof e?e:null!=e&&"false"!==e}let fw=null;function Jd(){return fw}class _O{}const Os=new Ot("DocumentToken");let gw=(()=>{var e;class t{historyGo(n){throw new Error("Not implemented")}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Lt({token:e,factory:function(){return It(yO)},providedIn:"platform"}),t})();const vO=new Ot("Location Initialized");let yO=(()=>{var e;class t extends gw{constructor(){super(),this._doc=It(Os),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Jd().getBaseHref(this._doc)}onPopState(n){const o=Jd().getGlobalEventTarget(this._doc,"window");return o.addEventListener("popstate",n,!1),()=>o.removeEventListener("popstate",n)}onHashChange(n){const o=Jd().getGlobalEventTarget(this._doc,"window");return o.addEventListener("hashchange",n,!1),()=>o.removeEventListener("hashchange",n)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(n){this._location.pathname=n}pushState(n,o,c){this._history.pushState(n,o,c)}replaceState(n,o,c){this._history.replaceState(n,o,c)}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Lt({token:e,factory:function(){return new e},providedIn:"platform"}),t})();function mw(e,t){if(0==e.length)return t;if(0==t.length)return e;let i=0;return e.endsWith("/")&&i++,t.startsWith("/")&&i++,2==i?e+t.substring(1):1==i?e+t:e+"/"+t}function DT(e){const t=e.match(/#|\?|$/),i=t&&t.index||e.length;return e.slice(0,i-("/"===e[i-1]?1:0))+e.slice(i)}function ku(e){return e&&"?"!==e[0]?"?"+e:e}let kp=(()=>{var e;class t{historyGo(n){throw new Error("Not implemented")}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Lt({token:e,factory:function(){return It(IT)},providedIn:"root"}),t})();const ST=new Ot("appBaseHref");let IT=(()=>{var e;class t extends kp{constructor(n,o){super(),this._platformLocation=n,this._removeListenerFns=[],this._baseHref=o??this._platformLocation.getBaseHrefFromDOM()??It(Os).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return mw(this._baseHref,n)}path(n=!1){const o=this._platformLocation.pathname+ku(this._platformLocation.search),c=this._platformLocation.hash;return c&&n?`${o}${c}`:o}pushState(n,o,c,f){const y=this.prepareExternalUrl(c+ku(f));this._platformLocation.pushState(n,o,y)}replaceState(n,o,c,f){const y=this.prepareExternalUrl(c+ku(f));this._platformLocation.replaceState(n,o,y)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return(e=t).\u0275fac=function(n){return new(n||e)(Ft(gw),Ft(ST,8))},e.\u0275prov=Lt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),xO=(()=>{var e;class t extends kp{constructor(n,o){super(),this._platformLocation=n,this._baseHref="",this._removeListenerFns=[],null!=o&&(this._baseHref=o)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}path(n=!1){let o=this._platformLocation.hash;return null==o&&(o="#"),o.length>0?o.substring(1):o}prepareExternalUrl(n){const o=mw(this._baseHref,n);return o.length>0?"#"+o:o}pushState(n,o,c,f){let y=this.prepareExternalUrl(c+ku(f));0==y.length&&(y=this._platformLocation.pathname),this._platformLocation.pushState(n,o,y)}replaceState(n,o,c,f){let y=this.prepareExternalUrl(c+ku(f));0==y.length&&(y=this._platformLocation.pathname),this._platformLocation.replaceState(n,o,y)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return(e=t).\u0275fac=function(n){return new(n||e)(Ft(gw),Ft(ST,8))},e.\u0275prov=Lt({token:e,factory:e.\u0275fac}),t})(),_w=(()=>{var e;class t{constructor(n){this._subject=new Tn,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=n;const o=this._locationStrategy.getBaseHref();this._basePath=function CO(e){if(new RegExp("^(https?:)?//").test(e)){const[,i]=e.split(/\/\/[^\/]+/);return i}return e}(DT(AT(o))),this._locationStrategy.onPopState(c=>{this._subject.emit({url:this.path(!0),pop:!0,state:c.state,type:c.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(n=!1){return this.normalize(this._locationStrategy.path(n))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(n,o=""){return this.path()==this.normalize(n+ku(o))}normalize(n){return t.stripTrailingSlash(function wO(e,t){if(!e||!t.startsWith(e))return t;const i=t.substring(e.length);return""===i||["/",";","?","#"].includes(i[0])?i:t}(this._basePath,AT(n)))}prepareExternalUrl(n){return n&&"/"!==n[0]&&(n="/"+n),this._locationStrategy.prepareExternalUrl(n)}go(n,o="",c=null){this._locationStrategy.pushState(c,"",n,o),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+ku(o)),c)}replaceState(n,o="",c=null){this._locationStrategy.replaceState(c,"",n,o),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+ku(o)),c)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(n=0){this._locationStrategy.historyGo?.(n)}onUrlChange(n){return this._urlChangeListeners.push(n),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(o=>{this._notifyUrlChangeListeners(o.url,o.state)})),()=>{const o=this._urlChangeListeners.indexOf(n);this._urlChangeListeners.splice(o,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(n="",o){this._urlChangeListeners.forEach(c=>c(n,o))}subscribe(n,o,c){return this._subject.subscribe({next:n,error:o,complete:c})}}return(e=t).normalizeQueryParams=ku,e.joinWithSlash=mw,e.stripTrailingSlash=DT,e.\u0275fac=function(n){return new(n||e)(Ft(kp))},e.\u0275prov=Lt({token:e,factory:function(){return function bO(){return new _w(Ft(kp))}()},providedIn:"root"}),t})();function AT(e){return e.replace(/\/index.html$/,"")}function BT(e,t){t=encodeURIComponent(t);for(const i of e.split(";")){const n=i.indexOf("="),[o,c]=-1==n?[i,""]:[i.slice(0,n),i.slice(n+1)];if(o.trim()===t)return decodeURIComponent(c)}return null}const Dw=/\s+/,VT=[];let Qd=(()=>{var e;class t{constructor(n,o,c,f){this._iterableDiffers=n,this._keyValueDiffers=o,this._ngEl=c,this._renderer=f,this.initialClasses=VT,this.stateMap=new Map}set klass(n){this.initialClasses=null!=n?n.trim().split(Dw):VT}set ngClass(n){this.rawClass="string"==typeof n?n.trim().split(Dw):n}ngDoCheck(){for(const o of this.initialClasses)this._updateState(o,!0);const n=this.rawClass;if(Array.isArray(n)||n instanceof Set)for(const o of n)this._updateState(o,!0);else if(null!=n)for(const o of Object.keys(n))this._updateState(o,!!n[o]);this._applyStateDiff()}_updateState(n,o){const c=this.stateMap.get(n);void 0!==c?(c.enabled!==o&&(c.changed=!0,c.enabled=o),c.touched=!0):this.stateMap.set(n,{enabled:o,changed:!0,touched:!0})}_applyStateDiff(){for(const n of this.stateMap){const o=n[0],c=n[1];c.changed?(this._toggleClass(o,c.enabled),c.changed=!1):c.touched||(c.enabled&&this._toggleClass(o,!1),this.stateMap.delete(o)),c.touched=!1}}_toggleClass(n,o){(n=n.trim()).length>0&&n.split(Dw).forEach(c=>{o?this._renderer.addClass(this._ngEl.nativeElement,c):this._renderer.removeClass(this._ngEl.nativeElement,c)})}}return(e=t).\u0275fac=function(n){return new(n||e)(G(ay),G(bv),G(Bi),G(Ss))},e.\u0275dir=mt({type:e,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0}),t})();class l4{constructor(t,i,n,o){this.$implicit=t,this.ngForOf=i,this.index=n,this.count=o}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let eh=(()=>{var e;class t{set ngForOf(n){this._ngForOf=n,this._ngForOfDirty=!0}set ngForTrackBy(n){this._trackByFn=n}get ngForTrackBy(){return this._trackByFn}constructor(n,o,c){this._viewContainer=n,this._template=o,this._differs=c,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(n){n&&(this._template=n)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const n=this._ngForOf;!this._differ&&n&&(this._differ=this._differs.find(n).create(this.ngForTrackBy))}if(this._differ){const n=this._differ.diff(this._ngForOf);n&&this._applyChanges(n)}}_applyChanges(n){const o=this._viewContainer;n.forEachOperation((c,f,y)=>{if(null==c.previousIndex)o.createEmbeddedView(this._template,new l4(c.item,this._ngForOf,-1,-1),null===y?void 0:y);else if(null==y)o.remove(null===f?void 0:f);else if(null!==f){const E=o.get(f);o.move(E,y),jT(E,c)}});for(let c=0,f=o.length;c<f;c++){const E=o.get(c).context;E.index=c,E.count=f,E.ngForOf=this._ngForOf}n.forEachIdentityChange(c=>{jT(o.get(c.currentIndex),c)})}static ngTemplateContextGuard(n,o){return!0}}return(e=t).\u0275fac=function(n){return new(n||e)(G(Cl),G(li),G(ay))},e.\u0275dir=mt({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),t})();function jT(e,t){e.context.$implicit=t.item}let Mc=(()=>{var e;class t{constructor(n,o){this._viewContainer=n,this._context=new c4,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=o}set ngIf(n){this._context.$implicit=this._context.ngIf=n,this._updateView()}set ngIfThen(n){$T("ngIfThen",n),this._thenTemplateRef=n,this._thenViewRef=null,this._updateView()}set ngIfElse(n){$T("ngIfElse",n),this._elseTemplateRef=n,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(n,o){return!0}}return(e=t).\u0275fac=function(n){return new(n||e)(G(Cl),G(li))},e.\u0275dir=mt({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),t})();class c4{constructor(){this.$implicit=null,this.ngIf=null}}function $T(e,t){if(t&&!t.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${jn(t)}'.`)}let GT=(()=>{var e;class t{constructor(n,o,c){this._ngEl=n,this._differs=o,this._renderer=c,this._ngStyle=null,this._differ=null}set ngStyle(n){this._ngStyle=n,!this._differ&&n&&(this._differ=this._differs.find(n).create())}ngDoCheck(){if(this._differ){const n=this._differ.diff(this._ngStyle);n&&this._applyChanges(n)}}_setStyle(n,o){const[c,f]=n.split("."),y=-1===c.indexOf("-")?void 0:ni.DashCase;null!=o?this._renderer.setStyle(this._ngEl.nativeElement,c,f?`${o}${f}`:o,y):this._renderer.removeStyle(this._ngEl.nativeElement,c,y)}_applyChanges(n){n.forEachRemovedItem(o=>this._setStyle(o.key,null)),n.forEachAddedItem(o=>this._setStyle(o.key,o.currentValue)),n.forEachChangedItem(o=>this._setStyle(o.key,o.currentValue))}}return(e=t).\u0275fac=function(n){return new(n||e)(G(Bi),G(bv),G(Ss))},e.\u0275dir=mt({type:e,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0}),t})(),Aw=(()=>{var e;class t{constructor(n){this._viewContainerRef=n,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(n){if(n.ngTemplateOutlet||n.ngTemplateOutletInjector){const o=this._viewContainerRef;if(this._viewRef&&o.remove(o.indexOf(this._viewRef)),this.ngTemplateOutlet){const{ngTemplateOutlet:c,ngTemplateOutletContext:f,ngTemplateOutletInjector:y}=this;this._viewRef=o.createEmbeddedView(c,f,y?{injector:y}:void 0)}else this._viewRef=null}else this._viewRef&&n.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}}return(e=t).\u0275fac=function(n){return new(n||e)(G(Cl))},e.\u0275dir=mt({type:e,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[Ee]}),t})(),ZT=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=cr({type:e}),e.\u0275inj=lr({}),t})();function XT(e){return"server"===e}let z4=(()=>{var e;class t{}return(e=t).\u0275prov=Lt({token:e,providedIn:"root",factory:()=>new B4(Ft(Os),window)}),t})();class B4{constructor(t,i){this.document=t,this.window=i,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const i=function V4(e,t){const i=e.getElementById(t)||e.getElementsByName(t)[0];if(i)return i;if("function"==typeof e.createTreeWalker&&e.body&&"function"==typeof e.body.attachShadow){const n=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let o=n.currentNode;for(;o;){const c=o.shadowRoot;if(c){const f=c.getElementById(t)||c.querySelector(`[name="${t}"]`);if(f)return f}o=n.nextNode()}}return null}(this.document,t);i&&(this.scrollToElement(i),i.focus())}setHistoryScrollRestoration(t){this.supportsScrolling()&&(this.window.history.scrollRestoration=t)}scrollToElement(t){const i=t.getBoundingClientRect(),n=i.left+this.window.pageXOffset,o=i.top+this.window.pageYOffset,c=this.offset();this.window.scrollTo(n-c[0],o-c[1])}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}class YT{}class cL extends _O{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class Rw extends cL{static makeCurrent(){!function mO(e){fw||(fw=e)}(new Rw)}onAndCancel(t,i,n){return t.addEventListener(i,n),()=>{t.removeEventListener(i,n)}}dispatchEvent(t,i){t.dispatchEvent(i)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,i){return(i=i||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,i){return"window"===i?window:"document"===i?t:"body"===i?t.body:null}getBaseHref(t){const i=function uL(){return Ev=Ev||document.querySelector("base"),Ev?Ev.getAttribute("href"):null}();return null==i?null:function dL(e){by=by||document.createElement("a"),by.setAttribute("href",e);const t=by.pathname;return"/"===t.charAt(0)?t:`/${t}`}(i)}resetBaseElement(){Ev=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return BT(document.cookie,t)}}let by,Ev=null,pL=(()=>{var e;class t{build(){return new XMLHttpRequest}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Lt({token:e,factory:e.\u0275fac}),t})();const Fw=new Ot("EventManagerPlugins");let tD=(()=>{var e;class t{constructor(n,o){this._zone=o,this._eventNameToPlugin=new Map,n.forEach(c=>{c.manager=this}),this._plugins=n.slice().reverse()}addEventListener(n,o,c){return this._findPluginFor(o).addEventListener(n,o,c)}getZone(){return this._zone}_findPluginFor(n){let o=this._eventNameToPlugin.get(n);if(o)return o;if(o=this._plugins.find(f=>f.supports(n)),!o)throw new ut(5101,!1);return this._eventNameToPlugin.set(n,o),o}}return(e=t).\u0275fac=function(n){return new(n||e)(Ft(Fw),Ft(ir))},e.\u0275prov=Lt({token:e,factory:e.\u0275fac}),t})();class nD{constructor(t){this._doc=t}}const Nw="ng-app-id";let iD=(()=>{var e;class t{constructor(n,o,c,f={}){this.doc=n,this.appId=o,this.nonce=c,this.platformId=f,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=XT(f),this.resetHostNodes()}addStyles(n){for(const o of n)1===this.changeUsageCount(o,1)&&this.onStyleAdded(o)}removeStyles(n){for(const o of n)this.changeUsageCount(o,-1)<=0&&this.onStyleRemoved(o)}ngOnDestroy(){const n=this.styleNodesInDOM;n&&(n.forEach(o=>o.remove()),n.clear());for(const o of this.getAllStyles())this.onStyleRemoved(o);this.resetHostNodes()}addHost(n){this.hostNodes.add(n);for(const o of this.getAllStyles())this.addStyleToHost(n,o)}removeHost(n){this.hostNodes.delete(n)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(n){for(const o of this.hostNodes)this.addStyleToHost(o,n)}onStyleRemoved(n){const o=this.styleRef;o.get(n)?.elements?.forEach(c=>c.remove()),o.delete(n)}collectServerRenderedStyles(){const n=this.doc.head?.querySelectorAll(`style[${Nw}="${this.appId}"]`);if(n?.length){const o=new Map;return n.forEach(c=>{null!=c.textContent&&o.set(c.textContent,c)}),o}return null}changeUsageCount(n,o){const c=this.styleRef;if(c.has(n)){const f=c.get(n);return f.usage+=o,f.usage}return c.set(n,{usage:o,elements:[]}),o}getStyleElement(n,o){const c=this.styleNodesInDOM,f=c?.get(o);if(f?.parentNode===n)return c.delete(o),f.removeAttribute(Nw),f;{const y=this.doc.createElement("style");return this.nonce&&y.setAttribute("nonce",this.nonce),y.textContent=o,this.platformIsServer&&y.setAttribute(Nw,this.appId),y}}addStyleToHost(n,o){const c=this.getStyleElement(n,o);n.appendChild(c);const f=this.styleRef,y=f.get(o)?.elements;y?y.push(c):f.set(o,{elements:[c],usage:1})}resetHostNodes(){const n=this.hostNodes;n.clear(),n.add(this.doc.head)}}return(e=t).\u0275fac=function(n){return new(n||e)(Ft(Os),Ft(Ks),Ft(fp,8),Ft(Js))},e.\u0275prov=Lt({token:e,factory:e.\u0275fac}),t})();const zw={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Bw=/%COMP%/g,_L=new Ot("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>!1});function oD(e,t){return t.map(i=>i.replace(Bw,e))}let sD=(()=>{var e;class t{constructor(n,o,c,f,y,E,A,z=null){this.eventManager=n,this.sharedStylesHost=o,this.appId=c,this.removeStylesOnCompDestroy=f,this.doc=y,this.platformId=E,this.ngZone=A,this.nonce=z,this.rendererByCompId=new Map,this.platformIsServer=XT(E),this.defaultRenderer=new Vw(n,y,A,this.platformIsServer)}createRenderer(n,o){if(!n||!o)return this.defaultRenderer;this.platformIsServer&&o.encapsulation===Qi.ShadowDom&&(o={...o,encapsulation:Qi.Emulated});const c=this.getOrCreateRenderer(n,o);return c instanceof lD?c.applyToHost(n):c instanceof Uw&&c.applyStyles(),c}getOrCreateRenderer(n,o){const c=this.rendererByCompId;let f=c.get(o.id);if(!f){const y=this.doc,E=this.ngZone,A=this.eventManager,z=this.sharedStylesHost,H=this.removeStylesOnCompDestroy,oe=this.platformIsServer;switch(o.encapsulation){case Qi.Emulated:f=new lD(A,z,o,this.appId,H,y,E,oe);break;case Qi.ShadowDom:return new bL(A,z,n,o,y,E,this.nonce,oe);default:f=new Uw(A,z,o,H,y,E,oe)}c.set(o.id,f)}return f}ngOnDestroy(){this.rendererByCompId.clear()}}return(e=t).\u0275fac=function(n){return new(n||e)(Ft(tD),Ft(iD),Ft(Ks),Ft(_L),Ft(Os),Ft(Js),Ft(ir),Ft(fp))},e.\u0275prov=Lt({token:e,factory:e.\u0275fac}),t})();class Vw{constructor(t,i,n,o){this.eventManager=t,this.doc=i,this.ngZone=n,this.platformIsServer=o,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,i){return i?this.doc.createElementNS(zw[i]||i,t):this.doc.createElement(t)}createComment(t){return this.doc.createComment(t)}createText(t){return this.doc.createTextNode(t)}appendChild(t,i){(aD(t)?t.content:t).appendChild(i)}insertBefore(t,i,n){t&&(aD(t)?t.content:t).insertBefore(i,n)}removeChild(t,i){t&&t.removeChild(i)}selectRootElement(t,i){let n="string"==typeof t?this.doc.querySelector(t):t;if(!n)throw new ut(-5104,!1);return i||(n.textContent=""),n}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,i,n,o){if(o){i=o+":"+i;const c=zw[o];c?t.setAttributeNS(c,i,n):t.setAttribute(i,n)}else t.setAttribute(i,n)}removeAttribute(t,i,n){if(n){const o=zw[n];o?t.removeAttributeNS(o,i):t.removeAttribute(`${n}:${i}`)}else t.removeAttribute(i)}addClass(t,i){t.classList.add(i)}removeClass(t,i){t.classList.remove(i)}setStyle(t,i,n,o){o&(ni.DashCase|ni.Important)?t.style.setProperty(i,n,o&ni.Important?"important":""):t.style[i]=n}removeStyle(t,i,n){n&ni.DashCase?t.style.removeProperty(i):t.style[i]=""}setProperty(t,i,n){t[i]=n}setValue(t,i){t.nodeValue=i}listen(t,i,n){if("string"==typeof t&&!(t=Jd().getGlobalEventTarget(this.doc,t)))throw new Error(`Unsupported event target ${t} for event ${i}`);return this.eventManager.addEventListener(t,i,this.decoratePreventDefault(n))}decoratePreventDefault(t){return i=>{if("__ngUnwrap__"===i)return t;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>t(i)):t(i))&&i.preventDefault()}}}function aD(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class bL extends Vw{constructor(t,i,n,o,c,f,y,E){super(t,c,f,E),this.sharedStylesHost=i,this.hostEl=n,this.shadowRoot=n.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const A=oD(o.id,o.styles);for(const z of A){const H=document.createElement("style");y&&H.setAttribute("nonce",y),H.textContent=z,this.shadowRoot.appendChild(H)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}appendChild(t,i){return super.appendChild(this.nodeOrShadowRoot(t),i)}insertBefore(t,i,n){return super.insertBefore(this.nodeOrShadowRoot(t),i,n)}removeChild(t,i){return super.removeChild(this.nodeOrShadowRoot(t),i)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class Uw extends Vw{constructor(t,i,n,o,c,f,y,E){super(t,c,f,y),this.sharedStylesHost=i,this.removeStylesOnCompDestroy=o,this.styles=E?oD(E,n.styles):n.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class lD extends Uw{constructor(t,i,n,o,c,f,y,E){const A=o+"-"+n.id;super(t,i,n,c,f,y,E,A),this.contentAttr=function vL(e){return"_ngcontent-%COMP%".replace(Bw,e)}(A),this.hostAttr=function yL(e){return"_nghost-%COMP%".replace(Bw,e)}(A)}applyToHost(t){this.applyStyles(),this.setAttribute(t,this.hostAttr,"")}createElement(t,i){const n=super.createElement(t,i);return super.setAttribute(n,this.contentAttr,""),n}}let wL=(()=>{var e;class t extends nD{constructor(n){super(n)}supports(n){return!0}addEventListener(n,o,c){return n.addEventListener(o,c,!1),()=>this.removeEventListener(n,o,c)}removeEventListener(n,o,c){return n.removeEventListener(o,c)}}return(e=t).\u0275fac=function(n){return new(n||e)(Ft(Os))},e.\u0275prov=Lt({token:e,factory:e.\u0275fac}),t})();const cD=["alt","control","meta","shift"],CL={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},ML={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let EL=(()=>{var e;class t extends nD{constructor(n){super(n)}supports(n){return null!=t.parseEventName(n)}addEventListener(n,o,c){const f=t.parseEventName(o),y=t.eventCallback(f.fullKey,c,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Jd().onAndCancel(n,f.domEventName,y))}static parseEventName(n){const o=n.toLowerCase().split("."),c=o.shift();if(0===o.length||"keydown"!==c&&"keyup"!==c)return null;const f=t._normalizeKey(o.pop());let y="",E=o.indexOf("code");if(E>-1&&(o.splice(E,1),y="code."),cD.forEach(z=>{const H=o.indexOf(z);H>-1&&(o.splice(H,1),y+=z+".")}),y+=f,0!=o.length||0===f.length)return null;const A={};return A.domEventName=c,A.fullKey=y,A}static matchEventFullKeyCode(n,o){let c=CL[n.key]||n.key,f="";return o.indexOf("code.")>-1&&(c=n.code,f="code."),!(null==c||!c)&&(c=c.toLowerCase()," "===c?c="space":"."===c&&(c="dot"),cD.forEach(y=>{y!==c&&(0,ML[y])(n)&&(f+=y+".")}),f+=c,f===o)}static eventCallback(n,o,c){return f=>{t.matchEventFullKeyCode(f,n)&&c.runGuarded(()=>o(f))}}static _normalizeKey(n){return"esc"===n?"escape":n}}return(e=t).\u0275fac=function(n){return new(n||e)(Ft(Os))},e.\u0275prov=Lt({token:e,factory:e.\u0275fac}),t})();const IL=nT(nO,"browser",[{provide:Js,useValue:"browser"},{provide:Fd,useValue:function TL(){Rw.makeCurrent()},multi:!0},{provide:Os,useFactory:function SL(){return function Hx(e){w_=e}(document),document},deps:[]}]),AL=new Ot(""),hD=[{provide:iy,useClass:class hL{addToWindow(t){Kn.getAngularTestability=(n,o=!0)=>{const c=t.findTestabilityInTree(n,o);if(null==c)throw new ut(5103,!1);return c},Kn.getAllAngularTestabilities=()=>t.getAllTestabilities(),Kn.getAllAngularRootElements=()=>t.getAllRootElements(),Kn.frameworkStabilizers||(Kn.frameworkStabilizers=[]),Kn.frameworkStabilizers.push(n=>{const o=Kn.getAllAngularTestabilities();let c=o.length,f=!1;const y=function(E){f=f||E,c--,0==c&&n(f)};o.forEach(E=>{E.whenStable(y)})})}findTestabilityInTree(t,i,n){return null==i?null:t.getTestability(i)??(n?Jd().isShadowRoot(i)?this.findTestabilityInTree(t,i.host,!0):this.findTestabilityInTree(t,i.parentElement,!0):null)}},deps:[]},{provide:KE,useClass:iw,deps:[ir,rw,iy]},{provide:iw,useClass:iw,deps:[ir,rw,iy]}],pD=[{provide:hp,useValue:"root"},{provide:yc,useFactory:function DL(){return new yc},deps:[]},{provide:Fw,useClass:wL,multi:!0,deps:[Os,ir,Js]},{provide:Fw,useClass:EL,multi:!0,deps:[Os]},sD,iD,tD,{provide:G_,useExisting:sD},{provide:YT,useClass:pL,deps:[]},[]];let PL=(()=>{var e;class t{constructor(n){}static withServerTransition(n){return{ngModule:t,providers:[{provide:Ks,useValue:n.appId}]}}}return(e=t).\u0275fac=function(n){return new(n||e)(Ft(AL,12))},e.\u0275mod=cr({type:e}),e.\u0275inj=lr({providers:[...pD,...hD],imports:[ZT,iO]}),t})(),fD=(()=>{var e;class t{constructor(n){this._doc=n}getTitle(){return this._doc.title}setTitle(n){this._doc.title=n||""}}return(e=t).\u0275fac=function(n){return new(n||e)(Ft(Os))},e.\u0275prov=Lt({token:e,factory:function(n){let o=null;return o=n?new n:function OL(){return new fD(Ft(Os))}(),o},providedIn:"root"}),t})();typeof window<"u"&&window;const{isArray:zL}=Array,{getPrototypeOf:BL,prototype:VL,keys:UL}=Object;function vD(e){if(1===e.length){const t=e[0];if(zL(t))return{args:t,keys:null};if(function jL(e){return e&&"object"==typeof e&&BL(e)===VL}(t)){const i=UL(t);return{args:i.map(n=>t[n]),keys:i}}}return{args:e,keys:null}}const{isArray:$L}=Array;function $w(e){return En(t=>function HL(e,t){return $L(t)?e(...t):e(t)}(e,t))}function yD(e,t){return e.reduce((i,n,o)=>(i[n]=t[o],i),{})}function xD(...e){const t=Wu(e),{args:i,keys:n}=vD(e),o=new xn(c=>{const{length:f}=i;if(!f)return void c.complete();const y=new Array(f);let E=f,A=f;for(let z=0;z<f;z++){let H=!1;An(i[z]).subscribe(ei(c,oe=>{H||(H=!0,A--),y[z]=oe},()=>E--,void 0,()=>{(!E||!H)&&(A||c.next(n?yD(n,y):y),c.complete())}))}});return t?o.pipe($w(t)):o}let bD=(()=>{var e;class t{constructor(n,o){this._renderer=n,this._elementRef=o,this.onChange=c=>{},this.onTouched=()=>{}}setProperty(n,o){this._renderer.setProperty(this._elementRef.nativeElement,n,o)}registerOnTouched(n){this.onTouched=n}registerOnChange(n){this.onChange=n}setDisabledState(n){this.setProperty("disabled",n)}}return(e=t).\u0275fac=function(n){return new(n||e)(G(Ss),G(Bi))},e.\u0275dir=mt({type:e}),t})(),Op=(()=>{var e;class t extends bD{}return(e=t).\u0275fac=function(){let i;return function(o){return(i||(i=nr(e)))(o||e)}}(),e.\u0275dir=mt({type:e,features:[yi]}),t})();const Tl=new Ot("NgValueAccessor"),GL={provide:Tl,useExisting:Pn(()=>Hw),multi:!0};let Hw=(()=>{var e;class t extends Op{writeValue(n){this.setProperty("checked",n)}}return(e=t).\u0275fac=function(){let i;return function(o){return(i||(i=nr(e)))(o||e)}}(),e.\u0275dir=mt({type:e,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(n,o){1&n&&ye("change",function(f){return o.onChange(f.target.checked)})("blur",function(){return o.onTouched()})},features:[Yi([GL]),yi]}),t})();const qL={provide:Tl,useExisting:Pn(()=>nh),multi:!0},WL=new Ot("CompositionEventMode");let nh=(()=>{var e;class t extends bD{constructor(n,o,c){super(n,o),this._compositionMode=c,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function ZL(){const e=Jd()?Jd().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}())}writeValue(n){this.setProperty("value",n??"")}_handleInput(n){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(n)}_compositionStart(){this._composing=!0}_compositionEnd(n){this._composing=!1,this._compositionMode&&this.onChange(n)}}return(e=t).\u0275fac=function(n){return new(n||e)(G(Ss),G(Bi),G(WL,8))},e.\u0275dir=mt({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(n,o){1&n&&ye("input",function(f){return o._handleInput(f.target.value)})("blur",function(){return o.onTouched()})("compositionstart",function(){return o._compositionStart()})("compositionend",function(f){return o._compositionEnd(f.target.value)})},features:[Yi([qL]),yi]}),t})();function ih(e){return null==e||("string"==typeof e||Array.isArray(e))&&0===e.length}const No=new Ot("NgValidators"),rh=new Ot("NgAsyncValidators");function ED(e){return ih(e.value)?{required:!0}:null}function wy(e){return null}function PD(e){return null!=e}function kD(e){return lv(e)?bi(e):e}function OD(e){let t={};return e.forEach(i=>{t=null!=i?{...t,...i}:t}),0===Object.keys(t).length?null:t}function LD(e,t){return t.map(i=>i(e))}function RD(e){return e.map(t=>function YL(e){return!e.validate}(t)?t:i=>t.validate(i))}function Gw(e){return null!=e?function FD(e){if(!e)return null;const t=e.filter(PD);return 0==t.length?null:function(i){return OD(LD(i,t))}}(RD(e)):null}function qw(e){return null!=e?function ND(e){if(!e)return null;const t=e.filter(PD);return 0==t.length?null:function(i){return xD(LD(i,t).map(kD)).pipe(En(OD))}}(RD(e)):null}function zD(e,t){return null===e?[t]:Array.isArray(e)?[...e,t]:[e,t]}function Zw(e){return e?Array.isArray(e)?e:[e]:[]}function Cy(e,t){return Array.isArray(e)?e.includes(t):e===t}function UD(e,t){const i=Zw(t);return Zw(e).forEach(o=>{Cy(i,o)||i.push(o)}),i}function jD(e,t){return Zw(t).filter(i=>!Cy(e,i))}class $D{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=Gw(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=qw(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t=void 0){this.control&&this.control.reset(t)}hasError(t,i){return!!this.control&&this.control.hasError(t,i)}getError(t,i){return this.control?this.control.getError(t,i):null}}class cs extends $D{get formDirective(){return null}get path(){return null}}class oh extends $D{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class HD{constructor(t){this._cd=t}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let Lp=(()=>{var e;class t extends HD{constructor(n){super(n)}}return(e=t).\u0275fac=function(n){return new(n||e)(G(oh,2))},e.\u0275dir=mt({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(n,o){2&n&&ka("ng-untouched",o.isUntouched)("ng-touched",o.isTouched)("ng-pristine",o.isPristine)("ng-dirty",o.isDirty)("ng-valid",o.isValid)("ng-invalid",o.isInvalid)("ng-pending",o.isPending)},features:[yi]}),t})(),Tv=(()=>{var e;class t extends HD{constructor(n){super(n)}}return(e=t).\u0275fac=function(n){return new(n||e)(G(cs,10))},e.\u0275dir=mt({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(n,o){2&n&&ka("ng-untouched",o.isUntouched)("ng-touched",o.isTouched)("ng-pristine",o.isPristine)("ng-dirty",o.isDirty)("ng-valid",o.isValid)("ng-invalid",o.isInvalid)("ng-pending",o.isPending)("ng-submitted",o.isSubmitted)},features:[yi]}),t})();const Dv="VALID",Ey="INVALID",lm="PENDING",Sv="DISABLED";function Yw(e){return(Ty(e)?e.validators:e)||null}function Kw(e,t){return(Ty(t)?t.asyncValidators:e)||null}function Ty(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}class WD{constructor(t,i){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(t),this._assignAsyncValidators(i)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get valid(){return this.status===Dv}get invalid(){return this.status===Ey}get pending(){return this.status==lm}get disabled(){return this.status===Sv}get enabled(){return this.status!==Sv}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._assignValidators(t)}setAsyncValidators(t){this._assignAsyncValidators(t)}addValidators(t){this.setValidators(UD(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(UD(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(jD(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(jD(t,this._rawAsyncValidators))}hasValidator(t){return Cy(this._rawValidators,t)}hasAsyncValidator(t){return Cy(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){this.touched=!0,this._parent&&!t.onlySelf&&this._parent.markAsTouched(t)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(t=>t.markAllAsTouched())}markAsUntouched(t={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(i=>{i.markAsUntouched({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}markAsDirty(t={}){this.pristine=!1,this._parent&&!t.onlySelf&&this._parent.markAsDirty(t)}markAsPristine(t={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(i=>{i.markAsPristine({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}markAsPending(t={}){this.status=lm,!1!==t.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!t.onlySelf&&this._parent.markAsPending(t)}disable(t={}){const i=this._parentMarkedDirty(t.onlySelf);this.status=Sv,this.errors=null,this._forEachChild(n=>{n.disable({...t,onlySelf:!0})}),this._updateValue(),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...t,skipPristineCheck:i}),this._onDisabledChange.forEach(n=>n(!0))}enable(t={}){const i=this._parentMarkedDirty(t.onlySelf);this.status=Dv,this._forEachChild(n=>{n.enable({...t,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors({...t,skipPristineCheck:i}),this._onDisabledChange.forEach(n=>n(!1))}_updateAncestors(t){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(t){this._parent=t}getRawValue(){return this.value}updateValueAndValidity(t={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Dv||this.status===lm)&&this._runAsyncValidator(t.emitEvent)),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(t)}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(i=>i._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Sv:Dv}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t){if(this.asyncValidator){this.status=lm,this._hasOwnPendingAsyncValidator=!0;const i=kD(this.asyncValidator(this));this._asyncValidationSubscription=i.subscribe(n=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(n,{emitEvent:t})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(t,i={}){this.errors=t,this._updateControlsErrors(!1!==i.emitEvent)}get(t){let i=t;return null==i||(Array.isArray(i)||(i=i.split(".")),0===i.length)?null:i.reduce((n,o)=>n&&n._find(o),this)}getError(t,i){const n=i?this.get(i):this;return n&&n.errors?n.errors[t]:null}hasError(t,i){return!!this.getError(t,i)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(t)}_initObservables(){this.valueChanges=new Tn,this.statusChanges=new Tn}_calculateStatus(){return this._allControlsDisabled()?Sv:this.errors?Ey:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(lm)?lm:this._anyControlsHaveStatus(Ey)?Ey:Dv}_anyControlsHaveStatus(t){return this._anyControls(i=>i.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t={}){this.pristine=!this._anyControlsDirty(),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}_updateTouched(t={}){this.touched=this._anyControlsTouched(),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){Ty(t)&&null!=t.updateOn&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){return!t&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(t){return null}_assignValidators(t){this._rawValidators=Array.isArray(t)?t.slice():t,this._composedValidatorFn=function eR(e){return Array.isArray(e)?Gw(e):e||null}(this._rawValidators)}_assignAsyncValidators(t){this._rawAsyncValidators=Array.isArray(t)?t.slice():t,this._composedAsyncValidatorFn=function tR(e){return Array.isArray(e)?qw(e):e||null}(this._rawAsyncValidators)}}class Jw extends WD{constructor(t,i,n){super(Yw(i),Kw(n,i)),this.controls=t,this._initObservables(),this._setUpdateStrategy(i),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(t,i){return this.controls[t]?this.controls[t]:(this.controls[t]=i,i.setParent(this),i._registerOnCollectionChange(this._onCollectionChange),i)}addControl(t,i,n={}){this.registerControl(t,i),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}removeControl(t,i={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}setControl(t,i,n={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],i&&this.registerControl(t,i),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,i={}){(function ZD(e,t,i){e._forEachChild((n,o)=>{if(void 0===i[o])throw new ut(1002,"")})})(this,0,t),Object.keys(t).forEach(n=>{(function qD(e,t,i){const n=e.controls;if(!(t?Object.keys(n):n).length)throw new ut(1e3,"");if(!n[i])throw new ut(1001,"")})(this,!0,n),this.controls[n].setValue(t[n],{onlySelf:!0,emitEvent:i.emitEvent})}),this.updateValueAndValidity(i)}patchValue(t,i={}){null!=t&&(Object.keys(t).forEach(n=>{const o=this.controls[n];o&&o.patchValue(t[n],{onlySelf:!0,emitEvent:i.emitEvent})}),this.updateValueAndValidity(i))}reset(t={},i={}){this._forEachChild((n,o)=>{n.reset(t[o],{onlySelf:!0,emitEvent:i.emitEvent})}),this._updatePristine(i),this._updateTouched(i),this.updateValueAndValidity(i)}getRawValue(){return this._reduceChildren({},(t,i,n)=>(t[n]=i.getRawValue(),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(i,n)=>!!n._syncPendingControls()||i);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){Object.keys(this.controls).forEach(i=>{const n=this.controls[i];n&&t(n,i)})}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){for(const[i,n]of Object.entries(this.controls))if(this.contains(i)&&t(n))return!0;return!1}_reduceValue(){return this._reduceChildren({},(i,n,o)=>((n.enabled||this.disabled)&&(i[o]=n.value),i))}_reduceChildren(t,i){let n=t;return this._forEachChild((o,c)=>{n=i(n,o,c)}),n}_allControlsDisabled(){for(const t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(t){return this.controls.hasOwnProperty(t)?this.controls[t]:null}}const Rp=new Ot("CallSetDisabledState",{providedIn:"root",factory:()=>Iv}),Iv="always";function Av(e,t,i=Iv){Qw(e,t),t.valueAccessor.writeValue(e.value),(e.disabled||"always"===i)&&t.valueAccessor.setDisabledState?.(e.disabled),function rR(e,t){t.valueAccessor.registerOnChange(i=>{e._pendingValue=i,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&XD(e,t)})}(e,t),function sR(e,t){const i=(n,o)=>{t.valueAccessor.writeValue(n),o&&t.viewToModelUpdate(n)};e.registerOnChange(i),t._registerOnDestroy(()=>{e._unregisterOnChange(i)})}(e,t),function oR(e,t){t.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&XD(e,t),"submit"!==e.updateOn&&e.markAsTouched()})}(e,t),function iR(e,t){if(t.valueAccessor.setDisabledState){const i=n=>{t.valueAccessor.setDisabledState(n)};e.registerOnDisabledChange(i),t._registerOnDestroy(()=>{e._unregisterOnDisabledChange(i)})}}(e,t)}function Iy(e,t){e.forEach(i=>{i.registerOnValidatorChange&&i.registerOnValidatorChange(t)})}function Qw(e,t){const i=function BD(e){return e._rawValidators}(e);null!==t.validator?e.setValidators(zD(i,t.validator)):"function"==typeof i&&e.setValidators([i]);const n=function VD(e){return e._rawAsyncValidators}(e);null!==t.asyncValidator?e.setAsyncValidators(zD(n,t.asyncValidator)):"function"==typeof n&&e.setAsyncValidators([n]);const o=()=>e.updateValueAndValidity();Iy(t._rawValidators,o),Iy(t._rawAsyncValidators,o)}function XD(e,t){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}const dR={provide:cs,useExisting:Pn(()=>Fp)},Pv=(()=>Promise.resolve())();let Fp=(()=>{var e;class t extends cs{constructor(n,o,c){super(),this.callSetDisabledState=c,this.submitted=!1,this._directives=new Set,this.ngSubmit=new Tn,this.form=new Jw({},Gw(n),qw(o))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(n){Pv.then(()=>{const o=this._findContainer(n.path);n.control=o.registerControl(n.name,n.control),Av(n.control,n,this.callSetDisabledState),n.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(n)})}getControl(n){return this.form.get(n.path)}removeControl(n){Pv.then(()=>{const o=this._findContainer(n.path);o&&o.removeControl(n.name),this._directives.delete(n)})}addFormGroup(n){Pv.then(()=>{const o=this._findContainer(n.path),c=new Jw({});(function YD(e,t){Qw(e,t)})(c,n),o.registerControl(n.name,c),c.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(n){Pv.then(()=>{const o=this._findContainer(n.path);o&&o.removeControl(n.name)})}getFormGroup(n){return this.form.get(n.path)}updateModel(n,o){Pv.then(()=>{this.form.get(n.path).setValue(o)})}setValue(n){this.control.setValue(n)}onSubmit(n){return this.submitted=!0,function KD(e,t){e._syncPendingControls(),t.forEach(i=>{const n=i.control;"submit"===n.updateOn&&n._pendingChange&&(i.viewToModelUpdate(n._pendingValue),n._pendingChange=!1)})}(this.form,this._directives),this.ngSubmit.emit(n),"dialog"===n?.target?.method}onReset(){this.resetForm()}resetForm(n=void 0){this.form.reset(n),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(n){return n.pop(),n.length?this.form.get(n):this.form}}return(e=t).\u0275fac=function(n){return new(n||e)(G(No,10),G(rh,10),G(Rp,8))},e.\u0275dir=mt({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(n,o){1&n&&ye("submit",function(f){return o.onSubmit(f)})("reset",function(){return o.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Yi([dR]),yi]}),t})();function JD(e,t){const i=e.indexOf(t);i>-1&&e.splice(i,1)}function QD(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}const eS=class extends WD{constructor(t=null,i,n){super(Yw(i),Kw(n,i)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(t),this._setUpdateStrategy(i),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Ty(i)&&(i.nonNullable||i.initialValueIsDefault)&&(this.defaultValue=QD(t)?t.value:t)}setValue(t,i={}){this.value=this._pendingValue=t,this._onChange.length&&!1!==i.emitModelToViewChange&&this._onChange.forEach(n=>n(this.value,!1!==i.emitViewToModelChange)),this.updateValueAndValidity(i)}patchValue(t,i={}){this.setValue(t,i)}reset(t=this.defaultValue,i={}){this._applyFormState(t),this.markAsPristine(i),this.markAsUntouched(i),this.setValue(this.value,i),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){JD(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){JD(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(t){QD(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}},fR={provide:oh,useExisting:Pn(()=>sh)},iS=(()=>Promise.resolve())();let sh=(()=>{var e;class t extends oh{constructor(n,o,c,f,y,E){super(),this._changeDetectorRef=y,this.callSetDisabledState=E,this.control=new eS,this._registered=!1,this.name="",this.update=new Tn,this._parent=n,this._setValidators(o),this._setAsyncValidators(c),this.valueAccessor=function nC(e,t){if(!t)return null;let i,n,o;return Array.isArray(t),t.forEach(c=>{c.constructor===nh?i=c:function cR(e){return Object.getPrototypeOf(e.constructor)===Op}(c)?n=c:o=c}),o||n||i||null}(0,f)}ngOnChanges(n){if(this._checkForErrors(),!this._registered||"name"in n){if(this._registered&&(this._checkName(),this.formDirective)){const o=n.name.previousValue;this.formDirective.removeControl({name:o,path:this._getPath(o)})}this._setUpControl()}"isDisabled"in n&&this._updateDisabled(n),function tC(e,t){if(!e.hasOwnProperty("model"))return!1;const i=e.model;return!!i.isFirstChange()||!Object.is(t,i.currentValue)}(n,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(n){this.viewModel=n,this.update.emit(n)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){Av(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(n){iS.then(()=>{this.control.setValue(n,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(n){const o=n.isDisabled.currentValue,c=0!==o&&sm(o);iS.then(()=>{c&&!this.control.disabled?this.control.disable():!c&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(n){return this._parent?function Dy(e,t){return[...t.path,e]}(n,this._parent):[n]}}return(e=t).\u0275fac=function(n){return new(n||e)(G(cs,9),G(No,10),G(rh,10),G(Tl,10),G(om,8),G(Rp,8))},e.\u0275dir=mt({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Yi([fR]),yi,Ee]}),t})(),kv=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275dir=mt({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),t})();const gR={provide:Tl,useExisting:Pn(()=>cm),multi:!0};let cm=(()=>{var e;class t extends Op{writeValue(n){this.setProperty("value",n??"")}registerOnChange(n){this.onChange=o=>{n(""==o?null:parseFloat(o))}}}return(e=t).\u0275fac=function(){let i;return function(o){return(i||(i=nr(e)))(o||e)}}(),e.\u0275dir=mt({type:e,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(n,o){1&n&&ye("input",function(f){return o.onChange(f.target.value)})("blur",function(){return o.onTouched()})},features:[Yi([gR]),yi]}),t})(),rS=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=cr({type:e}),e.\u0275inj=lr({}),t})();const iC=new Ot("NgModelWithFormControlWarning"),MR={provide:Tl,useExisting:Pn(()=>Ru),multi:!0};function uS(e,t){return null==e?`${t}`:(t&&"object"==typeof t&&(t="Object"),`${e}: ${t}`.slice(0,50))}let Ru=(()=>{var e;class t extends Op{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(n){this._compareWith=n}writeValue(n){this.value=n;const c=uS(this._getOptionId(n),n);this.setProperty("value",c)}registerOnChange(n){this.onChange=o=>{this.value=this._getOptionValue(o),n(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(n){for(const o of this._optionMap.keys())if(this._compareWith(this._optionMap.get(o),n))return o;return null}_getOptionValue(n){const o=function ER(e){return e.split(":")[0]}(n);return this._optionMap.has(o)?this._optionMap.get(o):n}}return(e=t).\u0275fac=function(){let i;return function(o){return(i||(i=nr(e)))(o||e)}}(),e.\u0275dir=mt({type:e,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(n,o){1&n&&ye("change",function(f){return o.onChange(f.target.value)})("blur",function(){return o.onTouched()})},inputs:{compareWith:"compareWith"},features:[Yi([MR]),yi]}),t})(),Np=(()=>{var e;class t{constructor(n,o,c){this._element=n,this._renderer=o,this._select=c,this._select&&(this.id=this._select._registerOption())}set ngValue(n){null!=this._select&&(this._select._optionMap.set(this.id,n),this._setElementValue(uS(this.id,n)),this._select.writeValue(this._select.value))}set value(n){this._setElementValue(n),this._select&&this._select.writeValue(this._select.value)}_setElementValue(n){this._renderer.setProperty(this._element.nativeElement,"value",n)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return(e=t).\u0275fac=function(n){return new(n||e)(G(Bi),G(Ss),G(Ru,9))},e.\u0275dir=mt({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),t})();const TR={provide:Tl,useExisting:Pn(()=>aC),multi:!0};function dS(e,t){return null==e?`${t}`:("string"==typeof t&&(t=`'${t}'`),t&&"object"==typeof t&&(t="Object"),`${e}: ${t}`.slice(0,50))}let aC=(()=>{var e;class t extends Op{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(n){this._compareWith=n}writeValue(n){let o;if(this.value=n,Array.isArray(n)){const c=n.map(f=>this._getOptionId(f));o=(f,y)=>{f._setSelected(c.indexOf(y.toString())>-1)}}else o=(c,f)=>{c._setSelected(!1)};this._optionMap.forEach(o)}registerOnChange(n){this.onChange=o=>{const c=[],f=o.selectedOptions;if(void 0!==f){const y=f;for(let E=0;E<y.length;E++){const z=this._getOptionValue(y[E].value);c.push(z)}}else{const y=o.options;for(let E=0;E<y.length;E++){const A=y[E];if(A.selected){const z=this._getOptionValue(A.value);c.push(z)}}}this.value=c,n(c)}}_registerOption(n){const o=(this._idCounter++).toString();return this._optionMap.set(o,n),o}_getOptionId(n){for(const o of this._optionMap.keys())if(this._compareWith(this._optionMap.get(o)._value,n))return o;return null}_getOptionValue(n){const o=function DR(e){return e.split(":")[0]}(n);return this._optionMap.has(o)?this._optionMap.get(o)._value:n}}return(e=t).\u0275fac=function(){let i;return function(o){return(i||(i=nr(e)))(o||e)}}(),e.\u0275dir=mt({type:e,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(n,o){1&n&&ye("change",function(f){return o.onChange(f.target)})("blur",function(){return o.onTouched()})},inputs:{compareWith:"compareWith"},features:[Yi([TR]),yi]}),t})(),zp=(()=>{var e;class t{constructor(n,o,c){this._element=n,this._renderer=o,this._select=c,this._select&&(this.id=this._select._registerOption(this))}set ngValue(n){null!=this._select&&(this._value=n,this._setElementValue(dS(this.id,n)),this._select.writeValue(this._select.value))}set value(n){this._select?(this._value=n,this._setElementValue(dS(this.id,n)),this._select.writeValue(this._select.value)):this._setElementValue(n)}_setElementValue(n){this._renderer.setProperty(this._element.nativeElement,"value",n)}_setSelected(n){this._renderer.setProperty(this._element.nativeElement,"selected",n)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return(e=t).\u0275fac=function(n){return new(n||e)(G(Bi),G(Ss),G(aC,9))},e.\u0275dir=mt({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),t})();function pS(e){return"number"==typeof e?e:parseFloat(e)}let Bp=(()=>{var e;class t{constructor(){this._validator=wy}ngOnChanges(n){if(this.inputName in n){const o=this.normalizeInput(n[this.inputName].currentValue);this._enabled=this.enabled(o),this._validator=this._enabled?this.createValidator(o):wy,this._onChange&&this._onChange()}}validate(n){return this._validator(n)}registerOnValidatorChange(n){this._onChange=n}enabled(n){return null!=n}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275dir=mt({type:e,features:[Ee]}),t})();const SR={provide:No,useExisting:Pn(()=>lC),multi:!0};let lC=(()=>{var e;class t extends Bp{constructor(){super(...arguments),this.inputName="max",this.normalizeInput=n=>pS(n),this.createValidator=n=>function MD(e){return t=>{if(ih(t.value)||ih(e))return null;const i=parseFloat(t.value);return!isNaN(i)&&i>e?{max:{max:e,actual:t.value}}:null}}(n)}}return(e=t).\u0275fac=function(){let i;return function(o){return(i||(i=nr(e)))(o||e)}}(),e.\u0275dir=mt({type:e,selectors:[["input","type","number","max","","formControlName",""],["input","type","number","max","","formControl",""],["input","type","number","max","","ngModel",""]],hostVars:1,hostBindings:function(n,o){2&n&&Fo("max",o._enabled?o.max:null)},inputs:{max:"max"},features:[Yi([SR]),yi]}),t})();const IR={provide:No,useExisting:Pn(()=>Ov),multi:!0};let Ov=(()=>{var e;class t extends Bp{constructor(){super(...arguments),this.inputName="min",this.normalizeInput=n=>pS(n),this.createValidator=n=>function CD(e){return t=>{if(ih(t.value)||ih(e))return null;const i=parseFloat(t.value);return!isNaN(i)&&i<e?{min:{min:e,actual:t.value}}:null}}(n)}}return(e=t).\u0275fac=function(){let i;return function(o){return(i||(i=nr(e)))(o||e)}}(),e.\u0275dir=mt({type:e,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(n,o){2&n&&Fo("min",o._enabled?o.min:null)},inputs:{min:"min"},features:[Yi([IR]),yi]}),t})();const AR={provide:No,useExisting:Pn(()=>um),multi:!0};let um=(()=>{var e;class t extends Bp{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=sm,this.createValidator=n=>ED}enabled(n){return n}}return(e=t).\u0275fac=function(){let i;return function(o){return(i||(i=nr(e)))(o||e)}}(),e.\u0275dir=mt({type:e,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(n,o){2&n&&Fo("required",o._enabled?"":null)},inputs:{required:"required"},features:[Yi([AR]),yi]}),t})();const LR={provide:No,useExisting:Pn(()=>dm),multi:!0};let dm=(()=>{var e;class t extends Bp{constructor(){super(...arguments),this.inputName="maxlength",this.normalizeInput=n=>function hS(e){return"number"==typeof e?e:parseInt(e,10)}(n),this.createValidator=n=>function ID(e){return t=>function wD(e){return null!=e&&"number"==typeof e.length}(t.value)&&t.value.length>e?{maxlength:{requiredLength:e,actualLength:t.value.length}}:null}(n)}}return(e=t).\u0275fac=function(){let i;return function(o){return(i||(i=nr(e)))(o||e)}}(),e.\u0275dir=mt({type:e,selectors:[["","maxlength","","formControlName",""],["","maxlength","","formControl",""],["","maxlength","","ngModel",""]],hostVars:1,hostBindings:function(n,o){2&n&&Fo("maxlength",o._enabled?o.maxlength:null)},inputs:{maxlength:"maxlength"},features:[Yi([LR]),yi]}),t})(),vS=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=cr({type:e}),e.\u0275inj=lr({imports:[rS]}),t})(),NR=(()=>{var e;class t{static withConfig(n){return{ngModule:t,providers:[{provide:Rp,useValue:n.callSetDisabledState??Iv}]}}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=cr({type:e}),e.\u0275inj=lr({imports:[vS]}),t})(),zR=(()=>{var e;class t{static withConfig(n){return{ngModule:t,providers:[{provide:iC,useValue:n.warnOnNgModelWithFormControl??"always"},{provide:Rp,useValue:n.callSetDisabledState??Iv}]}}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=cr({type:e}),e.\u0275inj=lr({imports:[vS]}),t})();function ah(e){return!!e&&(e instanceof xn||Rn(e.lift)&&Rn(e.subscribe))}function cC(...e){const t=jo(e),i=Wu(e),{args:n,keys:o}=vD(e);if(0===n.length)return bi([],t);const c=new xn(function BR(e,t,i=Uo){return n=>{yS(t,()=>{const{length:o}=e,c=new Array(o);let f=o,y=o;for(let E=0;E<o;E++)yS(t,()=>{const A=bi(e[E],t);let z=!1;A.subscribe(ei(n,H=>{c[E]=H,z||(z=!0,y--),y||n.next(i(c.slice()))},()=>{--f||n.complete()}))},n)},n)}}(n,t,o?f=>yD(o,f):Uo));return i?c.pipe($w(i)):c}function yS(e,t,i){e?ps(i,e,t):t()}const Py=gh(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function Lv(...e){return function VR(){return fs(1)}()(bi(e,jo(e)))}function ky(e){return new xn(t=>{An(e()).subscribe(t)})}function Rv(e,t){const i=Rn(e)?e:()=>e,n=o=>o.error(i());return new xn(t?o=>t.schedule(n,0,o):n)}function uC(){return ri((e,t)=>{let i=null;e._refCount++;const n=ei(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(i=null);const o=e._connection,c=i;i=null,o&&(!c||o===c)&&o.unsubscribe(),t.unsubscribe()});e.subscribe(n),n.closed||(i=e.connect())})}class xS extends xn{constructor(t,i){super(),this.source=t,this.subjectFactory=i,this._subject=null,this._refCount=0,this._connection=null,kc(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,t?.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new Je;const i=this.getSubject();t.add(this.source.subscribe(ei(i,void 0,()=>{this._teardown(),i.complete()},n=>{this._teardown(),i.error(n)},()=>this._teardown()))),t.closed&&(this._connection=null,t=Je.EMPTY)}return t}refCount(){return uC()(this)}}function Ec(e){return e<=0?()=>bo:ri((t,i)=>{let n=0;t.subscribe(ei(i,o=>{++n<=e&&(i.next(o),e<=n&&i.complete())}))})}function bS(...e){const t=jo(e);return ri((i,n)=>{(t?Lv(e,i,t):Lv(e,i)).subscribe(n)})}function Tc(e,t){return ri((i,n)=>{let o=0;i.subscribe(ei(n,c=>e.call(t,c,o++)&&n.next(c)))})}function Oy(e){return ri((t,i)=>{let n=!1;t.subscribe(ei(i,o=>{n=!0,i.next(o)},()=>{n||i.next(e),i.complete()}))})}function wS(e=UR){return ri((t,i)=>{let n=!1;t.subscribe(ei(i,o=>{n=!0,i.next(o)},()=>n?i.complete():i.error(e())))})}function UR(){return new Py}function Vp(e,t){const i=arguments.length>=2;return n=>n.pipe(e?Tc((o,c)=>e(o,c,n)):Uo,Ec(1),i?Oy(t):wS(()=>new Py))}function Up(e,t){return Rn(t)?Ji(e,t,1):Ji(e,1)}function zo(e,t,i){const n=Rn(e)||t||i?{next:e,error:t,complete:i}:e;return n?ri((o,c)=>{var f;null===(f=n.subscribe)||void 0===f||f.call(n);let y=!0;o.subscribe(ei(c,E=>{var A;null===(A=n.next)||void 0===A||A.call(n,E),c.next(E)},()=>{var E;y=!1,null===(E=n.complete)||void 0===E||E.call(n),c.complete()},E=>{var A;y=!1,null===(A=n.error)||void 0===A||A.call(n,E),c.error(E)},()=>{var E,A;y&&(null===(E=n.unsubscribe)||void 0===E||E.call(n)),null===(A=n.finalize)||void 0===A||A.call(n)}))}):Uo}function jp(e){return ri((t,i)=>{let c,n=null,o=!1;n=t.subscribe(ei(i,void 0,void 0,f=>{c=An(e(f,jp(e)(t))),n?(n.unsubscribe(),n=null,c.subscribe(i)):o=!0})),o&&(n.unsubscribe(),n=null,c.subscribe(i))})}function dC(e){return e<=0?()=>bo:ri((t,i)=>{let n=[];t.subscribe(ei(i,o=>{n.push(o),e<n.length&&n.shift()},()=>{for(const o of n)i.next(o);i.complete()},void 0,()=>{n=null}))})}function Fv(e){return ri((t,i)=>{try{t.subscribe(i)}finally{i.add(e)}})}const Dn="primary",Nv=Symbol("RouteTitle");class qR{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const i=this.params[t];return Array.isArray(i)?i[0]:i}return null}getAll(t){if(this.has(t)){const i=this.params[t];return Array.isArray(i)?i:[i]}return[]}get keys(){return Object.keys(this.params)}}function hm(e){return new qR(e)}function ZR(e,t,i){const n=i.path.split("/");if(n.length>e.length||"full"===i.pathMatch&&(t.hasChildren()||n.length<e.length))return null;const o={};for(let c=0;c<n.length;c++){const f=n[c],y=e[c];if(f.startsWith(":"))o[f.substring(1)]=y;else if(f!==y.path)return null}return{consumed:e.slice(0,n.length),posParams:o}}function Dc(e,t){const i=e?Object.keys(e):void 0,n=t?Object.keys(t):void 0;if(!i||!n||i.length!=n.length)return!1;let o;for(let c=0;c<i.length;c++)if(o=i[c],!CS(e[o],t[o]))return!1;return!0}function CS(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const i=[...e].sort(),n=[...t].sort();return i.every((o,c)=>n[c]===o)}return e===t}function MS(e){return e.length>0?e[e.length-1]:null}function lh(e){return ah(e)?e:lv(e)?bi(Promise.resolve(e)):pt(e)}const XR={exact:function DS(e,t,i){if(!$p(e.segments,t.segments)||!Ly(e.segments,t.segments,i)||e.numberOfChildren!==t.numberOfChildren)return!1;for(const n in t.children)if(!e.children[n]||!DS(e.children[n],t.children[n],i))return!1;return!0},subset:SS},ES={exact:function YR(e,t){return Dc(e,t)},subset:function KR(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(i=>CS(e[i],t[i]))},ignored:()=>!0};function TS(e,t,i){return XR[i.paths](e.root,t.root,i.matrixParams)&&ES[i.queryParams](e.queryParams,t.queryParams)&&!("exact"===i.fragment&&e.fragment!==t.fragment)}function SS(e,t,i){return IS(e,t,t.segments,i)}function IS(e,t,i,n){if(e.segments.length>i.length){const o=e.segments.slice(0,i.length);return!(!$p(o,i)||t.hasChildren()||!Ly(o,i,n))}if(e.segments.length===i.length){if(!$p(e.segments,i)||!Ly(e.segments,i,n))return!1;for(const o in t.children)if(!e.children[o]||!SS(e.children[o],t.children[o],n))return!1;return!0}{const o=i.slice(0,e.segments.length),c=i.slice(e.segments.length);return!!($p(e.segments,o)&&Ly(e.segments,o,n)&&e.children[Dn])&&IS(e.children[Dn],t,c,n)}}function Ly(e,t,i){return t.every((n,o)=>ES[i](e[o].parameters,n.parameters))}class pm{constructor(t=new xi([],{}),i={},n=null){this.root=t,this.queryParams=i,this.fragment=n}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=hm(this.queryParams)),this._queryParamMap}toString(){return eF.serialize(this)}}class xi{constructor(t,i){this.segments=t,this.children=i,this.parent=null,Object.values(i).forEach(n=>n.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Ry(this)}}class zv{constructor(t,i){this.path=t,this.parameters=i}get parameterMap(){return this._parameterMap||(this._parameterMap=hm(this.parameters)),this._parameterMap}toString(){return kS(this)}}function $p(e,t){return e.length===t.length&&e.every((i,n)=>i.path===t[n].path)}let Bv=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Lt({token:e,factory:function(){return new hC},providedIn:"root"}),t})();class hC{parse(t){const i=new dF(t);return new pm(i.parseRootSegment(),i.parseQueryParams(),i.parseFragment())}serialize(t){const i=`/${Vv(t.root,!0)}`,n=function iF(e){const t=Object.keys(e).map(i=>{const n=e[i];return Array.isArray(n)?n.map(o=>`${Fy(i)}=${Fy(o)}`).join("&"):`${Fy(i)}=${Fy(n)}`}).filter(i=>!!i);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${i}${n}${"string"==typeof t.fragment?`#${function tF(e){return encodeURI(e)}(t.fragment)}`:""}`}}const eF=new hC;function Ry(e){return e.segments.map(t=>kS(t)).join("/")}function Vv(e,t){if(!e.hasChildren())return Ry(e);if(t){const i=e.children[Dn]?Vv(e.children[Dn],!1):"",n=[];return Object.entries(e.children).forEach(([o,c])=>{o!==Dn&&n.push(`${o}:${Vv(c,!1)}`)}),n.length>0?`${i}(${n.join("//")})`:i}{const i=function QR(e,t){let i=[];return Object.entries(e.children).forEach(([n,o])=>{n===Dn&&(i=i.concat(t(o,n)))}),Object.entries(e.children).forEach(([n,o])=>{n!==Dn&&(i=i.concat(t(o,n)))}),i}(e,(n,o)=>o===Dn?[Vv(e.children[Dn],!1)]:[`${o}:${Vv(n,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[Dn]?`${Ry(e)}/${i[0]}`:`${Ry(e)}/(${i.join("//")})`}}function AS(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Fy(e){return AS(e).replace(/%3B/gi,";")}function pC(e){return AS(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Ny(e){return decodeURIComponent(e)}function PS(e){return Ny(e.replace(/\+/g,"%20"))}function kS(e){return`${pC(e.path)}${function nF(e){return Object.keys(e).map(t=>`;${pC(t)}=${pC(e[t])}`).join("")}(e.parameters)}`}const rF=/^[^\/()?;#]+/;function fC(e){const t=e.match(rF);return t?t[0]:""}const oF=/^[^\/()?;=#]+/,aF=/^[^=?&#]+/,cF=/^[^&#]+/;class dF{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new xi([],{}):new xi([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let i={};this.peekStartsWith("/(")&&(this.capture("/"),i=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(t.length>0||Object.keys(i).length>0)&&(n[Dn]=new xi(t,i)),n}parseSegment(){const t=fC(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new ut(4009,!1);return this.capture(t),new zv(Ny(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const i=function sF(e){const t=e.match(oF);return t?t[0]:""}(this.remaining);if(!i)return;this.capture(i);let n="";if(this.consumeOptional("=")){const o=fC(this.remaining);o&&(n=o,this.capture(n))}t[Ny(i)]=Ny(n)}parseQueryParam(t){const i=function lF(e){const t=e.match(aF);return t?t[0]:""}(this.remaining);if(!i)return;this.capture(i);let n="";if(this.consumeOptional("=")){const f=function uF(e){const t=e.match(cF);return t?t[0]:""}(this.remaining);f&&(n=f,this.capture(n))}const o=PS(i),c=PS(n);if(t.hasOwnProperty(o)){let f=t[o];Array.isArray(f)||(f=[f],t[o]=f),f.push(c)}else t[o]=c}parseParens(t){const i={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const n=fC(this.remaining),o=this.remaining[n.length];if("/"!==o&&")"!==o&&";"!==o)throw new ut(4010,!1);let c;n.indexOf(":")>-1?(c=n.slice(0,n.indexOf(":")),this.capture(c),this.capture(":")):t&&(c=Dn);const f=this.parseChildren();i[c]=1===Object.keys(f).length?f[Dn]:new xi([],f),this.consumeOptional("//")}return i}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new ut(4011,!1)}}function OS(e){return e.segments.length>0?new xi([],{[Dn]:e}):e}function LS(e){const t={};for(const n of Object.keys(e.children)){const c=LS(e.children[n]);if(n===Dn&&0===c.segments.length&&c.hasChildren())for(const[f,y]of Object.entries(c.children))t[f]=y;else(c.segments.length>0||c.hasChildren())&&(t[n]=c)}return function hF(e){if(1===e.numberOfChildren&&e.children[Dn]){const t=e.children[Dn];return new xi(e.segments.concat(t.segments),t.children)}return e}(new xi(e.segments,t))}function Hp(e){return e instanceof pm}function RS(e){let t;const o=OS(function i(c){const f={};for(const E of c.children){const A=i(E);f[E.outlet]=A}const y=new xi(c.url,f);return c===e&&(t=y),y}(e.root));return t??o}function FS(e,t,i,n){let o=e;for(;o.parent;)o=o.parent;if(0===t.length)return gC(o,o,o,i,n);const c=function fF(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new zS(!0,0,e);let t=0,i=!1;const n=e.reduce((o,c,f)=>{if("object"==typeof c&&null!=c){if(c.outlets){const y={};return Object.entries(c.outlets).forEach(([E,A])=>{y[E]="string"==typeof A?A.split("/"):A}),[...o,{outlets:y}]}if(c.segmentPath)return[...o,c.segmentPath]}return"string"!=typeof c?[...o,c]:0===f?(c.split("/").forEach((y,E)=>{0==E&&"."===y||(0==E&&""===y?i=!0:".."===y?t++:""!=y&&o.push(y))}),o):[...o,c]},[]);return new zS(i,t,n)}(t);if(c.toRoot())return gC(o,o,new xi([],{}),i,n);const f=function gF(e,t,i){if(e.isAbsolute)return new By(t,!0,0);if(!i)return new By(t,!1,NaN);if(null===i.parent)return new By(i,!0,0);const n=zy(e.commands[0])?0:1;return function mF(e,t,i){let n=e,o=t,c=i;for(;c>o;){if(c-=o,n=n.parent,!n)throw new ut(4005,!1);o=n.segments.length}return new By(n,!1,o-c)}(i,i.segments.length-1+n,e.numberOfDoubleDots)}(c,o,e),y=f.processChildren?jv(f.segmentGroup,f.index,c.commands):BS(f.segmentGroup,f.index,c.commands);return gC(o,f.segmentGroup,y,i,n)}function zy(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function Uv(e){return"object"==typeof e&&null!=e&&e.outlets}function gC(e,t,i,n,o){let f,c={};n&&Object.entries(n).forEach(([E,A])=>{c[E]=Array.isArray(A)?A.map(z=>`${z}`):`${A}`}),f=e===t?i:NS(e,t,i);const y=OS(LS(f));return new pm(y,c,o)}function NS(e,t,i){const n={};return Object.entries(e.children).forEach(([o,c])=>{n[o]=c===t?i:NS(c,t,i)}),new xi(e.segments,n)}class zS{constructor(t,i,n){if(this.isAbsolute=t,this.numberOfDoubleDots=i,this.commands=n,t&&n.length>0&&zy(n[0]))throw new ut(4003,!1);const o=n.find(Uv);if(o&&o!==MS(n))throw new ut(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class By{constructor(t,i,n){this.segmentGroup=t,this.processChildren=i,this.index=n}}function BS(e,t,i){if(e||(e=new xi([],{})),0===e.segments.length&&e.hasChildren())return jv(e,t,i);const n=function vF(e,t,i){let n=0,o=t;const c={match:!1,pathIndex:0,commandIndex:0};for(;o<e.segments.length;){if(n>=i.length)return c;const f=e.segments[o],y=i[n];if(Uv(y))break;const E=`${y}`,A=n<i.length-1?i[n+1]:null;if(o>0&&void 0===E)break;if(E&&A&&"object"==typeof A&&void 0===A.outlets){if(!US(E,A,f))return c;n+=2}else{if(!US(E,{},f))return c;n++}o++}return{match:!0,pathIndex:o,commandIndex:n}}(e,t,i),o=i.slice(n.commandIndex);if(n.match&&n.pathIndex<e.segments.length){const c=new xi(e.segments.slice(0,n.pathIndex),{});return c.children[Dn]=new xi(e.segments.slice(n.pathIndex),e.children),jv(c,0,o)}return n.match&&0===o.length?new xi(e.segments,{}):n.match&&!e.hasChildren()?mC(e,t,i):n.match?jv(e,0,o):mC(e,t,i)}function jv(e,t,i){if(0===i.length)return new xi(e.segments,{});{const n=function _F(e){return Uv(e[0])?e[0].outlets:{[Dn]:e}}(i),o={};if(!n[Dn]&&e.children[Dn]&&1===e.numberOfChildren&&0===e.children[Dn].segments.length){const c=jv(e.children[Dn],t,i);return new xi(e.segments,c.children)}return Object.entries(n).forEach(([c,f])=>{"string"==typeof f&&(f=[f]),null!==f&&(o[c]=BS(e.children[c],t,f))}),Object.entries(e.children).forEach(([c,f])=>{void 0===n[c]&&(o[c]=f)}),new xi(e.segments,o)}}function mC(e,t,i){const n=e.segments.slice(0,t);let o=0;for(;o<i.length;){const c=i[o];if(Uv(c)){const E=yF(c.outlets);return new xi(n,E)}if(0===o&&zy(i[0])){n.push(new zv(e.segments[t].path,VS(i[0]))),o++;continue}const f=Uv(c)?c.outlets[Dn]:`${c}`,y=o<i.length-1?i[o+1]:null;f&&y&&zy(y)?(n.push(new zv(f,VS(y))),o+=2):(n.push(new zv(f,{})),o++)}return new xi(n,{})}function yF(e){const t={};return Object.entries(e).forEach(([i,n])=>{"string"==typeof n&&(n=[n]),null!==n&&(t[i]=mC(new xi([],{}),0,n))}),t}function VS(e){const t={};return Object.entries(e).forEach(([i,n])=>t[i]=`${n}`),t}function US(e,t,i){return e==i.path&&Dc(t,i.parameters)}const $v="imperative";class Sc{constructor(t,i){this.id=t,this.url=i}}class _C extends Sc{constructor(t,i,n="imperative",o=null){super(t,i),this.type=0,this.navigationTrigger=n,this.restoredState=o}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Gp extends Sc{constructor(t,i,n){super(t,i),this.urlAfterRedirects=n,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Vy extends Sc{constructor(t,i,n,o){super(t,i),this.reason=n,this.code=o,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Hv extends Sc{constructor(t,i,n,o){super(t,i),this.reason=n,this.code=o,this.type=16}}class vC extends Sc{constructor(t,i,n,o){super(t,i),this.error=n,this.target=o,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class xF extends Sc{constructor(t,i,n,o){super(t,i),this.urlAfterRedirects=n,this.state=o,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class bF extends Sc{constructor(t,i,n,o){super(t,i),this.urlAfterRedirects=n,this.state=o,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class wF extends Sc{constructor(t,i,n,o,c){super(t,i),this.urlAfterRedirects=n,this.state=o,this.shouldActivate=c,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class CF extends Sc{constructor(t,i,n,o){super(t,i),this.urlAfterRedirects=n,this.state=o,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class MF extends Sc{constructor(t,i,n,o){super(t,i),this.urlAfterRedirects=n,this.state=o,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class EF{constructor(t){this.route=t,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class TF{constructor(t){this.route=t,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class DF{constructor(t){this.snapshot=t,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class SF{constructor(t){this.snapshot=t,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class IF{constructor(t){this.snapshot=t,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class AF{constructor(t){this.snapshot=t,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class jS{constructor(t,i,n){this.routerEvent=t,this.position=i,this.anchor=n,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class PF{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new Gv,this.attachRef=null}}let Gv=(()=>{var e;class t{constructor(){this.contexts=new Map}onChildOutletCreated(n,o){const c=this.getOrCreateContext(n);c.outlet=o,this.contexts.set(n,c)}onChildOutletDestroyed(n){const o=this.getContext(n);o&&(o.outlet=null,o.attachRef=null)}onOutletDeactivated(){const n=this.contexts;return this.contexts=new Map,n}onOutletReAttached(n){this.contexts=n}getOrCreateContext(n){let o=this.getContext(n);return o||(o=new PF,this.contexts.set(n,o)),o}getContext(n){return this.contexts.get(n)||null}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Lt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();class $S{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const i=this.pathFromRoot(t);return i.length>1?i[i.length-2]:null}children(t){const i=yC(t,this._root);return i?i.children.map(n=>n.value):[]}firstChild(t){const i=yC(t,this._root);return i&&i.children.length>0?i.children[0].value:null}siblings(t){const i=xC(t,this._root);return i.length<2?[]:i[i.length-2].children.map(o=>o.value).filter(o=>o!==t)}pathFromRoot(t){return xC(t,this._root).map(i=>i.value)}}function yC(e,t){if(e===t.value)return t;for(const i of t.children){const n=yC(e,i);if(n)return n}return null}function xC(e,t){if(e===t.value)return[t];for(const i of t.children){const n=xC(e,i);if(n.length)return n.unshift(t),n}return[]}class Fu{constructor(t,i){this.value=t,this.children=i}toString(){return`TreeNode(${this.value})`}}function fm(e){const t={};return e&&e.children.forEach(i=>t[i.value.outlet]=i),t}class HS extends $S{constructor(t,i){super(t),this.snapshot=i,bC(this,t)}toString(){return this.snapshot.toString()}}function GS(e,t){const i=function kF(e,t){const f=new Uy([],{},{},"",{},Dn,t,null,{});return new ZS("",new Fu(f,[]))}(0,t),n=new Ei([new zv("",{})]),o=new Ei({}),c=new Ei({}),f=new Ei({}),y=new Ei(""),E=new ch(n,o,f,y,c,Dn,t,i.root);return E.snapshot=i.root,new HS(new Fu(E,[]),i)}class ch{constructor(t,i,n,o,c,f,y,E){this.urlSubject=t,this.paramsSubject=i,this.queryParamsSubject=n,this.fragmentSubject=o,this.dataSubject=c,this.outlet=f,this.component=y,this._futureSnapshot=E,this.title=this.dataSubject?.pipe(En(A=>A[Nv]))??pt(void 0),this.url=t,this.params=i,this.queryParams=n,this.fragment=o,this.data=c}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(En(t=>hm(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(En(t=>hm(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function qS(e,t="emptyOnly"){const i=e.pathFromRoot;let n=0;if("always"!==t)for(n=i.length-1;n>=1;){const o=i[n],c=i[n-1];if(o.routeConfig&&""===o.routeConfig.path)n--;else{if(c.component)break;n--}}return function OF(e){return e.reduce((t,i)=>({params:{...t.params,...i.params},data:{...t.data,...i.data},resolve:{...i.data,...t.resolve,...i.routeConfig?.data,...i._resolvedData}}),{params:{},data:{},resolve:{}})}(i.slice(n))}class Uy{get title(){return this.data?.[Nv]}constructor(t,i,n,o,c,f,y,E,A){this.url=t,this.params=i,this.queryParams=n,this.fragment=o,this.data=c,this.outlet=f,this.component=y,this.routeConfig=E,this._resolve=A}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=hm(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=hm(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(n=>n.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class ZS extends $S{constructor(t,i){super(i),this.url=t,bC(this,i)}toString(){return WS(this._root)}}function bC(e,t){t.value._routerState=e,t.children.forEach(i=>bC(e,i))}function WS(e){const t=e.children.length>0?` { ${e.children.map(WS).join(", ")} } `:"";return`${e.value}${t}`}function wC(e){if(e.snapshot){const t=e.snapshot,i=e._futureSnapshot;e.snapshot=i,Dc(t.queryParams,i.queryParams)||e.queryParamsSubject.next(i.queryParams),t.fragment!==i.fragment&&e.fragmentSubject.next(i.fragment),Dc(t.params,i.params)||e.paramsSubject.next(i.params),function WR(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(!Dc(e[i],t[i]))return!1;return!0}(t.url,i.url)||e.urlSubject.next(i.url),Dc(t.data,i.data)||e.dataSubject.next(i.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function CC(e,t){const i=Dc(e.params,t.params)&&function JR(e,t){return $p(e,t)&&e.every((i,n)=>Dc(i.parameters,t[n].parameters))}(e.url,t.url);return i&&!(!e.parent!=!t.parent)&&(!e.parent||CC(e.parent,t.parent))}let jy=(()=>{var e;class t{constructor(){this.activated=null,this._activatedRoute=null,this.name=Dn,this.activateEvents=new Tn,this.deactivateEvents=new Tn,this.attachEvents=new Tn,this.detachEvents=new Tn,this.parentContexts=It(Gv),this.location=It(Cl),this.changeDetector=It(om),this.environmentInjector=It(ns),this.inputBinder=It($y,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(n){if(n.name){const{firstChange:o,previousValue:c}=n.name;if(o)return;this.isTrackedInParentContexts(c)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(c)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(n){return this.parentContexts.getContext(n)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const n=this.parentContexts.getContext(this.name);n?.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new ut(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new ut(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new ut(4012,!1);this.location.detach();const n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,o){this.activated=n,this._activatedRoute=o,this.location.insert(n.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){const n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,o){if(this.isActivated)throw new ut(4013,!1);this._activatedRoute=n;const c=this.location,y=n.snapshot.component,E=this.parentContexts.getOrCreateContext(this.name).children,A=new LF(n,E,c.injector);this.activated=c.createComponent(y,{index:c.length,injector:A,environmentInjector:o??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275dir=mt({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Ee]}),t})();class LF{constructor(t,i,n){this.route=t,this.childContexts=i,this.parent=n}get(t,i){return t===ch?this.route:t===Gv?this.childContexts:this.parent.get(t,i)}}const $y=new Ot("");let XS=(()=>{var e;class t{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(n){this.unsubscribeFromRouteData(n),this.subscribeToRouteData(n)}unsubscribeFromRouteData(n){this.outletDataSubscriptions.get(n)?.unsubscribe(),this.outletDataSubscriptions.delete(n)}subscribeToRouteData(n){const{activatedRoute:o}=n,c=cC([o.queryParams,o.params,o.data]).pipe(Ti(([f,y,E],A)=>(E={...f,...y,...E},0===A?pt(E):Promise.resolve(E)))).subscribe(f=>{if(!n.isActivated||!n.activatedComponentRef||n.activatedRoute!==o||null===o.component)return void this.unsubscribeFromRouteData(n);const y=function gO(e){const t=kn(e);if(!t)return null;const i=new iv(t);return{get selector(){return i.selector},get type(){return i.componentType},get inputs(){return i.inputs},get outputs(){return i.outputs},get ngContentSelectors(){return i.ngContentSelectors},get isStandalone(){return t.standalone},get isSignal(){return t.signals}}}(o.component);if(y)for(const{templateName:E}of y.inputs)n.activatedComponentRef.setInput(E,f[E]);else this.unsubscribeFromRouteData(n)});this.outletDataSubscriptions.set(n,c)}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Lt({token:e,factory:e.\u0275fac}),t})();function qv(e,t,i){if(i&&e.shouldReuseRoute(t.value,i.value.snapshot)){const n=i.value;n._futureSnapshot=t.value;const o=function FF(e,t,i){return t.children.map(n=>{for(const o of i.children)if(e.shouldReuseRoute(n.value,o.value.snapshot))return qv(e,n,o);return qv(e,n)})}(e,t,i);return new Fu(n,o)}{if(e.shouldAttach(t.value)){const c=e.retrieve(t.value);if(null!==c){const f=c.route;return f.value._futureSnapshot=t.value,f.children=t.children.map(y=>qv(e,y)),f}}const n=function NF(e){return new ch(new Ei(e.url),new Ei(e.params),new Ei(e.queryParams),new Ei(e.fragment),new Ei(e.data),e.outlet,e.component,e)}(t.value),o=t.children.map(c=>qv(e,c));return new Fu(n,o)}}const MC="ngNavigationCancelingError";function YS(e,t){const{redirectTo:i,navigationBehaviorOptions:n}=Hp(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,o=KS(!1,0,t);return o.url=i,o.navigationBehaviorOptions=n,o}function KS(e,t,i){const n=new Error("NavigationCancelingError: "+(e||""));return n[MC]=!0,n.cancellationCode=t,i&&(n.url=i),n}function JS(e){return QS(e)&&Hp(e.url)}function QS(e){return e&&e[MC]}let eI=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275cmp=mi({type:e,selectors:[["ng-component"]],standalone:!0,features:[KM],decls:1,vars:0,template:function(n,o){1&n&&He(0,"router-outlet")},dependencies:[jy],encapsulation:2}),t})();function EC(e){const t=e.children&&e.children.map(EC),i=t?{...e,children:t}:{...e};return!i.component&&!i.loadComponent&&(t||i.loadChildren)&&i.outlet&&i.outlet!==Dn&&(i.component=eI),i}function Dl(e){return e.outlet||Dn}function Zv(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let t=e.parent;t;t=t.parent){const i=t.routeConfig;if(i?._loadedInjector)return i._loadedInjector;if(i?._injector)return i._injector}return null}class HF{constructor(t,i,n,o,c){this.routeReuseStrategy=t,this.futureState=i,this.currState=n,this.forwardEvent=o,this.inputBindingEnabled=c}activate(t){const i=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(i,n,t),wC(this.futureState.root),this.activateChildRoutes(i,n,t)}deactivateChildRoutes(t,i,n){const o=fm(i);t.children.forEach(c=>{const f=c.value.outlet;this.deactivateRoutes(c,o[f],n),delete o[f]}),Object.values(o).forEach(c=>{this.deactivateRouteAndItsChildren(c,n)})}deactivateRoutes(t,i,n){const o=t.value,c=i?i.value:null;if(o===c)if(o.component){const f=n.getContext(o.outlet);f&&this.deactivateChildRoutes(t,i,f.children)}else this.deactivateChildRoutes(t,i,n);else c&&this.deactivateRouteAndItsChildren(i,n)}deactivateRouteAndItsChildren(t,i){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,i):this.deactivateRouteAndOutlet(t,i)}detachAndStoreRouteSubtree(t,i){const n=i.getContext(t.value.outlet),o=n&&t.value.component?n.children:i,c=fm(t);for(const f of Object.keys(c))this.deactivateRouteAndItsChildren(c[f],o);if(n&&n.outlet){const f=n.outlet.detach(),y=n.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:f,route:t,contexts:y})}}deactivateRouteAndOutlet(t,i){const n=i.getContext(t.value.outlet),o=n&&t.value.component?n.children:i,c=fm(t);for(const f of Object.keys(c))this.deactivateRouteAndItsChildren(c[f],o);n&&(n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated()),n.attachRef=null,n.route=null)}activateChildRoutes(t,i,n){const o=fm(i);t.children.forEach(c=>{this.activateRoutes(c,o[c.value.outlet],n),this.forwardEvent(new AF(c.value.snapshot))}),t.children.length&&this.forwardEvent(new SF(t.value.snapshot))}activateRoutes(t,i,n){const o=t.value,c=i?i.value:null;if(wC(o),o===c)if(o.component){const f=n.getOrCreateContext(o.outlet);this.activateChildRoutes(t,i,f.children)}else this.activateChildRoutes(t,i,n);else if(o.component){const f=n.getOrCreateContext(o.outlet);if(this.routeReuseStrategy.shouldAttach(o.snapshot)){const y=this.routeReuseStrategy.retrieve(o.snapshot);this.routeReuseStrategy.store(o.snapshot,null),f.children.onOutletReAttached(y.contexts),f.attachRef=y.componentRef,f.route=y.route.value,f.outlet&&f.outlet.attach(y.componentRef,y.route.value),wC(y.route.value),this.activateChildRoutes(t,null,f.children)}else{const y=Zv(o.snapshot);f.attachRef=null,f.route=o,f.injector=y,f.outlet&&f.outlet.activateWith(o,f.injector),this.activateChildRoutes(t,null,f.children)}}else this.activateChildRoutes(t,null,n)}}class tI{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class Hy{constructor(t,i){this.component=t,this.route=i}}function GF(e,t,i){const n=e._root;return Wv(n,t?t._root:null,i,[n.value])}function gm(e,t){const i=Symbol(),n=t.get(e,i);return n===i?"function"!=typeof e||function Xu(e){return null!==Co(e)}(e)?t.get(e):e:n}function Wv(e,t,i,n,o={canDeactivateChecks:[],canActivateChecks:[]}){const c=fm(t);return e.children.forEach(f=>{(function ZF(e,t,i,n,o={canDeactivateChecks:[],canActivateChecks:[]}){const c=e.value,f=t?t.value:null,y=i?i.getContext(e.value.outlet):null;if(f&&c.routeConfig===f.routeConfig){const E=function WF(e,t,i){if("function"==typeof i)return i(e,t);switch(i){case"pathParamsChange":return!$p(e.url,t.url);case"pathParamsOrQueryParamsChange":return!$p(e.url,t.url)||!Dc(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!CC(e,t)||!Dc(e.queryParams,t.queryParams);default:return!CC(e,t)}}(f,c,c.routeConfig.runGuardsAndResolvers);E?o.canActivateChecks.push(new tI(n)):(c.data=f.data,c._resolvedData=f._resolvedData),Wv(e,t,c.component?y?y.children:null:i,n,o),E&&y&&y.outlet&&y.outlet.isActivated&&o.canDeactivateChecks.push(new Hy(y.outlet.component,f))}else f&&Xv(t,y,o),o.canActivateChecks.push(new tI(n)),Wv(e,null,c.component?y?y.children:null:i,n,o)})(f,c[f.value.outlet],i,n.concat([f.value]),o),delete c[f.value.outlet]}),Object.entries(c).forEach(([f,y])=>Xv(y,i.getContext(f),o)),o}function Xv(e,t,i){const n=fm(e),o=e.value;Object.entries(n).forEach(([c,f])=>{Xv(f,o.component?t?t.children.getContext(c):null:t,i)}),i.canDeactivateChecks.push(new Hy(o.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,o))}function Yv(e){return"function"==typeof e}function nI(e){return e instanceof Py||"EmptyError"===e?.name}const Gy=Symbol("INITIAL_VALUE");function mm(){return Ti(e=>cC(e.map(t=>t.pipe(Ec(1),bS(Gy)))).pipe(En(t=>{for(const i of t)if(!0!==i){if(i===Gy)return Gy;if(!1===i||i instanceof pm)return i}return!0}),Tc(t=>t!==Gy),Ec(1)))}function iI(e){return function yn(...e){return za(e)}(zo(t=>{if(Hp(t))throw YS(0,t)}),En(t=>!0===t))}class qy{constructor(t){this.segmentGroup=t||null}}class rI{constructor(t){this.urlTree=t}}function _m(e){return Rv(new qy(e))}function oI(e){return Rv(new rI(e))}class fN{constructor(t,i){this.urlSerializer=t,this.urlTree=i}noMatchError(t){return new ut(4002,!1)}lineralizeSegments(t,i){let n=[],o=i.root;for(;;){if(n=n.concat(o.segments),0===o.numberOfChildren)return pt(n);if(o.numberOfChildren>1||!o.children[Dn])return Rv(new ut(4e3,!1));o=o.children[Dn]}}applyRedirectCommands(t,i,n){return this.applyRedirectCreateUrlTree(i,this.urlSerializer.parse(i),t,n)}applyRedirectCreateUrlTree(t,i,n,o){const c=this.createSegmentGroup(t,i.root,n,o);return new pm(c,this.createQueryParams(i.queryParams,this.urlTree.queryParams),i.fragment)}createQueryParams(t,i){const n={};return Object.entries(t).forEach(([o,c])=>{if("string"==typeof c&&c.startsWith(":")){const y=c.substring(1);n[o]=i[y]}else n[o]=c}),n}createSegmentGroup(t,i,n,o){const c=this.createSegments(t,i.segments,n,o);let f={};return Object.entries(i.children).forEach(([y,E])=>{f[y]=this.createSegmentGroup(t,E,n,o)}),new xi(c,f)}createSegments(t,i,n,o){return i.map(c=>c.path.startsWith(":")?this.findPosParam(t,c,o):this.findOrReturn(c,n))}findPosParam(t,i,n){const o=n[i.path.substring(1)];if(!o)throw new ut(4001,!1);return o}findOrReturn(t,i){let n=0;for(const o of i){if(o.path===t.path)return i.splice(n),o;n++}return t}}const TC={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function gN(e,t,i,n,o){const c=DC(e,t,i);return c.matched?(n=function zF(e,t){return e.providers&&!e._injector&&(e._injector=Fb(e.providers,t,`Route: ${e.path}`)),e._injector??t}(t,n),function dN(e,t,i,n){const o=t.canMatch;return o&&0!==o.length?pt(o.map(f=>{const y=gm(f,e);return lh(function eN(e){return e&&Yv(e.canMatch)}(y)?y.canMatch(t,i):e.runInContext(()=>y(t,i)))})).pipe(mm(),iI()):pt(!0)}(n,t,i).pipe(En(f=>!0===f?c:{...TC}))):pt(c)}function DC(e,t,i){if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||i.length>0)?{...TC}:{matched:!0,consumedSegments:[],remainingSegments:i,parameters:{},positionalParamSegments:{}};const o=(t.matcher||ZR)(i,e,t);if(!o)return{...TC};const c={};Object.entries(o.posParams??{}).forEach(([y,E])=>{c[y]=E.path});const f=o.consumed.length>0?{...c,...o.consumed[o.consumed.length-1].parameters}:c;return{matched:!0,consumedSegments:o.consumed,remainingSegments:i.slice(o.consumed.length),parameters:f,positionalParamSegments:o.posParams??{}}}function sI(e,t,i,n){return i.length>0&&function vN(e,t,i){return i.some(n=>Zy(e,t,n)&&Dl(n)!==Dn)}(e,i,n)?{segmentGroup:new xi(t,_N(n,new xi(i,e.children))),slicedSegments:[]}:0===i.length&&function yN(e,t,i){return i.some(n=>Zy(e,t,n))}(e,i,n)?{segmentGroup:new xi(e.segments,mN(e,0,i,n,e.children)),slicedSegments:i}:{segmentGroup:new xi(e.segments,e.children),slicedSegments:i}}function mN(e,t,i,n,o){const c={};for(const f of n)if(Zy(e,i,f)&&!o[Dl(f)]){const y=new xi([],{});c[Dl(f)]=y}return{...o,...c}}function _N(e,t){const i={};i[Dn]=t;for(const n of e)if(""===n.path&&Dl(n)!==Dn){const o=new xi([],{});i[Dl(n)]=o}return i}function Zy(e,t,i){return(!(e.hasChildren()||t.length>0)||"full"!==i.pathMatch)&&""===i.path}class CN{constructor(t,i,n,o,c,f,y){this.injector=t,this.configLoader=i,this.rootComponentType=n,this.config=o,this.urlTree=c,this.paramsInheritanceStrategy=f,this.urlSerializer=y,this.allowRedirects=!0,this.applyRedirects=new fN(this.urlSerializer,this.urlTree)}noMatchError(t){return new ut(4002,!1)}recognize(){const t=sI(this.urlTree.root,[],[],this.config).segmentGroup;return this.processSegmentGroup(this.injector,this.config,t,Dn).pipe(jp(i=>{if(i instanceof rI)return this.allowRedirects=!1,this.urlTree=i.urlTree,this.match(i.urlTree);throw i instanceof qy?this.noMatchError(i):i}),En(i=>{const n=new Uy([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},Dn,this.rootComponentType,null,{}),o=new Fu(n,i),c=new ZS("",o),f=function pF(e,t,i=null,n=null){return FS(RS(e),t,i,n)}(n,[],this.urlTree.queryParams,this.urlTree.fragment);return f.queryParams=this.urlTree.queryParams,c.url=this.urlSerializer.serialize(f),this.inheritParamsAndData(c._root),{state:c,tree:f}}))}match(t){return this.processSegmentGroup(this.injector,this.config,t.root,Dn).pipe(jp(n=>{throw n instanceof qy?this.noMatchError(n):n}))}inheritParamsAndData(t){const i=t.value,n=qS(i,this.paramsInheritanceStrategy);i.params=Object.freeze(n.params),i.data=Object.freeze(n.data),t.children.forEach(o=>this.inheritParamsAndData(o))}processSegmentGroup(t,i,n,o){return 0===n.segments.length&&n.hasChildren()?this.processChildren(t,i,n):this.processSegment(t,i,n,n.segments,o,!0)}processChildren(t,i,n){const o=[];for(const c of Object.keys(n.children))"primary"===c?o.unshift(c):o.push(c);return bi(o).pipe(Up(c=>{const f=n.children[c],y=function jF(e,t){const i=e.filter(n=>Dl(n)===t);return i.push(...e.filter(n=>Dl(n)!==t)),i}(i,c);return this.processSegmentGroup(t,y,f,c)}),function $R(e,t){return ri(function jR(e,t,i,n,o){return(c,f)=>{let y=i,E=t,A=0;c.subscribe(ei(f,z=>{const H=A++;E=y?e(E,z,H):(y=!0,z),n&&f.next(E)},o&&(()=>{y&&f.next(E),f.complete()})))}}(e,t,arguments.length>=2,!0))}((c,f)=>(c.push(...f),c)),Oy(null),function HR(e,t){const i=arguments.length>=2;return n=>n.pipe(e?Tc((o,c)=>e(o,c,n)):Uo,dC(1),i?Oy(t):wS(()=>new Py))}(),Ji(c=>{if(null===c)return _m(n);const f=aI(c);return function MN(e){e.sort((t,i)=>t.value.outlet===Dn?-1:i.value.outlet===Dn?1:t.value.outlet.localeCompare(i.value.outlet))}(f),pt(f)}))}processSegment(t,i,n,o,c,f){return bi(i).pipe(Up(y=>this.processSegmentAgainstRoute(y._injector??t,i,y,n,o,c,f).pipe(jp(E=>{if(E instanceof qy)return pt(null);throw E}))),Vp(y=>!!y),jp(y=>{if(nI(y))return function bN(e,t,i){return 0===t.length&&!e.children[i]}(n,o,c)?pt([]):_m(n);throw y}))}processSegmentAgainstRoute(t,i,n,o,c,f,y){return function xN(e,t,i,n){return!!(Dl(e)===n||n!==Dn&&Zy(t,i,e))&&("**"===e.path||DC(t,e,i).matched)}(n,o,c,f)?void 0===n.redirectTo?this.matchSegmentAgainstRoute(t,o,n,c,f,y):y&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,o,i,n,c,f):_m(o):_m(o)}expandSegmentAgainstRouteUsingRedirect(t,i,n,o,c,f){return"**"===o.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,n,o,f):this.expandRegularSegmentAgainstRouteUsingRedirect(t,i,n,o,c,f)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,i,n,o){const c=this.applyRedirects.applyRedirectCommands([],n.redirectTo,{});return n.redirectTo.startsWith("/")?oI(c):this.applyRedirects.lineralizeSegments(n,c).pipe(Ji(f=>{const y=new xi(f,{});return this.processSegment(t,i,y,f,o,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,i,n,o,c,f){const{matched:y,consumedSegments:E,remainingSegments:A,positionalParamSegments:z}=DC(i,o,c);if(!y)return _m(i);const H=this.applyRedirects.applyRedirectCommands(E,o.redirectTo,z);return o.redirectTo.startsWith("/")?oI(H):this.applyRedirects.lineralizeSegments(o,H).pipe(Ji(oe=>this.processSegment(t,n,i,oe.concat(A),f,!1)))}matchSegmentAgainstRoute(t,i,n,o,c,f){let y;if("**"===n.path){const E=o.length>0?MS(o).parameters:{};y=pt({snapshot:new Uy(o,E,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,lI(n),Dl(n),n.component??n._loadedComponent??null,n,cI(n)),consumedSegments:[],remainingSegments:[]}),i.children={}}else y=gN(i,n,o,t).pipe(En(({matched:E,consumedSegments:A,remainingSegments:z,parameters:H})=>E?{snapshot:new Uy(A,H,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,lI(n),Dl(n),n.component??n._loadedComponent??null,n,cI(n)),consumedSegments:A,remainingSegments:z}:null));return y.pipe(Ti(E=>null===E?_m(i):this.getChildConfig(t=n._injector??t,n,o).pipe(Ti(({routes:A})=>{const z=n._loadedInjector??t,{snapshot:H,consumedSegments:oe,remainingSegments:pe}=E,{segmentGroup:Ie,slicedSegments:Ve}=sI(i,oe,pe,A);if(0===Ve.length&&Ie.hasChildren())return this.processChildren(z,A,Ie).pipe(En(et=>null===et?null:[new Fu(H,et)]));if(0===A.length&&0===Ve.length)return pt([new Fu(H,[])]);const We=Dl(n)===c;return this.processSegment(z,A,Ie,Ve,We?Dn:c,!0).pipe(En(et=>[new Fu(H,et)]))}))))}getChildConfig(t,i,n){return i.children?pt({routes:i.children,injector:t}):i.loadChildren?void 0!==i._loadedRoutes?pt({routes:i._loadedRoutes,injector:i._loadedInjector}):function uN(e,t,i,n){const o=t.canLoad;return void 0===o||0===o.length?pt(!0):pt(o.map(f=>{const y=gm(f,e);return lh(function YF(e){return e&&Yv(e.canLoad)}(y)?y.canLoad(t,i):e.runInContext(()=>y(t,i)))})).pipe(mm(),iI())}(t,i,n).pipe(Ji(o=>o?this.configLoader.loadChildren(t,i).pipe(zo(c=>{i._loadedRoutes=c.routes,i._loadedInjector=c.injector})):function pN(e){return Rv(KS(!1,3))}())):pt({routes:[],injector:t})}}function EN(e){const t=e.value.routeConfig;return t&&""===t.path}function aI(e){const t=[],i=new Set;for(const n of e){if(!EN(n)){t.push(n);continue}const o=t.find(c=>n.value.routeConfig===c.value.routeConfig);void 0!==o?(o.children.push(...n.children),i.add(o)):t.push(n)}for(const n of i){const o=aI(n.children);t.push(new Fu(n.value,o))}return t.filter(n=>!i.has(n))}function lI(e){return e.data||{}}function cI(e){return e.resolve||{}}function uI(e){return"string"==typeof e.title||null===e.title}function SC(e){return Ti(t=>{const i=e(t);return i?bi(i).pipe(En(()=>t)):pt(t)})}const vm=new Ot("ROUTES");let IC=(()=>{var e;class t{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=It(jE)}loadComponent(n){if(this.componentLoaders.get(n))return this.componentLoaders.get(n);if(n._loadedComponent)return pt(n._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(n);const o=lh(n.loadComponent()).pipe(En(dI),zo(f=>{this.onLoadEndListener&&this.onLoadEndListener(n),n._loadedComponent=f}),Fv(()=>{this.componentLoaders.delete(n)})),c=new xS(o,()=>new ar).pipe(uC());return this.componentLoaders.set(n,c),c}loadChildren(n,o){if(this.childrenLoaders.get(o))return this.childrenLoaders.get(o);if(o._loadedRoutes)return pt({routes:o._loadedRoutes,injector:o._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(o);const f=this.loadModuleFactoryOrRoutes(o.loadChildren).pipe(En(E=>{this.onLoadEndListener&&this.onLoadEndListener(o);let A,z;return Array.isArray(E)?z=E:(A=E.create(n).injector,z=A.get(vm,[],kt.Self|kt.Optional).flat()),{routes:z.map(EC),injector:A}}),Fv(()=>{this.childrenLoaders.delete(o)})),y=new xS(f,()=>new ar).pipe(uC());return this.childrenLoaders.set(o,y),y}loadModuleFactoryOrRoutes(n){return lh(n()).pipe(En(dI),Ji(o=>o instanceof XM||Array.isArray(o)?pt(o):bi(this.compiler.compileModuleAsync(o))))}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Lt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();function dI(e){return function kN(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let Wy=(()=>{var e;class t{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.lastSuccessfulNavigation=null,this.events=new ar,this.configLoader=It(IC),this.environmentInjector=It(ns),this.urlSerializer=It(Bv),this.rootContexts=It(Gv),this.inputBindingEnabled=null!==It($y,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>pt(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=c=>this.events.next(new TF(c)),this.configLoader.onLoadStartListener=c=>this.events.next(new EF(c))}complete(){this.transitions?.complete()}handleNavigationRequest(n){const o=++this.navigationId;this.transitions?.next({...this.transitions.value,...n,id:o})}setupNavigations(n){return this.transitions=new Ei({id:0,currentUrlTree:n.currentUrlTree,currentRawUrl:n.currentUrlTree,extractedUrl:n.urlHandlingStrategy.extract(n.currentUrlTree),urlAfterRedirects:n.urlHandlingStrategy.extract(n.currentUrlTree),rawUrl:n.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:$v,restoredState:null,currentSnapshot:n.routerState.snapshot,targetSnapshot:null,currentRouterState:n.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Tc(o=>0!==o.id),En(o=>({...o,extractedUrl:n.urlHandlingStrategy.extract(o.rawUrl)})),Ti(o=>{let c=!1,f=!1;return pt(o).pipe(zo(y=>{this.currentNavigation={id:y.id,initialUrl:y.rawUrl,extractedUrl:y.extractedUrl,trigger:y.source,extras:y.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),Ti(y=>{const E=n.browserUrlTree.toString(),A=!n.navigated||y.extractedUrl.toString()!==E||E!==n.currentUrlTree.toString();if(!A&&"reload"!==(y.extras.onSameUrlNavigation??n.onSameUrlNavigation)){const H="";return this.events.next(new Hv(y.id,n.serializeUrl(o.rawUrl),H,0)),n.rawUrlTree=y.rawUrl,y.resolve(null),bo}if(n.urlHandlingStrategy.shouldProcessUrl(y.rawUrl))return hI(y.source)&&(n.browserUrlTree=y.extractedUrl),pt(y).pipe(Ti(H=>{const oe=this.transitions?.getValue();return this.events.next(new _C(H.id,this.urlSerializer.serialize(H.extractedUrl),H.source,H.restoredState)),oe!==this.transitions?.getValue()?bo:Promise.resolve(H)}),function TN(e,t,i,n,o,c){return Ji(f=>function wN(e,t,i,n,o,c,f="emptyOnly"){return new CN(e,t,i,n,o,f,c).recognize()}(e,t,i,n,f.extractedUrl,o,c).pipe(En(({state:y,tree:E})=>({...f,targetSnapshot:y,urlAfterRedirects:E}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,n.config,this.urlSerializer,n.paramsInheritanceStrategy),zo(H=>{if(o.targetSnapshot=H.targetSnapshot,o.urlAfterRedirects=H.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:H.urlAfterRedirects},"eager"===n.urlUpdateStrategy){if(!H.extras.skipLocationChange){const pe=n.urlHandlingStrategy.merge(H.urlAfterRedirects,H.rawUrl);n.setBrowserUrl(pe,H)}n.browserUrlTree=H.urlAfterRedirects}const oe=new xF(H.id,this.urlSerializer.serialize(H.extractedUrl),this.urlSerializer.serialize(H.urlAfterRedirects),H.targetSnapshot);this.events.next(oe)}));if(A&&n.urlHandlingStrategy.shouldProcessUrl(n.rawUrlTree)){const{id:H,extractedUrl:oe,source:pe,restoredState:Ie,extras:Ve}=y,We=new _C(H,this.urlSerializer.serialize(oe),pe,Ie);this.events.next(We);const et=GS(0,this.rootComponentType).snapshot;return pt(o={...y,targetSnapshot:et,urlAfterRedirects:oe,extras:{...Ve,skipLocationChange:!1,replaceUrl:!1}})}{const H="";return this.events.next(new Hv(y.id,n.serializeUrl(o.extractedUrl),H,1)),n.rawUrlTree=y.rawUrl,y.resolve(null),bo}}),zo(y=>{const E=new bF(y.id,this.urlSerializer.serialize(y.extractedUrl),this.urlSerializer.serialize(y.urlAfterRedirects),y.targetSnapshot);this.events.next(E)}),En(y=>o={...y,guards:GF(y.targetSnapshot,y.currentSnapshot,this.rootContexts)}),function nN(e,t){return Ji(i=>{const{targetSnapshot:n,currentSnapshot:o,guards:{canActivateChecks:c,canDeactivateChecks:f}}=i;return 0===f.length&&0===c.length?pt({...i,guardsResult:!0}):function iN(e,t,i,n){return bi(e).pipe(Ji(o=>function cN(e,t,i,n,o){const c=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return c&&0!==c.length?pt(c.map(y=>{const E=Zv(t)??o,A=gm(y,E);return lh(function QF(e){return e&&Yv(e.canDeactivate)}(A)?A.canDeactivate(e,t,i,n):E.runInContext(()=>A(e,t,i,n))).pipe(Vp())})).pipe(mm()):pt(!0)}(o.component,o.route,i,t,n)),Vp(o=>!0!==o,!0))}(f,n,o,e).pipe(Ji(y=>y&&function XF(e){return"boolean"==typeof e}(y)?function rN(e,t,i,n){return bi(t).pipe(Up(o=>Lv(function sN(e,t){return null!==e&&t&&t(new DF(e)),pt(!0)}(o.route.parent,n),function oN(e,t){return null!==e&&t&&t(new IF(e)),pt(!0)}(o.route,n),function lN(e,t,i){const n=t[t.length-1],c=t.slice(0,t.length-1).reverse().map(f=>function qF(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(f)).filter(f=>null!==f).map(f=>ky(()=>pt(f.guards.map(E=>{const A=Zv(f.node)??i,z=gm(E,A);return lh(function JF(e){return e&&Yv(e.canActivateChild)}(z)?z.canActivateChild(n,e):A.runInContext(()=>z(n,e))).pipe(Vp())})).pipe(mm())));return pt(c).pipe(mm())}(e,o.path,i),function aN(e,t,i){const n=t.routeConfig?t.routeConfig.canActivate:null;if(!n||0===n.length)return pt(!0);const o=n.map(c=>ky(()=>{const f=Zv(t)??i,y=gm(c,f);return lh(function KF(e){return e&&Yv(e.canActivate)}(y)?y.canActivate(t,e):f.runInContext(()=>y(t,e))).pipe(Vp())}));return pt(o).pipe(mm())}(e,o.route,i))),Vp(o=>!0!==o,!0))}(n,c,e,t):pt(y)),En(y=>({...i,guardsResult:y})))})}(this.environmentInjector,y=>this.events.next(y)),zo(y=>{if(o.guardsResult=y.guardsResult,Hp(y.guardsResult))throw YS(0,y.guardsResult);const E=new wF(y.id,this.urlSerializer.serialize(y.extractedUrl),this.urlSerializer.serialize(y.urlAfterRedirects),y.targetSnapshot,!!y.guardsResult);this.events.next(E)}),Tc(y=>!!y.guardsResult||(n.restoreHistory(y),this.cancelNavigationTransition(y,"",3),!1)),SC(y=>{if(y.guards.canActivateChecks.length)return pt(y).pipe(zo(E=>{const A=new CF(E.id,this.urlSerializer.serialize(E.extractedUrl),this.urlSerializer.serialize(E.urlAfterRedirects),E.targetSnapshot);this.events.next(A)}),Ti(E=>{let A=!1;return pt(E).pipe(function DN(e,t){return Ji(i=>{const{targetSnapshot:n,guards:{canActivateChecks:o}}=i;if(!o.length)return pt(i);let c=0;return bi(o).pipe(Up(f=>function SN(e,t,i,n){const o=e.routeConfig,c=e._resolve;return void 0!==o?.title&&!uI(o)&&(c[Nv]=o.title),function IN(e,t,i,n){const o=function AN(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}(e);if(0===o.length)return pt({});const c={};return bi(o).pipe(Ji(f=>function PN(e,t,i,n){const o=Zv(t)??n,c=gm(e,o);return lh(c.resolve?c.resolve(t,i):o.runInContext(()=>c(t,i)))}(e[f],t,i,n).pipe(Vp(),zo(y=>{c[f]=y}))),dC(1),function GR(e){return En(()=>e)}(c),jp(f=>nI(f)?bo:Rv(f)))}(c,e,t,n).pipe(En(f=>(e._resolvedData=f,e.data=qS(e,i).resolve,o&&uI(o)&&(e.data[Nv]=o.title),null)))}(f.route,n,e,t)),zo(()=>c++),dC(1),Ji(f=>c===o.length?pt(i):bo))})}(n.paramsInheritanceStrategy,this.environmentInjector),zo({next:()=>A=!0,complete:()=>{A||(n.restoreHistory(E),this.cancelNavigationTransition(E,"",2))}}))}),zo(E=>{const A=new MF(E.id,this.urlSerializer.serialize(E.extractedUrl),this.urlSerializer.serialize(E.urlAfterRedirects),E.targetSnapshot);this.events.next(A)}))}),SC(y=>{const E=A=>{const z=[];A.routeConfig?.loadComponent&&!A.routeConfig._loadedComponent&&z.push(this.configLoader.loadComponent(A.routeConfig).pipe(zo(H=>{A.component=H}),En(()=>{})));for(const H of A.children)z.push(...E(H));return z};return cC(E(y.targetSnapshot.root)).pipe(Oy(),Ec(1))}),SC(()=>this.afterPreactivation()),En(y=>{const E=function RF(e,t,i){const n=qv(e,t._root,i?i._root:void 0);return new HS(n,t)}(n.routeReuseStrategy,y.targetSnapshot,y.currentRouterState);return o={...y,targetRouterState:E}}),zo(y=>{n.currentUrlTree=y.urlAfterRedirects,n.rawUrlTree=n.urlHandlingStrategy.merge(y.urlAfterRedirects,y.rawUrl),n.routerState=y.targetRouterState,"deferred"===n.urlUpdateStrategy&&(y.extras.skipLocationChange||n.setBrowserUrl(n.rawUrlTree,y),n.browserUrlTree=y.urlAfterRedirects)}),((e,t,i,n)=>En(o=>(new HF(t,o.targetRouterState,o.currentRouterState,i,n).activate(e),o)))(this.rootContexts,n.routeReuseStrategy,y=>this.events.next(y),this.inputBindingEnabled),Ec(1),zo({next:y=>{c=!0,this.lastSuccessfulNavigation=this.currentNavigation,n.navigated=!0,this.events.next(new Gp(y.id,this.urlSerializer.serialize(y.extractedUrl),this.urlSerializer.serialize(n.currentUrlTree))),n.titleStrategy?.updateTitle(y.targetRouterState.snapshot),y.resolve(!0)},complete:()=>{c=!0}}),Fv(()=>{c||f||this.cancelNavigationTransition(o,"",1),this.currentNavigation?.id===o.id&&(this.currentNavigation=null)}),jp(y=>{if(f=!0,QS(y)){JS(y)||(n.navigated=!0,n.restoreHistory(o,!0));const E=new Vy(o.id,this.urlSerializer.serialize(o.extractedUrl),y.message,y.cancellationCode);if(this.events.next(E),JS(y)){const A=n.urlHandlingStrategy.merge(y.url,n.rawUrlTree),z={skipLocationChange:o.extras.skipLocationChange,replaceUrl:"eager"===n.urlUpdateStrategy||hI(o.source)};n.scheduleNavigation(A,$v,null,z,{resolve:o.resolve,reject:o.reject,promise:o.promise})}else o.resolve(!1)}else{n.restoreHistory(o,!0);const E=new vC(o.id,this.urlSerializer.serialize(o.extractedUrl),y,o.targetSnapshot??void 0);this.events.next(E);try{o.resolve(n.errorHandler(y))}catch(A){o.reject(A)}}return bo}))}))}cancelNavigationTransition(n,o,c){const f=new Vy(n.id,this.urlSerializer.serialize(n.extractedUrl),o,c);this.events.next(f),n.resolve(!1)}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Lt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();function hI(e){return e!==$v}let pI=(()=>{var e;class t{buildTitle(n){let o,c=n.root;for(;void 0!==c;)o=this.getResolvedTitleForRoute(c)??o,c=c.children.find(f=>f.outlet===Dn);return o}getResolvedTitleForRoute(n){return n.data[Nv]}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Lt({token:e,factory:function(){return It(ON)},providedIn:"root"}),t})(),ON=(()=>{var e;class t extends pI{constructor(n){super(),this.title=n}updateTitle(n){const o=this.buildTitle(n);void 0!==o&&this.title.setTitle(o)}}return(e=t).\u0275fac=function(n){return new(n||e)(Ft(fD))},e.\u0275prov=Lt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),LN=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Lt({token:e,factory:function(){return It(FN)},providedIn:"root"}),t})();class RN{shouldDetach(t){return!1}store(t,i){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,i){return t.routeConfig===i.routeConfig}}let FN=(()=>{var e;class t extends RN{}return(e=t).\u0275fac=function(){let i;return function(o){return(i||(i=nr(e)))(o||e)}}(),e.\u0275prov=Lt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();const Xy=new Ot("",{providedIn:"root",factory:()=>({})});let NN=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Lt({token:e,factory:function(){return It(zN)},providedIn:"root"}),t})(),zN=(()=>{var e;class t{shouldProcessUrl(n){return!0}extract(n){return n}merge(n,o){return n}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Lt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();var Kv=function(e){return e[e.COMPLETE=0]="COMPLETE",e[e.FAILED=1]="FAILED",e[e.REDIRECTING=2]="REDIRECTING",e}(Kv||{});function fI(e,t){e.events.pipe(Tc(i=>i instanceof Gp||i instanceof Vy||i instanceof vC||i instanceof Hv),En(i=>i instanceof Gp||i instanceof Hv?Kv.COMPLETE:i instanceof Vy&&(0===i.code||1===i.code)?Kv.REDIRECTING:Kv.FAILED),Tc(i=>i!==Kv.REDIRECTING),Ec(1)).subscribe(()=>{t()})}function BN(e){throw e}function VN(e,t,i){return t.parse("/")}const UN={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},jN={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Zr=(()=>{var e;class t{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){if("computed"===this.canceledNavigationResolution)return this.location.getState()?.\u0275routerPageId}get events(){return this.navigationTransitions.events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=It(UE),this.isNgZoneEnabled=!1,this.options=It(Xy,{optional:!0})||{},this.pendingTasks=It(ty),this.errorHandler=this.options.errorHandler||BN,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||VN,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=It(NN),this.routeReuseStrategy=It(LN),this.titleStrategy=It(pI),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=It(vm,{optional:!0})?.flat()??[],this.navigationTransitions=It(Wy),this.urlSerializer=It(Bv),this.location=It(_w),this.componentInputBindingEnabled=!!It($y,{optional:!0}),this.isNgZoneEnabled=It(ir)instanceof ir&&ir.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new pm,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=GS(0,null),this.navigationTransitions.setupNavigations(this).subscribe(n=>{this.lastSuccessfulId=n.id,this.currentPageId=this.browserPageId??0},n=>{this.console.warn(`Unhandled Navigation Error: ${n}`)})}resetRootComponentType(n){this.routerState.root.component=n,this.navigationTransitions.rootComponentType=n}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const n=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),$v,n)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(n=>{const o="popstate"===n.type?"popstate":"hashchange";"popstate"===o&&setTimeout(()=>{this.navigateToSyncWithBrowser(n.url,o,n.state)},0)}))}navigateToSyncWithBrowser(n,o,c){const f={replaceUrl:!0},y=c?.navigationId?c:null;if(c){const A={...c};delete A.navigationId,delete A.\u0275routerPageId,0!==Object.keys(A).length&&(f.state=A)}const E=this.parseUrl(n);this.scheduleNavigation(E,o,y,f)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(n){this.config=n.map(EC),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(n,o={}){const{relativeTo:c,queryParams:f,fragment:y,queryParamsHandling:E,preserveFragment:A}=o,z=A?this.currentUrlTree.fragment:y;let oe,H=null;switch(E){case"merge":H={...this.currentUrlTree.queryParams,...f};break;case"preserve":H=this.currentUrlTree.queryParams;break;default:H=f||null}null!==H&&(H=this.removeEmptyProps(H));try{oe=RS(c?c.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof n[0]||!n[0].startsWith("/"))&&(n=[]),oe=this.currentUrlTree.root}return FS(oe,n,H,z??null)}navigateByUrl(n,o={skipLocationChange:!1}){const c=Hp(n)?n:this.parseUrl(n),f=this.urlHandlingStrategy.merge(c,this.rawUrlTree);return this.scheduleNavigation(f,$v,null,o)}navigate(n,o={skipLocationChange:!1}){return function $N(e){for(let t=0;t<e.length;t++)if(null==e[t])throw new ut(4008,!1)}(n),this.navigateByUrl(this.createUrlTree(n,o),o)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){let o;try{o=this.urlSerializer.parse(n)}catch(c){o=this.malformedUriErrorHandler(c,this.urlSerializer,n)}return o}isActive(n,o){let c;if(c=!0===o?{...UN}:!1===o?{...jN}:o,Hp(n))return TS(this.currentUrlTree,n,c);const f=this.parseUrl(n);return TS(this.currentUrlTree,f,c)}removeEmptyProps(n){return Object.keys(n).reduce((o,c)=>{const f=n[c];return null!=f&&(o[c]=f),o},{})}scheduleNavigation(n,o,c,f,y){if(this.disposed)return Promise.resolve(!1);let E,A,z;y?(E=y.resolve,A=y.reject,z=y.promise):z=new Promise((oe,pe)=>{E=oe,A=pe});const H=this.pendingTasks.add();return fI(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(H))}),this.navigationTransitions.handleNavigationRequest({source:o,restoredState:c,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:n,extras:f,resolve:E,reject:A,promise:z,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),z.catch(oe=>Promise.reject(oe))}setBrowserUrl(n,o){const c=this.urlSerializer.serialize(n);if(this.location.isCurrentPathEqualTo(c)||o.extras.replaceUrl){const y={...o.extras.state,...this.generateNgRouterState(o.id,this.browserPageId)};this.location.replaceState(c,"",y)}else{const f={...o.extras.state,...this.generateNgRouterState(o.id,(this.browserPageId??0)+1)};this.location.go(c,"",f)}}restoreHistory(n,o=!1){if("computed"===this.canceledNavigationResolution){const f=this.currentPageId-(this.browserPageId??this.currentPageId);0!==f?this.location.historyGo(f):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===f&&(this.resetState(n),this.browserUrlTree=n.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(o&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=n.currentRouterState,this.currentUrlTree=n.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(n,o){return"computed"===this.canceledNavigationResolution?{navigationId:n,\u0275routerPageId:o}:{navigationId:n}}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Lt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),ym=(()=>{var e;class t{constructor(n,o,c,f,y,E){this.router=n,this.route=o,this.tabIndexAttribute=c,this.renderer=f,this.el=y,this.locationStrategy=E,this.href=null,this.commands=null,this.onChanges=new ar,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;const A=y.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===A||"area"===A,this.isAnchorElement?this.subscription=n.events.subscribe(z=>{z instanceof Gp&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(n){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",n)}ngOnChanges(n){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(n){null!=n?(this.commands=Array.isArray(n)?n:[n],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(n,o,c,f,y){return!!(null===this.urlTree||this.isAnchorElement&&(0!==n||o||c||f||y||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const n=null===this.href?null:function _0(e,t,i){return function Yx(e,t){return"src"===t&&("embed"===e||"frame"===e||"iframe"===e||"media"===e||"script"===e)||"href"===t&&("base"===e||"link"===e)?k_:Da}(t,i)(e)}(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",n)}applyAttributeValue(n,o){const c=this.renderer,f=this.el.nativeElement;null!==o?c.setAttribute(f,n,o):c.removeAttribute(f,n)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return(e=t).\u0275fac=function(n){return new(n||e)(G(Zr),G(ch),hu("tabindex"),G(Ss),G(Bi),G(kp))},e.\u0275dir=mt({type:e,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(n,o){1&n&&ye("click",function(f){return o.onClick(f.button,f.ctrlKey,f.shiftKey,f.altKey,f.metaKey)}),2&n&&Fo("target",o.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:["preserveFragment","preserveFragment",sm],skipLocationChange:["skipLocationChange","skipLocationChange",sm],replaceUrl:["replaceUrl","replaceUrl",sm],routerLink:"routerLink"},standalone:!0,features:[f2,Ee]}),t})();class gI{}let qN=(()=>{var e;class t{constructor(n,o,c,f,y){this.router=n,this.injector=c,this.preloadingStrategy=f,this.loader=y}setUpPreloading(){this.subscription=this.router.events.pipe(Tc(n=>n instanceof Gp),Up(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(n,o){const c=[];for(const f of o){f.providers&&!f._injector&&(f._injector=Fb(f.providers,n,`Route: ${f.path}`));const y=f._injector??n,E=f._loadedInjector??y;(f.loadChildren&&!f._loadedRoutes&&void 0===f.canLoad||f.loadComponent&&!f._loadedComponent)&&c.push(this.preloadConfig(y,f)),(f.children||f._loadedRoutes)&&c.push(this.processRoutes(E,f.children??f._loadedRoutes))}return bi(c).pipe(fs())}preloadConfig(n,o){return this.preloadingStrategy.preload(o,()=>{let c;c=o.loadChildren&&void 0===o.canLoad?this.loader.loadChildren(n,o):pt(null);const f=c.pipe(Ji(y=>null===y?pt(void 0):(o._loadedRoutes=y.routes,o._loadedInjector=y.injector,this.processRoutes(y.injector??n,y.routes))));return o.loadComponent&&!o._loadedComponent?bi([f,this.loader.loadComponent(o)]).pipe(fs()):f})}}return(e=t).\u0275fac=function(n){return new(n||e)(Ft(Zr),Ft(jE),Ft(ns),Ft(gI),Ft(IC))},e.\u0275prov=Lt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();const AC=new Ot("");let mI=(()=>{var e;class t{constructor(n,o,c,f,y={}){this.urlSerializer=n,this.transitions=o,this.viewportScroller=c,this.zone=f,this.options=y,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},y.scrollPositionRestoration=y.scrollPositionRestoration||"disabled",y.anchorScrolling=y.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof _C?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=n.navigationTrigger,this.restoredId=n.restoredState?n.restoredState.navigationId:0):n instanceof Gp?(this.lastId=n.id,this.scheduleScrollEvent(n,this.urlSerializer.parse(n.urlAfterRedirects).fragment)):n instanceof Hv&&0===n.code&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(n,this.urlSerializer.parse(n.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof jS&&(n.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(n.position):n.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(n.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(n,o){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new jS(n,"popstate"===this.lastSource?this.store[this.restoredId]:null,o))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return(e=t).\u0275fac=function(n){!function me(){throw new Error("invalid")}()},e.\u0275prov=Lt({token:e,factory:e.\u0275fac}),t})();function Nu(e,t){return{\u0275kind:e,\u0275providers:t}}function vI(){const e=It(fo);return t=>{const i=e.get(rm);if(t!==i.components[0])return;const n=e.get(Zr),o=e.get(yI);1===e.get(PC)&&n.initialNavigation(),e.get(xI,null,kt.Optional)?.setUpPreloading(),e.get(AC,null,kt.Optional)?.init(),n.resetRootComponentType(i.componentTypes[0]),o.closed||(o.next(),o.complete(),o.unsubscribe())}}const yI=new Ot("",{factory:()=>new ar}),PC=new Ot("",{providedIn:"root",factory:()=>1}),xI=new Ot("");function YN(e){return Nu(0,[{provide:xI,useExisting:qN},{provide:gI,useExisting:e}])}const bI=new Ot("ROUTER_FORROOT_GUARD"),JN=[_w,{provide:Bv,useClass:hC},Zr,Gv,{provide:ch,useFactory:function _I(e){return e.routerState.root},deps:[Zr]},IC,[]];function QN(){return new eT("Router",Zr)}let wI=(()=>{var e;class t{constructor(n){}static forRoot(n,o){return{ngModule:t,providers:[JN,[],{provide:vm,multi:!0,useValue:n},{provide:bI,useFactory:i6,deps:[[Zr,new zf,new Bf]]},{provide:Xy,useValue:o||{}},o?.useHash?{provide:kp,useClass:xO}:{provide:kp,useClass:IT},{provide:AC,useFactory:()=>{const e=It(z4),t=It(ir),i=It(Xy),n=It(Wy),o=It(Bv);return i.scrollOffset&&e.setOffset(i.scrollOffset),new mI(o,n,e,t,i)}},o?.preloadingStrategy?YN(o.preloadingStrategy).\u0275providers:[],{provide:eT,multi:!0,useFactory:QN},o?.initialNavigation?r6(o):[],o?.bindToComponentInputs?Nu(8,[XS,{provide:$y,useExisting:XS}]).\u0275providers:[],[{provide:CI,useFactory:vI},{provide:aw,multi:!0,useExisting:CI}]]}}static forChild(n){return{ngModule:t,providers:[{provide:vm,multi:!0,useValue:n}]}}}return(e=t).\u0275fac=function(n){return new(n||e)(Ft(bI,8))},e.\u0275mod=cr({type:e}),e.\u0275inj=lr({}),t})();function i6(e){return"guarded"}function r6(e){return["disabled"===e.initialNavigation?Nu(3,[{provide:Kb,multi:!0,useFactory:()=>{const t=It(Zr);return()=>{t.setUpLocationChangeListener()}}},{provide:PC,useValue:2}]).\u0275providers:[],"enabledBlocking"===e.initialNavigation?Nu(2,[{provide:PC,useValue:0},{provide:Kb,multi:!0,deps:[fo],useFactory:t=>{const i=t.get(vO,Promise.resolve());return()=>i.then(()=>new Promise(n=>{const o=t.get(Zr),c=t.get(yI);fI(o,()=>{n(!0)}),t.get(Wy).afterPreactivation=()=>(n(!0),c.closed?pt(void 0):c),o.initialNavigation()}))}}]).\u0275providers:[]]}const CI=new Ot("");let kC=(()=>{var e;class t{constructor(){}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275cmp=mi({type:e,selectors:[["app-device"]],decls:1,vars:0,template:function(n,o){1&n&&He(0,"router-outlet")},dependencies:[jy],styles:['*[_ngcontent-%COMP%]{font-family:system-ui}.input-1[_ngcontent-%COMP%]{width:15%}.input-0[_ngcontent-%COMP%]{width:10%}.input-00[_ngcontent-%COMP%]{width:5em}.input-2[_ngcontent-%COMP%]{width:30%}#map[_ngcontent-%COMP%]{width:100%;height:100%;position:relative}.floating-range[_ngcontent-%COMP%]{position:relative;bottom:0;z-index:999;width:40%}.toast-cont[_ngcontent-%COMP%]{top:-10px;right:0;position:fixed}.btn[_ngcontent-%COMP%]:hover{border-color:#fff}.mapboxgl-canvas[_ngcontent-%COMP%]{width:100%}.form-range[_ngcontent-%COMP%]::-moz-range-thumb{background-color:#6c757d}.form-range[_ngcontent-%COMP%]::-webkit-slider-thumb{background-color:#6c757d}.mark[_ngcontent-%COMP%]{background-color:#e3e3e3}th[_ngcontent-%COMP%]{border-radius:7px}.floating-content[_ngcontent-%COMP%]{display:flex}#menu[_ngcontent-%COMP%]{margin:.5em;font-size:medium;background-color:#fff;position:relative;width:max-content;padding:5px;top:0;left:0;z-index:999;border-radius:5px;border:1px #afafaf solid}#menu[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin-right:.5em}.list-group[_ngcontent-%COMP%]{z-index:999;position:absolute;top:0;right:0;cursor:pointer;height:85%}.botoncito[_ngcontent-%COMP%]{z-index:1000;position:absolute;top:30px;left:20px}.nav[_ngcontent-%COMP%]{margin:1em}.cc2[_ngcontent-%COMP%]{margin:0 1em 1em}h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%], h4[_ngcontent-%COMP%], p[_ngcontent-%COMP%], a[_ngcontent-%COMP%], .btn[_ngcontent-%COMP%], span[_ngcontent-%COMP%], label[_ngcontent-%COMP%]{font-weight:500}.navb[_ngcontent-%COMP%]{width:49%}.cont[_ngcontent-%COMP%]{background-color:#fff;border-radius:10px;min-height:88vh}.cont_recto[_ngcontent-%COMP%]{border-top-left-radius:0}.cont0[_ngcontent-%COMP%]{margin:0 1em}.c10[_ngcontent-%COMP%]{width:68.5%}.c100[_ngcontent-%COMP%]{width:98%}.sensores_2_20[_ngcontent-%COMP%]{width:29%}.sensores_2_100[_ngcontent-%COMP%]{width:96%}.c20[_ngcontent-%COMP%]{width:50%}.c200[_ngcontent-%COMP%]{width:100%}.single-line[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.rev[_ngcontent-%COMP%]{flex-direction:column-reverse}.cont1[_ngcontent-%COMP%]{background-color:#fff;padding:1em;border-radius:10px;margin-bottom:1em}.cont2[_ngcontent-%COMP%]{background-color:#fff;border-radius:10px;height:max-content;margin-bottom:1em}.alt[_ngcontent-%COMP%]{height:82vh}.cont3[_ngcontent-%COMP%]{padding:0 1em 1em;background-color:#fff;border-radius:10px;height:min-content;margin-bottom:1em}.over[_ngcontent-%COMP%]{overflow-y:scroll}thead[_ngcontent-%COMP%]{background-color:#f2f2f2;border-radius:10px}.half[_ngcontent-%COMP%]{width:50%}app-devices-edit[_ngcontent-%COMP%]{display:flex}a[_ngcontent-%COMP%]{text-decoration:none;color:#000}.c1[_ngcontent-%COMP%]{height:min-content}.c2[_ngcontent-%COMP%]{padding-top:1em;height:max-content}.c3[_ngcontent-%COMP%]{height:-moz-fit-content;height:fit-content}.c4[_ngcontent-%COMP%]{padding:.8em 1em .5em;height:-moz-fit-content;height:fit-content}.c5[_ngcontent-%COMP%]{height:62vh}.c6[_ngcontent-%COMP%]{padding:1em 1em .5em}.nuevo[_ngcontent-%COMP%]{border-radius:10px;background-color:#f2f2f2;padding:1em;margin:.01em .01em 1em}.not[_ngcontent-%COMP%]{font-size:large}.tt1[_ngcontent-%COMP%]{--width: 130px;--height: calc(var(--width) / 3.5)}.tt2[_ngcontent-%COMP%]{--width: 100px;--height: calc(var(--width) / 3.3)}.toggle[_ngcontent-%COMP%]{position:relative;display:inline-block;width:var(--width);height:var(--height);box-shadow:0 1px 3px #0000004d;border-radius:var(--height);cursor:pointer}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.toggle[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;border-radius:var(--height);background-color:#dc3545;transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;width:calc(var(--height));height:calc(var(--height));border-radius:calc(var(--height) / 2);background-color:#fff;box-shadow:0 1px 3px #0000004d;transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]{background-color:#198754}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]:before{transform:translate(calc(var(--width) - var(--height)))}.toggle[_ngcontent-%COMP%]   .labels[_ngcontent-%COMP%]{position:absolute;top:8px;left:0;width:100%;height:100%;font-weight:600;transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   .labels[_ngcontent-%COMP%]:after{content:attr(data-off);position:absolute;right:25px;color:#fff;opacity:1;text-shadow:1px 1px 2px rgba(0,0,0,.4);transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   .labels[_ngcontent-%COMP%]:before{content:attr(data-on);position:absolute;left:25px;color:#fff;opacity:0;text-shadow:1px 1px 2px rgba(255,255,255,.4);transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked ~ .labels[_ngcontent-%COMP%]:after{opacity:0}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked ~ .labels[_ngcontent-%COMP%]:before{opacity:1}.mapboxgl-popup[_ngcontent-%COMP%]{max-width:400px;font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif}.t1[_ngcontent-%COMP%]{font-size:15px}.t2[_ngcontent-%COMP%]{font-size:11px}  .ng-select .ng-clear-wrapper .ng-clear{font-size:40px!important;color:#969696;right:7px;line-height:.7!important}  .ng-select .ng-clear-wrapper{height:34px;line-height:.5;width:30px!important}  .ng-value{background-color:#e3e3e3;border-radius:6px;margin-right:.5em;padding-bottom:.2em}  .ng-dropdown-panel{background-color:#f5f5f5}  .ng-option{padding:0 .7em .7em}  .ng-value-icon{font-size:22px;padding-left:.4em;padding-right:.4em}  .ng-value-label{padding-right:1em}.mapbox-popup-anchor-bottom[_ngcontent-%COMP%]{max-width:400px}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}tbody[_ngcontent-%COMP%]{max-height:600px;overflow-y:scroll}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:left;position:sticky;top:0;z-index:1}']}),t})();function MI(e,t,i,n,o,c,f){try{var y=e[c](f),E=y.value}catch(A){return void i(A)}y.done?t(E):Promise.resolve(E).then(n,o)}const qt_languageName=["Espa\xf1ol","English"],qt_languageLang=["es","en"],qt_resultsPerPag=[1,15,50,100],qt_baseUrl="http://localhost:5172/api",qt_accessTokenMap="pk.eyJ1IjoiZGF2aWRzYWF2MyIsImEiOiJjbGl1cmZ4NG8wMTZqM2ZwNW1pcW85bGo4In0.ye1F3KfhnRZruosNYoAYYQ";class Yy{}class Ky{}class rr{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?"string"==typeof t?this.lazyInit=()=>{this.headers=new Map,t.split("\n").forEach(i=>{const n=i.indexOf(":");if(n>0){const o=i.slice(0,n),c=o.toLowerCase(),f=i.slice(n+1).trim();this.maybeSetNormalizedName(o,c),this.headers.has(c)?this.headers.get(c).push(f):this.headers.set(c,[f])}})}:typeof Headers<"u"&&t instanceof Headers?(this.headers=new Map,t.forEach((i,n)=>{this.setHeaderEntries(n,i)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(t).forEach(([i,n])=>{this.setHeaderEntries(i,n)})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const i=this.headers.get(t.toLowerCase());return i&&i.length>0?i[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,i){return this.clone({name:t,value:i,op:"a"})}set(t,i){return this.clone({name:t,value:i,op:"s"})}delete(t,i){return this.clone({name:t,value:i,op:"d"})}maybeSetNormalizedName(t,i){this.normalizedNames.has(i)||this.normalizedNames.set(i,t)}init(){this.lazyInit&&(this.lazyInit instanceof rr?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(i=>{this.headers.set(i,t.headers.get(i)),this.normalizedNames.set(i,t.normalizedNames.get(i))})}clone(t){const i=new rr;return i.lazyInit=this.lazyInit&&this.lazyInit instanceof rr?this.lazyInit:this,i.lazyUpdate=(this.lazyUpdate||[]).concat([t]),i}applyUpdate(t){const i=t.name.toLowerCase();switch(t.op){case"a":case"s":let n=t.value;if("string"==typeof n&&(n=[n]),0===n.length)return;this.maybeSetNormalizedName(t.name,i);const o=("a"===t.op?this.headers.get(i):void 0)||[];o.push(...n),this.headers.set(i,o);break;case"d":const c=t.value;if(c){let f=this.headers.get(i);if(!f)return;f=f.filter(y=>-1===c.indexOf(y)),0===f.length?(this.headers.delete(i),this.normalizedNames.delete(i)):this.headers.set(i,f)}else this.headers.delete(i),this.normalizedNames.delete(i)}}setHeaderEntries(t,i){const n=(Array.isArray(i)?i:[i]).map(c=>c.toString()),o=t.toLowerCase();this.headers.set(o,n),this.maybeSetNormalizedName(t,o)}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(i=>t(this.normalizedNames.get(i),this.headers.get(i)))}}class a6{encodeKey(t){return EI(t)}encodeValue(t){return EI(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const c6=/%(\d[a-f0-9])/gi,u6={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function EI(e){return encodeURIComponent(e).replace(c6,(t,i)=>u6[i]??t)}function Jy(e){return`${e}`}class uh{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new a6,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function l6(e,t){const i=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(o=>{const c=o.indexOf("="),[f,y]=-1==c?[t.decodeKey(o),""]:[t.decodeKey(o.slice(0,c)),t.decodeValue(o.slice(c+1))],E=i.get(f)||[];E.push(y),i.set(f,E)}),i}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(i=>{const n=t.fromObject[i],o=Array.isArray(n)?n.map(Jy):[Jy(n)];this.map.set(i,o)})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const i=this.map.get(t);return i?i[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,i){return this.clone({param:t,value:i,op:"a"})}appendAll(t){const i=[];return Object.keys(t).forEach(n=>{const o=t[n];Array.isArray(o)?o.forEach(c=>{i.push({param:n,value:c,op:"a"})}):i.push({param:n,value:o,op:"a"})}),this.clone(i)}set(t,i){return this.clone({param:t,value:i,op:"s"})}delete(t,i){return this.clone({param:t,value:i,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const i=this.encoder.encodeKey(t);return this.map.get(t).map(n=>i+"="+this.encoder.encodeValue(n)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const i=new uh({encoder:this.encoder});return i.cloneFrom=this.cloneFrom||this,i.updates=(this.updates||[]).concat(t),i}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const i=("a"===t.op?this.map.get(t.param):void 0)||[];i.push(Jy(t.value)),this.map.set(t.param,i);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let n=this.map.get(t.param)||[];const o=n.indexOf(Jy(t.value));-1!==o&&n.splice(o,1),n.length>0?this.map.set(t.param,n):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class d6{constructor(){this.map=new Map}set(t,i){return this.map.set(t,i),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}has(t){return this.map.has(t)}keys(){return this.map.keys()}}function TI(e){return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer}function DI(e){return typeof Blob<"u"&&e instanceof Blob}function SI(e){return typeof FormData<"u"&&e instanceof FormData}class Jv{constructor(t,i,n,o){let c;if(this.url=i,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function h6(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||o?(this.body=void 0!==n?n:null,c=o):c=n,c&&(this.reportProgress=!!c.reportProgress,this.withCredentials=!!c.withCredentials,c.responseType&&(this.responseType=c.responseType),c.headers&&(this.headers=c.headers),c.context&&(this.context=c.context),c.params&&(this.params=c.params)),this.headers||(this.headers=new rr),this.context||(this.context=new d6),this.params){const f=this.params.toString();if(0===f.length)this.urlWithParams=i;else{const y=i.indexOf("?");this.urlWithParams=i+(-1===y?"?":y<i.length-1?"&":"")+f}}else this.params=new uh,this.urlWithParams=i}serializeBody(){return null===this.body?null:TI(this.body)||DI(this.body)||SI(this.body)||function p6(e){return typeof URLSearchParams<"u"&&e instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof uh?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||SI(this.body)?null:DI(this.body)?this.body.type||null:TI(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof uh?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){const i=t.method||this.method,n=t.url||this.url,o=t.responseType||this.responseType,c=void 0!==t.body?t.body:this.body,f=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,y=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let E=t.headers||this.headers,A=t.params||this.params;const z=t.context??this.context;return void 0!==t.setHeaders&&(E=Object.keys(t.setHeaders).reduce((H,oe)=>H.set(oe,t.setHeaders[oe]),E)),t.setParams&&(A=Object.keys(t.setParams).reduce((H,oe)=>H.set(oe,t.setParams[oe]),A)),new Jv(i,n,c,{params:A,headers:E,context:z,reportProgress:y,responseType:o,withCredentials:f})}}var xm=function(e){return e[e.Sent=0]="Sent",e[e.UploadProgress=1]="UploadProgress",e[e.ResponseHeader=2]="ResponseHeader",e[e.DownloadProgress=3]="DownloadProgress",e[e.Response=4]="Response",e[e.User=5]="User",e}(xm||{});class OC{constructor(t,i=200,n="OK"){this.headers=t.headers||new rr,this.status=void 0!==t.status?t.status:i,this.statusText=t.statusText||n,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class LC extends OC{constructor(t={}){super(t),this.type=xm.ResponseHeader}clone(t={}){return new LC({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class bm extends OC{constructor(t={}){super(t),this.type=xm.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new bm({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class II extends OC{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function RC(e,t){return{body:t,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}let dh=(()=>{var e;class t{constructor(n){this.handler=n}request(n,o,c={}){let f;if(n instanceof Jv)f=n;else{let A,z;A=c.headers instanceof rr?c.headers:new rr(c.headers),c.params&&(z=c.params instanceof uh?c.params:new uh({fromObject:c.params})),f=new Jv(n,o,void 0!==c.body?c.body:null,{headers:A,context:c.context,params:z,reportProgress:c.reportProgress,responseType:c.responseType||"json",withCredentials:c.withCredentials})}const y=pt(f).pipe(Up(A=>this.handler.handle(A)));if(n instanceof Jv||"events"===c.observe)return y;const E=y.pipe(Tc(A=>A instanceof bm));switch(c.observe||"body"){case"body":switch(f.responseType){case"arraybuffer":return E.pipe(En(A=>{if(null!==A.body&&!(A.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return A.body}));case"blob":return E.pipe(En(A=>{if(null!==A.body&&!(A.body instanceof Blob))throw new Error("Response is not a Blob.");return A.body}));case"text":return E.pipe(En(A=>{if(null!==A.body&&"string"!=typeof A.body)throw new Error("Response is not a string.");return A.body}));default:return E.pipe(En(A=>A.body))}case"response":return E;default:throw new Error(`Unreachable: unhandled observe type ${c.observe}}`)}}delete(n,o={}){return this.request("DELETE",n,o)}get(n,o={}){return this.request("GET",n,o)}head(n,o={}){return this.request("HEAD",n,o)}jsonp(n,o){return this.request("JSONP",n,{params:(new uh).append(o,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(n,o={}){return this.request("OPTIONS",n,o)}patch(n,o,c={}){return this.request("PATCH",n,RC(c,o))}post(n,o,c={}){return this.request("POST",n,RC(c,o))}put(n,o,c={}){return this.request("PUT",n,RC(c,o))}}return(e=t).\u0275fac=function(n){return new(n||e)(Ft(Yy))},e.\u0275prov=Lt({token:e,factory:e.\u0275fac}),t})();function kI(e,t){return t(e)}function g6(e,t){return(i,n)=>t.intercept(i,{handle:o=>e(o,n)})}const _6=new Ot(""),Qv=new Ot(""),OI=new Ot("");function v6(){let e=null;return(t,i)=>{null===e&&(e=(It(_6,{optional:!0})??[]).reduceRight(g6,kI));const n=It(ty),o=n.add();return e(t,i).pipe(Fv(()=>n.remove(o)))}}let LI=(()=>{var e;class t extends Yy{constructor(n,o){super(),this.backend=n,this.injector=o,this.chain=null,this.pendingTasks=It(ty)}handle(n){if(null===this.chain){const c=Array.from(new Set([...this.injector.get(Qv),...this.injector.get(OI,[])]));this.chain=c.reduceRight((f,y)=>function m6(e,t,i){return(n,o)=>i.runInContext(()=>t(n,c=>e(c,o)))}(f,y,this.injector),kI)}const o=this.pendingTasks.add();return this.chain(n,c=>this.backend.handle(c)).pipe(Fv(()=>this.pendingTasks.remove(o)))}}return(e=t).\u0275fac=function(n){return new(n||e)(Ft(Ky),Ft(ns))},e.\u0275prov=Lt({token:e,factory:e.\u0275fac}),t})();const w6=/^\)\]\}',?\n/;let FI=(()=>{var e;class t{constructor(n){this.xhrFactory=n}handle(n){if("JSONP"===n.method)throw new ut(-2800,!1);const o=this.xhrFactory;return(o.\u0275loadImpl?bi(o.\u0275loadImpl()):pt(null)).pipe(Ti(()=>new xn(f=>{const y=o.build();if(y.open(n.method,n.urlWithParams),n.withCredentials&&(y.withCredentials=!0),n.headers.forEach((We,et)=>y.setRequestHeader(We,et.join(","))),n.headers.has("Accept")||y.setRequestHeader("Accept","application/json, text/plain, */*"),!n.headers.has("Content-Type")){const We=n.detectContentTypeHeader();null!==We&&y.setRequestHeader("Content-Type",We)}if(n.responseType){const We=n.responseType.toLowerCase();y.responseType="json"!==We?We:"text"}const E=n.serializeBody();let A=null;const z=()=>{if(null!==A)return A;const We=y.statusText||"OK",et=new rr(y.getAllResponseHeaders()),qe=function C6(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(y)||n.url;return A=new LC({headers:et,status:y.status,statusText:We,url:qe}),A},H=()=>{let{headers:We,status:et,statusText:qe,url:$t}=z(),Ut=null;204!==et&&(Ut=typeof y.response>"u"?y.responseText:y.response),0===et&&(et=Ut?200:0);let Sn=et>=200&&et<300;if("json"===n.responseType&&"string"==typeof Ut){const go=Ut;Ut=Ut.replace(w6,"");try{Ut=""!==Ut?JSON.parse(Ut):null}catch(oa){Ut=go,Sn&&(Sn=!1,Ut={error:oa,text:Ut})}}Sn?(f.next(new bm({body:Ut,headers:We,status:et,statusText:qe,url:$t||void 0})),f.complete()):f.error(new II({error:Ut,headers:We,status:et,statusText:qe,url:$t||void 0}))},oe=We=>{const{url:et}=z(),qe=new II({error:We,status:y.status||0,statusText:y.statusText||"Unknown Error",url:et||void 0});f.error(qe)};let pe=!1;const Ie=We=>{pe||(f.next(z()),pe=!0);let et={type:xm.DownloadProgress,loaded:We.loaded};We.lengthComputable&&(et.total=We.total),"text"===n.responseType&&y.responseText&&(et.partialText=y.responseText),f.next(et)},Ve=We=>{let et={type:xm.UploadProgress,loaded:We.loaded};We.lengthComputable&&(et.total=We.total),f.next(et)};return y.addEventListener("load",H),y.addEventListener("error",oe),y.addEventListener("timeout",oe),y.addEventListener("abort",oe),n.reportProgress&&(y.addEventListener("progress",Ie),null!==E&&y.upload&&y.upload.addEventListener("progress",Ve)),y.send(E),f.next({type:xm.Sent}),()=>{y.removeEventListener("error",oe),y.removeEventListener("abort",oe),y.removeEventListener("load",H),y.removeEventListener("timeout",oe),n.reportProgress&&(y.removeEventListener("progress",Ie),null!==E&&y.upload&&y.upload.removeEventListener("progress",Ve)),y.readyState!==y.DONE&&y.abort()}})))}}return(e=t).\u0275fac=function(n){return new(n||e)(Ft(YT))},e.\u0275prov=Lt({token:e,factory:e.\u0275fac}),t})();const FC=new Ot("XSRF_ENABLED"),NI=new Ot("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),zI=new Ot("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class BI{}let T6=(()=>{var e;class t{constructor(n,o,c){this.doc=n,this.platform=o,this.cookieName=c,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const n=this.doc.cookie||"";return n!==this.lastCookieString&&(this.parseCount++,this.lastToken=BT(n,this.cookieName),this.lastCookieString=n),this.lastToken}}return(e=t).\u0275fac=function(n){return new(n||e)(Ft(Os),Ft(Js),Ft(NI))},e.\u0275prov=Lt({token:e,factory:e.\u0275fac}),t})();function D6(e,t){const i=e.url.toLowerCase();if(!It(FC)||"GET"===e.method||"HEAD"===e.method||i.startsWith("http://")||i.startsWith("https://"))return t(e);const n=It(BI).getToken(),o=It(zI);return null!=n&&!e.headers.has(o)&&(e=e.clone({headers:e.headers.set(o,n)})),t(e)}var hh=function(e){return e[e.Interceptors=0]="Interceptors",e[e.LegacyInterceptors=1]="LegacyInterceptors",e[e.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",e[e.NoXsrfProtection=3]="NoXsrfProtection",e[e.JsonpSupport=4]="JsonpSupport",e[e.RequestsMadeViaParent=5]="RequestsMadeViaParent",e[e.Fetch=6]="Fetch",e}(hh||{});function qp(e,t){return{\u0275kind:e,\u0275providers:t}}function S6(...e){const t=[dh,FI,LI,{provide:Yy,useExisting:LI},{provide:Ky,useExisting:FI},{provide:Qv,useValue:D6,multi:!0},{provide:FC,useValue:!0},{provide:BI,useClass:T6}];for(const i of e)t.push(...i.\u0275providers);return function hc(e){return{\u0275providers:e}}(t)}const VI=new Ot("LEGACY_INTERCEPTOR_FN");let A6=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=cr({type:e}),e.\u0275inj=lr({providers:[S6(qp(hh.LegacyInterceptors,[{provide:VI,useFactory:v6},{provide:Qv,useExisting:VI,multi:!0}]))]}),t})(),NC=(()=>{var e;class t{constructor(){this.sharedLat=new Ei(""),this.sharedLat$=this.sharedLat.asObservable(),this.sharedLon=new Ei(""),this.sharedLon$=this.sharedLon.asObservable(),this.sharedAct=new Ei(!1),this.sharedAct$=this.sharedAct.asObservable()}updateSharedLat(n){this.sharedLat.next(n)}updateSharedLon(n){this.sharedLon.next(n)}updateSharedAct(n){this.sharedAct.next(n)}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Lt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();var Tr=Uu(574);function e1(e){return(e1="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function tn(e,t,i){return(t=function N6(e){var t=function F6(e,t){if("object"!==e1(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!==e1(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===e1(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const zC={now:()=>(zC.delegate||Date).now(),delegate:void 0};class z6 extends ar{constructor(t=1/0,i=1/0,n=zC){super(),this._bufferSize=t,this._windowTime=i,this._timestampProvider=n,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=i===1/0,this._bufferSize=Math.max(1,t),this._windowTime=Math.max(1,i)}next(t){const{isStopped:i,_buffer:n,_infiniteTimeWindow:o,_timestampProvider:c,_windowTime:f}=this;i||(n.push(t),!o&&n.push(c.now()+f)),this._trimBuffer(),super.next(t)}_subscribe(t){this._throwIfClosed(),this._trimBuffer();const i=this._innerSubscribe(t),{_infiniteTimeWindow:n,_buffer:o}=this,c=o.slice();for(let f=0;f<c.length&&!t.closed;f+=n?1:2)t.next(c[f]);return this._checkFinalizedStatuses(t),i}_trimBuffer(){const{_bufferSize:t,_timestampProvider:i,_buffer:n,_infiniteTimeWindow:o}=this,c=(o?1:2)*t;if(t<1/0&&c<n.length&&n.splice(0,n.length-c),!o){const f=i.now();let y=0;for(let E=1;E<n.length&&n[E]<=f;E+=2)y=E;y&&n.splice(0,y+1)}}}function UI(e,t,i){let n,o=!1;return e&&"object"==typeof e?({bufferSize:n=1/0,windowTime:t=1/0,refCount:o=!1,scheduler:i}=e):n=e??1/0,cn({connector:()=>new z6(n,t,i),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:o})}class t1{}let jI=(()=>{var e;class t extends t1{getTranslation(n){return pt({})}}return e=t,tn(t,"\u0275fac",function(){let i;return function(o){return(i||(i=nr(e)))(o||e)}}()),tn(t,"\u0275prov",Lt({token:e,factory:e.\u0275fac})),t})();class BC{}let $I=(()=>{var e;class t{handle(n){return n.key}}return e=t,tn(t,"\u0275fac",function(n){return new(n||e)}),tn(t,"\u0275prov",Lt({token:e,factory:e.\u0275fac})),t})();function ex(e,t){if(e===t)return!0;if(null===e||null===t)return!1;if(e!=e&&t!=t)return!0;let o,c,f,i=typeof e;if(i==typeof t&&"object"==i){if(!Array.isArray(e)){if(Array.isArray(t))return!1;for(c in f=Object.create(null),e){if(!ex(e[c],t[c]))return!1;f[c]=!0}for(c in t)if(!(c in f)&&typeof t[c]<"u")return!1;return!0}if(!Array.isArray(t))return!1;if((o=e.length)==t.length){for(c=0;c<o;c++)if(!ex(e[c],t[c]))return!1;return!0}}return!1}function ph(e){return typeof e<"u"&&null!==e}function VC(e){return e&&"object"==typeof e&&!Array.isArray(e)}function HI(e,t){let i=Object.assign({},e);return VC(e)&&VC(t)&&Object.keys(t).forEach(n=>{VC(t[n])?n in e?i[n]=HI(e[n],t[n]):Object.assign(i,{[n]:t[n]}):Object.assign(i,{[n]:t[n]})}),i}class tx{}let GI=(()=>{var e;class t extends tx{constructor(...n){super(...n),tn(this,"templateMatcher",/{{\s?([^{}\s]*)\s?}}/g)}interpolate(n,o){let c;return c="string"==typeof n?this.interpolateString(n,o):"function"==typeof n?this.interpolateFunction(n,o):n,c}getValue(n,o){let c="string"==typeof o?o.split("."):[o];o="";do{o+=c.shift(),!ph(n)||!ph(n[o])||"object"!=typeof n[o]&&c.length?c.length?o+=".":n=void 0:(n=n[o],o="")}while(c.length);return n}interpolateFunction(n,o){return n(o)}interpolateString(n,o){return o?n.replace(this.templateMatcher,(c,f)=>{let y=this.getValue(o,f);return ph(y)?y:c}):n}}return e=t,tn(t,"\u0275fac",function(){let i;return function(o){return(i||(i=nr(e)))(o||e)}}()),tn(t,"\u0275prov",Lt({token:e,factory:e.\u0275fac})),t})();class nx{}let qI=(()=>{var e;class t extends nx{compile(n,o){return n}compileTranslations(n,o){return n}}return e=t,tn(t,"\u0275fac",function(){let i;return function(o){return(i||(i=nr(e)))(o||e)}}()),tn(t,"\u0275prov",Lt({token:e,factory:e.\u0275fac})),t})();class ZI{constructor(){tn(this,"defaultLang",void 0),tn(this,"currentLang",this.defaultLang),tn(this,"translations",{}),tn(this,"langs",[]),tn(this,"onTranslationChange",new Tn),tn(this,"onLangChange",new Tn),tn(this,"onDefaultLangChange",new Tn)}}const UC=new Ot("USE_STORE"),jC=new Ot("USE_DEFAULT_LANG"),$C=new Ot("DEFAULT_LANGUAGE"),HC=new Ot("USE_EXTEND");let wm=(()=>{var e;class t{get onTranslationChange(){return this.isolate?this._onTranslationChange:this.store.onTranslationChange}get onLangChange(){return this.isolate?this._onLangChange:this.store.onLangChange}get onDefaultLangChange(){return this.isolate?this._onDefaultLangChange:this.store.onDefaultLangChange}get defaultLang(){return this.isolate?this._defaultLang:this.store.defaultLang}set defaultLang(n){this.isolate?this._defaultLang=n:this.store.defaultLang=n}get currentLang(){return this.isolate?this._currentLang:this.store.currentLang}set currentLang(n){this.isolate?this._currentLang=n:this.store.currentLang=n}get langs(){return this.isolate?this._langs:this.store.langs}set langs(n){this.isolate?this._langs=n:this.store.langs=n}get translations(){return this.isolate?this._translations:this.store.translations}set translations(n){this.isolate?this._translations=n:this.store.translations=n}constructor(n,o,c,f,y,E=!0,A=!1,z=!1,H){tn(this,"store",void 0),tn(this,"currentLoader",void 0),tn(this,"compiler",void 0),tn(this,"parser",void 0),tn(this,"missingTranslationHandler",void 0),tn(this,"useDefaultLang",void 0),tn(this,"isolate",void 0),tn(this,"extend",void 0),tn(this,"loadingTranslations",void 0),tn(this,"pending",!1),tn(this,"_onTranslationChange",new Tn),tn(this,"_onLangChange",new Tn),tn(this,"_onDefaultLangChange",new Tn),tn(this,"_defaultLang",void 0),tn(this,"_currentLang",void 0),tn(this,"_langs",[]),tn(this,"_translations",{}),tn(this,"_translationRequests",{}),this.store=n,this.currentLoader=o,this.compiler=c,this.parser=f,this.missingTranslationHandler=y,this.useDefaultLang=E,this.isolate=A,this.extend=z,H&&this.setDefaultLang(H)}setDefaultLang(n){if(n===this.defaultLang)return;let o=this.retrieveTranslations(n);typeof o<"u"?(null==this.defaultLang&&(this.defaultLang=n),o.pipe(Ec(1)).subscribe(c=>{this.changeDefaultLang(n)})):this.changeDefaultLang(n)}getDefaultLang(){return this.defaultLang}use(n){if(n===this.currentLang)return pt(this.translations[n]);let o=this.retrieveTranslations(n);return typeof o<"u"?(this.currentLang||(this.currentLang=n),o.pipe(Ec(1)).subscribe(c=>{this.changeLang(n)}),o):(this.changeLang(n),pt(this.translations[n]))}retrieveTranslations(n){let o;return(typeof this.translations[n]>"u"||this.extend)&&(this._translationRequests[n]=this._translationRequests[n]||this.getTranslation(n),o=this._translationRequests[n]),o}getTranslation(n){this.pending=!0;const o=this.currentLoader.getTranslation(n).pipe(UI(1),Ec(1));return this.loadingTranslations=o.pipe(En(c=>this.compiler.compileTranslations(c,n)),UI(1),Ec(1)),this.loadingTranslations.subscribe({next:c=>{this.translations[n]=this.extend&&this.translations[n]?{...c,...this.translations[n]}:c,this.updateLangs(),this.pending=!1},error:c=>{this.pending=!1}}),o}setTranslation(n,o,c=!1){o=this.compiler.compileTranslations(o,n),this.translations[n]=(c||this.extend)&&this.translations[n]?HI(this.translations[n],o):o,this.updateLangs(),this.onTranslationChange.emit({lang:n,translations:this.translations[n]})}getLangs(){return this.langs}addLangs(n){n.forEach(o=>{-1===this.langs.indexOf(o)&&this.langs.push(o)})}updateLangs(){this.addLangs(Object.keys(this.translations))}getParsedResult(n,o,c){let f;if(o instanceof Array){let y={},E=!1;for(let A of o)y[A]=this.getParsedResult(n,A,c),ah(y[A])&&(E=!0);return E?xD(o.map(z=>ah(y[z])?y[z]:pt(y[z]))).pipe(En(z=>{let H={};return z.forEach((oe,pe)=>{H[o[pe]]=oe}),H})):y}if(n&&(f=this.parser.interpolate(this.parser.getValue(n,o),c)),typeof f>"u"&&null!=this.defaultLang&&this.defaultLang!==this.currentLang&&this.useDefaultLang&&(f=this.parser.interpolate(this.parser.getValue(this.translations[this.defaultLang],o),c)),typeof f>"u"){let y={key:o,translateService:this};typeof c<"u"&&(y.interpolateParams=c),f=this.missingTranslationHandler.handle(y)}return typeof f<"u"?f:o}get(n,o){if(!ph(n)||!n.length)throw new Error('Parameter "key" required');if(this.pending)return this.loadingTranslations.pipe(Up(c=>ah(c=this.getParsedResult(c,n,o))?c:pt(c)));{let c=this.getParsedResult(this.translations[this.currentLang],n,o);return ah(c)?c:pt(c)}}getStreamOnTranslationChange(n,o){if(!ph(n)||!n.length)throw new Error('Parameter "key" required');return Lv(ky(()=>this.get(n,o)),this.onTranslationChange.pipe(Ti(c=>{const f=this.getParsedResult(c.translations,n,o);return"function"==typeof f.subscribe?f:pt(f)})))}stream(n,o){if(!ph(n)||!n.length)throw new Error('Parameter "key" required');return Lv(ky(()=>this.get(n,o)),this.onLangChange.pipe(Ti(c=>{const f=this.getParsedResult(c.translations,n,o);return ah(f)?f:pt(f)})))}instant(n,o){if(!ph(n)||!n.length)throw new Error('Parameter "key" required');let c=this.getParsedResult(this.translations[this.currentLang],n,o);if(ah(c)){if(n instanceof Array){let f={};return n.forEach((y,E)=>{f[n[E]]=n[E]}),f}return n}return c}set(n,o,c=this.currentLang){this.translations[c][n]=this.compiler.compile(o,c),this.updateLangs(),this.onTranslationChange.emit({lang:c,translations:this.translations[c]})}changeLang(n){this.currentLang=n,this.onLangChange.emit({lang:n,translations:this.translations[n]}),null==this.defaultLang&&this.changeDefaultLang(n)}changeDefaultLang(n){this.defaultLang=n,this.onDefaultLangChange.emit({lang:n,translations:this.translations[n]})}reloadLang(n){return this.resetLang(n),this.getTranslation(n)}resetLang(n){this._translationRequests[n]=void 0,this.translations[n]=void 0}getBrowserLang(){if(typeof window>"u"||typeof window.navigator>"u")return;let n=window.navigator.languages?window.navigator.languages[0]:null;return n=n||window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage,typeof n>"u"?void 0:(-1!==n.indexOf("-")&&(n=n.split("-")[0]),-1!==n.indexOf("_")&&(n=n.split("_")[0]),n)}getBrowserCultureLang(){if(typeof window>"u"||typeof window.navigator>"u")return;let n=window.navigator.languages?window.navigator.languages[0]:null;return n=n||window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage,n}}return e=t,tn(t,"\u0275fac",function(n){return new(n||e)(Ft(ZI),Ft(t1),Ft(nx),Ft(tx),Ft(BC),Ft(jC),Ft(UC),Ft(HC),Ft($C))}),tn(t,"\u0275prov",Lt({token:e,factory:e.\u0275fac})),t})(),Zp=(()=>{var e;class t{constructor(n,o){tn(this,"translate",void 0),tn(this,"_ref",void 0),tn(this,"value",""),tn(this,"lastKey",null),tn(this,"lastParams",[]),tn(this,"onTranslationChange",void 0),tn(this,"onLangChange",void 0),tn(this,"onDefaultLangChange",void 0),this.translate=n,this._ref=o}updateValue(n,o,c){let f=y=>{this.value=void 0!==y?y:n,this.lastKey=n,this._ref.markForCheck()};if(c){let y=this.translate.getParsedResult(c,n,o);ah(y.subscribe)?y.subscribe(f):f(y)}this.translate.get(n,o).subscribe(f)}transform(n,...o){if(!n||!n.length)return n;if(ex(n,this.lastKey)&&ex(o,this.lastParams))return this.value;let c;if(ph(o[0])&&o.length)if("string"==typeof o[0]&&o[0].length){let f=o[0].replace(/(\')?([a-zA-Z0-9_]+)(\')?(\s)?:/g,'"$2":').replace(/:(\s)?(\')(.*?)(\')/g,':"$3"');try{c=JSON.parse(f)}catch{throw new SyntaxError(`Wrong parameter in TranslatePipe. Expected a valid Object, received: ${o[0]}`)}}else"object"==typeof o[0]&&!Array.isArray(o[0])&&(c=o[0]);return this.lastKey=n,this.lastParams=o,this.updateValue(n,c),this._dispose(),this.onTranslationChange||(this.onTranslationChange=this.translate.onTranslationChange.subscribe(f=>{this.lastKey&&f.lang===this.translate.currentLang&&(this.lastKey=null,this.updateValue(n,c,f.translations))})),this.onLangChange||(this.onLangChange=this.translate.onLangChange.subscribe(f=>{this.lastKey&&(this.lastKey=null,this.updateValue(n,c,f.translations))})),this.onDefaultLangChange||(this.onDefaultLangChange=this.translate.onDefaultLangChange.subscribe(()=>{this.lastKey&&(this.lastKey=null,this.updateValue(n,c))})),this.value}_dispose(){typeof this.onTranslationChange<"u"&&(this.onTranslationChange.unsubscribe(),this.onTranslationChange=void 0),typeof this.onLangChange<"u"&&(this.onLangChange.unsubscribe(),this.onLangChange=void 0),typeof this.onDefaultLangChange<"u"&&(this.onDefaultLangChange.unsubscribe(),this.onDefaultLangChange=void 0)}ngOnDestroy(){this._dispose()}}return e=t,tn(t,"\u0275fac",function(n){return new(n||e)(G(wm,16),G(om,16))}),tn(t,"\u0275pipe",ur({name:"translate",type:e,pure:!1})),tn(t,"\u0275prov",Lt({token:e,factory:e.\u0275fac})),t})(),B6=(()=>{var e;class t{static forRoot(n={}){return{ngModule:t,providers:[n.loader||{provide:t1,useClass:jI},n.compiler||{provide:nx,useClass:qI},n.parser||{provide:tx,useClass:GI},n.missingTranslationHandler||{provide:BC,useClass:$I},ZI,{provide:UC,useValue:n.isolate},{provide:jC,useValue:n.useDefaultLang},{provide:HC,useValue:n.extend},{provide:$C,useValue:n.defaultLanguage},wm]}}static forChild(n={}){return{ngModule:t,providers:[n.loader||{provide:t1,useClass:jI},n.compiler||{provide:nx,useClass:qI},n.parser||{provide:tx,useClass:GI},n.missingTranslationHandler||{provide:BC,useClass:$I},{provide:UC,useValue:n.isolate},{provide:jC,useValue:n.useDefaultLang},{provide:HC,useValue:n.extend},{provide:$C,useValue:n.defaultLanguage},wm]}}}return e=t,tn(t,"\u0275fac",function(n){return new(n||e)}),tn(t,"\u0275mod",cr({type:e})),tn(t,"\u0275inj",lr({})),t})();const V6=["map"];function U6(e,t){1&e&&He(0,"input",18)}function j6(e,t){if(1&e){const i=Ke();L(0,"input",19),ye("click",function(){ce(i);const o=q();return o.changeMapStyle("streets-v12"),le(o.saveStorage())}),P()}}function $6(e,t){1&e&&He(0,"input",20)}function H6(e,t){if(1&e){const i=Ke();L(0,"input",21),ye("click",function(){ce(i);const o=q();return o.changeMapStyle("satellite-streets-v12"),le(o.saveStorage())}),P()}}function G6(e,t){1&e&&He(0,"input",22)}function q6(e,t){if(1&e){const i=Ke();L(0,"input",23),ye("click",function(){ce(i);const o=q();return o.changeMapStyle("outdoors-v12"),le(o.saveStorage())}),P()}}function Z6(e,t){1&e&&He(0,"input",24)}function W6(e,t){if(1&e){const i=Ke();L(0,"input",25),ye("click",function(){ce(i);const o=q();return o.changeMapStyle("light-v11"),le(o.saveStorage())}),P()}}function X6(e,t){1&e&&He(0,"input",26)}function Y6(e,t){if(1&e){const i=Ke();L(0,"input",27),ye("click",function(){ce(i);const o=q();return o.changeMapStyle("dark-v11"),le(o.saveStorage())}),P()}}Tr.accessToken=qt_accessTokenMap;let K6=(()=>{var e;class t{constructor(n,o,c,f){this.http=n,this.rutaActiva=o,this.rute1=c,this.dataSharingService=f,this.rute="",this.sharedLat=38.3855908932305,this.sharedLon=-.5098796883778505,this.sharedCota=10,this.idDevice=qt_baseUrl+"/device_configurations/id",this.currentLngLat=new Tr.LngLat(this.sharedLon,this.sharedLat),this.maxDevice=qt_baseUrl+"/device_configurations/max",this.zoom=10,this.markers=[],this.colorMap="streets-v12",this.id=parseInt(this.rutaActiva.snapshot.params.id),this.idMax=1,this.state=-1,this.rute=this.rute1.routerState.snapshot.url,this.ruteAux=this.rute.split("/")}ngOnInit(){this.http.get(this.maxDevice).subscribe(n=>{this.idMax=parseInt(n.id)-1,this.state=this.id<=this.idMax?1:0},n=>{console.error(n)}),this.readStorage(),this.rute=this.rute1.routerState.snapshot.url,this.ruteAux=this.rute.split("/")}ngAfterViewInit(){if("new"==this.ruteAux[2]&&0==this.state){if(!this.divMap)throw"No hay mapa";navigator.geolocation?navigator.geolocation.getCurrentPosition(n=>{this.map=this.createMap([n.coords.longitude,n.coords.latitude]),this.auxInit()},n=>{this.map=this.createMap([-3.7036360462944913,40.41686882952129]),console.log("Error geo",n),this.auxInit()}):(this.map=this.createMap([-3.7036360462944913,40.41686882952129]),console.log("Geo no compatible"),this.auxInit())}("edit"==this.ruteAux[2]||"new"==this.ruteAux[2]&&1==this.state)&&this.http.get(`${this.idDevice}/${this.ruteAux[3]}`).subscribe(n=>{this.sharedLon=n[0].lon,this.sharedLat=n[0].lat,this.currentLngLat=new Tr.LngLat(this.sharedLon,this.sharedLat),this.map=this.createMap(this.currentLngLat),this.deleteMarker(),this.createMarker(this.currentLngLat),this.auxInit()},n=>{console.error(n)})}auxInit(){if(null!=this.map){this.map.addControl(new Tr.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0})),this.map.addControl(new Tr.NavigationControl),this.map.on("click",o=>{this.deleteMarker(),this.createMarker(o.lngLat.wrap()),this.updateSharedAct()});let n=document.getElementById("menu");if(null!=n){let o=n.getElementsByTagName("input");if(null!=o){const c=Array.from(o);for(const f of c)f.onclick=y=>{null!=this.map&&this.map.setStyle("mapbox://styles/mapbox/"+this.colorMap)}}}}null!=this.map&&this.map.on("style.load",()=>{if(null!=this.map){let n,o;if(null!=this.map&&(n=this.map.getStyle().layers),void 0!==n){const c=n.find(f=>"symbol"==f.type&&f.layout&&f.layout["text-field"]);c&&(o=c.id),null!=this.map&&this.map.addLayer({id:"add-3d-buildings",source:"composite","source-layer":"building",filter:["==","extrude","true"],type:"fill-extrusion",minzoom:15,paint:{"fill-extrusion-color":"#aaa","fill-extrusion-height":["interpolate",["linear"],["zoom"],15,0,15.05,["get","height"]],"fill-extrusion-base":["interpolate",["linear"],["zoom"],15,0,15.05,["get","min_height"]],"fill-extrusion-opacity":.6}},o)}}}),setInterval(()=>{try{this.dataSharingService.sharedLat$.subscribe(n=>{0!=n&&(this.sharedLat=n)}),this.dataSharingService.sharedLon$.subscribe(n=>{0!=n&&(this.sharedLon=n)}),(this.sharedLat!=this.currentLngLat.lat||this.sharedLon!=this.currentLngLat.lng)&&(this.deleteMarker(),this.currentLngLat=new Tr.LngLat(this.sharedLon,this.sharedLat),this.createMarker(this.currentLngLat))}catch{}},50),setInterval(()=>{try{this.map&&this.map.resize()}catch{}},10)}createMap(n){if(!this.divMap)throw"No hay mapa";return this.ngOnDestroy(),this.map=new Tr.Map({container:this.divMap.nativeElement,style:"mapbox://styles/mapbox/"+this.colorMap,center:n,zoom:this.zoom}),this.map}ngOnDestroy(){try{this.map&&this.map.remove()}catch(n){console.error("Error al eliminar el mapa:",n)}}changeMapStyle(n){this.map&&(this.colorMap=n,this.saveStorage(),this.map.setStyle("mapbox://styles/mapbox/"+n))}createMarker(n){this.map&&this.addMarker(n,"#0dcaf0")}addMarker(n,o){if(!this.map)return;this.markers=[],this.markers.splice(0,1);const c=new Tr.Marker({color:"#0dcaf0",draggable:!1}).setLngLat(n).addTo(this.map);this.markers.push({color:o,marker:c}),"new"==this.ruteAux[2]&&(this.saveStorage(),c.on("dragend",()=>this.saveStorage())),this.sharedLat=n.lat,this.sharedLon=n.lng,this.updateSharedLat(),this.updateSharedLon()}deleteMarker(){for(let o=0;o<this.markers.length;o++)this.markers[o].marker.remove();let n=document.getElementsByClassName("marker_text");for(let o=0;o<n.length;o++)n[o].remove()}saveStorage(){localStorage.setItem("colorMap",this.colorMap)}readStorage(){this.colorMap=localStorage.getItem("colorMap")??"0"}updateSharedAct(){this.dataSharingService.updateSharedAct(!0)}updateSharedLat(){this.dataSharingService.updateSharedLat(this.sharedLat)}updateSharedLon(){this.dataSharingService.updateSharedLon(this.sharedLon)}}return(e=t).\u0275fac=function(n){return new(n||e)(G(dh),G(ch),G(Zr),G(NC))},e.\u0275cmp=mi({type:e,selectors:[["app-devices-map"]],viewQuery:function(n,o){if(1&n&&Xd(V6,5),2&n){let c;Cr(c=Mr())&&(o.divMap=c.first)}},decls:28,vars:25,consts:[["id","map",2,"position","relative"],["map",""],["id","menu",2,"position","absolute"],["id","streets-v12","name","streets-v12","type","radio","name","rtoggle","value","streets","checked","checked",4,"ngIf"],["id","streets-v12","type","radio","name","rtoggle","value","streets",3,"click",4,"ngIf"],["for","streets-v12"],["id","satellite-streets-v12","name","satellite-streets-v12","type","radio","name","rtoggle","class","ms-3","value","satellite","checked","checked",4,"ngIf"],["id","satellite-streets-v12","type","radio","name","rtoggle","class","ms-3","value","satellite",3,"click",4,"ngIf"],["for","satellite-streets-v12"],["id","outdoors-v12","name","outdoors-v12","type","radio","name","rtoggle","value","outdoors","class","ms-3","checked","checked",4,"ngIf"],["id","outdoors-v12","type","radio","name","rtoggle","value","outdoors","class","ms-3",3,"click",4,"ngIf"],["for","outdoors-v12"],["id","light-v11","name","light-v11","type","radio","name","rtoggle","value","light","class","ms-3","checked","checked",4,"ngIf"],["id","light-v11","type","radio","name","rtoggle","value","light","class","ms-3",3,"click",4,"ngIf"],["for","light-v11"],["id","dark-v11","name","dark-v11","type","radio","name","rtoggle","value","dark","class","ms-3","checked","checked",4,"ngIf"],["id","dark-v11","type","radio","name","rtoggle","value","dark","class","ms-3",3,"click",4,"ngIf"],["for","dark-v11"],["id","streets-v12","name","streets-v12","type","radio","name","rtoggle","value","streets","checked","checked"],["id","streets-v12","type","radio","name","rtoggle","value","streets",3,"click"],["id","satellite-streets-v12","name","satellite-streets-v12","type","radio","name","rtoggle","value","satellite","checked","checked",1,"ms-3"],["id","satellite-streets-v12","type","radio","name","rtoggle","value","satellite",1,"ms-3",3,"click"],["id","outdoors-v12","name","outdoors-v12","type","radio","name","rtoggle","value","outdoors","checked","checked",1,"ms-3"],["id","outdoors-v12","type","radio","name","rtoggle","value","outdoors",1,"ms-3",3,"click"],["id","light-v11","name","light-v11","type","radio","name","rtoggle","value","light","checked","checked",1,"ms-3"],["id","light-v11","type","radio","name","rtoggle","value","light",1,"ms-3",3,"click"],["id","dark-v11","name","dark-v11","type","radio","name","rtoggle","value","dark","checked","checked",1,"ms-3"],["id","dark-v11","type","radio","name","rtoggle","value","dark",1,"ms-3",3,"click"]],template:function(n,o){1&n&&(L(0,"div",0,1)(2,"div",2),J(3,U6,1,0,"input",3),J(4,j6,1,0,"input",4),L(5,"label",5),W(6),te(7,"translate"),P(),J(8,$6,1,0,"input",6),J(9,H6,1,0,"input",7),L(10,"label",8),W(11),te(12,"translate"),P(),J(13,G6,1,0,"input",9),J(14,q6,1,0,"input",10),L(15,"label",11),W(16),te(17,"translate"),P(),J(18,Z6,1,0,"input",12),J(19,W6,1,0,"input",13),L(20,"label",14),W(21),te(22,"translate"),P(),J(23,X6,1,0,"input",15),J(24,Y6,1,0,"input",16),L(25,"label",17),W(26),te(27,"translate"),P()()()),2&n&&(w(3),U("ngIf","streets-v12"==o.colorMap),w(1),U("ngIf","streets-v12"!=o.colorMap),w(2),Ce(ne(7,15,"predeterminado")),w(2),U("ngIf","satellite-streets-v12"==o.colorMap),w(1),U("ngIf","satellite-streets-v12"!=o.colorMap),w(2),Ce(ne(12,17,"satelite")),w(2),U("ngIf","outdoors-v12"==o.colorMap),w(1),U("ngIf","outdoors-v12"!=o.colorMap),w(2),Ce(ne(17,19,"relieve")),w(2),U("ngIf","light-v11"==o.colorMap),w(1),U("ngIf","light-v11"!=o.colorMap),w(2),Ce(ne(22,21,"claro")),w(2),U("ngIf","dark-v11"==o.colorMap),w(1),U("ngIf","dark-v11"!=o.colorMap),w(2),Ce(ne(27,23,"oscuro")))},dependencies:[Mc,Zp],styles:['*[_ngcontent-%COMP%]{font-family:system-ui}.input-1[_ngcontent-%COMP%]{width:15%}.input-0[_ngcontent-%COMP%]{width:10%}.input-00[_ngcontent-%COMP%]{width:5em}.input-2[_ngcontent-%COMP%]{width:30%}#map[_ngcontent-%COMP%]{width:100%;height:100%;position:relative}.floating-range[_ngcontent-%COMP%]{position:relative;bottom:0;z-index:999;width:40%}.toast-cont[_ngcontent-%COMP%]{top:-10px;right:0;position:fixed}.btn[_ngcontent-%COMP%]:hover{border-color:#fff}.mapboxgl-canvas[_ngcontent-%COMP%]{width:100%}.form-range[_ngcontent-%COMP%]::-moz-range-thumb{background-color:#6c757d}.form-range[_ngcontent-%COMP%]::-webkit-slider-thumb{background-color:#6c757d}.mark[_ngcontent-%COMP%]{background-color:#e3e3e3}th[_ngcontent-%COMP%]{border-radius:7px}.floating-content[_ngcontent-%COMP%]{display:flex}#menu[_ngcontent-%COMP%]{margin:.5em;font-size:medium;background-color:#fff;position:relative;width:max-content;padding:5px;top:0;left:0;z-index:999;border-radius:5px;border:1px #afafaf solid}#menu[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin-right:.5em}.list-group[_ngcontent-%COMP%]{z-index:999;position:absolute;top:0;right:0;cursor:pointer;height:85%}.botoncito[_ngcontent-%COMP%]{z-index:1000;position:absolute;top:30px;left:20px}.nav[_ngcontent-%COMP%]{margin:1em}.cc2[_ngcontent-%COMP%]{margin:0 1em 1em}h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%], h4[_ngcontent-%COMP%], p[_ngcontent-%COMP%], a[_ngcontent-%COMP%], .btn[_ngcontent-%COMP%], span[_ngcontent-%COMP%], label[_ngcontent-%COMP%]{font-weight:500}.navb[_ngcontent-%COMP%]{width:49%}.cont[_ngcontent-%COMP%]{background-color:#fff;border-radius:10px;min-height:88vh}.cont_recto[_ngcontent-%COMP%]{border-top-left-radius:0}.cont0[_ngcontent-%COMP%]{margin:0 1em}.c10[_ngcontent-%COMP%]{width:68.5%}.c100[_ngcontent-%COMP%]{width:98%}.sensores_2_20[_ngcontent-%COMP%]{width:29%}.sensores_2_100[_ngcontent-%COMP%]{width:96%}.c20[_ngcontent-%COMP%]{width:50%}.c200[_ngcontent-%COMP%]{width:100%}.single-line[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.rev[_ngcontent-%COMP%]{flex-direction:column-reverse}.cont1[_ngcontent-%COMP%]{background-color:#fff;padding:1em;border-radius:10px;margin-bottom:1em}.cont2[_ngcontent-%COMP%]{background-color:#fff;border-radius:10px;height:max-content;margin-bottom:1em}.alt[_ngcontent-%COMP%]{height:82vh}.cont3[_ngcontent-%COMP%]{padding:0 1em 1em;background-color:#fff;border-radius:10px;height:min-content;margin-bottom:1em}.over[_ngcontent-%COMP%]{overflow-y:scroll}thead[_ngcontent-%COMP%]{background-color:#f2f2f2;border-radius:10px}.half[_ngcontent-%COMP%]{width:50%}app-devices-edit[_ngcontent-%COMP%]{display:flex}a[_ngcontent-%COMP%]{text-decoration:none;color:#000}.c1[_ngcontent-%COMP%]{height:min-content}.c2[_ngcontent-%COMP%]{padding-top:1em;height:max-content}.c3[_ngcontent-%COMP%]{height:-moz-fit-content;height:fit-content}.c4[_ngcontent-%COMP%]{padding:.8em 1em .5em;height:-moz-fit-content;height:fit-content}.c5[_ngcontent-%COMP%]{height:62vh}.c6[_ngcontent-%COMP%]{padding:1em 1em .5em}.nuevo[_ngcontent-%COMP%]{border-radius:10px;background-color:#f2f2f2;padding:1em;margin:.01em .01em 1em}.not[_ngcontent-%COMP%]{font-size:large}.tt1[_ngcontent-%COMP%]{--width: 130px;--height: calc(var(--width) / 3.5)}.tt2[_ngcontent-%COMP%]{--width: 100px;--height: calc(var(--width) / 3.3)}.toggle[_ngcontent-%COMP%]{position:relative;display:inline-block;width:var(--width);height:var(--height);box-shadow:0 1px 3px #0000004d;border-radius:var(--height);cursor:pointer}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.toggle[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;border-radius:var(--height);background-color:#dc3545;transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;width:calc(var(--height));height:calc(var(--height));border-radius:calc(var(--height) / 2);background-color:#fff;box-shadow:0 1px 3px #0000004d;transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]{background-color:#198754}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]:before{transform:translate(calc(var(--width) - var(--height)))}.toggle[_ngcontent-%COMP%]   .labels[_ngcontent-%COMP%]{position:absolute;top:8px;left:0;width:100%;height:100%;font-weight:600;transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   .labels[_ngcontent-%COMP%]:after{content:attr(data-off);position:absolute;right:25px;color:#fff;opacity:1;text-shadow:1px 1px 2px rgba(0,0,0,.4);transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   .labels[_ngcontent-%COMP%]:before{content:attr(data-on);position:absolute;left:25px;color:#fff;opacity:0;text-shadow:1px 1px 2px rgba(255,255,255,.4);transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked ~ .labels[_ngcontent-%COMP%]:after{opacity:0}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked ~ .labels[_ngcontent-%COMP%]:before{opacity:1}.mapboxgl-popup[_ngcontent-%COMP%]{max-width:400px;font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif}.t1[_ngcontent-%COMP%]{font-size:15px}.t2[_ngcontent-%COMP%]{font-size:11px}  .ng-select .ng-clear-wrapper .ng-clear{font-size:40px!important;color:#969696;right:7px;line-height:.7!important}  .ng-select .ng-clear-wrapper{height:34px;line-height:.5;width:30px!important}  .ng-value{background-color:#e3e3e3;border-radius:6px;margin-right:.5em;padding-bottom:.2em}  .ng-dropdown-panel{background-color:#f5f5f5}  .ng-option{padding:0 .7em .7em}  .ng-value-icon{font-size:22px;padding-left:.4em;padding-right:.4em}  .ng-value-label{padding-right:1em}.mapbox-popup-anchor-bottom[_ngcontent-%COMP%]{max-width:400px}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}tbody[_ngcontent-%COMP%]{max-height:600px;overflow-y:scroll}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:left;position:sticky;top:0;z-index:1}']}),e.\u0275prov=Lt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();const ix=function(e){return{active:e}};function J6(e,t){if(1&e&&(L(0,"div",11)(1,"li",12)(2,"a",13),W(3),te(4,"translate"),P()(),L(5,"li",12)(6,"a",14),W(7),te(8,"translate"),P()(),L(9,"li",12)(10,"a",15),W(11),te(12,"translate"),P()(),L(13,"li",12)(14,"a",16),W(15),te(16,"translate"),P()()()),2&e){const i=q();w(2),U("ngClass",ft(16,ix,"/devices"==i.rute)),w(1),Ce(ne(4,8,"sensors.t1")),w(3),U("ngClass",ft(18,ix,"/sensors"==i.rute)),w(1),Ce(ne(8,10,"sensors.t2")),w(3),U("ngClass",ft(20,ix,"/structure"==i.rute)),w(1),Ce(ne(12,12,"sensors.t3")),w(3),U("ngClass",ft(22,ix,"/variable-structure"==i.rute)),w(1),Ce(ne(16,14,"variable_data_structure"))}}function Q6(e,t){1&e&&(L(0,"div",11)(1,"li",12)(2,"a",17),W(3,"\xa0"),P()()())}const ez=function(e){return{selected:e}};function tz(e,t){if(1&e&&(na(0),L(1,"option",18),W(2),P(),ia()),2&e){const i=t.$implicit,n=t.index,o=q();w(1),vn("value",i),U("ngClass",ft(3,ez,o.activeLang==i)),w(1),Ce(o.lengName[n])}}let n1=(()=>{var e;class t{constructor(n,o){this.translate=n,this.rutaActiva=o,this.lengName=qt_languageName,this.lengLang=qt_languageLang,this.activeLang=qt_languageLang[0],this.rute="",this.rute=this.rutaActiva.routerState.snapshot.url,this.ruteAux=this.rute.split("/")}ngOnInit(){this.readStorage(),this.translate.use(this.activeLang)}changeLanguage(){this.saveStorage(),this.translate.use(this.activeLang)}saveStorage(){localStorage.setItem("activeLang",this.activeLang)}readStorage(){this.activeLang=localStorage.getItem("activeLang")??"es"}}return(e=t).\u0275fac=function(n){return new(n||e)(G(wm),G(Zr))},e.\u0275cmp=mi({type:e,selectors:[["app-navbar"]],decls:12,vars:4,consts:[[1,"mb-0","d-flex"],[1,"col-lg-8","col-10","p-0"],["class","nav nav-tabs mb-0 p-0",4,"ngIf"],[1,"col-lg-4","col-2","p-0","pt-2"],[1,"d-flex",2,"justify-content","flex-end"],[1,"pe-3"],["aria-label","Default select example","id","sel_type",1,"form-select",3,"ngModel","change","ngModelChange"],[4,"ngFor","ngForOf"],[1,"d-none","d-xxl-inline","pe-3"],[1,"d-flex","justify-content-end"],["src","../../assets/logo.png","width","350px"],[1,"nav","nav-tabs","mb-0","p-0"],[1,"nav-item"],["aria-current","page","routerLink","/devices",1,"nav-link",3,"ngClass"],["href","#","routerLink","/sensors",1,"nav-link",3,"ngClass"],["href","#","routerLink","/structure",1,"nav-link",3,"ngClass"],["href","#","routerLink","/variable-structure",1,"nav-link",3,"ngClass"],[1,"nav-link","me-3"],[3,"value","ngClass"]],template:function(n,o){1&n&&(L(0,"div",0)(1,"div",1),J(2,J6,17,24,"div",2),J(3,Q6,4,0,"div",2),P(),L(4,"div",3)(5,"div",4)(6,"div",5)(7,"select",6),ye("change",function(){return o.changeLanguage()})("ngModelChange",function(f){return o.activeLang=f}),J(8,tz,3,5,"ng-container",7),P()(),L(9,"div",8)(10,"div",9),He(11,"img",10),P()()()()()),2&n&&(w(2),U("ngIf","edit"!=o.ruteAux[2]&&"new"!=o.ruteAux[2]),w(1),U("ngIf","edit"==o.ruteAux[2]||"new"==o.ruteAux[2]),w(4),U("ngModel",o.activeLang),w(1),U("ngForOf",o.lengLang))},dependencies:[Qd,eh,Mc,Np,zp,Ru,Lp,sh,ym,Zp],styles:['*[_ngcontent-%COMP%]{font-family:system-ui}.input-1[_ngcontent-%COMP%]{width:15%}.input-0[_ngcontent-%COMP%]{width:10%}.input-00[_ngcontent-%COMP%]{width:5em}.input-2[_ngcontent-%COMP%]{width:30%}#map[_ngcontent-%COMP%]{width:100%;height:100%;position:relative}.floating-range[_ngcontent-%COMP%]{position:relative;bottom:0;z-index:999;width:40%}.toast-cont[_ngcontent-%COMP%]{top:-10px;right:0;position:fixed}.btn[_ngcontent-%COMP%]:hover{border-color:#fff}.mapboxgl-canvas[_ngcontent-%COMP%]{width:100%}.form-range[_ngcontent-%COMP%]::-moz-range-thumb{background-color:#6c757d}.form-range[_ngcontent-%COMP%]::-webkit-slider-thumb{background-color:#6c757d}.mark[_ngcontent-%COMP%]{background-color:#e3e3e3}th[_ngcontent-%COMP%]{border-radius:7px}.floating-content[_ngcontent-%COMP%]{display:flex}#menu[_ngcontent-%COMP%]{margin:.5em;font-size:medium;background-color:#fff;position:relative;width:max-content;padding:5px;top:0;left:0;z-index:999;border-radius:5px;border:1px #afafaf solid}#menu[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin-right:.5em}.list-group[_ngcontent-%COMP%]{z-index:999;position:absolute;top:0;right:0;cursor:pointer;height:85%}.botoncito[_ngcontent-%COMP%]{z-index:1000;position:absolute;top:30px;left:20px}.nav[_ngcontent-%COMP%]{margin:1em}.cc2[_ngcontent-%COMP%]{margin:0 1em 1em}h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%], h4[_ngcontent-%COMP%], p[_ngcontent-%COMP%], a[_ngcontent-%COMP%], .btn[_ngcontent-%COMP%], span[_ngcontent-%COMP%], label[_ngcontent-%COMP%]{font-weight:500}.navb[_ngcontent-%COMP%]{width:49%}.cont[_ngcontent-%COMP%]{background-color:#fff;border-radius:10px;min-height:88vh}.cont_recto[_ngcontent-%COMP%]{border-top-left-radius:0}.cont0[_ngcontent-%COMP%]{margin:0 1em}.c10[_ngcontent-%COMP%]{width:68.5%}.c100[_ngcontent-%COMP%]{width:98%}.sensores_2_20[_ngcontent-%COMP%]{width:29%}.sensores_2_100[_ngcontent-%COMP%]{width:96%}.c20[_ngcontent-%COMP%]{width:50%}.c200[_ngcontent-%COMP%]{width:100%}.single-line[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.rev[_ngcontent-%COMP%]{flex-direction:column-reverse}.cont1[_ngcontent-%COMP%]{background-color:#fff;padding:1em;border-radius:10px;margin-bottom:1em}.cont2[_ngcontent-%COMP%]{background-color:#fff;border-radius:10px;height:max-content;margin-bottom:1em}.alt[_ngcontent-%COMP%]{height:82vh}.cont3[_ngcontent-%COMP%]{padding:0 1em 1em;background-color:#fff;border-radius:10px;height:min-content;margin-bottom:1em}.over[_ngcontent-%COMP%]{overflow-y:scroll}thead[_ngcontent-%COMP%]{background-color:#f2f2f2;border-radius:10px}.half[_ngcontent-%COMP%]{width:50%}app-devices-edit[_ngcontent-%COMP%]{display:flex}a[_ngcontent-%COMP%]{text-decoration:none;color:#000}.c1[_ngcontent-%COMP%]{height:min-content}.c2[_ngcontent-%COMP%]{padding-top:1em;height:max-content}.c3[_ngcontent-%COMP%]{height:-moz-fit-content;height:fit-content}.c4[_ngcontent-%COMP%]{padding:.8em 1em .5em;height:-moz-fit-content;height:fit-content}.c5[_ngcontent-%COMP%]{height:62vh}.c6[_ngcontent-%COMP%]{padding:1em 1em .5em}.nuevo[_ngcontent-%COMP%]{border-radius:10px;background-color:#f2f2f2;padding:1em;margin:.01em .01em 1em}.not[_ngcontent-%COMP%]{font-size:large}.tt1[_ngcontent-%COMP%]{--width: 130px;--height: calc(var(--width) / 3.5)}.tt2[_ngcontent-%COMP%]{--width: 100px;--height: calc(var(--width) / 3.3)}.toggle[_ngcontent-%COMP%]{position:relative;display:inline-block;width:var(--width);height:var(--height);box-shadow:0 1px 3px #0000004d;border-radius:var(--height);cursor:pointer}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.toggle[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;border-radius:var(--height);background-color:#dc3545;transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;width:calc(var(--height));height:calc(var(--height));border-radius:calc(var(--height) / 2);background-color:#fff;box-shadow:0 1px 3px #0000004d;transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]{background-color:#198754}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]:before{transform:translate(calc(var(--width) - var(--height)))}.toggle[_ngcontent-%COMP%]   .labels[_ngcontent-%COMP%]{position:absolute;top:8px;left:0;width:100%;height:100%;font-weight:600;transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   .labels[_ngcontent-%COMP%]:after{content:attr(data-off);position:absolute;right:25px;color:#fff;opacity:1;text-shadow:1px 1px 2px rgba(0,0,0,.4);transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   .labels[_ngcontent-%COMP%]:before{content:attr(data-on);position:absolute;left:25px;color:#fff;opacity:0;text-shadow:1px 1px 2px rgba(255,255,255,.4);transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked ~ .labels[_ngcontent-%COMP%]:after{opacity:0}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked ~ .labels[_ngcontent-%COMP%]:before{opacity:1}.mapboxgl-popup[_ngcontent-%COMP%]{max-width:400px;font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif}.t1[_ngcontent-%COMP%]{font-size:15px}.t2[_ngcontent-%COMP%]{font-size:11px}  .ng-select .ng-clear-wrapper .ng-clear{font-size:40px!important;color:#969696;right:7px;line-height:.7!important}  .ng-select .ng-clear-wrapper{height:34px;line-height:.5;width:30px!important}  .ng-value{background-color:#e3e3e3;border-radius:6px;margin-right:.5em;padding-bottom:.2em}  .ng-dropdown-panel{background-color:#f5f5f5}  .ng-option{padding:0 .7em .7em}  .ng-value-icon{font-size:22px;padding-left:.4em;padding-right:.4em}  .ng-value-label{padding-right:1em}.mapbox-popup-anchor-bottom[_ngcontent-%COMP%]{max-width:400px}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}tbody[_ngcontent-%COMP%]{max-height:600px;overflow-y:scroll}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:left;position:sticky;top:0;z-index:1}']}),t})();function nz(e,t){1&e&&(L(0,"h2",59),W(1),te(2,"translate"),P()),2&e&&(w(1),Ce(ne(2,1,"devices.edit.new_device")))}function iz(e,t){if(1&e&&(L(0,"h2",59),W(1),te(2,"translate"),P()),2&e){const i=q(2);w(1),pn("",ne(2,2,"sensors.duplicate")," ",i.devices.uid,"")}}function rz(e,t){if(1&e&&(L(0,"h2",59),W(1),te(2,"translate"),P()),2&e){const i=q(2);w(1),pn("",ne(2,2,"device")," ",i.devices.uid,"")}}function oz(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",63),ye("click",function(){return ce(i),le(q(3).mapShow())}),He(1,"path",64),P()}}function sz(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",65),ye("click",function(){return ce(i),le(q(3).mapHide())}),He(1,"path",66),P()}}function az(e,t){if(1&e&&(L(0,"div",60),J(1,oz,2,0,"svg",61),J(2,sz,2,0,"svg",62),P()),2&e){const i=q(2);w(1),U("ngIf",i.showMap),w(1),U("ngIf",!i.showMap)}}function lz(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"devices.edit.uid")," ",ne(3,4,"required"),""))}function cz(e,t){if(1&e&&(L(0,"div",104),J(1,lz,4,6,"div",6),P()),2&e){q(3);const i=Vt(2);w(1),U("ngIf",i.controls.uid.errors.required)}}function uz(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"devices.edit.alias")," ",ne(3,4,"required"),""))}function dz(e,t){if(1&e&&(L(0,"div",104),J(1,uz,4,6,"div",6),P()),2&e){q(3);const i=Vt(2);w(1),U("ngIf",i.controls.alias.errors.required)}}function hz(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"devices.edit.organization")," ",ne(3,4,"required"),""))}function pz(e,t){if(1&e&&(L(0,"div",104),J(1,hz,4,6,"div",6),P()),2&e){q(3);const i=Vt(2);w(1),U("ngIf",i.controls.organizationid.errors.required)}}function fz(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"devices.edit.typemeter")," ",ne(3,4,"required"),""))}function gz(e,t){if(1&e&&(L(0,"div",104),J(1,fz,4,6,"div",6),P()),2&e){q(3);const i=Vt(2);w(1),U("ngIf",i.controls.typemeter.errors.required)}}function mz(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"devices.edit.aplication")," ",ne(3,4,"required"),""))}function _z(e,t){if(1&e&&(L(0,"div",104),J(1,mz,4,6,"div",6),P()),2&e){q(3);const i=Vt(2);w(1),U("ngIf",i.controls.application_id.errors.required)}}function vz(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"devices.edit.topic")," ",ne(3,4,"required"),""))}function yz(e,t){if(1&e&&(L(0,"div",104),J(1,vz,4,6,"div",6),P()),2&e){q(3);const i=Vt(2);w(1),U("ngIf",i.controls.topic_name.errors.required)}}function xz(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"devices.edit.origin")," ",ne(3,4,"required"),""))}function bz(e,t){if(1&e&&(L(0,"div",104),J(1,xz,4,6,"div",6),P()),2&e){q(3);const i=Vt(2);w(1),U("ngIf",i.controls.origin.errors.required)}}function wz(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"devices.edit.description")," ",ne(3,4,"required"),""))}function Cz(e,t){if(1&e&&(L(0,"div",104),J(1,wz,4,6,"div",6),P()),2&e){q(3);const i=Vt(2);w(1),U("ngIf",i.controls.description_origin.errors.required)}}function Mz(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"created")," ",ne(3,4,"required"),""))}function Ez(e,t){if(1&e&&(L(0,"div",104),J(1,Mz,4,6,"div",6),P()),2&e){q(3);const i=Vt(2);w(1),U("ngIf",i.controls.createdAt.errors.required)}}function Tz(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"mod")," ",ne(3,4,"required"),""))}function Dz(e,t){if(1&e&&(L(0,"div",104),J(1,Tz,4,6,"div",6),P()),2&e){q(3);const i=Vt(2);w(1),U("ngIf",i.controls.updatedAt.errors.required)}}function Sz(e,t){if(1&e&&(na(0),L(1,"option",105),W(2),P(),ia()),2&e){const i=t.$implicit,n=q(3);w(1),vn("value",i.id_estructure),U("selected",i.id_estructure==n.devices.id_data_estructure),w(1),Ce(i.description)}}function Iz(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"structure")," ",ne(3,4,"required"),""))}function Az(e,t){if(1&e&&(xt(),eo(),L(0,"div",104),J(1,Iz,4,6,"div",6),P()),2&e){q(3);const i=Vt(2);w(1),U("ngIf",i.controls.id_data_estructure.errors.required)}}const Pz=function(e){return{"background-color":e}};function kz(e,t){if(1&e){const i=Ke();L(0,"div")(1,"div",19)(2,"div",67)(3,"input",68),ye("ngModelChange",function(o){return ce(i),le(q(2).devices.createdAt=o)}),P(),L(4,"label",69),W(5),te(6,"translate"),P(),L(7,"input",70),ye("ngModelChange",function(){return ce(i),le(q(2).changed=!0)})("ngModelChange",function(o){return ce(i),le(q(2).devices.uid=o)}),P(),J(8,cz,2,1,"div",71),P(),L(9,"div",67)(10,"label",72),W(11),te(12,"translate"),P(),L(13,"input",73),ye("ngModelChange",function(){return ce(i),le(q(2).changed=!0)})("ngModelChange",function(o){return ce(i),le(q(2).devices.alias=o)}),P(),J(14,dz,2,1,"div",71),P(),L(15,"div",74)(16,"label",75),W(17),te(18,"translate"),P(),L(19,"input",76),ye("ngModelChange",function(){return ce(i),le(q(2).changed=!0)})("ngModelChange",function(o){return ce(i),le(q(2).devices.organizationid=o)}),P(),J(20,pz,2,1,"div",71),P()(),L(21,"div",19)(22,"div",74)(23,"label",77),W(24),te(25,"translate"),P(),L(26,"input",78),ye("ngModelChange",function(){return ce(i),le(q(2).changed=!0)})("ngModelChange",function(o){return ce(i),le(q(2).devices.typemeter=o)}),P(),J(27,gz,2,1,"div",71),P(),L(28,"div",67)(29,"label",79),W(30),te(31,"translate"),P(),L(32,"input",80),ye("ngModelChange",function(){return ce(i),le(q(2).changed=!0)})("ngModelChange",function(o){return ce(i),le(q(2).devices.application_id=o)}),P(),J(33,_z,2,1,"div",71),P(),L(34,"div",67)(35,"label",81),W(36),te(37,"translate"),P(),L(38,"input",82),ye("ngModelChange",function(){return ce(i),le(q(2).changed=!0)})("ngModelChange",function(o){return ce(i),le(q(2).devices.topic_name=o)}),P(),J(39,yz,2,1,"div",71),P()(),L(40,"div",19)(41,"div",74)(42,"label",83),W(43),te(44,"translate"),P(),L(45,"input",84),ye("ngModelChange",function(){return ce(i),le(q(2).changed=!0)})("ngModelChange",function(o){return ce(i),le(q(2).devices.origin=o)}),P(),J(46,bz,2,1,"div",71),P(),L(47,"div",74)(48,"label",85),W(49),te(50,"translate"),P(),L(51,"input",86),ye("ngModelChange",function(){return ce(i),le(q(2).changed=!0)})("ngModelChange",function(o){return ce(i),le(q(2).devices.description_origin=o)}),P(),J(52,Cz,2,1,"div",71),P(),L(53,"div",74)(54,"label",87),W(55),te(56,"translate"),P(),L(57,"input",88),ye("ngModelChange",function(){return ce(i),le(q(2).changed=!0)})("ngModelChange",function(o){return ce(i),le(q(2).devices.createdAt=o)}),P(),J(58,Ez,2,1,"div",71),P(),L(59,"div",74)(60,"label",89),W(61),te(62,"translate"),P(),L(63,"input",90),ye("ngModelChange",function(){return ce(i),le(q(2).changed=!0)})("ngModelChange",function(o){return ce(i),le(q(2).devices.updatedAt=o)}),P(),J(64,Dz,2,1,"div",71),P(),L(65,"div",91)(66,"div",92)(67,"div",93)(68,"label",94),W(69),te(70,"translate"),P(),L(71,"select",95),ye("ngModelChange",function(){return ce(i),le(q(2).changed=!0)})("ngModelChange",function(o){return ce(i),le(q(2).devices.id_data_estructure=o)}),J(72,Sz,3,3,"ng-container",96),P(),L(73,"div"),xt(),L(74,"svg",97),He(75,"path",98),P()(),J(76,Az,2,1,"div",71),P(),eo(),L(77,"div")(78,"div",99)(79,"label",100)(80,"input",101),ye("ngModelChange",function(){return ce(i),le(q(2).changed=!0)})("change",function(o){return ce(i),le(q(2).getStructuresList(o))})("ngModelChange",function(o){return ce(i),le(q(2).devices.variable_configuration=o)}),P(),He(81,"span",102)(82,"span",103),te(83,"translate"),te(84,"translate"),P()()()()()()()}if(2&e){const i=q(2),n=Vt(2);w(3),U("value",i.devices.createdAt)("ngModel",i.devices.createdAt),w(2),Ce(ne(6,51,"devices.edit.uid")),w(2),U("value",i.devices.uid)("ngModel",i.devices.uid),w(1),U("ngIf",n.submitted&&n.controls.uid.errors),w(3),Ce(ne(12,53,"devices.edit.alias")),w(2),U("value",i.devices.alias)("ngModel",i.devices.alias),w(1),U("ngIf",n.submitted&&n.controls.alias.errors),w(3),Ce(ne(18,55,"devices.edit.organization")),w(2),U("value",i.devices.organizationid)("ngModel",i.devices.organizationid),w(1),U("ngIf",n.submitted&&n.controls.organizationid.errors),w(4),Ce(ne(25,57,"devices.edit.typemeter")),w(2),U("value",i.devices.typemeter)("ngModel",i.devices.typemeter),w(1),U("ngIf",n.submitted&&n.controls.typemeter.errors),w(3),Ce(ne(31,59,"devices.edit.aplication")),w(2),U("value",i.devices.application_id)("ngModel",i.devices.application_id),w(1),U("ngIf",n.submitted&&n.controls.application_id.errors),w(3),Ce(ne(37,61,"devices.edit.topic")),w(2),U("value",i.devices.topic_name)("ngModel",i.devices.topic_name),w(1),U("ngIf",n.submitted&&n.controls.topic_name.errors),w(4),Ce(ne(44,63,"devices.edit.origin")),w(2),U("value",i.devices.origin)("ngModel",i.devices.origin),w(1),U("ngIf",n.submitted&&n.controls.origin.errors),w(3),Ce(ne(50,65,"devices.edit.description")),w(2),U("value",i.devices.description_origin)("ngModel",i.devices.description_origin),w(1),U("ngIf",n.submitted&&n.controls.description_origin.errors),w(3),Ce(ne(56,67,"created")),w(2),U("value",i.devices.createdAt)("ngModel",i.devices.createdAt),w(1),U("ngIf",n.submitted&&n.controls.createdAt.errors),w(3),Ce(ne(62,69,"mod")),w(2),U("value",i.devices.updatedAt)("ngModel",i.devices.updatedAt),w(1),U("ngIf",n.submitted&&n.controls.updatedAt.errors),w(5),Ce(ne(70,71,"structure")),w(2),U("value",i.devices.id_data_estructure)("ngModel",i.devices.id_data_estructure),w(1),U("ngForOf",i.structures.structure),w(4),U("ngIf",n.submitted&&n.controls.id_data_estructure.errors),w(4),U("ngModel",i.devices.variable_configuration),w(1),U("ngStyle",ft(77,Pz,i.devices.variable_configuration?"rgb(127, 67, 219)":"rgb(108, 117, 125)")),w(1),Fo("data-on",ne(83,73,"variable"))("data-off",ne(84,75,"fixed"))}}function Oz(e,t){1&e&&(xt(),L(0,"svg",106),He(1,"path",98),P())}function Lz(e,t){1&e&&(L(0,"p",107),W(1),te(2,"translate"),P()),2&e&&(w(1),Ce(ne(2,1,"show")))}function Rz(e,t){1&e&&(xt(),L(0,"svg",108),He(1,"path",109),P())}function Fz(e,t){1&e&&(L(0,"p",107),W(1),te(2,"translate"),P()),2&e&&(w(1),Ce(ne(2,1,"hide")))}const i1=function(e){return{mark:e}};function Nz(e,t){if(1&e&&(L(0,"th",117),W(1),te(2,"translate"),P()),2&e){const i=q(3);U("ngClass",ft(4,i1,"datafield"==i.mark)),w(1),jt("",ne(2,2,"devices.sensors.datafield")," ")}}function zz(e,t){1&e&&(L(0,"th",114),W(1),te(2,"translate"),P()),2&e&&(w(1),jt("",ne(2,1,"devices.sensors.nodate")," "))}function Bz(e,t){if(1&e&&(L(0,"th",117),W(1),te(2,"translate"),P()),2&e){const i=q(3);U("ngClass",ft(4,i1,"topic_specific"==i.mark)),w(1),jt("",ne(2,2,"devices.sensors.topic_specific")," ")}}function Vz(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"devices.sensors.order")," ",ne(3,4,"required"),""))}function Uz(e,t){if(1&e&&(L(0,"div",104),J(1,Vz,4,6,"div",6),P()),2&e){q(2);const i=Vt(1);w(1),U("ngIf",i.controls.orden.errors.required)}}function jz(e,t){if(1&e&&(L(0,"option",140),W(1),P()),2&e){const i=t.$implicit,n=q().$implicit;U("value",i.id)("selected",i.id==n.id_type_sensor),w(1),Ce(i.type)}}function $z(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"devices.sensors.datafield")," ",ne(3,4,"required"),""))}function Hz(e,t){if(1&e&&(L(0,"div",104),J(1,$z,4,6,"div",6),P()),2&e){q(3);const i=Vt(1);w(1),U("ngIf",i.controls.datafield.errors.required)}}function Gz(e,t){if(1&e){const i=Ke();L(0,"td",132)(1,"label",122),W(2),te(3,"translate"),P(),L(4,"input",141),ye("ngModelChange",function(){return ce(i),le(q(4).changed=!0)})("ngModelChange",function(o){return ce(i),le(q().$implicit.datafield=o)}),P(),J(5,Hz,2,1,"div",71),P()}if(2&e){const i=q(),n=i.index,o=i.$implicit;q();const c=Vt(1);w(1),U("for","datafield"+n),w(1),Ce(ne(3,7,"devices.sensors.datafield")),w(2),vn("value",o.datafield),U("id","datafield"+n)("name","datafield"+n)("ngModel",o.datafield),w(1),U("ngIf",c.submitted&&c.controls.datafield.errors)}}function qz(e,t){if(1&e){const i=Ke();L(0,"td",134)(1,"div",142)(2,"label",122),W(3),te(4,"translate"),P(),L(5,"input",143),ye("ngModelChange",function(){return ce(i),le(q(4).changed=!0)})("ngModelChange",function(o){return ce(i),le(q().$implicit.nodata=o)}),P(),L(6,"label",144),W(7),te(8,"translate"),P()()()}if(2&e){const i=q(),n=i.index,o=i.$implicit;w(2),U("for","nodata"+n),w(1),Ce(ne(4,7,"devices.sensors.nodata")),w(2),vn("value",o.nodata),U("id","nodata"+n)("name","nodata"+n)("ngModel",o.nodata),w(2),Ce(ne(8,9,"devices.sensors.nodate"))}}function Zz(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"devices.sensors.specific")," ",ne(3,4,"required"),""))}function Wz(e,t){if(1&e&&(L(0,"div",104),J(1,Zz,4,6,"div",6),P()),2&e){q(2);const i=Vt(1);w(1),U("ngIf",i.controls.correction_specific.errors.required)}}function Xz(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"devices.sensors.time_specific")," ",ne(3,4,"required"),""))}function Yz(e,t){if(1&e&&(L(0,"div",104),J(1,Xz,4,6,"div",6),P()),2&e){q(2);const i=Vt(1);w(1),U("ngIf",i.controls.correction_time_specific.errors.required)}}function Kz(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"devices.sensors.specific")," ",ne(3,4,"required"),""))}function Jz(e,t){if(1&e&&(L(0,"div",104),J(1,Kz,4,6,"div",6),P()),2&e){q(3);const i=Vt(1);w(1),U("ngIf",i.controls.topic_specific.errors.required)}}function Qz(e,t){if(1&e){const i=Ke();L(0,"td",132)(1,"label",122),W(2),te(3,"translate"),P(),L(4,"input",133),ye("ngModelChange",function(){return ce(i),le(q(4).changed=!0)})("ngModelChange",function(o){return ce(i),le(q().$implicit.topic_specific=o)}),P(),J(5,Jz,2,1,"div",71),P()}if(2&e){const i=q(),n=i.index,o=i.$implicit;q();const c=Vt(1);w(1),U("for","topic_specific"+n),w(1),Ce(ne(3,7,"devices.sensors.specific")),w(2),vn("value",o.topic_specific),U("id","topic_specific"+n)("name","topic_specific"+n)("ngModel",o.topic_specific),w(1),U("ngIf",c.submitted&&c.controls.topic_specific.errors)}}function eB(e,t){1&e&&(xt(),L(0,"svg",145),He(1,"path",146),P())}function tB(e,t){1&e&&(xt(),L(0,"svg",147),He(1,"path",148),P())}function nB(e,t){if(1&e){const i=Ke();L(0,"tbody",120)(1,"tr",121)(2,"label",122),W(3),te(4,"translate"),P(),L(5,"input",123),ye("ngModelChange",function(){return ce(i),le(q(3).changed=!0)})("ngModelChange",function(o){return le(ce(i).$implicit.id=o)}),P(),L(6,"label",122),W(7),te(8,"translate"),P(),L(9,"input",124),ye("ngModelChange",function(){return ce(i),le(q(3).changed=!0)})("ngModelChange",function(o){return le(ce(i).$implicit.id_device=o)}),P(),L(10,"td",125)(11,"label",122),W(12),te(13,"translate"),P(),L(14,"input",126),ye("ngModelChange",function(){return ce(i),le(q(3).changed=!0)})("ngModelChange",function(o){return le(ce(i).$implicit.orden=o)}),P(),J(15,Uz,2,1,"div",71),P(),L(16,"td",127)(17,"select",128),ye("change",function(){const o=ce(i),c=o.index,f=o.$implicit,y=q(3);return y.getOrder(c,f.id_type_sensor),le(y.changed=!0)})("ngModelChange",function(o){return le(ce(i).$implicit.id_type_sensor=o)}),J(18,jz,2,3,"option",129),P()(),J(19,Gz,6,9,"td",130),J(20,qz,9,11,"td",131),L(21,"td",132)(22,"label",122),W(23),te(24,"translate"),P(),L(25,"input",133),ye("ngModelChange",function(){return ce(i),le(q(3).changed=!0)})("ngModelChange",function(o){return le(ce(i).$implicit.correction_specific=o)}),P(),J(26,Wz,2,1,"div",71),P(),L(27,"td",134)(28,"label",122),W(29),te(30,"translate"),P(),L(31,"input",133),ye("ngModelChange",function(){return ce(i),le(q(3).changed=!0)})("ngModelChange",function(o){return le(ce(i).$implicit.correction_time_specific=o)}),P(),J(32,Yz,2,1,"div",71),P(),J(33,Qz,6,9,"td",130),L(34,"td",134)(35,"label",135)(36,"label",122),W(37),te(38,"translate"),P(),L(39,"input",136),ye("ngModelChange",function(){return ce(i),le(q(3).changed=!0)})("ngModelChange",function(o){return le(ce(i).$implicit.enable=o)}),P(),He(40,"span",46)(41,"span",103),te(42,"translate"),te(43,"translate"),P()(),L(44,"td",137),ye("mouseout",function(){return ce(i),le(q(3).deleteAux=-1)})("mouseover",function(){const c=ce(i).index;return le(q(3).deleteAux=c)})("click",function(){const c=ce(i).$implicit;return le(q(3).deleteSensor(c.id))}),J(45,eB,2,0,"svg",138),J(46,tB,2,0,"svg",139),P()()()}if(2&e){const i=t.$implicit,n=t.index;q();const o=Vt(1),c=q(2);w(2),U("for","id"+n),w(1),Ce(ne(4,49,"devices.sensors.id")),w(2),vn("value",n),U("id","id"+n)("name","id"+n)("ngModel",i.id),w(1),U("for","id_device"+n),w(1),Ce(ne(8,51,"devices.sensors.id_device")),w(2),vn("value",c.id),U("id","id_device"+n)("name","id_device"+n)("ngModel",i.id_device),w(2),U("for","orden"+n),w(1),Ce(ne(13,53,"devices.sensors.order")),w(2),vn("value",i.orden),U("id","orden"+n)("name","orden"+n)("ngModel",i.orden),w(1),U("ngIf",o.submitted&&o.controls.orden.errors),w(2),U("id","type_name"+n)("name","type_name"+n)("ngModel",i.id_type_sensor),w(1),U("ngForOf",c.selectSensors.sensors),w(1),U("ngIf",c.showLarge||c.width<965),w(1),U("ngIf",c.showLarge||c.width<965),w(2),U("for","correction_specific"+n),w(1),Ce(ne(24,55,"devices.sensors.specific")),w(2),vn("value",i.correction_specific),U("id","correction_specific"+n)("name","correction_specific"+n)("ngModel",i.correction_specific),w(1),U("ngIf",o.submitted&&o.controls.correction_specific.errors),w(2),U("for","correction_time_specific"+n),w(1),Ce(ne(30,57,"devices.sensors.time_specific")),w(2),vn("value",i.correction_time_specific),U("id","correction_time_specific"+n)("name","correction_time_specific"+n)("ngModel",i.correction_time_specific),w(1),U("ngIf",o.submitted&&o.controls.correction_time_specific.errors),w(1),U("ngIf",c.showLarge||c.width<965),w(3),U("for","enable"+n),w(1),Ce(ne(38,59,"devices.sensors.enable")),w(2),U("id","enable"+n)("name","enable"+n)("ngModel",i.enable),w(2),Fo("data-on",ne(42,61,"sensors.enable2"))("data-off",ne(43,63,"sensors.disable2")),w(4),U("ngIf",c.deleteAux!=n),w(1),U("ngIf",c.deleteAux==n)}}function iB(e,t){if(1&e&&(L(0,"form",null,110)(3,"div",19)(4,"div",38)(5,"div",111)(6,"table",112)(7,"thead")(8,"tr")(9,"th",113),W(10),te(11,"translate"),P(),L(12,"th",114),W(13),te(14,"translate"),P(),J(15,Nz,3,6,"th",115),J(16,zz,3,3,"th",116),L(17,"th",117),W(18),te(19,"translate"),P(),L(20,"th",117),W(21),te(22,"translate"),P(),J(23,Bz,3,6,"th",115),L(24,"th",114),W(25),te(26,"translate"),P(),L(27,"th",118),W(28),te(29,"translate"),P()()(),J(30,nB,47,65,"tbody",119),P()()()()()),2&e){const i=q(2);w(5),Tb("height",i.exp?"62vh":"20vh"),w(4),U("ngClass",ft(27,i1,"position"==i.mark)),w(1),jt("",ne(11,15,"devices.sensors.order")," "),w(3),jt(" ",ne(14,17,"devices.sensors.type")," "),w(2),U("ngIf",i.showLarge||i.width<965),w(1),U("ngIf",i.showLarge||i.width<965),w(1),U("ngClass",ft(29,i1,"correction_specific"==i.mark)),w(1),jt("",ne(19,19,"devices.sensors.specific")," "),w(2),U("ngClass",ft(31,i1,"correction_time_specific"==i.mark)),w(1),jt("",ne(22,21,"devices.sensors.time_specific")," "),w(2),U("ngIf",i.showLarge||i.width<965),w(2),jt(" ",ne(26,23,"sensors.enable")," "),w(3),jt(" ",ne(29,25,"sensors.delete")," "),w(2),U("ngForOf",i.devices.sensors)}}function rB(e,t){1&e&&(L(0,"div",149)(1,"h3",150),W(2),te(3,"translate"),P()()),2&e&&(w(2),Ce(ne(3,1,"devices.sensors.add")))}const WI=function(e,t){return{c200:e,c20:t}},XI=function(e){return{alt:e}};function oB(e,t){if(1&e){const i=Ke();L(0,"div",35)(1,"div",36)(2,"div",37)(3,"div",38)(4,"div",39)(5,"div",40),J(6,nz,3,3,"h2",41),J(7,iz,3,4,"h2",41),J(8,rz,3,4,"h2",41),P(),L(9,"div",42)(10,"div",43)(11,"label",44)(12,"input",45),ye("ngModelChange",function(){return ce(i),le(q().changed=!0)})("ngModelChange",function(o){return ce(i),le(q().devices.enable=o)}),P(),He(13,"span",46)(14,"span",47),te(15,"translate"),te(16,"translate"),P()()(),J(17,az,3,2,"div",48),P(),J(18,kz,85,79,"div",6),P()(),L(19,"div",49)(20,"div",38)(21,"div",50)(22,"div",51)(23,"div",52)(24,"div",53),ye("click",function(){return ce(i),le(q().exp=!1)}),J(25,Oz,2,0,"svg",54),J(26,Lz,3,3,"p",55),P(),L(27,"div",53),ye("click",function(){return ce(i),le(q().exp=!0)}),J(28,Rz,2,0,"svg",56),J(29,Fz,3,3,"p",55),P()(),L(30,"div")(31,"button",57),ye("click",function(){return ce(i),le(q().addSensor())}),W(32),te(33,"translate"),P()()()(),J(34,iB,31,33,"form",6),J(35,rB,4,3,"div",58),P()()()()}if(2&e){const i=q();U("ngClass",Ap(23,WI,!i.showMap||i.width<965,i.showMap||i.width>=965)),w(1),U("ngClass",ft(26,XI,i.width>=965)),w(5),U("ngIf",0==i.state&&"new"==i.ruteAux[2]),w(1),U("ngIf",1==i.state&&"new"==i.ruteAux[2]),w(1),U("ngIf","edit"==i.ruteAux[2]),w(4),U("ngModel",i.devices.enable),w(2),Fo("data-on",ne(15,17,"sensors.enable"))("data-off",ne(16,19,"sensors.disable")),w(3),U("ngIf",i.width>965),w(1),U("ngIf",!i.exp),w(7),U("ngIf",i.exp),w(1),U("ngIf",i.exp),w(2),U("ngIf",!i.exp),w(1),U("ngIf",!i.exp),w(3),Ce(ne(33,21,"devices.sensors.new")),w(2),U("ngIf",i.devices.sensors.length>0),w(1),U("ngIf",i.devices.sensors.length<=0)}}function sB(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",63),ye("click",function(){return ce(i),le(q(4).formHide())}),He(1,"path",64),P()}}function aB(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",65),ye("click",function(){return ce(i),le(q(4).formShow())}),He(1,"path",66),P()}}function lB(e,t){if(1&e&&(L(0,"div",214),J(1,sB,2,0,"svg",61),J(2,aB,2,0,"svg",62),P()),2&e){const i=q(3);w(1),U("ngIf",i.showForm),w(1),U("ngIf",!i.showForm)}}function cB(e,t){if(1&e&&(L(0,"div",212)(1,"div",25)(2,"h5"),W(3),P()(),J(4,lB,3,2,"div",213),P()),2&e){const i=q(2);w(3),Ce(i.devices.alias),w(1),U("ngIf",i.width>965)}}function uB(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",218),ye("click",function(){return ce(i),le(q(4).formHide())}),He(1,"path",64),P()}}function dB(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",219),ye("click",function(){return ce(i),le(q(4).formShow())}),He(1,"path",66),P()}}function hB(e,t){if(1&e&&(L(0,"div",214),J(1,uB,2,0,"svg",216),J(2,dB,2,0,"svg",217),P()),2&e){const i=q(3);w(1),U("ngIf",i.showForm),w(1),U("ngIf",!i.showForm)}}function pB(e,t){if(1&e&&(L(0,"div",212)(1,"div",215)(2,"h5"),W(3),P()(),J(4,hB,3,2,"div",213),P()),2&e){const i=q(2);w(3),Ce(i.devices.alias),w(1),U("ngIf",i.width>965)}}function fB(e,t){if(1&e){const i=Ke();L(0,"div",220),ye("click",function(){return ce(i),le(q(2).rechargeMap())}),xt(),L(1,"svg",221),He(2,"path",222)(3,"path",223),P()()}}function gB(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"devices.edit.lat")," ",ne(3,4,"required"),""))}function mB(e,t){if(1&e&&(L(0,"div",104),J(1,gB,4,6,"div",6),P()),2&e){q(2);const i=Vt(2);w(1),U("ngIf",i.controls.lat.errors.required)}}function _B(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"devices.edit.long")," ",ne(3,4,"required"),""))}function vB(e,t){if(1&e&&(L(0,"div",104),J(1,_B,4,6,"div",6),P()),2&e){q(2);const i=Vt(2);w(1),U("ngIf",i.controls.lon.errors.required)}}function yB(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"devices.edit.alt")," ",ne(3,4,"required"),""))}function xB(e,t){if(1&e&&(L(0,"div",104),J(1,yB,4,6,"div",6),P()),2&e){q(2);const i=Vt(2);w(1),U("ngIf",i.controls.cota.errors.required)}}function bB(e,t){if(1&e){const i=Ke();L(0,"div",220),ye("click",function(){return ce(i),le(q(2).rechargeMap())}),xt(),L(1,"svg",221),He(2,"path",222)(3,"path",223),P()()}}function wB(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"devices.edit.zone")," ",ne(3,4,"required"),""))}function CB(e,t){if(1&e&&(xt(),eo(),L(0,"div",104),J(1,wB,4,6,"div",6),P()),2&e){q(2);const i=Vt(2);w(1),U("ngIf",i.controls.timezone.errors.required)}}function MB(e,t){1&e&&(xt(),L(0,"svg",224),He(1,"path",225),P())}function EB(e,t){1&e&&(xt(),L(0,"svg",226),He(1,"path",227),P())}function TB(e,t){if(1&e){const i=Ke();L(0,"div",35)(1,"div",151),J(2,cB,5,2,"div",152),J(3,pB,5,2,"div",152),L(4,"div",153),He(5,"app-devices-map",154),P(),L(6,"div",155),J(7,fB,4,0,"div",156),L(8,"div",157)(9,"div",19)(10,"div",158)(11,"label",159),W(12),te(13,"translate"),P(),L(14,"input",160),ye("change",function(){return ce(i),le(q().updateSharedLat())})("change",function(){return ce(i),le(q().changed=!0)})("ngModelChange",function(o){return ce(i),le(q().devices.lat=o)}),P(),J(15,mB,2,1,"div",71),P(),L(16,"div",158)(17,"label",161),W(18),te(19,"translate"),P(),L(20,"input",162),ye("change",function(){return ce(i),le(q().updateSharedLon())})("change",function(){return ce(i),le(q().changed=!0)})("ngModelChange",function(o){return ce(i),le(q().devices.lon=o)}),P(),J(21,vB,2,1,"div",71),P(),L(22,"div",158)(23,"label",163),W(24),te(25,"translate"),P(),L(26,"input",164),ye("change",function(){return ce(i),le(q().changed=!0)})("ngModelChange",function(o){return ce(i),le(q().devices.cota=o)}),P(),J(27,xB,2,1,"div",71),P()()(),J(28,bB,4,0,"div",156),L(29,"div",165)(30,"label",166),W(31),te(32,"translate"),P(),L(33,"select",167),ye("ngModelChange",function(){return ce(i),le(q().changed=!0)})("ngModelChange",function(o){return ce(i),le(q().devices.timezone=o)}),L(34,"option",168),W(35,"(GMT -12:00) Eniwetok, Kwajalein"),P(),L(36,"option",169),W(37,"(GMT -11:00) Midway Island, Samoa"),P(),L(38,"option",170),W(39,"(GMT -10:00) Hawaii"),P(),L(40,"option",171),W(41,"(GMT -9:30) Taiohae"),P(),L(42,"option",172),W(43,"(GMT -9:00) Alaska"),P(),L(44,"option",173),W(45,"(GMT -8:00) Pacific Time (US & Canada)"),P(),L(46,"option",174),W(47,"(GMT -7:00) Mountain Time (US & Canada)"),P(),L(48,"option",175),W(49,"(GMT -6:00) Central Time (US & Canada), Mexico City"),P(),L(50,"option",176),W(51,"(GMT -5:00) Eastern Time (US & Canada), Bogota, Lima"),P(),L(52,"option",177),W(53,"(GMT -4:30) Caracas"),P(),L(54,"option",178),W(55,"(GMT -4:00) Atlantic Time (Canada), Caracas, La Paz"),P(),L(56,"option",179),W(57,"(GMT -3:30) Newfoundland"),P(),L(58,"option",180),W(59,"(GMT -3:00) Brazil, Buenos Aires, Georgetown "),P(),L(60,"option",181),W(61,"(GMT -2:00) Mid-Atlantic"),P(),L(62,"option",182),W(63,"(GMT -1:00) Azores, Cape Verde Islands"),P(),L(64,"option",183),W(65,"(GMT) Western Europe Time, London, Lisbon, Casablanca"),P(),L(66,"option",184),W(67,"(GMT +1:00) Brussels, Copenhagen, Madrid, Paris"),P(),L(68,"option",185),W(69,"(GMT +2:00) Kaliningrad,South Africa"),P(),L(70,"option",186),W(71,"(GMT +3:00) Baghdad, Riyadh,Moscow, St. Petersburg"),P(),L(72,"option",187),W(73,"(GMT +3:30) Tehran"),P(),L(74,"option",188),W(75,"(GMT +4:00) Abu Dhabi, Muscat, Baku, Tbilisi"),P(),L(76,"option",189),W(77,"(GMT +4:30) Kabul"),P(),L(78,"option",190),W(79,"(GMT +5:00) Ekaterinburg, Islamabad, Karachi, Tashkent"),P(),L(80,"option",191),W(81,"(GMT +5:30) Bombay, Calcutta, Madras, New Delhi"),P(),L(82,"option",192),W(83,"(GMT +5:45) Kathmandu, Pokhara"),P(),L(84,"option",193),W(85,"(GMT +6:00) Almaty, Dhaka, Colombo"),P(),L(86,"option",194),W(87,"(GMT +6:30) Yangon, Mandalay"),P(),L(88,"option",195),W(89,"(GMT +7:00) Bangkok, Hanoi, Jakarta"),P(),L(90,"option",196),W(91,"(GMT +8:00) Beijing, Perth, Singapore, Hong Kong"),P(),L(92,"option",197),W(93,"(GMT +8:45) Eucla"),P(),L(94,"option",198),W(95,"(GMT +9:00) Tokyo, Seoul, Osaka, Sapporo, Yakutsk"),P(),L(96,"option",199),W(97,"(GMT +9:30) Adelaide, Darwin"),P(),L(98,"option",200),W(99,"(GMT +10:00) Eastern Australia, Guam, Vladivostok"),P(),L(100,"option",201),W(101,"(GMT +10:30) Lord Howe Island"),P(),L(102,"option",202),W(103,"(GMT +11:00) Magadan, Solomon Islands, New Caledonia"),P(),L(104,"option",203),W(105,"(GMT +11:30) Norfolk Island"),P(),L(106,"option",204),W(107,"(GMT +12:00) Auckland, Wellington, Fiji, Kamchatka"),P(),L(108,"option",205),W(109,"(GMT +12:45) Chatham Islands"),P(),L(110,"option",206),W(111,"(GMT +13:00) Apia, Nukualofa"),P(),L(112,"option",207),W(113,"(GMT +14:00) Line Islands, Tokelau"),P()(),xt(),L(114,"svg",208),He(115,"path",98),P(),J(116,CB,2,1,"div",71),P(),eo(),L(117,"div",209),ye("mouseout",function(){return ce(i),le(q().eraseAux=!1)})("mouseover",function(){return ce(i),le(q().eraseAux=!0)})("click",function(){ce(i);const o=q();return o.deleteMarker(),le(o.changed=!0)}),J(118,MB,2,0,"svg",210),J(119,EB,2,0,"svg",211),P()()()()}if(2&e){const i=q(),n=Vt(2);U("ngClass",Ap(32,WI,!i.showForm||i.width<965,i.showForm||i.width>=965)),w(1),U("ngClass",ft(35,XI,i.width>=965)),w(1),U("ngIf","edit"==i.ruteAux[2]),w(1),U("ngIf","new"==i.ruteAux[2]),w(4),U("ngIf",("edit"==i.ruteAux[2]||1==i.state)&&i.width>965),w(5),Ce(ne(13,24,"devices.edit.lat")),w(2),U("value",i.devices.lat)("ngModel",i.devices.lat),w(1),U("ngIf",n.submitted&&n.controls.lat.errors),w(3),Ce(ne(19,26,"devices.edit.long")),w(2),U("value",i.devices.lon)("ngModel",i.devices.lon),w(1),U("ngIf",n.submitted&&n.controls.lon.errors),w(3),Ce(ne(25,28,"devices.edit.alt")),w(2),U("value",i.devices.cota)("ngModel",i.devices.cota),w(1),U("ngIf",n.submitted&&n.controls.cota.errors),w(1),U("ngIf",("edit"==i.ruteAux[2]||1==i.state)&&i.width<=965),w(3),Ce(ne(32,30,"devices.edit.zone")),w(2),U("value",i.devices.timezone)("ngModel",i.devices.timezone),w(83),U("ngIf",n.submitted&&n.controls.timezone.errors),w(2),U("ngIf",!i.eraseAux),w(1),U("ngIf",i.eraseAux)}}function DB(e,t){1&e&&(L(0,"button",236),W(1),te(2,"translate"),P()),2&e&&(w(1),Ce(ne(2,1,"sensors.exit")))}function SB(e,t){1&e&&(L(0,"button",237),W(1),te(2,"translate"),P()),2&e&&(w(1),Ce(ne(2,1,"reset.data")))}function IB(e,t){1&e&&(L(0,"button",238),W(1),te(2,"translate"),P()),2&e&&(w(1),Ce(ne(2,1,"devices.edit.erase_disp")))}function AB(e,t){1&e&&(L(0,"button",239),W(1),te(2,"translate"),P()),2&e&&(w(1),Ce(ne(2,1,"devices.edit.erase_disp")))}const rx=function(e){return{disabled:e}};function PB(e,t){if(1&e){const i=Ke();L(0,"div")(1,"div")(2,"div",19)(3,"div",228)(4,"div",19)(5,"div",229),J(6,DB,3,3,"button",230),J(7,SB,3,3,"button",231),P(),L(8,"div",229)(9,"button",232),ye("click",function(){ce(i);const o=q(),c=Vt(2);return le(o.editDevices(c))}),W(10),te(11,"translate"),P()()()(),L(12,"div",233)(13,"div",229),J(14,IB,3,3,"button",234),J(15,AB,3,3,"button",235),P()()()()()}if(2&e){const i=q();w(6),U("ngIf",0==i.changed||1==i.saved),w(1),U("ngIf",1==i.changed&&0==i.saved),w(2),U("ngClass",ft(8,rx,!i.changed)),w(1),Ce(ne(11,6,"sensors.save")),w(4),U("ngIf",i.changed),w(1),U("ngIf",!i.changed)}}function kB(e,t){1&e&&(L(0,"button",236),W(1),te(2,"translate"),P()),2&e&&(w(1),Ce(ne(2,1,"sensors.cancel")))}function OB(e,t){1&e&&(L(0,"button",243),W(1),te(2,"translate"),P()),2&e&&(w(1),Ce(ne(2,1,"sensors.cancel")))}function LB(e,t){if(1&e){const i=Ke();L(0,"div",19)(1,"div",228)(2,"div",19)(3,"div",240),J(4,kB,3,3,"button",230),J(5,OB,3,3,"button",241),P(),L(6,"div",240)(7,"button",242),ye("click",function(){ce(i);const o=q(),c=Vt(2);return le(o.newDevices(c))}),W(8),te(9,"translate"),P()()()()()}if(2&e){const i=q();w(4),U("ngIf",0==i.changed),w(1),U("ngIf",1==i.changed),w(2),U("ngClass",ft(6,rx,!i.changed)),w(1),Ce(ne(9,4,"sensors.save"))}}function RB(e,t){1&e&&(L(0,"div",244)(1,"div",245)(2,"div",246)(3,"div",247),W(4),te(5,"translate"),P(),He(6,"button",248),P()()()),2&e&&(w(4),jt(" ",ne(5,1,"devices.edit.e1"),""))}function FB(e,t){1&e&&(L(0,"div",244)(1,"div",249)(2,"div",246)(3,"div",247),W(4),te(5,"translate"),P(),He(6,"button",248),P()()()),2&e&&(w(4),Ce(ne(5,1,"devices.edit.e2")))}const NB=function(e){return{"flex-column":e}};let GC=(()=>{var e;class t{onResize(){window.resizeBy(-1,0),this.resize()}constructor(n,o,c,f){this.http=n,this.router=o,this.dataSharingService=c,this.rutaActiva=f,this.sharedLat="",this.sharedLon="",this.state=0,this.rute="",this.cont=0,this.idDevice=qt_baseUrl+"/device_configurations/id",this.postDevice=qt_baseUrl+"/device_configurations",this.maxDevice=qt_baseUrl+"/device_configurations/max",this.getStructureList=qt_baseUrl+"/data_structure/get_list",this.duplicateDevice=qt_baseUrl+"/device_configurations/duplicate",this.getSensorsList=qt_baseUrl+"/sensors_types/get_list",this.id=parseInt(this.rutaActiva.snapshot.params.id),this.alt1=!0,this.alt2=!0,this.alt3=!0,this.alt4=!0,this.alt5=!0,this.alt6=!0,this.activeLang=qt_languageLang[0],this.mark="position1",this.exp=!1,this.idMax=2,this.width=0,this.eraseAux=!1,this.deleteAux=-1,this.actNot=!1,this.changed=!1,this.showLarge=!0,this.auxFixed=0,this.auxVariable=0,this.actOk=!1,this.showMap=!0,this.showForm=!0,this.viewRec=!1,this.saved=!1,this.devices={id:"",uid:"",alias:"",origin:"",description_origin:"",application_id:"",topic_name:"",typemeter:"",lat:this.sharedLat,lon:this.sharedLon,cota:0,timezone:"Brussels, Copenhagen, Madrid, Paris",organizationid:"",enable:0,createdAt:"",updatedAt:"",id_data_estructure:this.auxFixed,structure_name:"",variable_configuration:0,sensors:[{id:1,enable:0,id_device:0,id_type_sensor:0,datafield:"",nodata:!0,orden:1,type_name:"",correction_specific:"",correction_time_specific:"",topic_specific:"",position:0}]},this.selectSensors={sensors:[{id:1,type:"",position:0}]},this.structures={structure:[{id_estructure:1,description:"",configuration:""}]},this.rute=this.router.routerState.snapshot.url,this.ruteAux=this.rute.split("/"),this.createDate(),"new"==this.ruteAux[2]&&this.http.get(this.getStructureList).subscribe(y=>{this.structures.structure=y.data_estructure,this.auxFixed=y.data_estructure[0].id_estructure,this.devices.id_data_estructure=this.auxFixed},y=>{console.error(y)})}ngOnInit(){this.devices.sensors=[],this.rute=this.router.routerState.snapshot.url,this.ruteAux=this.rute.split("/"),this.getStructure(0),this.http.get(this.getSensorsList).subscribe(n=>{this.selectSensors.sensors=n},n=>{console.error(n)}),"edit"==this.ruteAux[2]&&(this.showLarge=!1,this.getDevices(),setTimeout(()=>{this.dataSharingService.sharedLat$.subscribe(n=>{this.devices.lat=n}),this.dataSharingService.sharedLon$.subscribe(n=>{this.devices.lon=n})},1)),"new"==this.ruteAux[2]&&(this.http.get(this.maxDevice).subscribe(n=>{this.idMax=parseInt(n.id),this.id<this.idMax&&(this.state=1),this.id>=this.idMax&&(this.state=0),1==this.state&&(this.http.get(`${this.idDevice}/${this.id}`).subscribe(o=>{this.devices=o[0],this.lat=this.devices.lat,this.lon=this.devices.lon,this.cota=this.devices.cota,this.timezone=this.devices.timezone,this.createDate(),this.devices.createdAt=this.formatDateTime(this.date),this.devices.updatedAt=this.formatDateTime(this.date);for(let c=0;c<this.devices.sensors.length;c++)this.devices.sensors[c].id_device=this.idMax;this.http.get(`${this.duplicateDevice}/${this.devices.uid}`,{responseType:"text"}).subscribe(c=>{this.devices.uid=c},c=>{console.error("Error al verificar la descripci\xf3n duplicada:",c)})},o=>{console.error(o)}),this.changed=!0),0==this.state&&(this.devices.lat=0,this.devices.lon=0,this.dataSharingService.updateSharedLon(0),this.dataSharingService.updateSharedLat(0))},n=>{console.error(n)}),this.getShared(),this.createDate()),setInterval(()=>{this.dataSharingService.sharedAct$.subscribe(n=>{0!=n&&(this.changed=n)}),this.readStorage()},10),this.onResize(),this.showLarge=!1}getDevices(){this.http.get(`${this.idDevice}/${this.id}`).subscribe(n=>{this.devices=n[0],this.createDate(),this.devices.createdAt=this.formatDateTime(n[0].createdAt),this.devices.updatedAt=this.formatDateTime(n[0].updatedAt),this.getStructure(n[0].variable_configuration),(null==n[0].id_data_estructure||null==n[0].id_data_estructure)&&(this.devices.id_data_estructure=this.auxFixed),(null==n[0].variable_configuration||null==n[0].variable_configuration)&&(this.devices.variable_configuration=0),this.updateSharedLat(),this.updateSharedLon()},n=>{console.error(n)})}getSensorsLocal(n,o){this.mark=n,"ASC"==o&&("position"==n&&this.devices.sensors.sort((c,f)=>Number(c.position)-Number(f.position)),"datafield"==n&&this.devices.sensors.sort((c,f)=>c.datafield.localeCompare(f.datafield)),"nodata"==n&&this.devices.sensors.sort((c,f)=>c.nodata.localeCompare(f.nodata)),"correction_specific"==n&&this.devices.sensors.sort((c,f)=>c.correction_specific.localeCompare(f.correction_specific)),"correction_time_specific"==n&&this.devices.sensors.sort((c,f)=>c.correction_time_specific.localeCompare(f.correction_time_specific)),"topic_specific"==n&&this.devices.sensors.sort((c,f)=>c.topic_specific.localeCompare(f.topic_specific))),"DESC"==o&&("position"==n&&this.devices.sensors.sort((c,f)=>Number(f.position)-Number(c.position)),"datafield"==n&&this.devices.sensors.sort((c,f)=>f.datafield.localeCompare(c.datafield)),"nodata"==n&&this.devices.sensors.sort((c,f)=>f.nodata.localeCompare(c.nodata)),"correction_specific"==n&&this.devices.sensors.sort((c,f)=>f.correction_specific.localeCompare(c.correction_specific)),"correction_time_specific"==n&&this.devices.sensors.sort((c,f)=>f.correction_time_specific.localeCompare(c.correction_time_specific)),"topic_specific"==n&&this.devices.sensors.sort((c,f)=>f.topic_specific.localeCompare(c.topic_specific)))}getStructure(n){this.http.get(`${this.getStructureList}`).subscribe(o=>{this.structures.structure=1===n?o.variable_data_structure:o.data_estructure,this.auxVariable=o.variable_data_structure[0].id_estructure,this.auxFixed=o.data_estructure[0].id_estructure},o=>{console.error(o)})}newDevices(n){if(this.createDate(),this.devices.createdAt=this.date,this.devices.updatedAt=this.date,this.getShared(),n.valid){if(0==this.devices.sensors.length)this.devices.sensors=[{id:-1,enable:0,id_device:this.id,id_type_sensor:0,datafield:"",nodata:!0,orden:1,type_name:"",correction_specific:"",correction_time_specific:"",topic_specific:"",position:0}],this.http.post(this.postDevice,this.devices,{headers:new rr({"Content-Type":"application/json; charset=UTF-8"})}).subscribe(c=>{},c=>{console.error(c)}),this.devices.sensors=[];else{const o={headers:new rr({"Content-Type":"application/json; charset=UTF-8"})};this.http.post(this.postDevice,this.devices,o).subscribe(c=>{},c=>{console.error(c)})}this.newSensors()}}newSensors(){0==this.state&&(this.changed=!1,this.router.navigate([`/devices/edit/${this.id}`])),1==this.state&&(this.devices.sensors.forEach(n=>{n.id_device=this.idMax}),this.devices.createdAt=this.date,this.changed=!1,this.router.navigate([`/devices/edit/${this.idMax}`]))}editDevices(n){if(this.getShared(),this.createDate(),this.devices.updatedAt=this.date,n.valid){if(0==this.devices.sensors.length){this.devices.sensors=[{id:-1,enable:0,id_device:this.id,id_type_sensor:0,datafield:"",nodata:!0,orden:1,type_name:"",correction_specific:"",correction_time_specific:"",topic_specific:"",position:0}];const c={headers:new rr({"Content-Type":"application/json; charset=UTF-8"})};this.http.put(this.postDevice,JSON.stringify(this.devices),c).subscribe(f=>{},f=>{console.error("Error:",f)}),this.devices.sensors=[]}else{const o={headers:new rr({"Content-Type":"application/json; charset=UTF-8"})};this.http.put(this.postDevice,JSON.stringify(this.devices),o).subscribe(c=>{},c=>{console.error("Error:",c)})}this.actOk=!0,setTimeout(()=>{this.actOk=!1},2e3),this.saved=!0}this.changed=!1,this.devices.updatedAt=this.formatDateTime(this.date)}deleteDevices(n){var o={id:n};const c={headers:new rr({"Content-Type":"application/json; charset=UTF-8"}),body:JSON.stringify(o)};this.http.delete(this.postDevice,c).subscribe(f=>{this.router.navigate(["/devices"])},f=>{console.error("Error:",f)})}addSensor(){this.devices.sensors.push({id:this.devices.sensors.length,enable:0,id_device:this.id,id_type_sensor:this.selectSensors.sensors[0].id,datafield:"",nodata:!0,orden:1,type_name:"",correction_specific:"",correction_time_specific:"",topic_specific:"",position:0}),this.changed=!0}getOrder(n,o){let c;c=this.selectSensors.sensors.find(f=>f.id==o),null!=c&&(this.devices.sensors[n].orden=c.position)}deleteSensor(n){this.deleteId=n,this.devices.sensors=this.devices.sensors.filter(o=>o.id!=this.deleteId),this.changed=!0}rechargeMap(){this.http.get(`${this.idDevice}/${this.id}`).subscribe(n=>{this.devices.lat=n[0].lat,this.devices.lon=n[0].lon,this.devices.cota=n[0].cota,this.devices.timezone=n[0].timezone,this.updateSharedLat(),this.updateSharedLon()},n=>{console.error(n)}),this.changed=!1}rechargeForm(){this.ngOnInit(),this.dataSharingService.updateSharedAct(!1),this.cont++,this.changed=!1}deleteMarker(){this.devices.lat=null,this.devices.lon=null,this.devices.cota=0,this.devices.timezone="Brussels, Copenhagen, Madrid, Paris",this.updateSharedLat(),this.updateSharedLon()}resize(){this.width=window.innerWidth}getShared(){this.dataSharingService.sharedLat$.subscribe(n=>{this.devices.lat=n}),this.dataSharingService.sharedLon$.subscribe(n=>{this.devices.lon=n}),this.dataSharingService.updateSharedAct(!1)}updateSharedLat(){this.dataSharingService.updateSharedLat(this.devices.lat)}updateSharedLon(){this.dataSharingService.updateSharedLon(this.devices.lon)}formShow(){this.showForm=!0,"edit"==this.ruteAux[2]&&this.onResize()}formHide(){this.showForm=!1,"edit"==this.ruteAux[2]&&this.onResize()}mapShow(){this.showLarge=!0,this.showMap=!1}mapHide(){this.showMap=!0,this.showLarge=!1}readStorage(){this.activeLang=localStorage.getItem("activeLang")??"es"}getStructuresList(n){var o=this;return function s6(e){return function(){var t=this,i=arguments;return new Promise(function(n,o){var c=e.apply(t,i);function f(E){MI(c,n,o,f,y,"next",E)}function y(E){MI(c,n,o,f,y,"throw",E)}f(void 0)})}}(function*(){let c=n.target.checked?1:0;try{yield o.getStructure(c),o.devices.variable_configuration=c,0==c&&(o.devices.id_data_estructure=o.auxFixed),1==c&&(o.devices.id_data_estructure=o.auxVariable)}catch(f){console.error("Error:",f)}})()}createDate(){this.date=this.formatDateTime(new Date)}formatDateTime(n){let o="";const c=new Date(n);return o=`${c.getFullYear()}-${(c.getMonth()+1).toString().padStart(2,"0")}-${c.getDate().toString().padStart(2,"0")} ${c.getHours().toString().padStart(2,"0")}:${c.getMinutes().toString().padStart(2,"0")}:${c.getSeconds().toString().padStart(2,"0")}`,isNaN(c.getFullYear())&&(o=""),o}}return(e=t).\u0275fac=function(n){return new(n||e)(G(dh),G(Zr),G(NC),G(ch))},e.\u0275cmp=mi({type:e,selectors:[["app-devices-new-edit"]],hostBindings:function(n,o){1&n&&ye("resize",function(f){return o.onResize(f)},0,Rg)},decls:122,vars:72,consts:[[1,"row","cont0","needs-validation"],["form","ngForm"],[1,"row","p-0","m-0",3,"ngClass"],["class","p-0",3,"ngClass",4,"ngIf"],[1,"row","p-0","m-0"],[1,"col-12","p-0"],[4,"ngIf"],["class","row",4,"ngIf"],[1,"toast-cont"],["class","top-0 end-0 p-3",4,"ngIf"],["id","exampleModal8","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header",2,"border-bottom","0px"],[1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"not"],[1,"modal-footer",2,"border-top","0px"],[1,"row"],[1,"col-7"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary","me-4",2,"width","max-content",3,"click"],[1,"col-5"],["type","button navb","data-bs-toggle","modal","data-bs-target","#exampleModal1",1,"btn","btn-info",2,"width","100%",3,"ngClass"],["id","exampleModal9","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],[1,"col-6"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary","text-light"],["type","button","data-bs-dismiss","modal","routerLink","/devices",1,"btn","btn-danger",3,"click"],["id","exampleModal","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],["type","button",1,"btn","btn-danger"],["id","exampleModal2","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],["type","button",1,"btn","btn-info"],["id","exampleModal13","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],["type","button","data-bs-dismiss","modal","routerLink","/devices",1,"btn","btn-secondary"],["type","button navb","data-bs-toggle","modal","data-bs-target","#exampleModal1",1,"btn","btn-info",2,"width","100%",3,"ngClass","click"],[1,"p-0",3,"ngClass"],[1,"cont1","pb-0",3,"ngClass"],[1,"row","c1"],[1,"col-12"],[1,"row","pb-3"],[1,"col-8","d-flex"],["class","pe-3",4,"ngIf"],[1,"col-3","d-flex","justify-content-end"],[1,"form-check","form-switch"],[1,"toggle","tt1","t1"],["maxlength","4","type","checkbox","id","check","name","check",3,"ngModel","ngModelChange"],[1,"slider"],[1,"labels","t1"],["class","col-1","style","cursor: pointer; display: flex; justify-content: flex-end;",4,"ngIf"],[1,"row","c2"],[1,"row","pb-0","pb-1","d-flex"],[1,"col","d-flex","ps-3",2,"justify-content","space-between"],[1,"d-flex","mt-2"],[1,"d-flex","mb-2",2,"cursor","pointer",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","class","bi bi-chevron-down","viewBox","0 0 16 16",4,"ngIf"],["class","ms-2 mb-0",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","class","bi bi-chevron-up","viewBox","0 0 16 16",4,"ngIf"],["type","button",1,"btn","btn-info",3,"click"],["class","text-center",4,"ngIf"],[1,"pe-3"],[1,"col-1",2,"cursor","pointer","display","flex","justify-content","flex-end"],["class","text-right","xmlns","http://www.w3.org/2000/svg","width","17","height","17","fill","currentColor","class","bi bi-arrows-angle-show","viewBox","0 0 16 16",3,"click",4,"ngIf"],["class","text-right","xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","class","bi bi-arrows-angle-hide","viewBox","0 0 16 16",3,"click",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","17","height","17","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-arrows-angle-show",3,"click"],["fill-rule","evenodd","d","M5.828 10.172a.5.5 0 0 0-.707 0l-4.096 4.096V11.5a.5.5 0 0 0-1 0v3.975a.5.5 0 0 0 .5.5H4.5a.5.5 0 0 0 0-1H1.732l4.096-4.096a.5.5 0 0 0 0-.707zm4.344-4.344a.5.5 0 0 0 .707 0l4.096-4.096V4.5a.5.5 0 1 0 1 0V.525a.5.5 0 0 0-.5-.5H11.5a.5.5 0 0 0 0 1h2.768l-4.096 4.096a.5.5 0 0 0 0 .707z"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-arrows-angle-hide",3,"click"],["fill-rule","evenodd","d","M.172 15.828a.5.5 0 0 0 .707 0l4.096-4.096V14.5a.5.5 0 1 0 1 0v-3.975a.5.5 0 0 0-.5-.5H1.5a.5.5 0 0 0 0 1h2.768L.172 15.121a.5.5 0 0 0 0 .707zM15.828.172a.5.5 0 0 0-.707 0l-4.096 4.096V1.5a.5.5 0 1 0-1 0v3.975a.5.5 0 0 0 .5.5H14.5a.5.5 0 0 0 0-1h-2.768L15.828.879a.5.5 0 0 0 0-.707z"],[1,"col-md-3"],["type","text","id","createdAt_2","name","createdAt_2","type","",1,"form-control","d-none",3,"value","ngModel","ngModelChange"],["for","uid"],["maxlength","45","type","text","id","uid","name","uid","required","","type","",1,"form-control",3,"value","ngModel","ngModelChange"],["class","text-danger",4,"ngIf"],["for","alias"],["maxlength","45","type","text","id","alias","name","alias","type","",1,"form-control",3,"value","ngModel","ngModelChange"],[1,"col-md-6"],["for","organizationid"],["maxlength","45","type","text","id","organizationid","name","organizationid","type","",1,"form-control",3,"value","ngModel","ngModelChange"],["for","typemeter"],["maxlength","45","type","text","id","typemeter","name","typemeter","type","",1,"form-control",3,"value","ngModel","ngModelChange"],["for","application_id"],["maxlength","45","type","text","id","application_id","name","application_id","type","",1,"form-control",3,"value","ngModel","ngModelChange"],["for","topic_name"],["maxlength","45","type","text","id","topic_name","name","topic_name","required","","type","",1,"form-control",3,"value","ngModel","ngModelChange"],["for","origin"],["maxlength","45","type","text","id","origin","name","origin","type","",1,"form-control",3,"value","ngModel","ngModelChange"],["for","description_origin"],["maxlength","45","type","text","id","description_origin","name","description_origin","type","",1,"form-control",3,"value","ngModel","ngModelChange"],["for","createdAt"],["disabled","disabled","maxlength","45","type","text","id","createdAt","name","createdAt","type","",1,"form-control",3,"value","ngModel","ngModelChange"],["for","updatedAt"],["disabled","disabled","maxlength","45","type","text","id","updatedAt","name","updatedAt","type","",1,"form-control",3,"value","ngModel","ngModelChange"],[1,"col-md-12",2,"position","relative"],[1,"d-flex",2,"justify-content","space-between"],[2,"width","-webkit-fill-available"],["for","id_data_estructure"],["type","select","type","text","id","id_data_estructure","name","id_data_estructure",1,"form-control",2,"position","relative",3,"value","ngModel","ngModelChange"],[4,"ngFor","ngForOf"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-chevron-down",2,"position","absolute","top","35px","right","170px"],["fill-rule","evenodd","d","M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"],[1,"form-check","form-switch","pt-4","pe-3","ps-3"],[1,"toggle","colorcito","tt2","t2"],["maxlength","4","type","checkbox","id","check2","name","check2",3,"ngModel","ngModelChange","change"],[1,"slider",3,"ngStyle"],[1,"labels","t2"],[1,"text-danger"],[3,"selected","value"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-chevron-down"],[1,"ms-2","mb-0"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-chevron-up"],["fill-rule","evenodd","d","M7.646 4.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 5.707l-5.646 5.647a.5.5 0 0 1-.708-.708l6-6z"],["form","ngForm","miDiv",""],[1,"over",2,"background-color","#f8f8f8"],[1,"table","table-hover"],["scope","col",2,"cursor","pointer","z-index","100",3,"ngClass"],["scope","col",2,"cursor","pointer"],["style","cursor: pointer;","scope","col",3,"ngClass",4,"ngIf"],["style","cursor: pointer;","scope","col",4,"ngIf"],["scope","col",2,"cursor","pointer",3,"ngClass"],["scope","col",2,"text-align","center"],["style","background-color: rgb(255, 255, 255);",4,"ngFor","ngForOf"],[2,"background-color","rgb(255, 255, 255)"],[1,"pb-0",2,"overflow-y","scroll"],[2,"display","none",3,"for"],["type","text",1,"form-control",2,"display","none",3,"id","name","value","ngModel","ngModelChange"],["type","number","min","0","maxlength","11",1,"form-control",2,"display","none",3,"id","name","value","ngModel","ngModelChange"],["scope","col2",1,"pb-0","input-0"],["type","number","min","0","maxlength","11","type","text","required","",1,"form-control",3,"value","id","name","ngModel","ngModelChange"],["scope","col",1,"pb-0","input-1"],["type","number","min","0","maxlength","11","aria-label","Default select example",1,"form-select",3,"id","name","ngModel","change","ngModelChange"],[3,"value","selected",4,"ngFor","ngForOf"],["class","pb-0 input-1",4,"ngIf"],["class","pb-0",4,"ngIf"],[1,"pb-0","input-1"],["type","text","type","",1,"form-control",3,"value","id","name","ngModel","ngModelChange"],[1,"pb-0"],[1,"toggle","t2","tt2","mt-1","mb-3"],["maxlength","4","type","checkbox","checked","",3,"id","name","ngModel","ngModelChange"],[1,"input-00",2,"cursor","pointer","text-align","center","padding-top","0.7em",3,"mouseout","mouseover","click"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","class","bi bi-trash2","viewBox","0 0 16 16",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","class","bi bi-trash2-fill","viewBox","0 0 16 16",4,"ngIf"],[3,"value","selected"],["maxlength","45","type","text","type","",1,"form-control",3,"value","id","name","ngModel","ngModelChange"],[1,"form-check"],["min","0","maxlength","4","type","checkbox","aria-label","Checkbox for following text input",1,"form-check-input",3,"value","id","name","ngModel","ngModelChange"],["for","flexCheckDefault",1,"form-check-label"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-trash2"],["d","M14 3a.702.702 0 0 1-.037.225l-1.684 10.104A2 2 0 0 1 10.305 15H5.694a2 2 0 0 1-1.973-1.671L2.037 3.225A.703.703 0 0 1 2 3c0-1.105 2.686-2 6-2s6 .895 6 2zM3.215 4.207l1.493 8.957a1 1 0 0 0 .986.836h4.612a1 1 0 0 0 .986-.836l1.493-8.957C11.69 4.689 9.954 5 8 5c-1.954 0-3.69-.311-4.785-.793z"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-trash2-fill"],["d","M2.037 3.225A.703.703 0 0 1 2 3c0-1.105 2.686-2 6-2s6 .895 6 2a.702.702 0 0 1-.037.225l-1.684 10.104A2 2 0 0 1 10.305 15H5.694a2 2 0 0 1-1.973-1.671L2.037 3.225zm9.89-.69C10.966 2.214 9.578 2 8 2c-1.58 0-2.968.215-3.926.534-.477.16-.795.327-.975.466.18.14.498.307.975.466C5.032 3.786 6.42 4 8 4s2.967-.215 3.926-.534c.477-.16.795-.327.975-.466-.18-.14-.498-.307-.975-.466z"],[1,"text-center"],[1,"mt-5"],[1,"cont2","ms-lg-3","ms-0","ms-md-0",3,"ngClass"],["class","c4 d-flex justify-content-between",4,"ngIf"],[1,"c5","p-0","m-0",2,"width","100%"],[2,"width","100%"],[1,"row","c6"],["class","col-1 pt-4","style","cursor: pointer;",3,"click",4,"ngIf"],[1,"col-11","col-lg-6","col-md-11","col-11"],[1,"col-md-4"],["for","lat"],["min","-90","max","90","type","text","id","lat","name","lat","type","number",1,"form-control",3,"value","ngModel","change","ngModelChange"],["for","lon"],["min","-90","max","90","type","text","id","lon","name","lon","type","number",1,"form-control",3,"value","ngModel","change","ngModelChange"],["for","cota"],["type","text","id","cota","name","cota","type","number",1,"form-control",3,"value","ngModel","change","ngModelChange"],[1,"col-11","col-lg-4","col-md-11","col-11",2,"position","relative"],["for","timezone",1,"form-label","m-0"],["aria-label","Default select example","type","text","id","timezone","name","timezone","type","",1,"form-control",3,"value","ngModel","ngModelChange"],["value","Eniwetok, Kwajalein"],["value","Midway Island, Samoa"],["value","Hawaii"],["value","Taiohae"],["value","Alaska"],["value","Pacific Time (US & Canada)"],["value","Mountain Time (US & Canada)"],["value","Central Time (US & Canada), Mexico City"],["value","Eastern Time (US & Canada), Bogota, Lima"],["value","Caracas"],["value","Atlantic Time (Canada), Caracas, La Paz"],["value","Newfoundland"],["value","Brazil, Buenos Aires, Georgetown"],["value","Mid-Atlantic"],["value","Azores, Cape Verde Islands"],["value","Western Europe Time, London, Lisbon, Casablanca"],["value","Brussels, Copenhagen, Madrid, Paris","selected","selected"],["value","Kaliningrad, South Africa"],["value","Baghdad, Riyadh, Moscow, St. Petersburg"],["value","Tehran"],["value","Abu Dhabi, Muscat, Baku, Tbilisi"],["value","Kabul"],["value","Ekaterinburg, Islamabad, Karachi, Tashkent"],["value","Bombay, Calcutta, Madras, New Delhi"],["value","Kathmandu, Pokhara"],["value","Almaty, Dhaka, Colombo"],["value","Yangon, Mandala"],["value","Bangkok, Hanoi, Jakarta"],["value","Beijing, Perth, Singapore, Hong Kong"],["value","Eucla"],["value","Tokyo, Seoul, Osaka, Sapporo, Yakutsk"],["value","Adelaide, Darwin"],["value","Eastern Australia, Guam, Vladivostok"],["value","Lord Howe Island"],["value","Magadan, Solomon Islands, New Caledonia"],["value","Norfolk Island"],["value","Auckland, Wellington, Fiji, Kamchatka"],["value","Chatham Islands"],["value","Apia, Nukualofa"],["value","Line Islands, Tokelau"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-chevron-down",2,"position","absolute","top","35px","right","20px"],[1,"col-1","col-lg-1","col-md-1","col-1","pt-4",2,"cursor","pointer","text-align","center","padding-top","0.7em",3,"mouseout","mouseover","click"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","class","bi bi-eraser","viewBox","0 0 16 16",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","class","bi bi-eraser-fill","viewBox","0 0 16 16",4,"ngIf"],[1,"c4","d-flex","justify-content-between"],["class","col-3","style","cursor: pointer; cursor: pointer; display: flex; justify-content: flex-end;",4,"ngIf"],[1,"col-3",2,"cursor","pointer","cursor","pointer","display","flex","justify-content","flex-end"],[1,"col-9"],["class","text-right","xmlns","http://www.w3.org/2000/svg","width","17","height","17","fill","currentColor","class","bi bi-arrows-angle-expand","viewBox","0 0 16 16",3,"click",4,"ngIf"],["class","text-right","xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","class","bi bi-arrows-angle-contract","viewBox","0 0 16 16",3,"click",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","17","height","17","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-arrows-angle-expand",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-arrows-angle-contract",3,"click"],[1,"col-1","pt-4",2,"cursor","pointer",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-arrow-repeat"],["d","M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41zm-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9z"],["fill-rule","evenodd","d","M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5.002 5.002 0 0 0 8 3zM3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9H3.1z"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-eraser"],["d","M8.086 2.207a2 2 0 0 1 2.828 0l3.879 3.879a2 2 0 0 1 0 2.828l-5.5 5.5A2 2 0 0 1 7.879 15H5.12a2 2 0 0 1-1.414-.586l-2.5-2.5a2 2 0 0 1 0-2.828l6.879-6.879zm2.121.707a1 1 0 0 0-1.414 0L4.16 7.547l5.293 5.293 4.633-4.633a1 1 0 0 0 0-1.414l-3.879-3.879zM8.746 13.547 3.453 8.254 1.914 9.793a1 1 0 0 0 0 1.414l2.5 2.5a1 1 0 0 0 .707.293H7.88a1 1 0 0 0 .707-.293l.16-.16z"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-eraser-fill"],["d","M8.086 2.207a2 2 0 0 1 2.828 0l3.879 3.879a2 2 0 0 1 0 2.828l-5.5 5.5A2 2 0 0 1 7.879 15H5.12a2 2 0 0 1-1.414-.586l-2.5-2.5a2 2 0 0 1 0-2.828l6.879-6.879zm.66 11.34L3.453 8.254 1.914 9.793a1 1 0 0 0 0 1.414l2.5 2.5a1 1 0 0 0 .707.293H7.88a1 1 0 0 0 .707-.293l.16-.16z"],[1,"col-md-6","col-12"],[1,"col-md-4","col-12","mt-1","pb-3"],["type","button navb","class","btn btn-secondary text-light navb","routerLink","/devices","style","width: 100%",4,"ngIf"],["type","button navb","class","btn btn-secondary text-light navb","style","width: 100%","data-bs-toggle","modal","data-bs-target","#exampleModal8",4,"ngIf"],["ng-click","ocultar = true","type","button navb",1,"btn","btn-info","navb","me-3",2,"width","100%",3,"ngClass","click"],[1,"col-md-6","col-12","d-flex",2,"justify-content","flex-end"],["type","button","class","btn btn-danger navb me-3","data-bs-toggle","modal","style","width: 100%","data-bs-target","#exampleModal9","disabled","",4,"ngIf"],["type","button","class","btn btn-danger navb me-3","data-bs-toggle","modal","style","width: 100%","data-bs-target","#exampleModal9",4,"ngIf"],["type","button navb","routerLink","/devices",1,"btn","btn-secondary","text-light","navb",2,"width","100%"],["type","button navb","data-bs-toggle","modal","data-bs-target","#exampleModal8",1,"btn","btn-secondary","text-light","navb",2,"width","100%"],["type","button","data-bs-toggle","modal","data-bs-target","#exampleModal9","disabled","",1,"btn","btn-danger","navb","me-3",2,"width","100%"],["type","button","data-bs-toggle","modal","data-bs-target","#exampleModal9",1,"btn","btn-danger","navb","me-3",2,"width","100%"],[1,"col-md-6","col-12","mt-1","pb-3"],["type","button navb","class","btn btn-secondary text-light navb","style","width: 100%","data-bs-toggle","modal","data-bs-target","#exampleModal13",4,"ngIf"],["type","button navb",1,"btn","btn-info","navb","me-3",2,"width","100%",3,"ngClass","click"],["type","button navb","data-bs-toggle","modal","data-bs-target","#exampleModal13",1,"btn","btn-secondary","text-light","navb",2,"width","100%"],[1,"top-0","end-0","p-3"],["role","alert","role","alert","aria-live","assertive","aria-atomic","true",1,"toast","show","align-items-center","text-bg-success","border-0"],[1,"d-flex"],[1,"toast-body"],["type","button","data-bs-dismiss","toast","aria-label","Close",1,"btn-close","btn-close-white","me-2","m-auto"],["role","alert","role","alert","aria-live","assertive","aria-atomic","true",1,"toast","show","align-items-center","text-bg-danger","border-0"]],template:function(n,o){if(1&n){const c=Ke();He(0,"app-navbar"),L(1,"form",0,1)(3,"div",2),J(4,oB,36,28,"div",3),J(5,TB,120,37,"div",3),P(),L(6,"div",4)(7,"div",5),J(8,PB,16,10,"div",6),J(9,LB,10,8,"div",7),P()()(),L(10,"div",8),J(11,RB,7,3,"div",9),J(12,FB,7,3,"div",9),P(),L(13,"div",10)(14,"div",11)(15,"div",12)(16,"div",13)(17,"h3",14),W(18),te(19,"translate"),P(),He(20,"button",15),P(),L(21,"div",16)(22,"p",17),W(23),te(24,"translate"),P()(),L(25,"div",18)(26,"div",19)(27,"div",20)(28,"button",21),ye("click",function(){return o.rechargeForm()}),W(29),te(30,"translate"),P()(),L(31,"div",22)(32,"button",23),W(33,"Cancelar"),P()()()()()()(),L(34,"div",24)(35,"div",11)(36,"div",12)(37,"div",13)(38,"h3",14),W(39),te(40,"translate"),P(),He(41,"button",15),P(),L(42,"div",16)(43,"p",17),W(44),te(45,"translate"),P()(),L(46,"div",18)(47,"div",19)(48,"div",25)(49,"button",26),W(50),te(51,"translate"),P()(),L(52,"div",25)(53,"button",27),ye("click",function(){return o.deleteDevices(o.devices.id)}),W(54),te(55,"translate"),P()()()()()()(),L(56,"div",28)(57,"div",11)(58,"div",12)(59,"div",13)(60,"h3",14),W(61),te(62,"translate"),P(),He(63,"button",15),P(),L(64,"div",16)(65,"p",17),W(66),te(67,"translate"),P()(),L(68,"div",18)(69,"div",19)(70,"div",25)(71,"button",26),W(72),te(73,"translate"),P()(),L(74,"div",25)(75,"button",29),W(76),te(77,"translate"),P()()()()()()(),L(78,"div",30)(79,"div",11)(80,"div",12)(81,"div",13)(82,"h3",14),W(83),te(84,"translate"),P(),He(85,"button",15),P(),L(86,"div",16)(87,"p",17),W(88),te(89,"translate"),P()(),L(90,"div",18)(91,"div",19)(92,"div",25)(93,"button",26),W(94),te(95,"translate"),P()(),L(96,"div",25)(97,"button",31),W(98),te(99,"translate"),P()()()()()()(),L(100,"div",32)(101,"div",11)(102,"div",12)(103,"div",13)(104,"h3",14),W(105),te(106,"translate"),P(),He(107,"button",15),P(),L(108,"div",16)(109,"p",17),W(110),te(111,"translate"),P()(),L(112,"div",18)(113,"div",19)(114,"div",22)(115,"button",33),W(116),te(117,"translate"),P()(),L(118,"div",20)(119,"button",34),ye("click",function(){ce(c);const y=Vt(2);return le(o.newDevices(y))}),W(120),te(121,"translate"),P()()()()()()()}2&n&&(w(3),U("ngClass",ft(66,NB,o.width<965)),w(1),U("ngIf",o.showForm),w(1),U("ngIf",o.showMap),w(3),U("ngIf","edit"==o.ruteAux[2]),w(1),U("ngIf","new"==o.ruteAux[2]),w(2),U("ngIf",o.actOk),w(1),U("ngIf",o.actNot),w(6),Ce(ne(19,28,"reset.data2")),w(5),Ce(ne(24,30,"irreversible")),w(6),Ce(ne(30,32,"reset.data")),w(3),U("ngClass",ft(68,rx,!o.changed)),w(7),Ce(ne(40,34,"devices.edit.m1.1")),w(5),Ce(ne(45,36,"devices.edit.m1.2")),w(6),Ce(ne(51,38,"sensors.cancel")),w(4),Ce(ne(55,40,"sensors.delete")),w(7),Ce(ne(62,42,"devices.edit.m5.1")),w(5),Ce(ne(67,44,"devices.edit.m5.1")),w(6),Ce(ne(73,46,"sensors.cancel")),w(4),Ce(ne(77,48,"sensors.delete")),w(7),Ce(ne(84,50,"devices.edit.m3.1")),w(5),Ce(ne(89,52,"devices.edit.m3.2")),w(6),Ce(ne(95,54,"sensors.cancel")),w(4),Ce(ne(99,56,"sensors.acept")),w(7),Ce(ne(106,58,"devices.edit.m2.1")),w(5),Ce(ne(111,60,"devices.edit.m2.2")),w(6),Ce(ne(117,62,"sensors.exit")),w(3),U("ngClass",ft(70,rx,!o.changed)),w(1),Ce(ne(121,64,"sensors.save")))},dependencies:[Qd,eh,Mc,GT,kv,Np,zp,nh,cm,Hw,Ru,Lp,Tv,um,dm,Ov,lC,sh,Fp,ym,K6,n1,Zp],styles:['*[_ngcontent-%COMP%]{font-family:system-ui}.input-1[_ngcontent-%COMP%]{width:15%}.input-0[_ngcontent-%COMP%]{width:10%}.input-00[_ngcontent-%COMP%]{width:5em}.input-2[_ngcontent-%COMP%]{width:30%}#map[_ngcontent-%COMP%]{width:100%;height:100%;position:relative}.floating-range[_ngcontent-%COMP%]{position:relative;bottom:0;z-index:999;width:40%}.toast-cont[_ngcontent-%COMP%]{top:-10px;right:0;position:fixed}.btn[_ngcontent-%COMP%]:hover{border-color:#fff}.mapboxgl-canvas[_ngcontent-%COMP%]{width:100%}.form-range[_ngcontent-%COMP%]::-moz-range-thumb{background-color:#6c757d}.form-range[_ngcontent-%COMP%]::-webkit-slider-thumb{background-color:#6c757d}.mark[_ngcontent-%COMP%]{background-color:#e3e3e3}th[_ngcontent-%COMP%]{border-radius:7px}.floating-content[_ngcontent-%COMP%]{display:flex}#menu[_ngcontent-%COMP%]{margin:.5em;font-size:medium;background-color:#fff;position:relative;width:max-content;padding:5px;top:0;left:0;z-index:999;border-radius:5px;border:1px #afafaf solid}#menu[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin-right:.5em}.list-group[_ngcontent-%COMP%]{z-index:999;position:absolute;top:0;right:0;cursor:pointer;height:85%}.botoncito[_ngcontent-%COMP%]{z-index:1000;position:absolute;top:30px;left:20px}.nav[_ngcontent-%COMP%]{margin:1em}.cc2[_ngcontent-%COMP%]{margin:0 1em 1em}h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%], h4[_ngcontent-%COMP%], p[_ngcontent-%COMP%], a[_ngcontent-%COMP%], .btn[_ngcontent-%COMP%], span[_ngcontent-%COMP%], label[_ngcontent-%COMP%]{font-weight:500}.navb[_ngcontent-%COMP%]{width:49%}.cont[_ngcontent-%COMP%]{background-color:#fff;border-radius:10px;min-height:88vh}.cont_recto[_ngcontent-%COMP%]{border-top-left-radius:0}.cont0[_ngcontent-%COMP%]{margin:0 1em}.c10[_ngcontent-%COMP%]{width:68.5%}.c100[_ngcontent-%COMP%]{width:98%}.sensores_2_20[_ngcontent-%COMP%]{width:29%}.sensores_2_100[_ngcontent-%COMP%]{width:96%}.c20[_ngcontent-%COMP%]{width:50%}.c200[_ngcontent-%COMP%]{width:100%}.single-line[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.rev[_ngcontent-%COMP%]{flex-direction:column-reverse}.cont1[_ngcontent-%COMP%]{background-color:#fff;padding:1em;border-radius:10px;margin-bottom:1em}.cont2[_ngcontent-%COMP%]{background-color:#fff;border-radius:10px;height:max-content;margin-bottom:1em}.alt[_ngcontent-%COMP%]{height:82vh}.cont3[_ngcontent-%COMP%]{padding:0 1em 1em;background-color:#fff;border-radius:10px;height:min-content;margin-bottom:1em}.over[_ngcontent-%COMP%]{overflow-y:scroll}thead[_ngcontent-%COMP%]{background-color:#f2f2f2;border-radius:10px}.half[_ngcontent-%COMP%]{width:50%}app-devices-edit[_ngcontent-%COMP%]{display:flex}a[_ngcontent-%COMP%]{text-decoration:none;color:#000}.c1[_ngcontent-%COMP%]{height:min-content}.c2[_ngcontent-%COMP%]{padding-top:1em;height:max-content}.c3[_ngcontent-%COMP%]{height:-moz-fit-content;height:fit-content}.c4[_ngcontent-%COMP%]{padding:.8em 1em .5em;height:-moz-fit-content;height:fit-content}.c5[_ngcontent-%COMP%]{height:62vh}.c6[_ngcontent-%COMP%]{padding:1em 1em .5em}.nuevo[_ngcontent-%COMP%]{border-radius:10px;background-color:#f2f2f2;padding:1em;margin:.01em .01em 1em}.not[_ngcontent-%COMP%]{font-size:large}.tt1[_ngcontent-%COMP%]{--width: 130px;--height: calc(var(--width) / 3.5)}.tt2[_ngcontent-%COMP%]{--width: 100px;--height: calc(var(--width) / 3.3)}.toggle[_ngcontent-%COMP%]{position:relative;display:inline-block;width:var(--width);height:var(--height);box-shadow:0 1px 3px #0000004d;border-radius:var(--height);cursor:pointer}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.toggle[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;border-radius:var(--height);background-color:#dc3545;transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;width:calc(var(--height));height:calc(var(--height));border-radius:calc(var(--height) / 2);background-color:#fff;box-shadow:0 1px 3px #0000004d;transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]{background-color:#198754}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]:before{transform:translate(calc(var(--width) - var(--height)))}.toggle[_ngcontent-%COMP%]   .labels[_ngcontent-%COMP%]{position:absolute;top:8px;left:0;width:100%;height:100%;font-weight:600;transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   .labels[_ngcontent-%COMP%]:after{content:attr(data-off);position:absolute;right:25px;color:#fff;opacity:1;text-shadow:1px 1px 2px rgba(0,0,0,.4);transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   .labels[_ngcontent-%COMP%]:before{content:attr(data-on);position:absolute;left:25px;color:#fff;opacity:0;text-shadow:1px 1px 2px rgba(255,255,255,.4);transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked ~ .labels[_ngcontent-%COMP%]:after{opacity:0}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked ~ .labels[_ngcontent-%COMP%]:before{opacity:1}.mapboxgl-popup[_ngcontent-%COMP%]{max-width:400px;font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif}.t1[_ngcontent-%COMP%]{font-size:15px}.t2[_ngcontent-%COMP%]{font-size:11px}  .ng-select .ng-clear-wrapper .ng-clear{font-size:40px!important;color:#969696;right:7px;line-height:.7!important}  .ng-select .ng-clear-wrapper{height:34px;line-height:.5;width:30px!important}  .ng-value{background-color:#e3e3e3;border-radius:6px;margin-right:.5em;padding-bottom:.2em}  .ng-dropdown-panel{background-color:#f5f5f5}  .ng-option{padding:0 .7em .7em}  .ng-value-icon{font-size:22px;padding-left:.4em;padding-right:.4em}  .ng-value-label{padding-right:1em}.mapbox-popup-anchor-bottom[_ngcontent-%COMP%]{max-width:400px}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}tbody[_ngcontent-%COMP%]{max-height:600px;overflow-y:scroll}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:left;position:sticky;top:0;z-index:1}']}),t})();function Cm(e){return ri((t,i)=>{An(e).subscribe(ei(i,()=>i.complete(),Bo)),!i.closed&&t.subscribe(i)})}class zB extends Je{constructor(t,i){super()}schedule(t,i=0){return this}}const ox={setInterval(e,t,...i){const{delegate:n}=ox;return n?.setInterval?n.setInterval(e,t,...i):setInterval(e,t,...i)},clearInterval(e){const{delegate:t}=ox;return(t?.clearInterval||clearInterval)(e)},delegate:void 0};class qC extends zB{constructor(t,i){super(t,i),this.scheduler=t,this.work=i,this.pending=!1}schedule(t,i=0){var n;if(this.closed)return this;this.state=t;const o=this.id,c=this.scheduler;return null!=o&&(this.id=this.recycleAsyncId(c,o,i)),this.pending=!0,this.delay=i,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(c,this.id,i),this}requestAsyncId(t,i,n=0){return ox.setInterval(t.flush.bind(t,this),n)}recycleAsyncId(t,i,n=0){if(null!=n&&this.delay===n&&!1===this.pending)return i;null!=i&&ox.clearInterval(i)}execute(t,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const n=this._execute(t,i);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,i){let o,n=!1;try{this.work(t)}catch(c){n=!0,o=c||new Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),o}unsubscribe(){if(!this.closed){const{id:t,scheduler:i}=this,{actions:n}=i;this.work=this.state=this.scheduler=null,this.pending=!1,p(n,this),null!=t&&(this.id=this.recycleAsyncId(i,t,null)),this.delay=null,super.unsubscribe()}}}class r1{constructor(t,i=r1.now){this.schedulerActionCtor=t,this.now=i}schedule(t,i=0,n){return new this.schedulerActionCtor(this,t).schedule(n,i)}}r1.now=zC.now;class ZC extends r1{constructor(t,i=r1.now){super(t,i),this.actions=[],this._active=!1}flush(t){const{actions:i}=this;if(this._active)return void i.push(t);let n;this._active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=i.shift());if(this._active=!1,n){for(;t=i.shift();)t.unsubscribe();throw n}}}const WC=new ZC(qC),BB=WC;function $B(e,t=WC){return function VB(e){return ri((t,i)=>{let n=!1,o=null,c=null,f=!1;const y=()=>{if(c?.unsubscribe(),c=null,n){n=!1;const A=o;o=null,i.next(A)}f&&i.complete()},E=()=>{c=null,f&&i.complete()};t.subscribe(ei(i,A=>{n=!0,o=A,c||An(e(A)).subscribe(c=ei(i,y,E))},()=>{f=!0,(!n||!c||c.closed)&&i.complete()}))})}(()=>function jB(e=0,t,i=BB){let n=-1;return null!=t&&(ms(t)?i=t:n=t),new xn(o=>{let c=function UB(e){return e instanceof Date&&!isNaN(e)}(e)?+e-i.now():e;c<0&&(c=0);let f=0;return i.schedule(function(){o.closed||(o.next(f++),0<=n?this.schedule(void 0,n):o.complete())},c)})}(e,t))}const o1={schedule(e){let t=requestAnimationFrame,i=cancelAnimationFrame;const{delegate:n}=o1;n&&(t=n.requestAnimationFrame,i=n.cancelAnimationFrame);const o=t(c=>{i=void 0,e(c)});return new Je(()=>i?.(o))},requestAnimationFrame(...e){const{delegate:t}=o1;return(t?.requestAnimationFrame||requestAnimationFrame)(...e)},cancelAnimationFrame(...e){const{delegate:t}=o1;return(t?.cancelAnimationFrame||cancelAnimationFrame)(...e)},delegate:void 0},ZB=new class qB extends ZC{flush(t){this._active=!0;const i=this._scheduled;this._scheduled=void 0;const{actions:n}=this;let o;t=t||n.shift();do{if(o=t.execute(t.state,t.delay))break}while((t=n[0])&&t.id===i&&n.shift());if(this._active=!1,o){for(;(t=n[0])&&t.id===i&&n.shift();)t.unsubscribe();throw o}}}(class GB extends qC{constructor(t,i){super(t,i),this.scheduler=t,this.work=i}requestAsyncId(t,i,n=0){return null!==n&&n>0?super.requestAsyncId(t,i,n):(t.actions.push(this),t._scheduled||(t._scheduled=o1.requestAnimationFrame(()=>t.flush(void 0))))}recycleAsyncId(t,i,n=0){var o;if(null!=n?n>0:this.delay>0)return super.recycleAsyncId(t,i,n);const{actions:c}=t;null!=i&&(null===(o=c[c.length-1])||void 0===o?void 0:o.id)!==i&&(o1.cancelAnimationFrame(i),t._scheduled=void 0)}});let XC,WB=1;const sx={};function YI(e){return e in sx&&(delete sx[e],!0)}const XB={setImmediate(e){const t=WB++;return sx[t]=!0,XC||(XC=Promise.resolve()),XC.then(()=>YI(t)&&e()),t},clearImmediate(e){YI(e)}},{setImmediate:YB,clearImmediate:KB}=XB,ax={setImmediate(...e){const{delegate:t}=ax;return(t?.setImmediate||YB)(...e)},clearImmediate(e){const{delegate:t}=ax;return(t?.clearImmediate||KB)(e)},delegate:void 0},e8=new class QB extends ZC{flush(t){this._active=!0;const i=this._scheduled;this._scheduled=void 0;const{actions:n}=this;let o;t=t||n.shift();do{if(o=t.execute(t.state,t.delay))break}while((t=n[0])&&t.id===i&&n.shift());if(this._active=!1,o){for(;(t=n[0])&&t.id===i&&n.shift();)t.unsubscribe();throw o}}}(class JB extends qC{constructor(t,i){super(t,i),this.scheduler=t,this.work=i}requestAsyncId(t,i,n=0){return null!==n&&n>0?super.requestAsyncId(t,i,n):(t.actions.push(this),t._scheduled||(t._scheduled=ax.setImmediate(t.flush.bind(t,void 0))))}recycleAsyncId(t,i,n=0){var o;if(null!=n?n>0:this.delay>0)return super.recycleAsyncId(t,i,n);const{actions:c}=t;null!=i&&(null===(o=c[c.length-1])||void 0===o?void 0:o.id)!==i&&(ax.clearImmediate(i),t._scheduled===i&&(t._scheduled=void 0))}}),t8=["addListener","removeListener"],n8=["addEventListener","removeEventListener"],i8=["on","off"];function Mm(e,t,i,n){if(Rn(i)&&(n=i,i=void 0),n)return Mm(e,t,i).pipe($w(n));const[o,c]=function s8(e){return Rn(e.addEventListener)&&Rn(e.removeEventListener)}(e)?n8.map(f=>y=>e[f](t,y,i)):function r8(e){return Rn(e.addListener)&&Rn(e.removeListener)}(e)?t8.map(KI(e,t)):function o8(e){return Rn(e.on)&&Rn(e.off)}(e)?i8.map(KI(e,t)):[];if(!o&&ze(e))return Ji(f=>Mm(f,t,i))(An(e));if(!o)throw new TypeError("Invalid event target");return new xn(f=>{const y=(...E)=>f.next(1<E.length?E:E[0]);return o(y),()=>c(y)})}function KI(e,t){return i=>n=>e[i](t,n)}const a8=["content"],l8=["scroll"],c8=["padding"],s1=function(e){return{searchTerm:e}};function u8(e,t){if(1&e&&(L(0,"div",6),G0(1,7),P()),2&e){const i=q();w(1),U("ngTemplateOutlet",i.headerTemplate)("ngTemplateOutletContext",ft(2,s1,i.filterValue))}}function d8(e,t){if(1&e&&(L(0,"div",8),G0(1,7),P()),2&e){const i=q();w(1),U("ngTemplateOutlet",i.footerTemplate)("ngTemplateOutletContext",ft(2,s1,i.filterValue))}}const JI=["*"],h8=["searchInput"];function p8(e,t){if(1&e){const i=Ke();L(0,"span",15),ye("click",function(){ce(i);const o=q().$implicit;return le(q(2).unselect(o))}),W(1,"\xd7"),P(),He(2,"span",16)}if(2&e){const i=q().$implicit,n=q(2);w(2),U("ngItemLabel",i.label)("escape",n.escapeHTML)}}function f8(e,t){}const g8=function(e,t,i){return{item:e,clear:t,label:i}};function m8(e,t){if(1&e&&(L(0,"div",12),J(1,p8,3,2,"ng-template",null,13,Yd),J(3,f8,0,0,"ng-template",14),P()),2&e){const i=t.$implicit,n=Vt(2),o=q(2);ka("ng-value-disabled",i.disabled),w(3),U("ngTemplateOutlet",o.labelTemplate||n)("ngTemplateOutletContext",rE(4,g8,i.value,o.clearItem,i.label))}}function _8(e,t){if(1&e&&(na(0),J(1,m8,4,8,"div",11),ia()),2&e){const i=q();w(1),U("ngForOf",i.selectedItems)("ngForTrackBy",i.trackByOption)}}function v8(e,t){}const y8=function(e,t){return{items:e,clear:t}};function x8(e,t){if(1&e&&J(0,v8,0,0,"ng-template",14),2&e){const i=q();U("ngTemplateOutlet",i.multiLabelTemplate)("ngTemplateOutletContext",Ap(2,y8,i.selectedValues,i.clearItem))}}function b8(e,t){1&e&&He(0,"div",19)}function w8(e,t){}function C8(e,t){if(1&e&&(na(0),J(1,b8,1,0,"ng-template",null,17,Yd),J(3,w8,0,0,"ng-template",18),ia()),2&e){const i=Vt(2),n=q();w(3),U("ngTemplateOutlet",n.loadingSpinnerTemplate||i)}}function M8(e,t){1&e&&(L(0,"span",20)(1,"span",21),W(2,"\xd7"),P()()),2&e&&vn("title",q().clearAllText)}function E8(e,t){if(1&e&&He(0,"span",27),2&e){const i=q().$implicit,n=q(2);U("ngItemLabel",i.label)("escape",n.escapeHTML)}}function T8(e,t){}const D8=function(e,t,i,n){return{item:e,item$:t,index:i,searchTerm:n}};function S8(e,t){if(1&e){const i=Ke();L(0,"div",25),ye("click",function(){const c=ce(i).$implicit;return le(q(2).toggleItem(c))})("mouseover",function(){const c=ce(i).$implicit;return le(q(2).onItemHover(c))}),J(1,E8,1,2,"ng-template",null,26,Yd),J(3,T8,0,0,"ng-template",14),P()}if(2&e){const i=t.$implicit,n=Vt(2),o=q(2);ka("ng-option-disabled",i.disabled)("ng-option-selected",i.selected)("ng-optgroup",i.children)("ng-option",!i.children)("ng-option-child",!!i.parent)("ng-option-marked",i===o.itemsList.markedItem),Fo("role",i.children?"group":"option")("aria-selected",i.selected)("id",null==i?null:i.htmlId),w(3),U("ngTemplateOutlet",i.children?o.optgroupTemplate||n:o.optionTemplate||n)("ngTemplateOutletContext",oE(17,D8,i.value,i,i.index,o.searchTerm))}}function I8(e,t){if(1&e&&(L(0,"span")(1,"span",30),W(2),P(),W(3),P()),2&e){const i=q(3);w(2),Ce(i.addTagText),w(1),jt('"',i.searchTerm,'"')}}function A8(e,t){}function P8(e,t){if(1&e){const i=Ke();L(0,"div",28),ye("mouseover",function(){return ce(i),le(q(2).itemsList.unmarkItem())})("click",function(){return ce(i),le(q(2).selectTag())}),J(1,I8,4,2,"ng-template",null,29,Yd),J(3,A8,0,0,"ng-template",14),P()}if(2&e){const i=Vt(2),n=q(2);ka("ng-option-marked",!n.itemsList.markedItem),w(3),U("ngTemplateOutlet",n.tagTemplate||i)("ngTemplateOutletContext",ft(4,s1,n.searchTerm))}}function k8(e,t){if(1&e&&(L(0,"div",32),W(1),P()),2&e){const i=q(3);w(1),Ce(i.notFoundText)}}function O8(e,t){}function L8(e,t){if(1&e&&(na(0),J(1,k8,2,1,"ng-template",null,31,Yd),J(3,O8,0,0,"ng-template",14),ia()),2&e){const i=Vt(2),n=q(2);w(3),U("ngTemplateOutlet",n.notFoundTemplate||i)("ngTemplateOutletContext",ft(2,s1,n.searchTerm))}}function R8(e,t){if(1&e&&(L(0,"div",32),W(1),P()),2&e){const i=q(3);w(1),Ce(i.typeToSearchText)}}function F8(e,t){}function N8(e,t){if(1&e&&(na(0),J(1,R8,2,1,"ng-template",null,33,Yd),J(3,F8,0,0,"ng-template",18),ia()),2&e){const i=Vt(2),n=q(2);w(3),U("ngTemplateOutlet",n.typeToSearchTemplate||i)}}function z8(e,t){if(1&e&&(L(0,"div",32),W(1),P()),2&e){const i=q(3);w(1),Ce(i.loadingText)}}function B8(e,t){}function V8(e,t){if(1&e&&(na(0),J(1,z8,2,1,"ng-template",null,34,Yd),J(3,B8,0,0,"ng-template",14),ia()),2&e){const i=Vt(2),n=q(2);w(3),U("ngTemplateOutlet",n.loadingTextTemplate||i)("ngTemplateOutletContext",ft(2,s1,n.searchTerm))}}function U8(e,t){if(1&e){const i=Ke();L(0,"ng-dropdown-panel",22),ye("update",function(o){return ce(i),le(q().viewPortItems=o)})("scroll",function(o){return ce(i),le(q().scroll.emit(o))})("scrollToEnd",function(o){return ce(i),le(q().scrollToEnd.emit(o))})("outsideClick",function(){return ce(i),le(q().close())}),na(1),J(2,S8,4,22,"div",23),J(3,P8,4,6,"div",24),ia(),J(4,L8,4,4,"ng-container",3),J(5,N8,4,1,"ng-container",3),J(6,V8,4,4,"ng-container",3),P()}if(2&e){const i=q();ka("ng-select-multiple",i.multiple),U("virtualScroll",i.virtualScroll)("bufferAmount",i.bufferAmount)("appendTo",i.appendTo)("position",i.dropdownPosition)("headerTemplate",i.headerTemplate)("footerTemplate",i.footerTemplate)("filterValue",i.searchTerm)("items",i.itemsList.filteredItems)("markedItem",i.itemsList.markedItem)("ngClass",i.appendTo?i.classes:null)("id",i.dropdownId),w(2),U("ngForOf",i.viewPortItems)("ngForTrackBy",i.trackByOption),w(1),U("ngIf",i.showAddTag),w(1),U("ngIf",i.showNoItemsFound()),w(1),U("ngIf",i.showTypeToSearch()),w(1),U("ngIf",i.loading&&0===i.itemsList.filteredItems.length)}}const QI=/[&<>"']/g,j8=RegExp(QI.source),$8={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function fr(e){return null!=e}function a1(e){return"object"==typeof e&&fr(e)}function lx(e){return e instanceof Function}let q8=(()=>{var e;class t{constructor(n){this.element=n,this.escape=!0}ngOnChanges(n){this.element.nativeElement.innerHTML=this.escape?function H8(e){return e&&j8.test(e)?e.replace(QI,t=>$8[t]):e}(this.ngItemLabel):this.ngItemLabel}}return(e=t).\u0275fac=function(n){return new(n||e)(G(Bi))},e.\u0275dir=mt({type:e,selectors:[["","ngItemLabel",""]],inputs:{ngItemLabel:"ngItemLabel",escape:"escape"},features:[Ee]}),t})(),Z8=(()=>{var e;class t{constructor(n){this.template=n}}return(e=t).\u0275fac=function(n){return new(n||e)(G(li))},e.\u0275dir=mt({type:e,selectors:[["","ng-option-tmp",""]]}),t})(),W8=(()=>{var e;class t{constructor(n){this.template=n}}return(e=t).\u0275fac=function(n){return new(n||e)(G(li))},e.\u0275dir=mt({type:e,selectors:[["","ng-optgroup-tmp",""]]}),t})(),X8=(()=>{var e;class t{constructor(n){this.template=n}}return(e=t).\u0275fac=function(n){return new(n||e)(G(li))},e.\u0275dir=mt({type:e,selectors:[["","ng-label-tmp",""]]}),t})(),Y8=(()=>{var e;class t{constructor(n){this.template=n}}return(e=t).\u0275fac=function(n){return new(n||e)(G(li))},e.\u0275dir=mt({type:e,selectors:[["","ng-multi-label-tmp",""]]}),t})(),K8=(()=>{var e;class t{constructor(n){this.template=n}}return(e=t).\u0275fac=function(n){return new(n||e)(G(li))},e.\u0275dir=mt({type:e,selectors:[["","ng-header-tmp",""]]}),t})(),J8=(()=>{var e;class t{constructor(n){this.template=n}}return(e=t).\u0275fac=function(n){return new(n||e)(G(li))},e.\u0275dir=mt({type:e,selectors:[["","ng-footer-tmp",""]]}),t})(),Q8=(()=>{var e;class t{constructor(n){this.template=n}}return(e=t).\u0275fac=function(n){return new(n||e)(G(li))},e.\u0275dir=mt({type:e,selectors:[["","ng-notfound-tmp",""]]}),t})(),eV=(()=>{var e;class t{constructor(n){this.template=n}}return(e=t).\u0275fac=function(n){return new(n||e)(G(li))},e.\u0275dir=mt({type:e,selectors:[["","ng-typetosearch-tmp",""]]}),t})(),tV=(()=>{var e;class t{constructor(n){this.template=n}}return(e=t).\u0275fac=function(n){return new(n||e)(G(li))},e.\u0275dir=mt({type:e,selectors:[["","ng-loadingtext-tmp",""]]}),t})(),nV=(()=>{var e;class t{constructor(n){this.template=n}}return(e=t).\u0275fac=function(n){return new(n||e)(G(li))},e.\u0275dir=mt({type:e,selectors:[["","ng-tag-tmp",""]]}),t})(),iV=(()=>{var e;class t{constructor(n){this.template=n}}return(e=t).\u0275fac=function(n){return new(n||e)(G(li))},e.\u0275dir=mt({type:e,selectors:[["","ng-loadingspinner-tmp",""]]}),t})();function eA(){return"axxxxxxxxxxx".replace(/[x]/g,()=>(16*Math.random()|0).toString(16))}const rV={"\u24b6":"A",\uff21:"A",\u00c0:"A",\u00c1:"A",\u00c2:"A",\u1ea6:"A",\u1ea4:"A",\u1eaa:"A",\u1ea8:"A",\u00c3:"A",\u0100:"A",\u0102:"A",\u1eb0:"A",\u1eae:"A",\u1eb4:"A",\u1eb2:"A",\u0226:"A",\u01e0:"A",\u00c4:"A",\u01de:"A",\u1ea2:"A",\u00c5:"A",\u01fa:"A",\u01cd:"A",\u0200:"A",\u0202:"A",\u1ea0:"A",\u1eac:"A",\u1eb6:"A",\u1e00:"A",\u0104:"A",\u023a:"A",\u2c6f:"A",\ua732:"AA",\u00c6:"AE",\u01fc:"AE",\u01e2:"AE",\ua734:"AO",\ua736:"AU",\ua738:"AV",\ua73a:"AV",\ua73c:"AY","\u24b7":"B",\uff22:"B",\u1e02:"B",\u1e04:"B",\u1e06:"B",\u0243:"B",\u0182:"B",\u0181:"B","\u24b8":"C",\uff23:"C",\u0106:"C",\u0108:"C",\u010a:"C",\u010c:"C",\u00c7:"C",\u1e08:"C",\u0187:"C",\u023b:"C",\ua73e:"C","\u24b9":"D",\uff24:"D",\u1e0a:"D",\u010e:"D",\u1e0c:"D",\u1e10:"D",\u1e12:"D",\u1e0e:"D",\u0110:"D",\u018b:"D",\u018a:"D",\u0189:"D",\ua779:"D",\u01f1:"DZ",\u01c4:"DZ",\u01f2:"Dz",\u01c5:"Dz","\u24ba":"E",\uff25:"E",\u00c8:"E",\u00c9:"E",\u00ca:"E",\u1ec0:"E",\u1ebe:"E",\u1ec4:"E",\u1ec2:"E",\u1ebc:"E",\u0112:"E",\u1e14:"E",\u1e16:"E",\u0114:"E",\u0116:"E",\u00cb:"E",\u1eba:"E",\u011a:"E",\u0204:"E",\u0206:"E",\u1eb8:"E",\u1ec6:"E",\u0228:"E",\u1e1c:"E",\u0118:"E",\u1e18:"E",\u1e1a:"E",\u0190:"E",\u018e:"E","\u24bb":"F",\uff26:"F",\u1e1e:"F",\u0191:"F",\ua77b:"F","\u24bc":"G",\uff27:"G",\u01f4:"G",\u011c:"G",\u1e20:"G",\u011e:"G",\u0120:"G",\u01e6:"G",\u0122:"G",\u01e4:"G",\u0193:"G",\ua7a0:"G",\ua77d:"G",\ua77e:"G","\u24bd":"H",\uff28:"H",\u0124:"H",\u1e22:"H",\u1e26:"H",\u021e:"H",\u1e24:"H",\u1e28:"H",\u1e2a:"H",\u0126:"H",\u2c67:"H",\u2c75:"H",\ua78d:"H","\u24be":"I",\uff29:"I",\u00cc:"I",\u00cd:"I",\u00ce:"I",\u0128:"I",\u012a:"I",\u012c:"I",\u0130:"I",\u00cf:"I",\u1e2e:"I",\u1ec8:"I",\u01cf:"I",\u0208:"I",\u020a:"I",\u1eca:"I",\u012e:"I",\u1e2c:"I",\u0197:"I","\u24bf":"J",\uff2a:"J",\u0134:"J",\u0248:"J","\u24c0":"K",\uff2b:"K",\u1e30:"K",\u01e8:"K",\u1e32:"K",\u0136:"K",\u1e34:"K",\u0198:"K",\u2c69:"K",\ua740:"K",\ua742:"K",\ua744:"K",\ua7a2:"K","\u24c1":"L",\uff2c:"L",\u013f:"L",\u0139:"L",\u013d:"L",\u1e36:"L",\u1e38:"L",\u013b:"L",\u1e3c:"L",\u1e3a:"L",\u0141:"L",\u023d:"L",\u2c62:"L",\u2c60:"L",\ua748:"L",\ua746:"L",\ua780:"L",\u01c7:"LJ",\u01c8:"Lj","\u24c2":"M",\uff2d:"M",\u1e3e:"M",\u1e40:"M",\u1e42:"M",\u2c6e:"M",\u019c:"M","\u24c3":"N",\uff2e:"N",\u01f8:"N",\u0143:"N",\u00d1:"N",\u1e44:"N",\u0147:"N",\u1e46:"N",\u0145:"N",\u1e4a:"N",\u1e48:"N",\u0220:"N",\u019d:"N",\ua790:"N",\ua7a4:"N",\u01ca:"NJ",\u01cb:"Nj","\u24c4":"O",\uff2f:"O",\u00d2:"O",\u00d3:"O",\u00d4:"O",\u1ed2:"O",\u1ed0:"O",\u1ed6:"O",\u1ed4:"O",\u00d5:"O",\u1e4c:"O",\u022c:"O",\u1e4e:"O",\u014c:"O",\u1e50:"O",\u1e52:"O",\u014e:"O",\u022e:"O",\u0230:"O",\u00d6:"O",\u022a:"O",\u1ece:"O",\u0150:"O",\u01d1:"O",\u020c:"O",\u020e:"O",\u01a0:"O",\u1edc:"O",\u1eda:"O",\u1ee0:"O",\u1ede:"O",\u1ee2:"O",\u1ecc:"O",\u1ed8:"O",\u01ea:"O",\u01ec:"O",\u00d8:"O",\u01fe:"O",\u0186:"O",\u019f:"O",\ua74a:"O",\ua74c:"O",\u01a2:"OI",\ua74e:"OO",\u0222:"OU","\u24c5":"P",\uff30:"P",\u1e54:"P",\u1e56:"P",\u01a4:"P",\u2c63:"P",\ua750:"P",\ua752:"P",\ua754:"P","\u24c6":"Q",\uff31:"Q",\ua756:"Q",\ua758:"Q",\u024a:"Q","\u24c7":"R",\uff32:"R",\u0154:"R",\u1e58:"R",\u0158:"R",\u0210:"R",\u0212:"R",\u1e5a:"R",\u1e5c:"R",\u0156:"R",\u1e5e:"R",\u024c:"R",\u2c64:"R",\ua75a:"R",\ua7a6:"R",\ua782:"R","\u24c8":"S",\uff33:"S",\u1e9e:"S",\u015a:"S",\u1e64:"S",\u015c:"S",\u1e60:"S",\u0160:"S",\u1e66:"S",\u1e62:"S",\u1e68:"S",\u0218:"S",\u015e:"S",\u2c7e:"S",\ua7a8:"S",\ua784:"S","\u24c9":"T",\uff34:"T",\u1e6a:"T",\u0164:"T",\u1e6c:"T",\u021a:"T",\u0162:"T",\u1e70:"T",\u1e6e:"T",\u0166:"T",\u01ac:"T",\u01ae:"T",\u023e:"T",\ua786:"T",\ua728:"TZ","\u24ca":"U",\uff35:"U",\u00d9:"U",\u00da:"U",\u00db:"U",\u0168:"U",\u1e78:"U",\u016a:"U",\u1e7a:"U",\u016c:"U",\u00dc:"U",\u01db:"U",\u01d7:"U",\u01d5:"U",\u01d9:"U",\u1ee6:"U",\u016e:"U",\u0170:"U",\u01d3:"U",\u0214:"U",\u0216:"U",\u01af:"U",\u1eea:"U",\u1ee8:"U",\u1eee:"U",\u1eec:"U",\u1ef0:"U",\u1ee4:"U",\u1e72:"U",\u0172:"U",\u1e76:"U",\u1e74:"U",\u0244:"U","\u24cb":"V",\uff36:"V",\u1e7c:"V",\u1e7e:"V",\u01b2:"V",\ua75e:"V",\u0245:"V",\ua760:"VY","\u24cc":"W",\uff37:"W",\u1e80:"W",\u1e82:"W",\u0174:"W",\u1e86:"W",\u1e84:"W",\u1e88:"W",\u2c72:"W","\u24cd":"X",\uff38:"X",\u1e8a:"X",\u1e8c:"X","\u24ce":"Y",\uff39:"Y",\u1ef2:"Y",\u00dd:"Y",\u0176:"Y",\u1ef8:"Y",\u0232:"Y",\u1e8e:"Y",\u0178:"Y",\u1ef6:"Y",\u1ef4:"Y",\u01b3:"Y",\u024e:"Y",\u1efe:"Y","\u24cf":"Z",\uff3a:"Z",\u0179:"Z",\u1e90:"Z",\u017b:"Z",\u017d:"Z",\u1e92:"Z",\u1e94:"Z",\u01b5:"Z",\u0224:"Z",\u2c7f:"Z",\u2c6b:"Z",\ua762:"Z","\u24d0":"a",\uff41:"a",\u1e9a:"a",\u00e0:"a",\u00e1:"a",\u00e2:"a",\u1ea7:"a",\u1ea5:"a",\u1eab:"a",\u1ea9:"a",\u00e3:"a",\u0101:"a",\u0103:"a",\u1eb1:"a",\u1eaf:"a",\u1eb5:"a",\u1eb3:"a",\u0227:"a",\u01e1:"a",\u00e4:"a",\u01df:"a",\u1ea3:"a",\u00e5:"a",\u01fb:"a",\u01ce:"a",\u0201:"a",\u0203:"a",\u1ea1:"a",\u1ead:"a",\u1eb7:"a",\u1e01:"a",\u0105:"a",\u2c65:"a",\u0250:"a",\ua733:"aa",\u00e6:"ae",\u01fd:"ae",\u01e3:"ae",\ua735:"ao",\ua737:"au",\ua739:"av",\ua73b:"av",\ua73d:"ay","\u24d1":"b",\uff42:"b",\u1e03:"b",\u1e05:"b",\u1e07:"b",\u0180:"b",\u0183:"b",\u0253:"b","\u24d2":"c",\uff43:"c",\u0107:"c",\u0109:"c",\u010b:"c",\u010d:"c",\u00e7:"c",\u1e09:"c",\u0188:"c",\u023c:"c",\ua73f:"c",\u2184:"c","\u24d3":"d",\uff44:"d",\u1e0b:"d",\u010f:"d",\u1e0d:"d",\u1e11:"d",\u1e13:"d",\u1e0f:"d",\u0111:"d",\u018c:"d",\u0256:"d",\u0257:"d",\ua77a:"d",\u01f3:"dz",\u01c6:"dz","\u24d4":"e",\uff45:"e",\u00e8:"e",\u00e9:"e",\u00ea:"e",\u1ec1:"e",\u1ebf:"e",\u1ec5:"e",\u1ec3:"e",\u1ebd:"e",\u0113:"e",\u1e15:"e",\u1e17:"e",\u0115:"e",\u0117:"e",\u00eb:"e",\u1ebb:"e",\u011b:"e",\u0205:"e",\u0207:"e",\u1eb9:"e",\u1ec7:"e",\u0229:"e",\u1e1d:"e",\u0119:"e",\u1e19:"e",\u1e1b:"e",\u0247:"e",\u025b:"e",\u01dd:"e","\u24d5":"f",\uff46:"f",\u1e1f:"f",\u0192:"f",\ua77c:"f","\u24d6":"g",\uff47:"g",\u01f5:"g",\u011d:"g",\u1e21:"g",\u011f:"g",\u0121:"g",\u01e7:"g",\u0123:"g",\u01e5:"g",\u0260:"g",\ua7a1:"g",\u1d79:"g",\ua77f:"g","\u24d7":"h",\uff48:"h",\u0125:"h",\u1e23:"h",\u1e27:"h",\u021f:"h",\u1e25:"h",\u1e29:"h",\u1e2b:"h",\u1e96:"h",\u0127:"h",\u2c68:"h",\u2c76:"h",\u0265:"h",\u0195:"hv","\u24d8":"i",\uff49:"i",\u00ec:"i",\u00ed:"i",\u00ee:"i",\u0129:"i",\u012b:"i",\u012d:"i",\u00ef:"i",\u1e2f:"i",\u1ec9:"i",\u01d0:"i",\u0209:"i",\u020b:"i",\u1ecb:"i",\u012f:"i",\u1e2d:"i",\u0268:"i",\u0131:"i","\u24d9":"j",\uff4a:"j",\u0135:"j",\u01f0:"j",\u0249:"j","\u24da":"k",\uff4b:"k",\u1e31:"k",\u01e9:"k",\u1e33:"k",\u0137:"k",\u1e35:"k",\u0199:"k",\u2c6a:"k",\ua741:"k",\ua743:"k",\ua745:"k",\ua7a3:"k","\u24db":"l",\uff4c:"l",\u0140:"l",\u013a:"l",\u013e:"l",\u1e37:"l",\u1e39:"l",\u013c:"l",\u1e3d:"l",\u1e3b:"l",\u017f:"l",\u0142:"l",\u019a:"l",\u026b:"l",\u2c61:"l",\ua749:"l",\ua781:"l",\ua747:"l",\u01c9:"lj","\u24dc":"m",\uff4d:"m",\u1e3f:"m",\u1e41:"m",\u1e43:"m",\u0271:"m",\u026f:"m","\u24dd":"n",\uff4e:"n",\u01f9:"n",\u0144:"n",\u00f1:"n",\u1e45:"n",\u0148:"n",\u1e47:"n",\u0146:"n",\u1e4b:"n",\u1e49:"n",\u019e:"n",\u0272:"n",\u0149:"n",\ua791:"n",\ua7a5:"n",\u01cc:"nj","\u24de":"o",\uff4f:"o",\u00f2:"o",\u00f3:"o",\u00f4:"o",\u1ed3:"o",\u1ed1:"o",\u1ed7:"o",\u1ed5:"o",\u00f5:"o",\u1e4d:"o",\u022d:"o",\u1e4f:"o",\u014d:"o",\u1e51:"o",\u1e53:"o",\u014f:"o",\u022f:"o",\u0231:"o",\u00f6:"o",\u022b:"o",\u1ecf:"o",\u0151:"o",\u01d2:"o",\u020d:"o",\u020f:"o",\u01a1:"o",\u1edd:"o",\u1edb:"o",\u1ee1:"o",\u1edf:"o",\u1ee3:"o",\u1ecd:"o",\u1ed9:"o",\u01eb:"o",\u01ed:"o",\u00f8:"o",\u01ff:"o",\u0254:"o",\ua74b:"o",\ua74d:"o",\u0275:"o",\u01a3:"oi",\u0223:"ou",\ua74f:"oo","\u24df":"p",\uff50:"p",\u1e55:"p",\u1e57:"p",\u01a5:"p",\u1d7d:"p",\ua751:"p",\ua753:"p",\ua755:"p","\u24e0":"q",\uff51:"q",\u024b:"q",\ua757:"q",\ua759:"q","\u24e1":"r",\uff52:"r",\u0155:"r",\u1e59:"r",\u0159:"r",\u0211:"r",\u0213:"r",\u1e5b:"r",\u1e5d:"r",\u0157:"r",\u1e5f:"r",\u024d:"r",\u027d:"r",\ua75b:"r",\ua7a7:"r",\ua783:"r","\u24e2":"s",\uff53:"s",\u00df:"s",\u015b:"s",\u1e65:"s",\u015d:"s",\u1e61:"s",\u0161:"s",\u1e67:"s",\u1e63:"s",\u1e69:"s",\u0219:"s",\u015f:"s",\u023f:"s",\ua7a9:"s",\ua785:"s",\u1e9b:"s","\u24e3":"t",\uff54:"t",\u1e6b:"t",\u1e97:"t",\u0165:"t",\u1e6d:"t",\u021b:"t",\u0163:"t",\u1e71:"t",\u1e6f:"t",\u0167:"t",\u01ad:"t",\u0288:"t",\u2c66:"t",\ua787:"t",\ua729:"tz","\u24e4":"u",\uff55:"u",\u00f9:"u",\u00fa:"u",\u00fb:"u",\u0169:"u",\u1e79:"u",\u016b:"u",\u1e7b:"u",\u016d:"u",\u00fc:"u",\u01dc:"u",\u01d8:"u",\u01d6:"u",\u01da:"u",\u1ee7:"u",\u016f:"u",\u0171:"u",\u01d4:"u",\u0215:"u",\u0217:"u",\u01b0:"u",\u1eeb:"u",\u1ee9:"u",\u1eef:"u",\u1eed:"u",\u1ef1:"u",\u1ee5:"u",\u1e73:"u",\u0173:"u",\u1e77:"u",\u1e75:"u",\u0289:"u","\u24e5":"v",\uff56:"v",\u1e7d:"v",\u1e7f:"v",\u028b:"v",\ua75f:"v",\u028c:"v",\ua761:"vy","\u24e6":"w",\uff57:"w",\u1e81:"w",\u1e83:"w",\u0175:"w",\u1e87:"w",\u1e85:"w",\u1e98:"w",\u1e89:"w",\u2c73:"w","\u24e7":"x",\uff58:"x",\u1e8b:"x",\u1e8d:"x","\u24e8":"y",\uff59:"y",\u1ef3:"y",\u00fd:"y",\u0177:"y",\u1ef9:"y",\u0233:"y",\u1e8f:"y",\u00ff:"y",\u1ef7:"y",\u1e99:"y",\u1ef5:"y",\u01b4:"y",\u024f:"y",\u1eff:"y","\u24e9":"z",\uff5a:"z",\u017a:"z",\u1e91:"z",\u017c:"z",\u017e:"z",\u1e93:"z",\u1e95:"z",\u01b6:"z",\u0225:"z",\u0240:"z",\u2c6c:"z",\ua763:"z",\u0386:"\u0391",\u0388:"\u0395",\u0389:"\u0397",\u038a:"\u0399",\u03aa:"\u0399",\u038c:"\u039f",\u038e:"\u03a5",\u03ab:"\u03a5",\u038f:"\u03a9",\u03ac:"\u03b1",\u03ad:"\u03b5",\u03ae:"\u03b7",\u03af:"\u03b9",\u03ca:"\u03b9",\u0390:"\u03b9",\u03cc:"\u03bf",\u03cd:"\u03c5",\u03cb:"\u03c5",\u03b0:"\u03c5",\u03c9:"\u03c9",\u03c2:"\u03c3"};function cx(e){return e.replace(/[^\u0000-\u007E]/g,i=>rV[i]||i)}class oV{constructor(t,i){this._ngSelect=t,this._selectionModel=i,this._items=[],this._filteredItems=[],this._markedIndex=-1}get items(){return this._items}get filteredItems(){return this._filteredItems}get markedIndex(){return this._markedIndex}get selectedItems(){return this._selectionModel.value}get markedItem(){return this._filteredItems[this._markedIndex]}get noItemsToSelect(){return this._ngSelect.hideSelected&&this._items.length===this.selectedItems.length}get maxItemsSelected(){return this._ngSelect.multiple&&this._ngSelect.maxSelectedItems<=this.selectedItems.length}get lastSelectedItem(){let t=this.selectedItems.length-1;for(;t>=0;t--){const i=this.selectedItems[t];if(!i.disabled)return i}return null}setItems(t){this._items=t.map((i,n)=>this.mapItem(i,n)),this._ngSelect.groupBy?(this._groups=this._groupBy(this._items,this._ngSelect.groupBy),this._items=this._flatten(this._groups)):(this._groups=new Map,this._groups.set(void 0,this._items)),this._filteredItems=[...this._items]}select(t){if(t.selected||this.maxItemsSelected)return;const i=this._ngSelect.multiple;i||this.clearSelected(),this._selectionModel.select(t,i,this._ngSelect.selectableGroupAsModel),this._ngSelect.hideSelected&&this._hideSelected(t)}unselect(t){t.selected&&(this._selectionModel.unselect(t,this._ngSelect.multiple),this._ngSelect.hideSelected&&fr(t.index)&&this._ngSelect.multiple&&this._showSelected(t))}findItem(t){let i;return i=this._ngSelect.compareWith?n=>this._ngSelect.compareWith(n.value,t):this._ngSelect.bindValue?n=>!n.children&&this.resolveNested(n.value,this._ngSelect.bindValue)===t:n=>n.value===t||!n.children&&n.label&&n.label===this.resolveNested(t,this._ngSelect.bindLabel),this._items.find(n=>i(n))}addItem(t){const i=this.mapItem(t,this._items.length);return this._items.push(i),this._filteredItems.push(i),i}clearSelected(t=!1){this._selectionModel.clear(t),this._items.forEach(i=>{i.selected=t&&i.selected&&i.disabled,i.marked=!1}),this._ngSelect.hideSelected&&this.resetFilteredItems()}findByLabel(t){return t=cx(t).toLocaleLowerCase(),this.filteredItems.find(i=>cx(i.label).toLocaleLowerCase().substr(0,t.length)===t)}filter(t){if(!t)return void this.resetFilteredItems();this._filteredItems=[],t=this._ngSelect.searchFn?t:cx(t).toLocaleLowerCase();const i=this._ngSelect.searchFn||this._defaultSearchFn,n=this._ngSelect.hideSelected;for(const o of Array.from(this._groups.keys())){const c=[];for(const f of this._groups.get(o))n&&(f.parent&&f.parent.selected||f.selected)||i(t,this._ngSelect.searchFn?f.value:f)&&c.push(f);if(c.length>0){const[f]=c.slice(-1);if(f.parent){const y=this._items.find(E=>E===f.parent);this._filteredItems.push(y)}this._filteredItems.push(...c)}}}resetFilteredItems(){this._filteredItems.length!==this._items.length&&(this._filteredItems=this._ngSelect.hideSelected&&this.selectedItems.length>0?this._items.filter(t=>!t.selected):this._items)}unmarkItem(){this._markedIndex=-1}markNextItem(){this._stepToItem(1)}markPreviousItem(){this._stepToItem(-1)}markItem(t){this._markedIndex=this._filteredItems.indexOf(t)}markSelectedOrDefault(t){if(0===this._filteredItems.length)return;const i=this._getLastMarkedIndex();this._markedIndex=i>-1?i:t?this.filteredItems.findIndex(n=>!n.disabled):-1}resolveNested(t,i){if(!a1(t))return t;if(-1===i.indexOf("."))return t[i];{const n=i.split(".");let o=t;for(let c=0,f=n.length;c<f;++c){if(null==o)return null;o=o[n[c]]}return o}}mapItem(t,i){const n=fr(t.$ngOptionLabel)?t.$ngOptionLabel:this.resolveNested(t,this._ngSelect.bindLabel),o=fr(t.$ngOptionValue)?t.$ngOptionValue:t;return{index:i,label:fr(n)?n.toString():"",value:o,disabled:t.disabled,htmlId:`${this._ngSelect.dropdownId}-${i}`}}mapSelectedItems(){const t=this._ngSelect.multiple;for(const i of this.selectedItems){const n=this._ngSelect.bindValue?this.resolveNested(i.value,this._ngSelect.bindValue):i.value,o=fr(n)?this.findItem(n):null;this._selectionModel.unselect(i,t),this._selectionModel.select(o||i,t,this._ngSelect.selectableGroupAsModel)}this._ngSelect.hideSelected&&(this._filteredItems=this.filteredItems.filter(i=>-1===this.selectedItems.indexOf(i)))}_showSelected(t){if(this._filteredItems.push(t),t.parent){const i=t.parent;this._filteredItems.find(o=>o===i)||this._filteredItems.push(i)}else if(t.children)for(const i of t.children)i.selected=!1,this._filteredItems.push(i);this._filteredItems=[...this._filteredItems.sort((i,n)=>i.index-n.index)]}_hideSelected(t){this._filteredItems=this._filteredItems.filter(i=>i!==t),t.parent?t.parent.children.every(n=>n.selected)&&(this._filteredItems=this._filteredItems.filter(n=>n!==t.parent)):t.children&&(this._filteredItems=this.filteredItems.filter(i=>i.parent!==t))}_defaultSearchFn(t,i){return cx(i.label).toLocaleLowerCase().indexOf(t)>-1}_getNextItemIndex(t){return t>0?this._markedIndex>=this._filteredItems.length-1?0:this._markedIndex+1:this._markedIndex<=0?this._filteredItems.length-1:this._markedIndex-1}_stepToItem(t){0===this._filteredItems.length||this._filteredItems.every(i=>i.disabled)||(this._markedIndex=this._getNextItemIndex(t),this.markedItem.disabled&&this._stepToItem(t))}_getLastMarkedIndex(){if(this._ngSelect.hideSelected||this._markedIndex>-1&&void 0===this.markedItem)return-1;const t=this._filteredItems.indexOf(this.lastSelectedItem);return this.lastSelectedItem&&t<0?-1:Math.max(this.markedIndex,t)}_groupBy(t,i){const n=new Map;if(0===t.length)return n;if(Array.isArray(t[0].value[i])){for(const f of t){const y=(f.value[i]||[]).map((E,A)=>this.mapItem(E,A));n.set(f,y)}return n}const o=lx(this._ngSelect.groupBy),c=f=>{const y=o?i(f.value):f.value[i];return fr(y)?y:void 0};for(const f of t){const y=c(f),E=n.get(y);E?E.push(f):n.set(y,[f])}return n}_flatten(t){const i=lx(this._ngSelect.groupBy),n=[];for(const o of Array.from(t.keys())){let c=n.length;if(void 0===o){const H=t.get(void 0)||[];n.push(...H.map(oe=>(oe.index=c++,oe)));continue}const f=a1(o),y={label:f?"":String(o),children:void 0,parent:null,index:c++,disabled:!this._ngSelect.selectableGroup,htmlId:eA()},E=i?this._ngSelect.bindLabel:this._ngSelect.groupBy,A=this._ngSelect.groupValue||(()=>f?o.value:{[E]:o}),z=t.get(o).map(H=>(H.parent=y,H.children=void 0,H.index=c++,H));y.children=z,y.value=A(o,z.map(H=>H.value)),n.push(y),n.push(...z)}return n}}var zu=function(e){return e[e.Tab=9]="Tab",e[e.Enter=13]="Enter",e[e.Esc=27]="Esc",e[e.Space=32]="Space",e[e.ArrowUp=38]="ArrowUp",e[e.ArrowDown=40]="ArrowDown",e[e.Backspace=8]="Backspace",e}(zu||{});let tA=(()=>{var e;class t{constructor(){this._dimensions={itemHeight:0,panelHeight:0,itemsPerViewport:0}}get dimensions(){return this._dimensions}calculateItems(n,o,c){const f=this._dimensions,y=f.itemHeight*o,A=Math.max(0,n)/y*o;let z=Math.min(o,Math.ceil(A)+(f.itemsPerViewport+1));const oe=Math.max(0,z-f.itemsPerViewport);let pe=Math.min(oe,Math.floor(A)),Ie=f.itemHeight*Math.ceil(pe)-f.itemHeight*Math.min(pe,c);return Ie=isNaN(Ie)?0:Ie,pe=isNaN(pe)?-1:pe,z=isNaN(z)?-1:z,pe-=c,pe=Math.max(0,pe),z+=c,z=Math.min(o,z),{topPadding:Ie,scrollHeight:y,start:pe,end:z}}setDimensions(n,o){const c=Math.max(1,Math.floor(o/n));this._dimensions={itemHeight:n,panelHeight:o,itemsPerViewport:c}}getScrollTo(n,o,c){const{panelHeight:f}=this.dimensions,y=n+o,A=c+f;return f>=y&&c===n?null:y>A?c+y-A:n<=c?n:null}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Lt({token:e,factory:e.\u0275fac}),t})();const nA=["top","right","bottom","left"],sV=typeof requestAnimationFrame<"u"?ZB:e8;let iA=(()=>{var e;class t{constructor(n,o,c,f,y){this._renderer=n,this._zone=o,this._panelService=c,this._document=y,this.items=[],this.position="auto",this.virtualScroll=!1,this.filterValue=null,this.update=new Tn,this.scroll=new Tn,this.scrollToEnd=new Tn,this.outsideClick=new Tn,this._destroy$=new ar,this._scrollToEndFired=!1,this._updateScrollHeight=!1,this._lastScrollPosition=0,this._dropdown=f.nativeElement}get currentPosition(){return this._currentPosition}get itemsLength(){return this._itemsLength}set itemsLength(n){n!==this._itemsLength&&(this._itemsLength=n,this._onItemsLengthChanged())}get _startOffset(){if(this.markedItem){const{itemHeight:n,panelHeight:o}=this._panelService.dimensions,c=this.markedItem.index*n;return o>c?0:c}return 0}ngOnInit(){this._select=this._dropdown.parentElement,this._virtualPadding=this.paddingElementRef.nativeElement,this._scrollablePanel=this.scrollElementRef.nativeElement,this._contentPanel=this.contentElementRef.nativeElement,this._handleScroll(),this._handleOutsideClick(),this._appendDropdown(),this._setupMousedownListener()}ngOnChanges(n){if(n.items){const o=n.items;this._onItemsChange(o.currentValue,o.firstChange)}}ngOnDestroy(){this._destroy$.next(),this._destroy$.complete(),this._destroy$.unsubscribe(),this.appendTo&&this._renderer.removeChild(this._dropdown.parentNode,this._dropdown)}scrollTo(n,o=!1){if(!n)return;const c=this.items.indexOf(n);if(c<0||c>=this.itemsLength)return;let f;if(this.virtualScroll){const y=this._panelService.dimensions.itemHeight;f=this._panelService.getScrollTo(c*y,y,this._lastScrollPosition)}else{const y=this._dropdown.querySelector(`#${n.htmlId}`);f=this._panelService.getScrollTo(y.offsetTop,y.clientHeight,o?y.offsetTop:this._lastScrollPosition)}fr(f)&&(this._scrollablePanel.scrollTop=f)}scrollToTag(){const n=this._scrollablePanel;n.scrollTop=n.scrollHeight-n.clientHeight}adjustPosition(){this._updateYPosition()}_handleDropdownPosition(){this._currentPosition=this._calculateCurrentPosition(this._dropdown),nA.includes(this._currentPosition)?this._updateDropdownClass(this._currentPosition):this._updateDropdownClass("bottom"),this.appendTo&&this._updateYPosition(),this._dropdown.style.opacity="1"}_updateDropdownClass(n){nA.forEach(c=>{const f=`ng-select-${c}`;this._renderer.removeClass(this._dropdown,f),this._renderer.removeClass(this._select,f)});const o=`ng-select-${n}`;this._renderer.addClass(this._dropdown,o),this._renderer.addClass(this._select,o)}_handleScroll(){this._zone.runOutsideAngular(()=>{Mm(this.scrollElementRef.nativeElement,"scroll").pipe(Cm(this._destroy$),$B(0,sV)).subscribe(n=>{const o=n.path||n.composedPath&&n.composedPath();this._onContentScrolled(o&&0!==o.length?o[0].scrollTop:n.target.scrollTop)})})}_handleOutsideClick(){this._document&&this._zone.runOutsideAngular(()=>{bt(Mm(this._document,"touchstart",{capture:!0}),Mm(this._document,"mousedown",{capture:!0})).pipe(Cm(this._destroy$)).subscribe(n=>this._checkToClose(n))})}_checkToClose(n){if(this._select.contains(n.target)||this._dropdown.contains(n.target))return;const o=n.path||n.composedPath&&n.composedPath();n.target&&n.target.shadowRoot&&o&&o[0]&&this._select.contains(o[0])||this._zone.run(()=>this.outsideClick.emit())}_onItemsChange(n,o){this.items=n||[],this._scrollToEndFired=!1,this.itemsLength=n.length,this.virtualScroll?this._updateItemsRange(o):(this._setVirtualHeight(),this._updateItems(o))}_updateItems(n){this.update.emit(this.items),!1!==n&&this._zone.runOutsideAngular(()=>{Promise.resolve().then(()=>{this._panelService.setDimensions(0,this._scrollablePanel.clientHeight),this._handleDropdownPosition(),this.scrollTo(this.markedItem,n)})})}_updateItemsRange(n){this._zone.runOutsideAngular(()=>{this._measureDimensions().then(()=>{n?(this._renderItemsRange(this._startOffset),this._handleDropdownPosition()):this._renderItemsRange()})})}_onContentScrolled(n){this.virtualScroll&&this._renderItemsRange(n),this._lastScrollPosition=n,this._fireScrollToEnd(n)}_updateVirtualHeight(n){this._updateScrollHeight&&(this._virtualPadding.style.height=`${n}px`,this._updateScrollHeight=!1)}_setVirtualHeight(){this._virtualPadding&&(this._virtualPadding.style.height="0px")}_onItemsLengthChanged(){this._updateScrollHeight=!0}_renderItemsRange(n=null){if(n&&this._lastScrollPosition===n)return;const o=this._panelService.calculateItems(n=n||this._scrollablePanel.scrollTop,this.itemsLength,this.bufferAmount);this._updateVirtualHeight(o.scrollHeight),this._contentPanel.style.transform=`translateY(${o.topPadding}px)`,this._zone.run(()=>{this.update.emit(this.items.slice(o.start,o.end)),this.scroll.emit({start:o.start,end:o.end})}),fr(n)&&0===this._lastScrollPosition&&(this._scrollablePanel.scrollTop=n,this._lastScrollPosition=n)}_measureDimensions(){if(this._panelService.dimensions.itemHeight>0||0===this.itemsLength)return Promise.resolve(this._panelService.dimensions);const[n]=this.items;return this.update.emit([n]),Promise.resolve().then(()=>{const c=this._dropdown.querySelector(`#${n.htmlId}`).clientHeight;return this._virtualPadding.style.height=c*this.itemsLength+"px",this._panelService.setDimensions(c,this._scrollablePanel.clientHeight),this._panelService.dimensions})}_fireScrollToEnd(n){this._scrollToEndFired||0===n||n+this._dropdown.clientHeight>=(this.virtualScroll?this._virtualPadding:this._contentPanel).clientHeight-1&&(this._zone.run(()=>this.scrollToEnd.emit()),this._scrollToEndFired=!0)}_calculateCurrentPosition(n){if("auto"!==this.position)return this.position;const o=this._select.getBoundingClientRect(),c=document.documentElement.scrollTop||document.body.scrollTop;return o.top+window.pageYOffset+o.height+n.getBoundingClientRect().height>c+document.documentElement.clientHeight?"top":"bottom"}_appendDropdown(){if(this.appendTo){if(this._parent=document.querySelector(this.appendTo),!this._parent)throw new Error(`appendTo selector ${this.appendTo} did not found any parent element`);this._updateXPosition(),this._parent.appendChild(this._dropdown)}}_updateXPosition(){const n=this._select.getBoundingClientRect(),o=this._parent.getBoundingClientRect();this._dropdown.style.left=n.left-o.left+"px",this._dropdown.style.width=n.width+"px",this._dropdown.style.minWidth=n.width+"px"}_updateYPosition(){const n=this._select.getBoundingClientRect(),o=this._parent.getBoundingClientRect(),c=n.height;"top"===this._currentPosition?(this._dropdown.style.bottom=o.bottom-n.bottom+c+"px",this._dropdown.style.top="auto"):"bottom"===this._currentPosition&&(this._dropdown.style.top=n.top-o.top+c+"px",this._dropdown.style.bottom="auto")}_setupMousedownListener(){this._zone.runOutsideAngular(()=>{Mm(this._dropdown,"mousedown").pipe(Cm(this._destroy$)).subscribe(n=>{"INPUT"!==n.target.tagName&&n.preventDefault()})})}}return(e=t).\u0275fac=function(n){return new(n||e)(G(Ss),G(ir),G(tA),G(Bi),G(Os,8))},e.\u0275cmp=mi({type:e,selectors:[["ng-dropdown-panel"]],viewQuery:function(n,o){if(1&n&&(Xd(a8,7,Bi),Xd(l8,7,Bi),Xd(c8,7,Bi)),2&n){let c;Cr(c=Mr())&&(o.contentElementRef=c.first),Cr(c=Mr())&&(o.scrollElementRef=c.first),Cr(c=Mr())&&(o.paddingElementRef=c.first)}},inputs:{items:"items",markedItem:"markedItem",position:"position",appendTo:"appendTo",bufferAmount:"bufferAmount",virtualScroll:"virtualScroll",headerTemplate:"headerTemplate",footerTemplate:"footerTemplate",filterValue:"filterValue"},outputs:{update:"update",scroll:"scroll",scrollToEnd:"scrollToEnd",outsideClick:"outsideClick"},features:[Ee],ngContentSelectors:JI,decls:9,vars:6,consts:[["class","ng-dropdown-header",4,"ngIf"],["role","listbox",1,"ng-dropdown-panel-items","scroll-host"],["scroll",""],["padding",""],["content",""],["class","ng-dropdown-footer",4,"ngIf"],[1,"ng-dropdown-header"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"ng-dropdown-footer"]],template:function(n,o){1&n&&(bb(),J(0,u8,2,4,"div",0),L(1,"div",1,2),He(3,"div",null,3),L(5,"div",null,4),wb(7),P()(),J(8,d8,2,4,"div",5)),2&n&&(U("ngIf",o.headerTemplate),w(3),ka("total-padding",o.virtualScroll),w(2),ka("scrollable-content",o.virtualScroll&&o.items.length),w(3),U("ngIf",o.footerTemplate))},dependencies:[Mc,Aw],encapsulation:2,changeDetection:0}),t})(),aV=(()=>{var e;class t{get disabled(){return this._disabled}set disabled(n){this._disabled=this._isDisabled(n)}constructor(n){this.elementRef=n,this.stateChange$=new ar,this._disabled=!1}get label(){return(this.elementRef.nativeElement.textContent||"").trim()}ngOnChanges(n){n.disabled&&this.stateChange$.next({value:this.value,disabled:this._disabled})}ngAfterViewChecked(){this.label!==this._previousLabel&&(this._previousLabel=this.label,this.stateChange$.next({value:this.value,disabled:this._disabled,label:this.elementRef.nativeElement.innerHTML}))}ngOnDestroy(){this.stateChange$.complete()}_isDisabled(n){return null!=n&&"false"!=`${n}`}}return(e=t).\u0275fac=function(n){return new(n||e)(G(Bi))},e.\u0275cmp=mi({type:e,selectors:[["ng-option"]],inputs:{value:"value",disabled:"disabled"},features:[Ee],ngContentSelectors:JI,decls:1,vars:0,template:function(n,o){1&n&&(bb(),wb(0))},encapsulation:2,changeDetection:0}),t})(),lV=(()=>{var e;class t{constructor(){this.notFoundText="No items found",this.typeToSearchText="Type to search",this.addTagText="Add item",this.loadingText="Loading...",this.clearAllText="Clear all",this.disableVirtualScroll=!0,this.openOnEnter=!0,this.appearance="underline"}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Lt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})(),cV=(()=>{var e;class t{warn(n){console.warn(n)}}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275prov=Lt({token:e,factory:e.\u0275fac,providedIn:"root"}),t})();const rA=new Ot("ng-select-selection-model");let uV=(()=>{var e;class t{get items(){return this._items}set items(n){null===n&&(n=[]),this._itemsAreUsed=!0,this._items=n}get compareWith(){return this._compareWith}set compareWith(n){if(null!=n&&!lx(n))throw Error("`compareWith` must be a function.");this._compareWith=n}get clearSearchOnAdd(){return fr(this._clearSearchOnAdd)?this._clearSearchOnAdd:fr(this.config.clearSearchOnAdd)?this.config.clearSearchOnAdd:this.closeOnSelect}set clearSearchOnAdd(n){this._clearSearchOnAdd=n}get deselectOnClick(){return fr(this._deselectOnClick)?this._deselectOnClick:fr(this.config.deselectOnClick)?this.config.deselectOnClick:this.multiple}set deselectOnClick(n){this._deselectOnClick=n}get disabled(){return this.readonly||this._disabled}get filtered(){return!!this.searchTerm&&this.searchable||this._isComposing}get single(){return!this.multiple}get _editableSearchTerm(){return this.editableSearchTerm&&!this.multiple}constructor(n,o,c,f,y,E,A){this.classes=n,this.autoFocus=o,this.config=c,this._cd=E,this._console=A,this.markFirst=!0,this.dropdownPosition="auto",this.loading=!1,this.closeOnSelect=!0,this.hideSelected=!1,this.selectOnTab=!1,this.bufferAmount=4,this.selectableGroup=!1,this.selectableGroupAsModel=!0,this.searchFn=null,this.trackByFn=null,this.clearOnBackspace=!0,this.labelForId=null,this.inputAttrs={},this.readonly=!1,this.searchWhileComposing=!0,this.minTermLength=0,this.editableSearchTerm=!1,this.keyDownFn=z=>!0,this.multiple=!1,this.addTag=!1,this.searchable=!0,this.clearable=!0,this.isOpen=!1,this.blurEvent=new Tn,this.focusEvent=new Tn,this.changeEvent=new Tn,this.openEvent=new Tn,this.closeEvent=new Tn,this.searchEvent=new Tn,this.clearEvent=new Tn,this.addEvent=new Tn,this.removeEvent=new Tn,this.scroll=new Tn,this.scrollToEnd=new Tn,this.useDefaultClass=!0,this.viewPortItems=[],this.searchTerm=null,this.dropdownId=eA(),this.escapeHTML=!0,this._items=[],this._defaultLabel="label",this._pressedKeys=[],this._isComposing=!1,this._destroy$=new ar,this._keyPress$=new ar,this._onChange=z=>{},this._onTouched=()=>{},this.clearItem=z=>{const H=this.selectedItems.find(oe=>oe.value===z);this.unselect(H)},this.trackByOption=(z,H)=>this.trackByFn?this.trackByFn(H.value):H,this._mergeGlobalConfig(c),this.itemsList=new oV(this,f()),this.element=y.nativeElement}get selectedItems(){return this.itemsList.selectedItems}get selectedValues(){return this.selectedItems.map(n=>n.value)}get hasValue(){return this.selectedItems.length>0}get currentPanelPosition(){if(this.dropdownPanel)return this.dropdownPanel.currentPosition}ngOnInit(){this._handleKeyPresses(),this._setInputAttributes()}ngOnChanges(n){n.multiple&&this.itemsList.clearSelected(),n.items&&this._setItems(n.items.currentValue||[]),n.isOpen&&(this._manualOpen=fr(n.isOpen.currentValue))}ngAfterViewInit(){this._itemsAreUsed||(this.escapeHTML=!1,this._setItemsFromNgOptions()),fr(this.autoFocus)&&this.focus()}ngOnDestroy(){this._destroy$.next(),this._destroy$.complete()}handleKeyDown(n){if(zu[n.which]){if(!1===this.keyDownFn(n))return;this.handleKeyCode(n)}else n.key&&1===n.key.length&&this._keyPress$.next(n.key.toLocaleLowerCase())}handleKeyCode(n){switch(n.which){case zu.ArrowDown:this._handleArrowDown(n);break;case zu.ArrowUp:this._handleArrowUp(n);break;case zu.Space:this._handleSpace(n);break;case zu.Enter:this._handleEnter(n);break;case zu.Tab:this._handleTab(n);break;case zu.Esc:this.close(),n.preventDefault();break;case zu.Backspace:this._handleBackspace()}}handleMousedown(n){const o=n.target;"INPUT"!==o.tagName&&n.preventDefault(),o.classList.contains("ng-clear-wrapper")?this.handleClearClick():o.classList.contains("ng-arrow-wrapper")?this.handleArrowClick():o.classList.contains("ng-value-icon")||(this.focused||this.focus(),this.searchable?this.open():this.toggle())}handleArrowClick(){this.isOpen?this.close():this.open()}handleClearClick(){this.hasValue&&(this.itemsList.clearSelected(!0),this._updateNgModel()),this._clearSearch(),this.focus(),this.clearEvent.emit(),this._onSelectionChanged()}clearModel(){this.clearable&&(this.itemsList.clearSelected(),this._updateNgModel())}writeValue(n){this.itemsList.clearSelected(),this._handleWriteValue(n),this._cd.markForCheck()}registerOnChange(n){this._onChange=n}registerOnTouched(n){this._onTouched=n}setDisabledState(n){this._disabled=n,this._cd.markForCheck()}toggle(){this.isOpen?this.close():this.open()}open(){this.disabled||this.isOpen||this._manualOpen||!this._isTypeahead&&!this.addTag&&this.itemsList.noItemsToSelect||(this.isOpen=!0,this.itemsList.markSelectedOrDefault(this.markFirst),this.openEvent.emit(),this.searchTerm||this.focus(),this.detectChanges())}close(){!this.isOpen||this._manualOpen||(this.isOpen=!1,this._isComposing=!1,this._editableSearchTerm?this.itemsList.resetFilteredItems():this._clearSearch(),this.itemsList.unmarkItem(),this._onTouched(),this.closeEvent.emit(),this._cd.markForCheck())}toggleItem(n){!n||n.disabled||this.disabled||(this.deselectOnClick&&n.selected?this.unselect(n):this.select(n),this._editableSearchTerm&&this._setSearchTermFromItems(),this._onSelectionChanged())}select(n){n.selected||(this.itemsList.select(n),this.clearSearchOnAdd&&!this._editableSearchTerm&&this._clearSearch(),this._updateNgModel(),this.multiple&&this.addEvent.emit(n.value)),(this.closeOnSelect||this.itemsList.noItemsToSelect)&&this.close()}focus(){this.searchInput.nativeElement.readOnly||this.searchInput.nativeElement.focus()}blur(){this.searchInput.nativeElement.blur()}unselect(n){n&&(this.itemsList.unselect(n),this.focus(),this._updateNgModel(),this.removeEvent.emit(n))}selectTag(){let n;n=lx(this.addTag)?this.addTag(this.searchTerm):this._primitive?this.searchTerm:{[this.bindLabel]:this.searchTerm};const o=c=>this._isTypeahead||!this.isOpen?this.itemsList.mapItem(c,null):this.itemsList.addItem(c);!function G8(e){return e instanceof Promise}(n)?n&&this.select(o(n)):n.then(c=>this.select(o(c))).catch(()=>{})}showClear(){return this.clearable&&(this.hasValue||this.searchTerm)&&!this.disabled}get showAddTag(){if(!this._validTerm)return!1;const n=this.searchTerm.toLowerCase().trim();return this.addTag&&!this.itemsList.filteredItems.some(o=>o.label.toLowerCase()===n)&&(!this.hideSelected&&this.isOpen||!this.selectedItems.some(o=>o.label.toLowerCase()===n))&&!this.loading}showNoItemsFound(){const n=0===this.itemsList.filteredItems.length;return(n&&!this._isTypeahead&&!this.loading||n&&this._isTypeahead&&this._validTerm&&!this.loading)&&!this.showAddTag}showTypeToSearch(){return 0===this.itemsList.filteredItems.length&&this._isTypeahead&&!this._validTerm&&!this.loading}onCompositionStart(){this._isComposing=!0}onCompositionEnd(n){this._isComposing=!1,!this.searchWhileComposing&&this.filter(n)}filter(n){this._isComposing&&!this.searchWhileComposing||(this.searchTerm=n,this._isTypeahead&&(this._validTerm||0===this.minTermLength)&&this.typeahead.next(n),this._isTypeahead||(this.itemsList.filter(this.searchTerm),this.isOpen&&this.itemsList.markSelectedOrDefault(this.markFirst)),this.searchEvent.emit({term:n,items:this.itemsList.filteredItems.map(o=>o.value)}),this.open())}onInputFocus(n){this.focused||(this._editableSearchTerm&&this._setSearchTermFromItems(),this.element.classList.add("ng-select-focused"),this.focusEvent.emit(n),this.focused=!0)}onInputBlur(n){this.element.classList.remove("ng-select-focused"),this.blurEvent.emit(n),!this.isOpen&&!this.disabled&&this._onTouched(),this._editableSearchTerm&&this._setSearchTermFromItems(),this.focused=!1}onItemHover(n){n.disabled||this.itemsList.markItem(n)}detectChanges(){this._cd.destroyed||this._cd.detectChanges()}_setSearchTermFromItems(){const n=this.selectedItems&&this.selectedItems[0];this.searchTerm=n&&n.label||null}_setItems(n){const o=n[0];this.bindLabel=this.bindLabel||this._defaultLabel,this._primitive=fr(o)?!a1(o):this._primitive||this.bindLabel===this._defaultLabel,this.itemsList.setItems(n),n.length>0&&this.hasValue&&this.itemsList.mapSelectedItems(),this.isOpen&&fr(this.searchTerm)&&!this._isTypeahead&&this.itemsList.filter(this.searchTerm),(this._isTypeahead||this.isOpen)&&this.itemsList.markSelectedOrDefault(this.markFirst)}_setItemsFromNgOptions(){const n=c=>{this.items=c.map(f=>({$ngOptionValue:f.value,$ngOptionLabel:f.elementRef.nativeElement.innerHTML,disabled:f.disabled})),this.itemsList.setItems(this.items),this.hasValue&&this.itemsList.mapSelectedItems(),this.detectChanges()},o=()=>{const c=bt(this.ngOptions.changes,this._destroy$);bt(...this.ngOptions.map(f=>f.stateChange$)).pipe(Cm(c)).subscribe(f=>{const y=this.itemsList.findItem(f.value);y.disabled=f.disabled,y.label=f.label||y.label,this._cd.detectChanges()})};this.ngOptions.changes.pipe(bS(this.ngOptions),Cm(this._destroy$)).subscribe(c=>{this.bindLabel=this._defaultLabel,n(c),o()})}_isValidWriteValue(n){if(!fr(n)||this.multiple&&""===n||Array.isArray(n)&&0===n.length)return!1;const o=c=>!(!fr(this.compareWith)&&a1(c)&&this.bindValue&&(this._console.warn(`Setting object(${JSON.stringify(c)}) as your model with bindValue is not allowed unless [compareWith] is used.`),1));return this.multiple?Array.isArray(n)?n.every(c=>o(c)):(this._console.warn("Multiple select ngModel should be array."),!1):o(n)}_handleWriteValue(n){if(!this._isValidWriteValue(n))return;const o=c=>{let f=this.itemsList.findItem(c);if(f)this.itemsList.select(f);else{const y=a1(c);y||!y&&!this.bindValue?this.itemsList.select(this.itemsList.mapItem(c,null)):this.bindValue&&(f={[this.bindLabel]:null,[this.bindValue]:c},this.itemsList.select(this.itemsList.mapItem(f,null)))}};this.multiple?n.forEach(c=>o(c)):o(n)}_handleKeyPresses(){this.searchable||this._keyPress$.pipe(Cm(this._destroy$),zo(n=>this._pressedKeys.push(n)),function HB(e,t=WC){return ri((i,n)=>{let o=null,c=null,f=null;const y=()=>{if(o){o.unsubscribe(),o=null;const A=c;c=null,n.next(A)}};function E(){const A=f+e,z=t.now();if(z<A)return o=this.schedule(void 0,A-z),void n.add(o);y()}i.subscribe(ei(n,A=>{c=A,f=t.now(),o||(o=t.schedule(E,e),n.add(o))},()=>{y(),n.complete()},void 0,()=>{c=o=null}))})}(200),Tc(()=>this._pressedKeys.length>0),En(()=>this._pressedKeys.join(""))).subscribe(n=>{const o=this.itemsList.findByLabel(n);o&&(this.isOpen?(this.itemsList.markItem(o),this._scrollToMarked(),this._cd.markForCheck()):this.select(o)),this._pressedKeys=[]})}_setInputAttributes(){const n=this.searchInput.nativeElement,o={type:"text",autocorrect:"off",autocapitalize:"off",autocomplete:this.labelForId?"off":this.dropdownId,...this.inputAttrs};for(const c of Object.keys(o))n.setAttribute(c,o[c])}_updateNgModel(){const n=[];for(const c of this.selectedItems)if(this.bindValue){let f=null;f=c.children?c.value[(this.groupValue?this.bindValue:this.groupBy)||this.groupBy]:this.itemsList.resolveNested(c.value,this.bindValue),n.push(f)}else n.push(c.value);const o=this.selectedItems.map(c=>c.value);this.multiple?(this._onChange(n),this.changeEvent.emit(o)):(this._onChange(fr(n[0])?n[0]:null),this.changeEvent.emit(o[0])),this._cd.markForCheck()}_clearSearch(){this.searchTerm&&(this._changeSearch(null),this.itemsList.resetFilteredItems())}_changeSearch(n){this.searchTerm=n,this._isTypeahead&&this.typeahead.next(n)}_scrollToMarked(){!this.isOpen||!this.dropdownPanel||this.dropdownPanel.scrollTo(this.itemsList.markedItem)}_scrollToTag(){!this.isOpen||!this.dropdownPanel||this.dropdownPanel.scrollToTag()}_onSelectionChanged(){this.isOpen&&this.deselectOnClick&&this.appendTo&&(this._cd.detectChanges(),this.dropdownPanel.adjustPosition())}_handleTab(n){!1===this.isOpen&&!this.addTag||(this.selectOnTab?this.itemsList.markedItem?(this.toggleItem(this.itemsList.markedItem),n.preventDefault()):this.showAddTag?(this.selectTag(),n.preventDefault()):this.close():this.close())}_handleEnter(n){if(this.isOpen||this._manualOpen)this.itemsList.markedItem?this.toggleItem(this.itemsList.markedItem):this.showAddTag&&this.selectTag();else{if(!this.openOnEnter)return;this.open()}n.preventDefault()}_handleSpace(n){this.isOpen||this._manualOpen||(this.open(),n.preventDefault())}_handleArrowDown(n){this._nextItemIsTag(1)?(this.itemsList.unmarkItem(),this._scrollToTag()):(this.itemsList.markNextItem(),this._scrollToMarked()),this.open(),n.preventDefault()}_handleArrowUp(n){this.isOpen&&(this._nextItemIsTag(-1)?(this.itemsList.unmarkItem(),this._scrollToTag()):(this.itemsList.markPreviousItem(),this._scrollToMarked()),n.preventDefault())}_nextItemIsTag(n){const o=this.itemsList.markedIndex+n;return this.addTag&&this.searchTerm&&this.itemsList.markedItem&&(o<0||o===this.itemsList.filteredItems.length)}_handleBackspace(){this.searchTerm||!this.clearable||!this.clearOnBackspace||!this.hasValue||(this.multiple?this.unselect(this.itemsList.lastSelectedItem):this.clearModel())}get _isTypeahead(){return this.typeahead&&this.typeahead.observers.length>0}get _validTerm(){const n=this.searchTerm&&this.searchTerm.trim();return n&&n.length>=this.minTermLength}_mergeGlobalConfig(n){this.placeholder=this.placeholder||n.placeholder,this.notFoundText=this.notFoundText||n.notFoundText,this.typeToSearchText=this.typeToSearchText||n.typeToSearchText,this.addTagText=this.addTagText||n.addTagText,this.loadingText=this.loadingText||n.loadingText,this.clearAllText=this.clearAllText||n.clearAllText,this.virtualScroll=fr(this.virtualScroll)?this.virtualScroll:!!fr(n.disableVirtualScroll)&&!n.disableVirtualScroll,this.openOnEnter=fr(this.openOnEnter)?this.openOnEnter:n.openOnEnter,this.appendTo=this.appendTo||n.appendTo,this.bindValue=this.bindValue||n.bindValue,this.bindLabel=this.bindLabel||n.bindLabel,this.appearance=this.appearance||n.appearance}}return(e=t).\u0275fac=function(n){return new(n||e)(hu("class"),hu("autofocus"),G(lV),G(rA),G(Bi),G(om),G(cV))},e.\u0275cmp=mi({type:e,selectors:[["ng-select"]],contentQueries:function(n,o,c){if(1&n&&(Ps(c,Z8,5,li),Ps(c,W8,5,li),Ps(c,X8,5,li),Ps(c,Y8,5,li),Ps(c,K8,5,li),Ps(c,J8,5,li),Ps(c,Q8,5,li),Ps(c,eV,5,li),Ps(c,tV,5,li),Ps(c,nV,5,li),Ps(c,iV,5,li),Ps(c,aV,5)),2&n){let f;Cr(f=Mr())&&(o.optionTemplate=f.first),Cr(f=Mr())&&(o.optgroupTemplate=f.first),Cr(f=Mr())&&(o.labelTemplate=f.first),Cr(f=Mr())&&(o.multiLabelTemplate=f.first),Cr(f=Mr())&&(o.headerTemplate=f.first),Cr(f=Mr())&&(o.footerTemplate=f.first),Cr(f=Mr())&&(o.notFoundTemplate=f.first),Cr(f=Mr())&&(o.typeToSearchTemplate=f.first),Cr(f=Mr())&&(o.loadingTextTemplate=f.first),Cr(f=Mr())&&(o.tagTemplate=f.first),Cr(f=Mr())&&(o.loadingSpinnerTemplate=f.first),Cr(f=Mr())&&(o.ngOptions=f)}},viewQuery:function(n,o){if(1&n&&(Xd(iA,5),Xd(h8,7)),2&n){let c;Cr(c=Mr())&&(o.dropdownPanel=c.first),Cr(c=Mr())&&(o.searchInput=c.first)}},hostVars:20,hostBindings:function(n,o){1&n&&ye("keydown",function(f){return o.handleKeyDown(f)}),2&n&&ka("ng-select-typeahead",o.typeahead)("ng-select-multiple",o.multiple)("ng-select-taggable",o.addTag)("ng-select-searchable",o.searchable)("ng-select-clearable",o.clearable)("ng-select-opened",o.isOpen)("ng-select",o.useDefaultClass)("ng-select-disabled",o.disabled)("ng-select-filtered",o.filtered)("ng-select-single",o.single)},inputs:{bindLabel:"bindLabel",bindValue:"bindValue",markFirst:"markFirst",placeholder:"placeholder",notFoundText:"notFoundText",typeToSearchText:"typeToSearchText",addTagText:"addTagText",loadingText:"loadingText",clearAllText:"clearAllText",appearance:"appearance",dropdownPosition:"dropdownPosition",appendTo:"appendTo",loading:"loading",closeOnSelect:"closeOnSelect",hideSelected:"hideSelected",selectOnTab:"selectOnTab",openOnEnter:"openOnEnter",maxSelectedItems:"maxSelectedItems",groupBy:"groupBy",groupValue:"groupValue",bufferAmount:"bufferAmount",virtualScroll:"virtualScroll",selectableGroup:"selectableGroup",selectableGroupAsModel:"selectableGroupAsModel",searchFn:"searchFn",trackByFn:"trackByFn",clearOnBackspace:"clearOnBackspace",labelForId:"labelForId",inputAttrs:"inputAttrs",tabIndex:"tabIndex",readonly:"readonly",searchWhileComposing:"searchWhileComposing",minTermLength:"minTermLength",editableSearchTerm:"editableSearchTerm",keyDownFn:"keyDownFn",typeahead:"typeahead",multiple:"multiple",addTag:"addTag",searchable:"searchable",clearable:"clearable",isOpen:"isOpen",items:"items",compareWith:"compareWith",clearSearchOnAdd:"clearSearchOnAdd",deselectOnClick:"deselectOnClick"},outputs:{blurEvent:"blur",focusEvent:"focus",changeEvent:"change",openEvent:"open",closeEvent:"close",searchEvent:"search",clearEvent:"clear",addEvent:"add",removeEvent:"remove",scroll:"scroll",scrollToEnd:"scrollToEnd"},features:[Yi([{provide:Tl,useExisting:Pn(()=>e),multi:!0},tA]),Ee],decls:14,vars:19,consts:[[1,"ng-select-container",3,"mousedown"],[1,"ng-value-container"],[1,"ng-placeholder"],[4,"ngIf"],["role","combobox","aria-haspopup","listbox",1,"ng-input"],["aria-autocomplete","list",3,"readOnly","disabled","value","input","compositionstart","compositionend","focus","blur","change"],["searchInput",""],["class","ng-clear-wrapper",3,"title",4,"ngIf"],[1,"ng-arrow-wrapper"],[1,"ng-arrow"],["class","ng-dropdown-panel","role","listbox","aria-label","Options list",3,"virtualScroll","bufferAmount","appendTo","position","headerTemplate","footerTemplate","filterValue","items","markedItem","ng-select-multiple","ngClass","id","update","scroll","scrollToEnd","outsideClick",4,"ngIf"],["class","ng-value",3,"ng-value-disabled",4,"ngFor","ngForOf","ngForTrackBy"],[1,"ng-value"],["defaultLabelTemplate",""],[3,"ngTemplateOutlet","ngTemplateOutletContext"],["aria-hidden","true",1,"ng-value-icon","left",3,"click"],[1,"ng-value-label",3,"ngItemLabel","escape"],["defaultLoadingSpinnerTemplate",""],[3,"ngTemplateOutlet"],[1,"ng-spinner-loader"],[1,"ng-clear-wrapper",3,"title"],["aria-hidden","true",1,"ng-clear"],["role","listbox","aria-label","Options list",1,"ng-dropdown-panel",3,"virtualScroll","bufferAmount","appendTo","position","headerTemplate","footerTemplate","filterValue","items","markedItem","ngClass","id","update","scroll","scrollToEnd","outsideClick"],["class","ng-option",3,"ng-option-disabled","ng-option-selected","ng-optgroup","ng-option","ng-option-child","ng-option-marked","click","mouseover",4,"ngFor","ngForOf","ngForTrackBy"],["class","ng-option","role","option",3,"ng-option-marked","mouseover","click",4,"ngIf"],[1,"ng-option",3,"click","mouseover"],["defaultOptionTemplate",""],[1,"ng-option-label",3,"ngItemLabel","escape"],["role","option",1,"ng-option",3,"mouseover","click"],["defaultTagTemplate",""],[1,"ng-tag-label"],["defaultNotFoundTemplate",""],[1,"ng-option","ng-option-disabled"],["defaultTypeToSearchTemplate",""],["defaultLoadingTextTemplate",""]],template:function(n,o){if(1&n){const c=Ke();L(0,"div",0),ye("mousedown",function(y){return o.handleMousedown(y)}),L(1,"div",1)(2,"div",2),W(3),P(),J(4,_8,2,2,"ng-container",3),J(5,x8,1,5,null,3),L(6,"div",4)(7,"input",5,6),ye("input",function(){ce(c);const y=Vt(8);return le(o.filter(y.value))})("compositionstart",function(){return o.onCompositionStart()})("compositionend",function(){ce(c);const y=Vt(8);return le(o.onCompositionEnd(y.value))})("focus",function(y){return o.onInputFocus(y)})("blur",function(y){return o.onInputBlur(y)})("change",function(y){return y.stopPropagation()}),P()()(),J(9,C8,4,1,"ng-container",3),J(10,M8,3,1,"span",7),L(11,"span",8),He(12,"span",9),P()(),J(13,U8,7,19,"ng-dropdown-panel",10)}2&n&&(ka("ng-appearance-outline","outline"===o.appearance)("ng-has-value",o.hasValue),w(3),Ce(o.placeholder),w(1),U("ngIf",(!o.multiLabelTemplate||!o.multiple)&&o.selectedItems.length>0),w(1),U("ngIf",o.multiple&&o.multiLabelTemplate&&o.selectedValues.length>0),w(1),Fo("aria-expanded",o.isOpen)("aria-owns",o.isOpen?o.dropdownId:null),w(1),U("readOnly",!o.searchable||o.itemsList.maxItemsSelected)("disabled",o.disabled)("value",o.searchTerm?o.searchTerm:""),Fo("id",o.labelForId)("tabindex",o.tabIndex)("aria-activedescendant",o.isOpen?null==o.itemsList||null==o.itemsList.markedItem?null:o.itemsList.markedItem.htmlId:null)("aria-controls",o.isOpen?o.dropdownId:null),w(2),U("ngIf",o.loading),w(1),U("ngIf",o.showClear()),w(3),U("ngIf",o.isOpen))},dependencies:[Qd,eh,Mc,Aw,iA,q8],styles:['@charset "UTF-8";.ng-select{position:relative;display:block;box-sizing:border-box}.ng-select div,.ng-select input,.ng-select span{box-sizing:border-box}.ng-select [hidden]{display:none}.ng-select.ng-select-searchable .ng-select-container .ng-value-container .ng-input{opacity:1}.ng-select.ng-select-opened .ng-select-container{z-index:1001}.ng-select.ng-select-disabled .ng-select-container .ng-value-container .ng-placeholder,.ng-select.ng-select-disabled .ng-select-container .ng-value-container .ng-value{-webkit-user-select:none;user-select:none;cursor:default}.ng-select.ng-select-disabled .ng-arrow-wrapper{cursor:default}.ng-select.ng-select-filtered .ng-placeholder{display:none}.ng-select .ng-select-container{cursor:default;display:flex;outline:none;overflow:hidden;position:relative;width:100%}.ng-select .ng-select-container .ng-value-container{display:flex;flex:1}.ng-select .ng-select-container .ng-value-container .ng-input{opacity:0}.ng-select .ng-select-container .ng-value-container .ng-input>input{box-sizing:content-box;background:none transparent;border:0 none;box-shadow:none;outline:none;padding:0;cursor:default;width:100%}.ng-select .ng-select-container .ng-value-container .ng-input>input::-ms-clear{display:none}.ng-select .ng-select-container .ng-value-container .ng-input>input[readonly]{-webkit-user-select:none;user-select:none;width:0;padding:0}.ng-select.ng-select-single.ng-select-filtered .ng-select-container .ng-value-container .ng-value{visibility:hidden}.ng-select.ng-select-single .ng-select-container .ng-value-container,.ng-select.ng-select-single .ng-select-container .ng-value-container .ng-value{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.ng-select.ng-select-single .ng-select-container .ng-value-container .ng-value .ng-value-icon{display:none}.ng-select.ng-select-single .ng-select-container .ng-value-container .ng-input{position:absolute;left:0;width:100%}.ng-select.ng-select-multiple.ng-select-disabled>.ng-select-container .ng-value-container .ng-value .ng-value-icon{display:none}.ng-select.ng-select-multiple .ng-select-container .ng-value-container{flex-wrap:wrap}.ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-placeholder{position:absolute}.ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-value{white-space:nowrap}.ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-value.ng-value-disabled .ng-value-icon{display:none}.ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-value .ng-value-icon{cursor:pointer}.ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-input{flex:1;z-index:2}.ng-select.ng-select-multiple .ng-select-container .ng-value-container .ng-placeholder{z-index:1}.ng-select .ng-clear-wrapper{cursor:pointer;position:relative;width:17px;-webkit-user-select:none;user-select:none}.ng-select .ng-clear-wrapper .ng-clear{display:inline-block;font-size:18px;line-height:1;pointer-events:none}.ng-select .ng-spinner-loader{border-radius:50%;width:17px;height:17px;margin-right:5px;font-size:10px;position:relative;text-indent:-9999em;border-top:2px solid rgba(66,66,66,.2);border-right:2px solid rgba(66,66,66,.2);border-bottom:2px solid rgba(66,66,66,.2);border-left:2px solid #424242;transform:translateZ(0);animation:load8 .8s infinite linear}.ng-select .ng-spinner-loader:after{border-radius:50%;width:17px;height:17px}@keyframes load8{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.ng-select .ng-arrow-wrapper{cursor:pointer;position:relative;text-align:center;-webkit-user-select:none;user-select:none}.ng-select .ng-arrow-wrapper .ng-arrow{pointer-events:none;display:inline-block;height:0;width:0;position:relative}.ng-dropdown-panel{box-sizing:border-box;position:absolute;opacity:0;width:100%;z-index:1050;-webkit-overflow-scrolling:touch}.ng-dropdown-panel .ng-dropdown-panel-items{display:block;height:auto;box-sizing:border-box;max-height:240px;overflow-y:auto}.ng-dropdown-panel .ng-dropdown-panel-items .ng-optgroup{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.ng-dropdown-panel .ng-dropdown-panel-items .ng-option{box-sizing:border-box;cursor:pointer;display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.ng-dropdown-panel .ng-dropdown-panel-items .ng-option .ng-option-label:empty:before{content:"\\200b"}.ng-dropdown-panel .ng-dropdown-panel-items .ng-option .highlighted{font-weight:700;text-decoration:underline}.ng-dropdown-panel .ng-dropdown-panel-items .ng-option.disabled{cursor:default}.ng-dropdown-panel .scroll-host{overflow:hidden;overflow-y:auto;position:relative;display:block;-webkit-overflow-scrolling:touch}.ng-dropdown-panel .scrollable-content{top:0;left:0;width:100%;height:100%;position:absolute}.ng-dropdown-panel .total-padding{width:1px;opacity:0}\n'],encapsulation:2,changeDetection:0}),t})();function dV(){return new hV}class hV{constructor(){this._selected=[]}get value(){return this._selected}select(t,i,n){if(t.selected=!0,(!t.children||!i&&n)&&this._selected.push(t),i)if(t.parent){const o=t.parent.children.length,c=t.parent.children.filter(f=>f.selected).length;t.parent.selected=o===c}else t.children&&(this._setChildrenSelectedState(t.children,!0),this._removeChildren(t),this._selected=n&&this._activeChildren(t)?[...this._selected.filter(o=>o.parent!==t),t]:[...this._selected,...t.children.filter(o=>!o.disabled)])}unselect(t,i){if(this._selected=this._selected.filter(n=>n!==t),t.selected=!1,i)if(t.parent&&t.parent.selected){const n=t.parent.children;this._removeParent(t.parent),this._removeChildren(t.parent),this._selected.push(...n.filter(o=>o!==t&&!o.disabled)),t.parent.selected=!1}else t.children&&(this._setChildrenSelectedState(t.children,!1),this._removeChildren(t))}clear(t){this._selected=t?this._selected.filter(i=>i.disabled):[]}_setChildrenSelectedState(t,i){for(const n of t)n.disabled||(n.selected=i)}_removeChildren(t){this._selected=[...this._selected.filter(i=>i.parent!==t),...t.children.filter(i=>i.parent===t&&i.disabled&&i.selected)]}_removeParent(t){this._selected=this._selected.filter(i=>i!==t)}_activeChildren(t){return t.children.every(i=>!i.disabled||i.selected)}}let pV=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=cr({type:e}),e.\u0275inj=lr({providers:[{provide:rA,useValue:dV}],imports:[ZT]}),t})();const fV=["map"];function gV(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",53),ye("mouseover",function(){return ce(i),le(q().viewList=!0)}),He(1,"path",54)(2,"path",55)(3,"path",56),P()}}function mV(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",57),ye("mouseout",function(){return ce(i),le(q().viewList=!1)}),He(1,"path",58),P()}}function _V(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",59),ye("mouseover",function(){return ce(i),le(q().viewMap=!0)}),He(1,"path",60),P()}}function vV(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",61),ye("mouseout",function(){return ce(i),le(q().viewMap=!1)}),He(1,"path",62),P()}}function yV(e,t){if(1&e){const i=Ke();L(0,"select",63),ye("change",function(){ce(i);const o=q();return o.filterDevices(),o.search.value="",le(o.currentPage=1)})("ngModelChange",function(o){return ce(i),le(q().search.sensorsAct=o)}),L(1,"option",23),W(2),te(3,"translate"),P(),L(4,"option",24),W(5),te(6,"translate"),P(),L(7,"option",24),W(8),te(9,"translate"),P()()}2&e&&(U("ngModel",q().search.sensorsAct),w(1),U("ngValue",2),w(1),Ce(ne(3,7,"sensors.all")),w(2),U("ngValue",1),w(1),Ce(ne(6,9,"sensors.enable")),w(2),U("ngValue",0),w(1),Ce(ne(9,11,"sensors.disable")))}function xV(e,t){if(1&e){const i=Ke();L(0,"select",64),ye("change",function(){ce(i);const o=q();return o.filterDevices(),o.search.value="",le(o.currentPage=1)})("ngModelChange",function(o){return ce(i),le(q().search.sensorsAct=o)}),L(1,"option",23),W(2),te(3,"translate"),P(),L(4,"option",24),W(5),te(6,"translate"),P(),L(7,"option",24),W(8),te(9,"translate"),P()()}2&e&&(U("ngModel",q().search.sensorsAct),w(1),U("ngValue",2),w(1),Ce(ne(3,7,"sensors.all")),w(2),U("ngValue",1),w(1),Ce(ne(6,9,"sensors.enable")),w(2),U("ngValue",0),w(1),Ce(ne(9,11,"sensors.disable")))}function bV(e,t){1&e&&(L(0,"div",71)(1,"div",72)(2,"p",73),W(3),te(4,"translate"),P()()()),2&e&&(w(3),Ce(ne(4,1,"no_devices")))}function wV(e,t){1&e&&(L(0,"div",71)(1,"div",74)(2,"span",75),W(3),te(4,"translate"),P()()()),2&e&&(w(3),Ce(ne(4,1,"loading")))}function CV(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",90),ye("click",function(){ce(i);const o=q(3);return o.alt1=!1,le(o.getDevicesLocal("uid","DESC"))}),He(1,"path",91),P()}}function MV(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",92),ye("click",function(){ce(i);const o=q(3);return o.alt1=!0,le(o.getDevicesLocal("uid","ASC"))}),He(1,"path",93),P()}}function EV(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",90),ye("click",function(){ce(i);const o=q(3);return o.alt2=!1,le(o.getDevicesLocal("topic_name","DESC"))}),He(1,"path",91),P()}}function TV(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",92),ye("click",function(){ce(i);const o=q(3);return o.alt2=!0,le(o.getDevicesLocal("topic_name","ASC"))}),He(1,"path",93),P()}}function DV(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",90),ye("click",function(){ce(i);const o=q(3);return o.alt3=!1,le(o.getDevicesLocal("application_id","DESC"))}),He(1,"path",91),P()}}function SV(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",92),ye("click",function(){ce(i);const o=q(3);return o.alt3=!0,le(o.getDevicesLocal("application_id","ASC"))}),He(1,"path",93),P()}}function IV(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",90),ye("click",function(){ce(i);const o=q(3);return o.alt4=!1,le(o.getDevicesLocal("data_estructure","DESC"))}),He(1,"path",91),P()}}function AV(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",92),ye("click",function(){ce(i);const o=q(3);return o.alt4=!0,le(o.getDevicesLocal("data_estructure","ASC"))}),He(1,"path",93),P()}}function PV(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",90),ye("click",function(){ce(i);const o=q(3);return o.alt5=!1,le(o.getDevicesLocal("updatedAt","DESC"))}),He(1,"path",91),P()}}function kV(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",92),ye("click",function(){ce(i);const o=q(3);return o.alt5=!0,le(o.getDevicesLocal("updatedAt","ASC"))}),He(1,"path",93),P()}}const ux=function(e){return{"d-none":e}};function OV(e,t){if(1&e&&(L(0,"div",112)(1,"span",113)(2,"p",98),W(3),P()(),L(4,"span",114)(5,"p",98),W(6),P()()()),2&e){const i=t.$implicit;w(1),uv(ft(6,ux,0==i.enable)),w(2),Ce(i.type_name),w(1),uv(ft(8,ux,1==i.enable)),w(2),Ce(i.type_name)}}function LV(e,t){if(1&e&&(L(0,"div"),J(1,OV,7,10,"div",111),P()),2&e){const i=q(2).$implicit;w(1),U("ngForOf",i.sensors)}}function RV(e,t){1&e&&(L(0,"div",112)(1,"p",115),W(2),te(3,"translate"),P()()),2&e&&(w(2),Ce(ne(3,1,"sensors.sin_sensores")))}function FV(e,t){if(1&e&&(L(0,"div"),J(1,LV,2,1,"div",101),J(2,RV,4,3,"div",110),P()),2&e){const i=q().$implicit;w(1),U("ngIf",i.sensors.length>0),w(1),U("ngIf",i.sensors.length<=0)}}const Bu=function(e){return["/devices/edit/",e]};function NV(e,t){if(1&e&&(L(0,"td",100),W(1),P()),2&e){const i=q().$implicit;U("routerLink",ft(2,Bu,i.id)),w(1),Ce(i.data_estructure)}}function zV(e,t){if(1&e&&(L(0,"td",100),W(1),P()),2&e){const i=q().$implicit;U("routerLink",ft(2,Bu,i.id)),w(1),Ce(i.variable_data_structure)}}function BV(e,t){1&e&&(xt(),L(0,"svg",116),He(1,"path",117)(2,"path",118)(3,"path",119),P())}function VV(e,t){1&e&&(xt(),L(0,"svg",120),He(1,"path",121)(2,"path",122),P())}function UV(e,t){1&e&&(xt(),L(0,"svg",123),He(1,"path",124),P())}function jV(e,t){1&e&&(xt(),L(0,"svg",125),He(1,"path",126),P())}function $V(e,t){if(1&e){const i=Ke();L(0,"tr",94)(1,"th",95),W(2),P(),L(3,"td",96),W(4),P(),L(5,"td",96),W(6),P(),L(7,"td",96)(8,"span",97)(9,"p",98),W(10),te(11,"translate"),P()(),L(12,"span",99)(13,"p",98),W(14),te(15,"translate"),P()()(),L(16,"td",100),J(17,FV,3,2,"div",101),P(),J(18,NV,2,4,"td",102),J(19,zV,2,4,"td",102),L(20,"td",103),W(21),P(),L(22,"td",104),ye("mouseout",function(){return ce(i),le(q(3).viewDup=-1)})("mouseover",function(){const c=ce(i).index;return le(q(3).viewDup=c)}),J(23,BV,4,0,"svg",105),J(24,VV,3,0,"svg",106),P(),L(25,"td",107),ye("mouseover",function(){const c=ce(i).index;return le(q(3).pencilDup=c)})("mouseout",function(){return ce(i),le(q(3).pencilDup=-10)}),J(26,UV,2,0,"svg",108),J(27,jV,2,0,"svg",109),P()()}if(2&e){const i=t.$implicit,n=t.index,o=q(3);w(1),U("routerLink",ft(29,Bu,i.id)),w(1),Ce(i.uid),w(1),U("routerLink",ft(31,Bu,i.id)),w(1),Ce(i.topic_name),w(1),U("routerLink",ft(33,Bu,i.id)),w(1),Ce(i.application_id),w(1),U("routerLink",ft(35,Bu,i.id)),w(1),uv(ft(37,ux,0==i.enable)),w(2),Ce(ne(11,25,"sensors.enable")),w(2),uv(ft(39,ux,1==i.enable)),w(2),Ce(ne(15,27,"sensors.disable")),w(2),U("routerLink",ft(41,Bu,i.id)),w(1),U("ngIf",null!=i.sensors),w(1),U("ngIf",0==i.variable_configuration),w(1),U("ngIf",1==i.variable_configuration),w(1),U("routerLink",ft(43,Bu,i.id)),w(1),Ce(o.formatDateTime(i.updatedAt)),w(1),cv("routerLink","/devices/new/",i.id,""),w(1),U("ngIf",o.viewDup!=n),w(1),U("ngIf",o.viewDup==n),w(1),U("routerLink",ft(45,Bu,i.id)),w(1),U("ngIf",o.pencilDup!=n),w(1),U("ngIf",o.pencilDup==n)}}const dx=function(e){return{mark:e}};function HV(e,t){if(1&e&&(L(0,"div",76)(1,"table",77)(2,"thead")(3,"tr")(4,"th",78),J(5,CV,2,0,"svg",79),J(6,MV,2,0,"svg",80),W(7),te(8,"translate"),P(),L(9,"th",81),J(10,EV,2,0,"svg",79),J(11,TV,2,0,"svg",80),W(12),te(13,"translate"),P(),L(14,"th",82),J(15,DV,2,0,"svg",79),J(16,SV,2,0,"svg",80),W(17),te(18,"translate"),P(),L(19,"th",83),W(20),te(21,"translate"),P(),L(22,"th",84),W(23),te(24,"translate"),P(),L(25,"th",85),J(26,IV,2,0,"svg",79),J(27,AV,2,0,"svg",80),W(28),te(29,"translate"),P(),L(30,"th",86),J(31,PV,2,0,"svg",79),J(32,kV,2,0,"svg",80),W(33),te(34,"translate"),P(),L(35,"th",87),W(36),te(37,"translate"),P(),L(38,"th",88),W(39),te(40,"translate"),P()()(),L(41,"tbody"),J(42,$V,28,47,"tr",89),P()()()),2&e){const i=q(2);w(4),U("ngClass",ft(42,dx,"uid"==i.mark)),w(1),U("ngIf",i.alt1),w(1),U("ngIf",!i.alt1),w(1),jt("",ne(8,24,"devices.edit.uid")," "),w(2),U("ngClass",ft(44,dx,"topic_name"==i.mark)),w(1),U("ngIf",i.alt2),w(1),U("ngIf",!i.alt2),w(1),jt("",ne(13,26,"devices.edit.topic")," "),w(2),U("ngClass",ft(46,dx,"application_id"==i.mark)),w(1),U("ngIf",i.alt3),w(1),U("ngIf",!i.alt3),w(1),jt("",ne(18,28,"devices.edit.aplication")," "),w(3),jt(" ",ne(21,30,"sensors.enable")," "),w(3),jt(" ",ne(24,32,"sensors.sensors")," "),w(3),U("ngIf",i.alt4),w(1),U("ngIf",!i.alt4),w(1),jt("",ne(29,34,"structure")," "),w(2),U("ngClass",ft(48,dx,"updatedAt"==i.mark)),w(1),U("ngIf",i.alt5),w(1),U("ngIf",!i.alt5),w(1),jt("",ne(34,36,"mod")," "),w(3),Ce(ne(37,38,"sensors.duplicate")),w(3),Ce(ne(40,40,"sensors.edit")),w(3),U("ngForOf",i.data)}}function GV(e,t){if(1&e&&(L(0,"option",135),W(1),te(2,"translate"),P()),2&e){const i=t.$implicit;U("value",i)("selected",15==i),w(1),pn("",i," ",ne(2,4,"res"),"")}}function qV(e,t){if(1&e){const i=Ke();L(0,"li",137)(1,"a",138),ye("click",function(){return ce(i),le(q(4).previousPage10())}),L(2,"span",139),W(3,"\xab 10"),P()()()}}function ZV(e,t){if(1&e){const i=Ke();L(0,"li",137)(1,"a",143),ye("click",function(){return ce(i),le(q(4).previousPage())}),W(2),P()()}if(2&e){const i=q(4);w(2),Ce(i.currentPage-1)}}function WV(e,t){if(1&e){const i=Ke();L(0,"li",137)(1,"a",143),ye("click",function(){return ce(i),le(q(4).nextPage())}),W(2),P()()}if(2&e){const i=q(4);w(2),Ce(i.currentPage+1)}}function XV(e,t){if(1&e){const i=Ke();L(0,"li",137)(1,"a",142),ye("click",function(){return ce(i),le(q(4).nextPage10())}),L(2,"span",139),W(3,"10 \xbb"),P()()()}}function YV(e,t){if(1&e){const i=Ke();L(0,"ul",136)(1,"li",137)(2,"a",138),ye("click",function(){return ce(i),le(q(3).firstPage())}),L(3,"span",139),W(4),te(5,"translate"),P()()(),J(6,qV,4,0,"li",140),J(7,ZV,3,1,"li",140),L(8,"li",137)(9,"a",141),ye("click",function(){ce(i);const o=q(3);return le(o.Page(o.currentPage))}),L(10,"strong"),W(11),P()()(),J(12,WV,3,1,"li",140),J(13,XV,4,0,"li",140),L(14,"li",137)(15,"a",142),ye("click",function(){return ce(i),le(q(3).lastPage())}),L(16,"span",139),W(17),te(18,"translate"),P()()()()}if(2&e){const i=q(3);w(4),Ce(ne(5,7,"first")),w(2),U("ngIf",i.currentPage-10>0),w(1),U("ngIf",i.currentPage-1!=0),w(4),Ce(i.currentPage),w(1),U("ngIf",i.currentPage!=i.totalPages),w(1),U("ngIf",i.currentPage+10<i.totalPages),w(4),Ce(ne(18,9,"last"))}}function KV(e,t){if(1&e){const i=Ke();L(0,"div",127)(1,"div",128)(2,"div")(3,"p",129),W(4),P()(),L(5,"div")(6,"select",130),ye("change",function(){ce(i);const o=q(2);return o.getDevicesLocal("uid","ASC"),le(o.currentPage=1)})("ngModelChange",function(o){return ce(i),le(q(2).quantPage=o)}),J(7,GV,3,6,"option",131),P()()(),L(8,"div",132)(9,"nav",133),J(10,YV,19,11,"ul",134),P()()()}if(2&e){const i=q(2);w(4),Qg("",i.quantPage*(i.currentPage-1)+1," - ",i.totalPage," de ",i.total,""),w(2),U("ngModel",i.quantPage),w(1),U("ngForOf",i.resultsPerPag),w(3),U("ngIf",i.data.length>0)}}function JV(e,t){if(1&e&&(L(0,"div",65)(1,"div",66)(2,"div",67),J(3,bV,5,3,"div",68),J(4,wV,5,3,"div",68),J(5,HV,43,50,"div",69),P()(),J(6,KV,11,6,"div",70),P()),2&e){const i=q();w(3),U("ngIf",i.data.length<=0&&0==i.charging),w(1),U("ngIf",i.charging),w(1),U("ngIf",i.data.length>0),w(1),U("ngIf",i.openAux)}}function QV(e,t){1&e&&He(0,"input",144)}function e7(e,t){if(1&e){const i=Ke();L(0,"input",145),ye("click",function(){ce(i);const o=q();return o.changeMapStyle("streets-v12"),le(o.saveStorage())}),P()}}function t7(e,t){1&e&&He(0,"input",146)}function n7(e,t){if(1&e){const i=Ke();L(0,"input",147),ye("click",function(){ce(i);const o=q();return o.changeMapStyle("satellite-streets-v12"),le(o.saveStorage())}),P()}}function i7(e,t){1&e&&He(0,"input",148)}function r7(e,t){if(1&e){const i=Ke();L(0,"input",149),ye("click",function(){ce(i);const o=q();return o.changeMapStyle("outdoors-v12"),le(o.saveStorage())}),P()}}function o7(e,t){1&e&&He(0,"input",150)}function s7(e,t){if(1&e){const i=Ke();L(0,"input",151),ye("click",function(){ce(i);const o=q();return o.changeMapStyle("light-v11"),le(o.saveStorage())}),P()}}function a7(e,t){1&e&&He(0,"input",152)}function l7(e,t){if(1&e){const i=Ke();L(0,"input",153),ye("click",function(){ce(i);const o=q();return o.changeMapStyle("dark-v11"),le(o.saveStorage())}),P()}}function c7(e,t){1&e&&(L(0,"div",154)(1,"div",155)(2,"div",156)(3,"div",157),W(4),te(5,"translate"),P(),He(6,"button",158),P()()()),2&e&&(w(4),jt(" ",ne(5,1,"devices.list.e1")," "))}function u7(e,t){1&e&&(L(0,"div",154)(1,"div",159)(2,"div",156)(3,"div",157),W(4),te(5,"translate"),P(),He(6,"button",158),P()()()),2&e&&(w(4),jt(" ",ne(5,1,"devices.list.e2")," "))}function h7(e,t){if(1&e){const i=Ke();L(0,"input",45),ye("keyup",function(o){return ce(i),le(q().textSearch(o))})("ngModelChange",function(o){return ce(i),le(q().searchAuxArray.value=o)}),te(1,"translate"),P()}if(2&e){const i=q();vn("placeholder",ne(1,2,"sensors.buscar_sensores")),U("ngModel",i.searchAuxArray.value)}}function p7(e,t){if(1&e){const i=Ke();L(0,"input",46),ye("keyup",function(o){return ce(i),le(q().textSearch(o))})("ngModelChange",function(o){return ce(i),le(q().searchAuxArray.value=o)}),te(1,"translate"),P()}if(2&e){const i=q();vn("placeholder",ne(1,2,"sensors.buscar_sensores")),U("ngModel",i.searchAuxArray.value)}}function f7(e,t){1&e&&(L(0,"div",47)(1,"div",48)(2,"span",49),W(3),te(4,"translate"),P()()()),2&e&&(w(3),Ce(ne(4,1,"loading")))}function g7(e,t){1&e&&(L(0,"div",47)(1,"div",50)(2,"p",51),W(3),te(4,"translate"),P()()()),2&e&&(w(3),Ce(ne(4,1,"no_sensors")))}function m7(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",64),ye("click",function(){ce(i);const o=q(2);return o.alt1=!1,le(o.getSensorsLocal("position","DESC"))}),He(1,"path",65),P()}}function _7(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",66),ye("click",function(){ce(i);const o=q(2);return o.alt1=!0,le(o.getSensorsLocal("position","ASC"))}),He(1,"path",67),P()}}function v7(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",64),ye("click",function(){ce(i);const o=q(2);return o.alt2=!1,le(o.getSensorsLocal("type","DESC"))}),He(1,"path",65),P()}}function y7(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",66),ye("click",function(){ce(i);const o=q(2);return o.alt2=!0,le(o.getSensorsLocal("type","ASC"))}),He(1,"path",67),P()}}function x7(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",64),ye("click",function(){ce(i);const o=q(2);return o.alt3=!1,le(o.getSensorsLocal("metric","DESC"))}),He(1,"path",65),P()}}function b7(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",66),ye("click",function(){ce(i);const o=q(2);return o.alt3=!0,le(o.getSensorsLocal("metric","ASC"))}),He(1,"path",67),P()}}function w7(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",64),ye("click",function(){ce(i);const o=q(2);return o.alt4=!1,le(o.getSensorsLocal("description","DESC"))}),He(1,"path",65),P()}}function C7(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",66),ye("click",function(){ce(i);const o=q(2);return o.alt4=!0,le(o.getSensorsLocal("description","ASC"))}),He(1,"path",67),P()}}function M7(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",64),ye("click",function(){ce(i);const o=q(3);return o.alt6=!1,le(o.getSensorsLocal("correction_general","DESC"))}),He(1,"path",65),P()}}function E7(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",66),ye("click",function(){ce(i);const o=q(3);return o.alt6=!0,le(o.getSensorsLocal("correction_general","ASC"))}),He(1,"path",67),P()}}Tr.accessToken=qt_accessTokenMap;const Ls=function(e){return{mark:e}};function T7(e,t){if(1&e&&(L(0,"th",68),J(1,M7,2,0,"svg",56),J(2,E7,2,0,"svg",57),W(3),te(4,"translate"),P()),2&e){const i=q(2);U("ngClass",ft(6,Ls,"correction_general"==i.order)),w(1),U("ngIf",i.alt6),w(1),U("ngIf",!i.alt6),w(1),jt(" ",ne(4,4,"sensors.general")," ")}}function D7(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",64),ye("click",function(){ce(i);const o=q(3);return o.alt7=!1,le(o.getSensorsLocal("correction_time_general","DESC"))}),He(1,"path",65),P()}}function S7(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",66),ye("click",function(){ce(i);const o=q(3);return o.alt7=!0,le(o.getSensorsLocal("correction_time_general","ASC"))}),He(1,"path",67),P()}}function I7(e,t){if(1&e&&(L(0,"th",58),J(1,D7,2,0,"svg",56),J(2,S7,2,0,"svg",57),W(3),te(4,"translate"),P()),2&e){const i=q(2);U("ngClass",ft(6,Ls,"correction_time_general"==i.order)),w(1),U("ngIf",i.alt7),w(1),U("ngIf",!i.alt7),w(1),jt(" ",ne(4,4,"sensors.time_general")," ")}}function A7(e,t){if(1&e){const i=Ke();L(0,"td",71),ye("click",function(){ce(i);const o=q().$implicit;return le(q(2).orderColumn(o.id))}),W(1),P()}if(2&e){const i=q().$implicit,n=q(2);U("ngClass",ft(2,Ls,n.actId==i.id&&2==n.state)),w(1),Ce(i.correction_general)}}function P7(e,t){if(1&e){const i=Ke();L(0,"td",71),ye("click",function(){ce(i);const o=q().$implicit;return le(q(2).orderColumn(o.id))}),W(1),P()}if(2&e){const i=q().$implicit,n=q(2);U("ngClass",ft(2,Ls,n.actId==i.id&&2==n.state)),w(1),Ce(i.correction_time_general)}}function k7(e,t){1&e&&(xt(),L(0,"svg",80),He(1,"path",81)(2,"path",82)(3,"path",83),P())}function O7(e,t){1&e&&(xt(),L(0,"svg",84),He(1,"path",85)(2,"path",86),P())}function L7(e,t){1&e&&(xt(),L(0,"svg",87),He(1,"path",88),P())}function R7(e,t){1&e&&(xt(),L(0,"svg",89),He(1,"path",90),P())}const F7=function(e){return{mark_select:e}},l1=function(e){return{disabled:e}};function N7(e,t){if(1&e){const i=Ke();L(0,"tbody")(1,"tr",69)(2,"th",70),ye("click",function(){const c=ce(i).$implicit;return le(q(2).orderColumn(c.id))}),W(3),P(),L(4,"td",71),ye("click",function(){const c=ce(i).$implicit;return le(q(2).orderColumn(c.id))}),W(5),P(),L(6,"td",71),ye("click",function(){const c=ce(i).$implicit;return le(q(2).orderColumn(c.id))}),W(7),P(),L(8,"td",72),ye("click",function(){const c=ce(i).$implicit;return le(q(2).orderColumn(c.id))}),W(9),P(),J(10,A7,2,4,"td",73),J(11,P7,2,4,"td",73),L(12,"td",74),ye("mouseout",function(){return ce(i),le(q(2).viewDup=-1)})("mouseover",function(){const c=ce(i).index;return le(q(2).viewDup=c)})("click",function(){const c=ce(i).$implicit;return le(q(2).duplicateSensors(c.id,c.type))}),J(13,k7,4,0,"svg",75),J(14,O7,3,0,"svg",76),P(),L(15,"td",77),ye("mouseover",function(){const c=ce(i).index;return le(q(2).pencilDup=c)})("mouseout",function(){return ce(i),le(q(2).pencilDup=-1)})("click",function(){const c=ce(i).$implicit;return le(q(2).orderColumn(c.id))}),J(16,L7,2,0,"svg",78),J(17,R7,2,0,"svg",79),P()()()}if(2&e){const i=t.$implicit,n=t.index,o=q(2);w(1),U("ngClass",ft(18,F7,o.actId==i.id&&2==o.state))("ngClass",ft(20,l1,o.change)),w(1),U("ngClass",ft(22,Ls,o.actId==i.id&&2==o.state)),w(1),Ce(i.position),w(1),U("ngClass",ft(24,Ls,o.actId==i.id&&2==o.state)),w(1),Ce(i.type),w(1),U("ngClass",ft(26,Ls,o.actId==i.id&&2==o.state)),w(1),Ce(i.metric),w(1),U("ngClass",ft(28,Ls,o.actId==i.id&&2==o.state)),w(1),Ce(i.description),w(1),U("ngIf",0==o.show),w(1),U("ngIf",0==o.show),w(1),U("ngClass",ft(30,Ls,o.actId==i.id&&2==o.state)),w(1),U("ngIf",o.viewDup!=n),w(1),U("ngIf",o.viewDup==n),w(1),U("ngClass",ft(32,Ls,o.actId==i.id&&2==o.state)),w(1),U("ngIf",o.pencilDup!=n),w(1),U("ngIf",o.pencilDup==n)}}const z7=function(e){return{"table-hover":e}};function B7(e,t){if(1&e&&(L(0,"div",52)(1,"table",53)(2,"thead")(3,"tr",54)(4,"th",55),J(5,m7,2,0,"svg",56),J(6,_7,2,0,"svg",57),W(7),te(8,"translate"),P(),L(9,"th",58),J(10,v7,2,0,"svg",56),J(11,y7,2,0,"svg",57),W(12),te(13,"translate"),P(),L(14,"th",58),J(15,x7,2,0,"svg",56),J(16,b7,2,0,"svg",57),W(17),te(18,"translate"),P(),L(19,"th",59),J(20,w7,2,0,"svg",56),J(21,C7,2,0,"svg",57),W(22),te(23,"translate"),P(),J(24,T7,5,8,"th",60),J(25,I7,5,8,"th",61),L(26,"th",62),W(27),te(28,"translate"),P(),L(29,"th",62),W(30),te(31,"translate"),P()()(),J(32,N7,18,34,"tbody",63),P()()),2&e){const i=q();w(1),U("ngClass",ft(34,z7,!i.change)),w(3),U("ngClass",ft(36,Ls,"position"==i.order)),w(1),U("ngIf",i.alt1),w(1),U("ngIf",!i.alt1),w(1),jt(" ",ne(8,22,"sensors.order")," "),w(2),U("ngClass",ft(38,Ls,"type"==i.order)),w(1),U("ngIf",i.alt2),w(1),U("ngIf",!i.alt2),w(1),jt(" ",ne(13,24,"sensors.type")," "),w(2),U("ngClass",ft(40,Ls,"metric"==i.order)),w(1),U("ngIf",i.alt3),w(1),U("ngIf",!i.alt3),w(1),jt(" ",ne(18,26,"sensors.metric")," "),w(2),U("ngClass",ft(42,Ls,"description"==i.order)),w(1),U("ngIf",i.alt4),w(1),U("ngIf",!i.alt4),w(1),jt(" ",ne(23,28,"sensors.description")," "),w(2),U("ngIf",0==i.show),w(1),U("ngIf",0==i.show),w(2),Ce(ne(28,30,"sensors.duplicate")),w(3),Ce(ne(31,32,"sensors.edit")),w(2),U("ngForOf",i.data)}}function V7(e,t){if(1&e&&(L(0,"option",91),W(1),te(2,"translate"),P()),2&e){const i=t.$implicit;U("value",i)("selected",15==i),w(1),pn("",i," ",ne(2,4,"res"),"")}}function U7(e,t){if(1&e){const i=Ke();L(0,"li",93)(1,"a",94),ye("click",function(){return ce(i),le(q(2).previousPage10())}),L(2,"span",95),W(3,"\xab 10"),P()()()}}function j7(e,t){if(1&e){const i=Ke();L(0,"li",93)(1,"a",99),ye("click",function(){return ce(i),le(q(2).previousPage())}),W(2),P()()}if(2&e){const i=q(2);w(2),Ce(i.currentPage-1)}}function $7(e,t){if(1&e){const i=Ke();L(0,"li",93)(1,"a",99),ye("click",function(){return ce(i),le(q(2).nextPage())}),W(2),P()()}if(2&e){const i=q(2);w(2),Ce(i.currentPage+1)}}function H7(e,t){if(1&e){const i=Ke();L(0,"li",93)(1,"a",98),ye("click",function(){return ce(i),le(q(2).nextPage10())}),L(2,"span",95),W(3,"10 \xbb"),P()()()}}function G7(e,t){if(1&e){const i=Ke();L(0,"ul",92)(1,"li",93)(2,"a",94),ye("click",function(){return ce(i),le(q().firstPage())}),L(3,"span",95),W(4),te(5,"translate"),P()()(),J(6,U7,4,0,"li",96),J(7,j7,3,1,"li",96),L(8,"li",93)(9,"a",97),ye("click",function(){ce(i);const o=q();return le(o.Page(o.currentPage))}),L(10,"strong"),W(11),P()()(),J(12,$7,3,1,"li",96),J(13,H7,4,0,"li",96),L(14,"li",93)(15,"a",98),ye("click",function(){return ce(i),le(q().lastPage())}),L(16,"span",95),W(17),te(18,"translate"),P()()()()}if(2&e){const i=q();w(4),Ce(ne(5,7,"first")),w(2),U("ngIf",i.currentPage-10>0),w(1),U("ngIf",i.currentPage-1!=0),w(4),Ce(i.currentPage),w(1),U("ngIf",i.currentPage!=i.totalPages),w(1),U("ngIf",i.currentPage+10<i.totalPages),w(4),Ce(ne(18,9,"last"))}}function q7(e,t){if(1&e&&(L(0,"h1",135),W(1),te(2,"translate"),P()),2&e){const i=q(2);w(1),pn("",ne(2,2,"sensors.duplicate")," ",i.sensors.type,"")}}function Z7(e,t){1&e&&(L(0,"h1",135),W(1),te(2,"translate"),P()),2&e&&(w(1),Ce(ne(2,1,"sensors.nuevo_sensor")))}function W7(e,t){if(1&e&&(L(0,"h1",135),W(1),te(2,"translate"),P()),2&e){const i=q(2);w(1),pn("",ne(2,2,"sensors.of")," ",i.sensors.type,"")}}function X7(e,t){if(1&e){const i=Ke();L(0,"input",136,137),ye("ngModelChange",function(){return ce(i),le(q(2).change=!0)})("ngModelChange",function(o){return ce(i),le(q(2).sensors.id=o)}),P()}if(2&e){const i=q(2);vn("value",i.sensors.id),U("ngModel",i.sensors.id)}}function Y7(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"sensors.type")," ",ne(3,4,"required"),""))}function K7(e,t){if(1&e&&(L(0,"div",138),J(1,Y7,4,6,"div",139),P()),2&e){q();const i=Vt(2);w(1),U("ngIf",i.controls.type.errors.required)}}function J7(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"sensors.metric")," ",ne(3,4,"required"),""))}function Q7(e,t){if(1&e&&(L(0,"div",138),J(1,J7,4,6,"div",139),P()),2&e){q();const i=Vt(2);w(1),U("ngIf",i.controls.metric.errors.required)}}function eU(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"sensors.order")," ",ne(3,4,"required"),""))}function tU(e,t){if(1&e&&(L(0,"div",138),J(1,eU,4,6,"div",139),P()),2&e){q();const i=Vt(2);w(1),U("ngIf",i.controls.position.errors.required)}}function nU(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"sensors.description")," ",ne(3,4,"required"),""))}function iU(e,t){if(1&e&&(L(0,"div",138),J(1,nU,4,6,"div",139),P()),2&e){q();const i=Vt(2);w(1),U("ngIf",i.controls.description.errors.required)}}function rU(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"sensors.error_value")," ",ne(3,4,"required"),""))}function oU(e,t){if(1&e&&(L(0,"div",138),J(1,rU,4,6,"div",139),P()),2&e){q();const i=Vt(2);w(1),U("ngIf",i.controls.errorvalue.errors.required)}}function sU(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"sensors.time_general")," ",ne(3,4,"required"),""))}function aU(e,t){if(1&e&&(L(0,"div",138),J(1,sU,4,6,"div",139),P()),2&e){q();const i=Vt(2);w(1),U("ngIf",i.controls.time_general.errors.required)}}function lU(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"sensors.value_min")," ",ne(3,4,"required"),""))}function cU(e,t){if(1&e&&(L(0,"div",138),J(1,lU,4,6,"div",139),P()),2&e){q();const i=Vt(2);w(1),U("ngIf",i.controls.valuemin.errors.required)}}function uU(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"sensors.value_max")," ",ne(3,4,"required"),""))}function dU(e,t){if(1&e&&(L(0,"div",138),J(1,uU,4,6,"div",139),P()),2&e){q();const i=Vt(2);w(1),U("ngIf",i.controls.valuemax.errors.required)}}function hU(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"sensors.general")," ",ne(3,4,"required"),""))}function pU(e,t){if(1&e&&(L(0,"div",138),J(1,hU,4,6,"div",139),P()),2&e){q();const i=Vt(2);w(1),U("ngIf",i.controls.general.errors.required)}}function fU(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"sensors.discard_value")," ",ne(3,4,"required"),""))}function gU(e,t){if(1&e&&(L(0,"div",138),J(1,fU,4,6,"div",139),P()),2&e){q();const i=Vt(2);w(1),U("ngIf",i.controls.discard_value.errors.required)}}function mU(e,t){if(1&e){const i=Ke();L(0,"div",32)(1,"div",33)(2,"button",140),ye("click",function(){return ce(i),le(q(2).clouseAll())}),W(3),te(4,"translate"),P()(),L(5,"div",33)(6,"button",141),ye("click",function(){ce(i),q();const o=Vt(2);return le(q().newSensor(o))}),W(7),te(8,"translate"),P()()()}if(2&e){const i=q(2);w(3),Ce(ne(4,3,"sensors.exit")),w(3),U("ngClass",ft(7,l1,!i.change&&0!=i.state)),w(1),Ce(ne(8,5,"sensors.save"))}}function _U(e,t){if(1&e){const i=Ke();L(0,"button",140),ye("click",function(){return ce(i),le(q(3).clouse())}),W(1),te(2,"translate"),P()}2&e&&(w(1),Ce(ne(2,1,"sensors.exit")))}function vU(e,t){1&e&&(L(0,"button",148),W(1),te(2,"translate"),P()),2&e&&(w(1),Ce(ne(2,1,"reset.data")))}function yU(e,t){1&e&&(L(0,"button",149),W(1),te(2,"translate"),P()),2&e&&(w(1),Ce(ne(2,1,"sensors.erase_sensor")))}function xU(e,t){1&e&&(L(0,"button",150),W(1),te(2,"translate"),P()),2&e&&(w(1),Ce(ne(2,1,"sensors.erase_sensor")))}function bU(e,t){if(1&e){const i=Ke();L(0,"div",32)(1,"div",33),J(2,_U,3,3,"button",142),J(3,vU,3,3,"button",143),P(),L(4,"div",33)(5,"button",144),ye("click",function(){ce(i),q();const o=Vt(2);return le(q().editSensor(o))}),W(6),te(7,"translate"),P()(),L(8,"div",133)(9,"div",145)(10,"div",33),J(11,yU,3,3,"button",146),J(12,xU,3,3,"button",147),P()()()()}if(2&e){const i=q(2);w(2),U("ngIf",0==i.change),w(1),U("ngIf",1==i.change),w(2),U("ngClass",ft(8,l1,!i.change)),w(1),Ce(ne(7,6,"sensors.save")),w(5),U("ngIf",i.change),w(1),U("ngIf",!i.change)}}const wU=function(e,t){return{sensores_2_100:e,sensores_2_20:t}},oA=function(e){return{"mt-2":e}};function CU(e,t){if(1&e){const i=Ke();L(0,"div",1)(1,"form",100,101)(3,"div",102)(4,"div",103)(5,"div",102),J(6,q7,3,4,"h1",104),J(7,Z7,3,3,"h1",104),J(8,W7,3,4,"h1",104),P(),J(9,X7,2,2,"input",105),L(10,"div",106)(11,"label",107),W(12),te(13,"translate"),P(),L(14,"input",108),ye("ngModelChange",function(){return ce(i),le(q().change=!0)})("ngModelChange",function(o){return ce(i),le(q().sensors.type=o)}),P(),J(15,K7,2,1,"div",109),P(),L(16,"div",110)(17,"label",111),W(18),te(19,"translate"),P(),L(20,"input",112),ye("ngModelChange",function(){return ce(i),le(q().change=!0)})("ngModelChange",function(o){return ce(i),le(q().sensors.metric=o)}),P(),J(21,Q7,2,1,"div",109),P(),L(22,"div",113)(23,"label",114),W(24),te(25,"translate"),P(),L(26,"input",115),ye("ngModelChange",function(){return ce(i),le(q().change=!0)})("ngModelChange",function(o){return ce(i),le(q().sensors.position=o)}),P(),J(27,tU,2,1,"div",109),P(),L(28,"div",116)(29,"label",117),W(30),te(31,"translate"),P(),L(32,"input",118),ye("ngModelChange",function(){return ce(i),le(q().change=!0)})("ngModelChange",function(o){return ce(i),le(q().sensors.description=o)}),P(),J(33,iU,2,1,"div",109),P(),L(34,"div",119)(35,"label",120),W(36),te(37,"translate"),P(),L(38,"input",121),ye("ngModelChange",function(){return ce(i),le(q().change=!0)})("ngModelChange",function(o){return ce(i),le(q().sensors.errorvalue=o)}),P(),J(39,oU,2,1,"div",109),P(),L(40,"div",119)(41,"label",122),W(42),te(43,"translate"),P(),L(44,"input",123),ye("ngModelChange",function(){return ce(i),le(q().change=!0)})("ngModelChange",function(o){return ce(i),le(q().sensors.correction_time_general=o)}),P(),J(45,aU,2,1,"div",109),P(),L(46,"div",124)(47,"label",125),W(48),te(49,"translate"),P(),L(50,"input",126),ye("ngModelChange",function(){return ce(i),le(q().change=!0)})("ngModelChange",function(o){return ce(i),le(q().sensors.valuemin=o)}),P(),J(51,cU,2,1,"div",109),P(),L(52,"div",124)(53,"label",127),W(54),te(55,"translate"),P(),L(56,"input",128),ye("ngModelChange",function(){return ce(i),le(q().change=!0)})("ngModelChange",function(o){return ce(i),le(q().sensors.valuemax=o)}),P(),J(57,dU,2,1,"div",109),P(),L(58,"div",116)(59,"label",129),W(60),te(61,"translate"),P(),L(62,"input",130),ye("ngModelChange",function(){return ce(i),le(q().change=!0)})("ngModelChange",function(o){return ce(i),le(q().sensors.correction_general=o)}),P(),J(63,pU,2,1,"div",109),P(),L(64,"div",116)(65,"label",131),W(66),te(67,"translate"),P(),L(68,"input",132),ye("ngModelChange",function(){return ce(i),le(q().change=!0)})("ngModelChange",function(o){return ce(i),le(q().sensors.discard_value=o)}),P(),J(69,gU,2,1,"div",109),P()()(),L(70,"div",133),J(71,mU,9,9,"div",134),J(72,bU,13,10,"div",134),P()()()}if(2&e){const i=Vt(2),n=q();U("ngClass",Ap(69,wU,n.width<965,n.width>=965)),w(6),U("ngIf",0==n.state),w(1),U("ngIf",1==n.state),w(1),U("ngIf",2==n.state),w(1),U("ngIf",2==n.state),w(3),Ce(ne(13,49,"sensors.type")),w(2),vn("value",n.sensors.type),U("ngModel",n.sensors.type),w(1),U("ngIf",i.submitted&&i.controls.type.errors),w(3),Ce(ne(19,51,"sensors.metric")),w(2),vn("value",n.sensors.metric),U("ngModel",n.sensors.metric),w(1),U("ngIf",i.submitted&&i.controls.metric.errors),w(3),Ce(ne(25,53,"sensors.order")),w(2),vn("value",n.sensors.position),U("ngModel",n.sensors.position),w(1),U("ngIf",i.submitted&&i.controls.position.errors),w(3),Ce(ne(31,55,"sensors.description")),w(2),vn("value",n.sensors.description),U("ngModel",n.sensors.description),w(1),U("ngIf",i.submitted&&i.controls.description.errors),w(1),U("ngClass",ft(72,oA,n.width>=965)),w(2),Ce(ne(37,57,"sensors.error_value")),w(2),vn("value",n.sensors.errorvalue),U("ngModel",n.sensors.errorvalue),w(1),U("ngIf",i.submitted&&i.controls.errorvalue.errors),w(1),U("ngClass",ft(74,oA,n.width>=965)),w(2),Ce(ne(43,59,"sensors.time_general")),w(2),vn("value",n.sensors.correction_time_general),U("ngModel",n.sensors.correction_time_general),w(1),U("ngIf",i.submitted&&i.controls.time_general.errors),w(3),Ce(ne(49,61,"sensors.value_min")),w(2),vn("value",n.sensors.valuemin),U("ngModel",n.sensors.valuemin),w(1),U("ngIf",i.submitted&&i.controls.valuemin.errors),w(3),Ce(ne(55,63,"sensors.value_max")),w(2),vn("value",n.sensors.valuemax),U("ngModel",n.sensors.valuemax),w(1),U("ngIf",i.submitted&&i.controls.valuemax.errors),w(3),Ce(ne(61,65,"sensors.general")),w(2),vn("value",n.sensors.correction_general),U("ngModel",n.sensors.correction_general),w(1),U("ngIf",i.submitted&&i.controls.general.errors),w(3),Ce(ne(67,67,"sensors.discard_value")),w(2),vn("value",n.sensors.discard_value),U("ngModel",n.sensors.discard_value),w(1),U("ngIf",i.submitted&&i.controls.discard_value.errors),w(2),U("ngIf",1==n.state||0==n.state),w(1),U("ngIf",2==n.state)}}function MU(e,t){if(1&e){const i=Ke();L(0,"button",151),ye("click",function(){ce(i);const o=q();return le(o.deleteSensors(o.id))}),W(1),te(2,"translate"),P()}2&e&&(w(1),Ce(ne(2,1,"sensors.delete")))}function EU(e,t){if(1&e){const i=Ke();L(0,"button",152),ye("click",function(){ce(i);const o=q();return le(o.deleteSensors(o.id))}),W(1),te(2,"translate"),P()}2&e&&(w(1),Ce(ne(2,1,"sensors.delete")))}function TU(e,t){1&e&&(L(0,"div",153)(1,"div",154)(2,"div",155)(3,"div",156),W(4),te(5,"translate"),P(),He(6,"button",157),P()()()),2&e&&(w(4),jt(" ",ne(5,1,"sensors.e7")," "))}function DU(e,t){1&e&&(L(0,"div",158)(1,"div",159)(2,"div",155)(3,"div",156),W(4),te(5,"translate"),P(),He(6,"button",157),P()()()),2&e&&(w(4),jt(" ",ne(5,1,"sensors.e8")," "))}function SU(e,t){1&e&&(L(0,"div",158)(1,"div",154)(2,"div",155)(3,"div",156),W(4),te(5,"translate"),P(),He(6,"button",157),P()()()),2&e&&(w(4),jt(" ",ne(5,1,"sensors.e3")," "))}function IU(e,t){1&e&&(L(0,"div",158)(1,"div",159)(2,"div",155)(3,"div",156),W(4),te(5,"translate"),P(),He(6,"button",157),P()()()),2&e&&(w(4),jt(" ",ne(5,1,"sensors.e6")," "))}function AU(e,t){1&e&&(L(0,"div",158)(1,"div",154)(2,"div",155)(3,"div",156),W(4),te(5,"translate"),P(),He(6,"button",157),P()()()),2&e&&(w(4),jt(" ",ne(5,1,"sensors.e4")," "))}function PU(e,t){1&e&&(L(0,"div",158)(1,"div",159)(2,"div",155)(3,"div",156),W(4),te(5,"translate"),P(),He(6,"button",157),P()()()),2&e&&(w(4),jt(" ",ne(5,1,"sensors.e5")," "))}function kU(e,t){1&e&&(L(0,"div",158)(1,"div",154)(2,"div",155)(3,"div",156),W(4),te(5,"translate"),P(),He(6,"button",157),P()()()),2&e&&(w(4),jt(" ",ne(5,1,"sensors.e2")," "))}function OU(e,t){1&e&&(L(0,"div",158)(1,"div",159)(2,"div",155)(3,"div",156),W(4),te(5,"translate"),P(),He(6,"button",157),P()()()),2&e&&(w(4),jt(" ",ne(5,1,"sensors.e1")," "))}const LU=function(e,t){return{"rev ps-2":e,"":t}},RU=function(e,t){return{c100:e,c10:t}};function NU(e,t){if(1&e){const i=Ke();L(0,"input",44),ye("keyup",function(o){return ce(i),le(q().textSearch(o))})("ngModelChange",function(o){return ce(i),le(q().search.value=o)}),te(1,"translate"),P()}if(2&e){const i=q();vn("placeholder",ne(1,2,"structure.buscar_structure")),U("ngModel",i.search.value)}}function zU(e,t){if(1&e){const i=Ke();L(0,"input",45),ye("keyup",function(o){return ce(i),le(q().textSearch(o))})("ngModelChange",function(o){return ce(i),le(q().search.value=o)}),te(1,"translate"),P()}if(2&e){const i=q();vn("placeholder",ne(1,2,"structure.buscar_structure")),U("ngModel",i.search.value)}}function BU(e,t){1&e&&(L(0,"div",46)(1,"div",47)(2,"span",48),W(3),te(4,"translate"),P()()()),2&e&&(w(3),Ce(ne(4,1,"loading")))}function VU(e,t){1&e&&(L(0,"div",46)(1,"div",49)(2,"p",50),W(3),te(4,"translate"),P()()()),2&e&&(w(3),Ce(ne(4,1,"no_structure")))}function UU(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",59),ye("click",function(){ce(i);const o=q(2);return o.alt1=!1,le(o.getStructuresLocal("description","DESC"))}),He(1,"path",60),P()}}function jU(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",61),ye("click",function(){ce(i);const o=q(2);return o.alt1=!0,le(o.getStructuresLocal("description","ASC"))}),He(1,"path",62),P()}}function $U(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",59),ye("click",function(){ce(i);const o=q(2);return o.alt2=!1,le(o.getStructuresLocal("configuration","DESC"))}),He(1,"path",60),P()}}function HU(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",61),ye("click",function(){ce(i);const o=q(2);return o.alt2=!0,le(o.getStructuresLocal("configuration","ASC"))}),He(1,"path",62),P()}}function GU(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",59),ye("click",function(){ce(i);const o=q(2);return o.alt3=!1,le(o.getStructuresLocal("identifier_code","DESC"))}),He(1,"path",60),P()}}function qU(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",61),ye("click",function(){ce(i);const o=q(2);return o.alt3=!0,le(o.getStructuresLocal("identifier_code","ASC"))}),He(1,"path",62),P()}}function ZU(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",59),ye("click",function(){ce(i);const o=q(2);return o.alt4=!1,le(o.getStructuresLocal("id_variable_data_structure","DESC"))}),He(1,"path",60),P()}}function WU(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",61),ye("click",function(){ce(i);const o=q(2);return o.alt4=!0,le(o.getStructuresLocal("id_variable_data_structure","ASC"))}),He(1,"path",62),P()}}function XU(e,t){if(1&e&&(na(0),L(1,"option",96),W(2),P(),ia()),2&e){const i=t.$implicit,n=q(5);w(1),vn("value",i.id),U("selected",i.id==n.estructure.id_variable_data_structure),w(1),Ce(i.description)}}function YU(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"structure.id_variable_data_structure")," ",ne(3,4,"required"),""))}function KU(e,t){if(1&e&&(xt(),eo(),L(0,"div",97),J(1,YU,4,6,"div",98),P()),2&e){q();const i=Vt(2);w(1),U("ngIf",i.controls.id_variable_data_structure.errors.required)}}const JU=function(e){return{"mb-3":e}},c1=function(e){return{disabled:e}};function QU(e,t){if(1&e){const i=Ke();xt(),eo(),L(0,"div",99)(1,"div",31)(2,"div",100)(3,"button",101),ye("click",function(){return ce(i),le(q(5).clouseAll())}),W(4),te(5,"translate"),P()(),L(6,"div",102)(7,"button",103),ye("click",function(){ce(i),q();const o=Vt(2);return le(q(4).newStructures(o))}),W(8),te(9,"translate"),P()()()()}if(2&e){const i=q(5);w(2),U("ngClass",ft(8,JU,i.width<965)),w(2),Ce(ne(5,4,"sensors.exit")),w(3),U("ngClass",ft(10,c1,!i.change&&1==i.state)),w(1),Ce(ne(9,6,"sensors.save"))}}function ej(e,t){if(1&e){const i=Ke();L(0,"td",77)(1,"form",78,79)(3,"div",80)(4,"label",81),W(5),te(6,"translate"),P(),L(7,"input",82),ye("ngModelChange",function(){return ce(i),le(q(4).change=!0)})("ngModelChange",function(o){return ce(i),le(q(4).estructure.description=o)}),P()(),L(8,"div",80)(9,"label",83),W(10),te(11,"translate"),P(),L(12,"input",84),ye("ngModelChange",function(){return ce(i),le(q(4).change=!0)})("ngModelChange",function(o){return ce(i),le(q(4).estructure.configuration=o)}),P()(),L(13,"div",85)(14,"label",86),W(15),te(16,"translate"),P(),L(17,"input",87),ye("ngModelChange",function(){return ce(i),le(q(4).change=!0)})("ngModelChange",function(o){return ce(i),le(q(4).estructure.identifier_code=o)}),P()(),L(18,"div",88)(19,"label",89),W(20),te(21,"translate"),P(),L(22,"select",90),ye("ngModelChange",function(){return ce(i),le(q(4).change=!0)})("ngModelChange",function(o){return ce(i),le(q(4).estructure.id_variable_data_structure=o)}),J(23,XU,3,3,"ng-container",58),P(),L(24,"div",91),xt(),L(25,"svg",92),He(26,"path",93),P()(),J(27,KU,2,1,"div",94),P(),J(28,QU,10,12,"div",95),P()()}if(2&e){const i=Vt(2),n=q(4);w(5),Ce(ne(6,15,"sensors.description")),w(2),vn("value",n.estructure.description),U("ngModel",n.estructure.description),w(3),Ce(ne(11,17,"structure.configuration")),w(2),vn("value",n.estructure.configuration),U("ngModel",n.estructure.configuration),w(3),Ce(ne(16,19,"structure.identifier_code")),w(2),vn("value",n.estructure.identifier_code),U("ngModel",n.estructure.identifier_code),w(3),Ce(ne(21,21,"structure.id_variable_data_structure")),w(2),U("value",n.estructure.id_variable_data_structure)("ngModel",n.estructure.id_variable_data_structure),w(1),U("ngForOf",n.estructureVariable.structure),w(4),U("ngIf",i.submitted&&i.controls.id_variable_data_structure.errors),w(1),U("ngIf",1==n.state||0==n.state)}}function tj(e,t){if(1&e&&(L(0,"tr",75),J(1,ej,29,23,"td",76),P()),2&e){const i=q(3);w(1),U("ngIf",i.show)}}function nj(e,t){1&e&&(xt(),L(0,"svg",104),W(1,"5 "),He(2,"path",105)(3,"path",106)(4,"path",107),P())}function ij(e,t){1&e&&(xt(),L(0,"svg",108),He(1,"path",109)(2,"path",110),P())}function rj(e,t){1&e&&(xt(),L(0,"svg",111),He(1,"path",112),P())}function oj(e,t){1&e&&(xt(),L(0,"svg",113),He(1,"path",114),P())}function sj(e,t){if(1&e){const i=Ke();L(0,"input",118,119),ye("ngModelChange",function(){return ce(i),le(q(5).change=!0)})("ngModelChange",function(o){return ce(i),le(q(5).estructure.id_estructure=o)}),P()}if(2&e){const i=q(5);vn("value",i.estructure.id_estructure),U("ngModel",i.estructure.id_estructure)}}function aj(e,t){if(1&e&&(na(0),L(1,"option",96),W(2),P(),ia()),2&e){const i=t.$implicit,n=q(5);w(1),vn("value",i.id),U("selected",i.id==n.estructure.id_variable_data_structure),w(1),Ce(i.description)}}function lj(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"structure.id_variable_data_structure")," ",ne(3,4,"required"),""))}function cj(e,t){if(1&e&&(xt(),eo(),L(0,"div",97),J(1,lj,4,6,"div",98),P()),2&e){q();const i=Vt(2);w(1),U("ngIf",i.controls.id_variable_data_structure.errors.required)}}function uj(e,t){if(1&e){const i=Ke();L(0,"button",101),ye("click",function(){return ce(i),le(q(6).clouse())}),W(1),te(2,"translate"),P()}2&e&&(w(1),Ce(ne(2,1,"sensors.exit")))}function dj(e,t){1&e&&(L(0,"button",131),W(1),te(2,"translate"),P()),2&e&&(w(1),Ce(ne(2,1,"reset.data")))}function hj(e,t){1&e&&(L(0,"button",132),W(1),te(2,"translate"),P()),2&e&&(w(1),Ce(ne(2,1,"sensors.delete")))}function pj(e,t){1&e&&(L(0,"button",133),W(1),te(2,"translate"),P()),2&e&&(w(1),Ce(ne(2,1,"sensors.delete")))}const fj=function(e){return{"pb-3":e}};function gj(e,t){if(1&e){const i=Ke();xt(),eo(),L(0,"div",99)(1,"div",31)(2,"div",120)(3,"div",31)(4,"div",121),J(5,uj,3,3,"button",122),J(6,dj,3,3,"button",123),P(),L(7,"div",124)(8,"button",125),ye("click",function(){ce(i),q();const o=Vt(2),c=q(2).index;return le(q(2).editStructuresAux(o,c))}),W(9),te(10,"translate"),P()()()(),L(11,"div",126)(12,"div",127)(13,"div",128),J(14,hj,3,3,"button",129),J(15,pj,3,3,"button",130),P()()()()()}if(2&e){const i=q(5);w(5),U("ngIf",0==i.change||1==i.saved),w(1),U("ngIf",1==i.change&&0==i.saved),w(2),U("ngClass",ft(9,c1,!i.change)),w(1),Ce(ne(10,7,"sensors.save")),w(2),U("ngClass",ft(11,fj,i.width<965)),w(3),U("ngIf",i.change),w(1),U("ngIf",!i.change)}}function mj(e,t){if(1&e){const i=Ke();L(0,"td",77)(1,"form",116,79),J(3,sj,2,2,"input",117),L(4,"div",80)(5,"label",81),W(6),te(7,"translate"),P(),L(8,"input",82),ye("ngModelChange",function(){return ce(i),le(q(4).change=!0)})("ngModelChange",function(o){return ce(i),le(q(4).estructure.description=o)}),P()(),L(9,"div",80)(10,"label",83),W(11),te(12,"translate"),P(),L(13,"input",84),ye("ngModelChange",function(){return ce(i),le(q(4).change=!0)})("ngModelChange",function(o){return ce(i),le(q(4).estructure.configuration=o)}),P()(),L(14,"div",85)(15,"label",86),W(16),te(17,"translate"),P(),L(18,"input",87),ye("ngModelChange",function(){return ce(i),le(q(4).change=!0)})("ngModelChange",function(o){return ce(i),le(q(4).estructure.identifier_code=o)}),P()(),L(19,"div",88)(20,"label",89),W(21),te(22,"translate"),P(),L(23,"select",90),ye("ngModelChange",function(){return ce(i),le(q(4).change=!0)})("ngModelChange",function(o){return ce(i),le(q(4).estructure.id_variable_data_structure=o)}),J(24,aj,3,3,"ng-container",58),P(),L(25,"div",91),xt(),L(26,"svg",92),He(27,"path",93),P()(),J(28,cj,2,1,"div",94),P(),J(29,gj,16,13,"div",95),P()()}if(2&e){const i=Vt(2),n=q(4);w(3),U("ngIf",2==n.state),w(3),Ce(ne(7,16,"sensors.description")),w(2),vn("value",n.estructure.description),U("ngModel",n.estructure.description),w(3),Ce(ne(12,18,"structure.configuration")),w(2),vn("value",n.estructure.configuration),U("ngModel",n.estructure.configuration),w(3),Ce(ne(17,20,"structure.identifier_code")),w(2),vn("value",n.estructure.identifier_code),U("ngModel",n.estructure.identifier_code),w(3),Ce(ne(22,22,"structure.id_variable_data_structure")),w(2),U("value",n.estructure.id_variable_data_structure)("ngModel",n.estructure.id_variable_data_structure),w(1),U("ngForOf",n.estructureVariable.structure),w(4),U("ngIf",i.submitted&&i.controls.id_variable_data_structure.errors),w(1),U("ngIf",2==n.state)}}const _j=function(e){return{mark_select:e}};function vj(e,t){if(1&e&&(L(0,"tr",115),J(1,mj,30,24,"td",76),P()),2&e){const i=q().$implicit,n=q(2);U("ngClass",ft(2,_j,n.actId==i.id_estructure)),w(1),U("ngIf",n.show)}}const Ic=function(e){return{mark:e}};function yj(e,t){if(1&e){const i=Ke();L(0,"tbody"),J(1,tj,2,1,"tr",63),L(2,"tr",64)(3,"th",65),ye("click",function(){const c=ce(i).$implicit;return le(q(2).orderColumn(c.id_estructure))}),W(4),P(),L(5,"td",66),ye("click",function(){const c=ce(i).$implicit;return le(q(2).orderColumn(c.id_estructure))}),W(6),P(),L(7,"td",67),ye("click",function(){const c=ce(i).$implicit;return le(q(2).orderColumn(c.id_estructure))}),W(8),P(),L(9,"td",67),ye("click",function(){const c=ce(i).$implicit;return le(q(2).orderColumn(c.id_estructure))}),W(10),P(),L(11,"td",68),ye("mouseout",function(){return ce(i),le(q(2).viewDup=-1)})("mouseover",function(){const c=ce(i).index;return le(q(2).viewDup=c)})("click",function(){const c=ce(i).$implicit;return le(q(2).duplicateStructures(c.id_estructure,c.description))}),J(12,nj,5,0,"svg",69),J(13,ij,3,0,"svg",70),P(),L(14,"td",71),ye("mouseover",function(){const c=ce(i).index;return le(q(2).pencilDup=c)})("mouseout",function(){return ce(i),le(q(2).pencilDup=-1)})("click",function(){const c=ce(i).$implicit;return le(q(2).orderColumn(c.id_estructure))}),J(15,rj,2,0,"svg",72),J(16,oj,2,0,"svg",73),P()(),J(17,vj,2,4,"tr",74),P()}if(2&e){const i=t.$implicit,n=t.index,o=q(2);w(1),U("ngIf",n+1==o.actId&&(0==o.state||1==o.state)),w(1),U("ngClass",ft(17,c1,o.change)),w(1),U("ngClass",ft(19,Ic,o.actId==i.id_estructure&&2==o.state)),w(1),Ce(i.description),w(1),U("ngClass",ft(21,Ic,o.actId==i.id_estructure&&2==o.state)),w(1),Ce(i.configuration),w(1),U("ngClass",ft(23,Ic,o.actId==i.id_estructure&&2==o.state)),w(1),Ce(i.identifier_code),w(1),U("ngClass",ft(25,Ic,o.actId==i.id_estructure&&2==o.state)),w(1),Ce(i.variable_description),w(1),U("ngClass",ft(27,Ic,o.actId==i.id_estructure&&2==o.state)),w(1),U("ngIf",o.viewDup!=n),w(1),U("ngIf",o.viewDup==n),w(1),U("ngClass",ft(29,Ic,o.actId==i.id_estructure&&2==o.state)),w(1),U("ngIf",o.pencilDup!=n),w(1),U("ngIf",o.pencilDup==n),w(1),U("ngIf",i.id_estructure==o.actId&&2==o.state)}}const xj=function(e){return{"table-hover":e}};function bj(e,t){if(1&e&&(L(0,"div",51)(1,"table",52)(2,"thead")(3,"tr")(4,"th",53),J(5,UU,2,0,"svg",54),J(6,jU,2,0,"svg",55),W(7),te(8,"translate"),P(),L(9,"th",56),J(10,$U,2,0,"svg",54),J(11,HU,2,0,"svg",55),W(12),te(13,"translate"),P(),L(14,"th",56),J(15,GU,2,0,"svg",54),J(16,qU,2,0,"svg",55),W(17),te(18,"translate"),P(),L(19,"th",56),J(20,ZU,2,0,"svg",54),J(21,WU,2,0,"svg",55),W(22),te(23,"translate"),P(),L(24,"th",57),W(25),te(26,"translate"),P(),L(27,"th",57),W(28),te(29,"translate"),P()()(),J(30,yj,18,31,"tbody",58),P()()),2&e){const i=q();w(1),U("ngClass",ft(32,xj,!i.change)),w(3),U("ngClass",ft(34,Ic,"description"==i.order)),w(1),U("ngIf",i.alt1),w(1),U("ngIf",!i.alt1),w(1),jt(" ",ne(8,20,"sensors.description")," "),w(2),U("ngClass",ft(36,Ic,"configuration"==i.order)),w(1),U("ngIf",i.alt2),w(1),U("ngIf",!i.alt2),w(1),jt(" ",ne(13,22,"structure.configuration")," "),w(2),U("ngClass",ft(38,Ic,"identifier_code"==i.order)),w(1),U("ngIf",i.alt3),w(1),U("ngIf",!i.alt3),w(1),jt(" ",ne(18,24,"structure.identifier_code")," "),w(2),U("ngClass",ft(40,Ic,"id_variable_data_structure"==i.order)),w(1),U("ngIf",i.alt4),w(1),U("ngIf",!i.alt4),w(1),jt(" ",ne(23,26,"structure.id_variable_data_structure")," "),w(3),Ce(ne(26,28,"sensors.duplicate")),w(3),Ce(ne(29,30,"sensors.edit")),w(2),U("ngForOf",i.data)}}function wj(e,t){if(1&e&&(L(0,"option",134),W(1),te(2,"translate"),P()),2&e){const i=t.$implicit;U("value",i)("selected",15==i),w(1),pn("",i," ",ne(2,4,"res"),"")}}function Cj(e,t){if(1&e){const i=Ke();L(0,"li",136)(1,"a",137),ye("click",function(){return ce(i),le(q(2).previousPage10())}),L(2,"span",138),W(3,"\xab 10"),P()()()}}function Mj(e,t){if(1&e){const i=Ke();L(0,"li",136)(1,"a",142),ye("click",function(){return ce(i),le(q(2).previousPage())}),W(2),P()()}if(2&e){const i=q(2);w(2),Ce(i.currentPage-1)}}function Ej(e,t){if(1&e){const i=Ke();L(0,"li",136)(1,"a",142),ye("click",function(){return ce(i),le(q(2).nextPage())}),W(2),P()()}if(2&e){const i=q(2);w(2),Ce(i.currentPage+1)}}function Tj(e,t){if(1&e){const i=Ke();L(0,"li",136)(1,"a",141),ye("click",function(){return ce(i),le(q(2).nextPage10())}),L(2,"span",138),W(3,"10 \xbb"),P()()()}}function Dj(e,t){if(1&e){const i=Ke();L(0,"ul",135)(1,"li",136)(2,"a",137),ye("click",function(){return ce(i),le(q().firstPage())}),L(3,"span",138),W(4),te(5,"translate"),P()()(),J(6,Cj,4,0,"li",139),J(7,Mj,3,1,"li",139),L(8,"li",136)(9,"a",140),ye("click",function(){ce(i);const o=q();return le(o.Page(o.currentPage))}),L(10,"strong"),W(11),P()()(),J(12,Ej,3,1,"li",139),J(13,Tj,4,0,"li",139),L(14,"li",136)(15,"a",141),ye("click",function(){return ce(i),le(q().lastPage())}),L(16,"span",138),W(17),te(18,"translate"),P()()()()}if(2&e){const i=q();w(4),Ce(ne(5,7,"first")),w(2),U("ngIf",i.currentPage-10>0),w(1),U("ngIf",i.currentPage-1!=0),w(4),Ce(i.currentPage),w(1),U("ngIf",i.currentPage!=i.totalPages),w(1),U("ngIf",i.currentPage+10<i.totalPages),w(4),Ce(ne(18,9,"last"))}}function Sj(e,t){if(1&e){const i=Ke();L(0,"button",143),ye("click",function(){ce(i);const o=q();return le(o.deleteStructures(o.id))}),W(1),te(2,"translate"),P()}2&e&&(w(1),Ce(ne(2,1,"sensors.delete")))}function Ij(e,t){if(1&e){const i=Ke();L(0,"button",144),ye("click",function(){ce(i);const o=q();return le(o.deleteStructures(o.id))}),W(1),te(2,"translate"),P()}2&e&&(w(1),Ce(ne(2,1,"sensors.delete")))}function Aj(e,t){1&e&&(L(0,"div",145)(1,"div",146)(2,"div",147)(3,"div",148),W(4),te(5,"translate"),P(),He(6,"button",149),P()()()),2&e&&(w(4),jt(" ",ne(5,1,"structure.e7")," "))}function Pj(e,t){1&e&&(L(0,"div",150)(1,"div",151)(2,"div",147)(3,"div",148),W(4),te(5,"translate"),P(),He(6,"button",149),P()()()),2&e&&(w(4),jt(" ",ne(5,1,"structure.e8")," "))}function kj(e,t){1&e&&(L(0,"div",150)(1,"div",146)(2,"div",147)(3,"div",148),W(4),te(5,"translate"),P(),He(6,"button",149),P()()()),2&e&&(w(4),jt(" ",ne(5,1,"structure.e3")," "))}function Oj(e,t){1&e&&(L(0,"div",150)(1,"div",151)(2,"div",147)(3,"div",148),W(4),te(5,"translate"),P(),He(6,"button",149),P()()()),2&e&&(w(4),jt(" ",ne(5,1,"structure.e6")," "))}function Lj(e,t){1&e&&(L(0,"div",150)(1,"div",146)(2,"div",147)(3,"div",148),W(4),te(5,"translate"),P(),He(6,"button",149),P()()()),2&e&&(w(4),jt(" ",ne(5,1,"structure.e4")," "))}function Rj(e,t){1&e&&(L(0,"div",150)(1,"div",151)(2,"div",147)(3,"div",148),W(4),te(5,"translate"),P(),He(6,"button",149),P()()()),2&e&&(w(4),jt(" ",ne(5,1,"structure.e5")," "))}function Fj(e,t){1&e&&(L(0,"div",150)(1,"div",146)(2,"div",147)(3,"div",148),W(4),te(5,"translate"),P(),He(6,"button",149),P()()()),2&e&&(w(4),jt(" ",ne(5,1,"structure.e2")," "))}function Nj(e,t){1&e&&(L(0,"div",150)(1,"div",151)(2,"div",147)(3,"div",148),W(4),te(5,"translate"),P(),He(6,"button",149),P()()()),2&e&&(w(4),jt(" ",ne(5,1,"structure.e1")," "))}function Bj(e,t){if(1&e){const i=Ke();L(0,"input",44),ye("keyup",function(o){return ce(i),le(q().textSearch(o))})("ngModelChange",function(o){return ce(i),le(q().search.value=o)}),te(1,"translate"),P()}if(2&e){const i=q();vn("placeholder",ne(1,2,"search_variable_data_structure")),U("ngModel",i.search.value)}}function Vj(e,t){if(1&e){const i=Ke();L(0,"input",45),ye("keyup",function(o){return ce(i),le(q().textSearch(o))})("ngModelChange",function(o){return ce(i),le(q().search.value=o)}),te(1,"translate"),P()}if(2&e){const i=q();vn("placeholder",ne(1,2,"search_variable_data_structure")),U("ngModel",i.search.value)}}function Uj(e,t){1&e&&(L(0,"div",46)(1,"div",47)(2,"span",48),W(3),te(4,"translate"),P()()()),2&e&&(w(3),Ce(ne(4,1,"loading")))}function jj(e,t){1&e&&(L(0,"div",46)(1,"div",49)(2,"p",50),W(3),te(4,"translate"),P()()()),2&e&&(w(3),Ce(ne(4,1,"no_structure")))}function $j(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",59),ye("click",function(){ce(i);const o=q(2);return o.alt1=!1,le(o.getStructureLocal("description","DESC"))}),He(1,"path",60),P()}}function Hj(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",61),ye("click",function(){ce(i);const o=q(2);return o.alt1=!0,le(o.getStructureLocal("description","ASC"))}),He(1,"path",62),P()}}function Gj(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",59),ye("click",function(){ce(i);const o=q(2);return o.alt2=!1,le(o.getStructureLocal("structure","DESC"))}),He(1,"path",60),P()}}function qj(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",61),ye("click",function(){ce(i);const o=q(2);return o.alt2=!0,le(o.getStructureLocal("structure","ASC"))}),He(1,"path",62),P()}}function Zj(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",59),ye("click",function(){ce(i);const o=q(2);return o.alt3=!1,le(o.getStructureLocal("initial_byte","DESC"))}),He(1,"path",60),P()}}function Wj(e,t){if(1&e){const i=Ke();xt(),L(0,"svg",61),ye("click",function(){ce(i);const o=q(2);return o.alt3=!0,le(o.getStructureLocal("initial_byte","ASC"))}),He(1,"path",62),P()}}function Xj(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"sensors.description")," ",ne(3,4,"required"),""))}function Yj(e,t){if(1&e&&(L(0,"div",89),J(1,Xj,4,6,"div",90),P()),2&e){q();const i=Vt(2);w(1),U("ngIf",i.controls.description.errors.required)}}function Kj(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"structure.structure")," ",ne(3,4,"required"),""))}function Jj(e,t){if(1&e&&(L(0,"div",89),J(1,Kj,4,6,"div",90),P()),2&e){q();const i=Vt(2);w(1),U("ngIf",i.controls.structure.errors.required)}}function Qj(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"structure.initial_byte")," ",ne(3,4,"required"),""))}function e9(e,t){if(1&e&&(L(0,"div",89),J(1,Qj,4,6,"div",90),P()),2&e){q();const i=Vt(2);w(1),U("ngIf",i.controls.initial_byte.errors.required)}}const t9=function(e){return{"mb-3":e}},u1=function(e){return{disabled:e}};function n9(e,t){if(1&e){const i=Ke();L(0,"div",91)(1,"div",31)(2,"div",92)(3,"button",93),ye("click",function(){return ce(i),le(q(5).clouseAll())}),W(4),te(5,"translate"),P()(),L(6,"div",94)(7,"button",95),ye("click",function(){ce(i),q();const o=Vt(2);return le(q(4).newStructure(o))}),W(8),te(9,"translate"),P()()()()}if(2&e){const i=q(5);w(2),U("ngClass",ft(8,t9,i.width<965)),w(2),Ce(ne(5,4,"sensors.exit")),w(3),U("ngClass",ft(10,u1,!i.change&&1==i.state)),w(1),Ce(ne(9,6,"sensors.save"))}}function i9(e,t){if(1&e){const i=Ke();L(0,"td",76)(1,"form",77,78)(3,"div",79)(4,"label",80),W(5),te(6,"translate"),P(),L(7,"input",81),ye("ngModelChange",function(){return ce(i),le(q(4).change=!0)})("ngModelChange",function(o){return ce(i),le(q(4).structure.description=o)}),P(),J(8,Yj,2,1,"div",82),P(),L(9,"div",83)(10,"label",84),W(11),te(12,"translate"),P(),L(13,"input",85),ye("ngModelChange",function(){return ce(i),le(q(4).change=!0)})("ngModelChange",function(o){return ce(i),le(q(4).structure.structure=o)}),P(),J(14,Jj,2,1,"div",82),P(),L(15,"div",79)(16,"label",86),W(17),te(18,"translate"),P(),L(19,"input",87),ye("ngModelChange",function(){return ce(i),le(q(4).change=!0)})("ngModelChange",function(o){return ce(i),le(q(4).structure.initial_byte=o)}),P(),J(20,e9,2,1,"div",82),P(),J(21,n9,10,12,"div",88),P()()}if(2&e){const i=Vt(2),n=q(4);w(5),Ce(ne(6,13,"sensors.description")),w(2),vn("value",n.structure.description),U("ngModel",n.structure.description),w(1),U("ngIf",i.submitted&&i.controls.description.errors),w(3),Ce(ne(12,15,"structure.structure")),w(2),vn("value",n.structure.structure),U("ngModel",n.structure.structure),w(1),U("ngIf",i.submitted&&i.controls.structure.errors),w(3),Ce(ne(18,17,"structure.initial_byte")),w(2),vn("value",n.structure.initial_byte),U("ngModel",n.structure.initial_byte),w(1),U("ngIf",i.submitted&&i.controls.initial_byte.errors),w(1),U("ngIf",1==n.state||0==n.state)}}function r9(e,t){if(1&e&&(L(0,"tr",74),J(1,i9,22,19,"td",75),P()),2&e){const i=q(3);w(1),U("ngIf",i.show)}}function o9(e,t){1&e&&(xt(),L(0,"svg",96),W(1,"5 "),He(2,"path",97)(3,"path",98)(4,"path",99),P())}function s9(e,t){1&e&&(xt(),L(0,"svg",100),He(1,"path",101)(2,"path",102),P())}function a9(e,t){1&e&&(xt(),L(0,"svg",103),He(1,"path",104),P())}function l9(e,t){1&e&&(xt(),L(0,"svg",105),He(1,"path",106),P())}function c9(e,t){if(1&e){const i=Ke();L(0,"input",110,111),ye("ngModelChange",function(){return ce(i),le(q(5).change=!0)})("ngModelChange",function(o){return ce(i),le(q(5).structure.id=o)}),P()}if(2&e){const i=q(5);vn("value",i.structure.id),U("ngModel",i.structure.id)}}function u9(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"sensors.description")," ",ne(3,4,"required"),""))}function d9(e,t){if(1&e&&(L(0,"div",89),J(1,u9,4,6,"div",90),P()),2&e){q();const i=Vt(2);w(1),U("ngIf",i.controls.description.errors.required)}}function h9(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"structure.structure")," ",ne(3,4,"required"),""))}function p9(e,t){if(1&e&&(L(0,"div",89),J(1,h9,4,6,"div",90),P()),2&e){q();const i=Vt(2);w(1),U("ngIf",i.controls.structure.errors.required)}}function f9(e,t){1&e&&(L(0,"div"),W(1),te(2,"translate"),te(3,"translate"),P()),2&e&&(w(1),pn("",ne(2,2,"structure.initial_byte")," ",ne(3,4,"required"),""))}function g9(e,t){if(1&e&&(L(0,"div",89),J(1,f9,4,6,"div",90),P()),2&e){q();const i=Vt(2);w(1),U("ngIf",i.controls.initial_byte.errors.required)}}function m9(e,t){if(1&e){const i=Ke();L(0,"button",93),ye("click",function(){return ce(i),le(q(6).clouse())}),W(1),te(2,"translate"),P()}2&e&&(w(1),Ce(ne(2,1,"sensors.exit")))}function _9(e,t){1&e&&(L(0,"button",123),W(1),te(2,"translate"),P()),2&e&&(w(1),Ce(ne(2,1,"reset.data")))}function v9(e,t){1&e&&(L(0,"button",124),W(1),te(2,"translate"),P()),2&e&&(w(1),Ce(ne(2,1,"sensors.delete")))}function y9(e,t){1&e&&(L(0,"button",125),W(1),te(2,"translate"),P()),2&e&&(w(1),Ce(ne(2,1,"sensors.delete")))}const x9=function(e){return{"pb-3":e}};function b9(e,t){if(1&e){const i=Ke();L(0,"div",91)(1,"div",31)(2,"div",112)(3,"div",31)(4,"div",113),J(5,m9,3,3,"button",114),J(6,_9,3,3,"button",115),P(),L(7,"div",116)(8,"button",117),ye("click",function(){ce(i),q();const o=Vt(2);return le(q(4).editStructureAux(o))}),W(9),te(10,"translate"),P()()()(),L(11,"div",118)(12,"div",119)(13,"div",120),J(14,v9,3,3,"button",121),J(15,y9,3,3,"button",122),P()()()()()}if(2&e){const i=q(5);w(5),U("ngIf",0==i.change||1==i.saved),w(1),U("ngIf",1==i.change&&0==i.saved),w(2),U("ngClass",ft(9,u1,!i.change)),w(1),Ce(ne(10,7,"sensors.save")),w(2),U("ngClass",ft(11,x9,i.width<965)),w(3),U("ngIf",i.change),w(1),U("ngIf",!i.change)}}function w9(e,t){if(1&e){const i=Ke();L(0,"td",76)(1,"form",108,78),J(3,c9,2,2,"input",109),L(4,"div",79)(5,"label",80),W(6),te(7,"translate"),P(),L(8,"input",81),ye("ngModelChange",function(){return ce(i),le(q(4).change=!0)})("ngModelChange",function(o){return ce(i),le(q(4).structure.description=o)}),P(),J(9,d9,2,1,"div",82),P(),L(10,"div",83)(11,"label",84),W(12),te(13,"translate"),P(),L(14,"input",85),ye("ngModelChange",function(){return ce(i),le(q(4).change=!0)})("ngModelChange",function(o){return ce(i),le(q(4).structure.structure=o)}),P(),J(15,p9,2,1,"div",82),P(),L(16,"div",79)(17,"label",86),W(18),te(19,"translate"),P(),L(20,"input",87),ye("ngModelChange",function(){return ce(i),le(q(4).change=!0)})("ngModelChange",function(o){return ce(i),le(q(4).structure.initial_byte=o)}),P(),J(21,g9,2,1,"div",82),P(),J(22,b9,16,13,"div",88),P()()}if(2&e){const i=Vt(2),n=q(4);w(3),U("ngIf",2==n.state),w(3),Ce(ne(7,14,"sensors.description")),w(2),vn("value",n.structure.description),U("ngModel",n.structure.description),w(1),U("ngIf",i.submitted&&i.controls.description.errors),w(3),Ce(ne(13,16,"structure.structure")),w(2),vn("value",n.structure.structure),U("ngModel",n.structure.structure),w(1),U("ngIf",i.submitted&&i.controls.structure.errors),w(3),Ce(ne(19,18,"structure.initial_byte")),w(2),vn("value",n.structure.initial_byte),U("ngModel",n.structure.initial_byte),w(1),U("ngIf",i.submitted&&i.controls.initial_byte.errors),w(1),U("ngIf",2==n.state)}}const C9=function(e){return{mark_select:e}};function M9(e,t){if(1&e&&(L(0,"tr",107),J(1,w9,23,20,"td",75),P()),2&e){const i=q().$implicit,n=q(2);U("ngClass",ft(2,C9,n.actId==i.id)),w(1),U("ngIf",n.show)}}const fh=function(e){return{mark:e}};function E9(e,t){if(1&e){const i=Ke();L(0,"tbody"),J(1,r9,2,1,"tr",63),L(2,"tr",64)(3,"th",65),ye("click",function(){const c=ce(i).$implicit;return le(q(2).orderColumn(c.id))}),W(4),P(),L(5,"td",66),ye("click",function(){const c=ce(i).$implicit;return le(q(2).orderColumn(c.id))}),W(6),P(),L(7,"td",66),ye("click",function(){const c=ce(i).$implicit;return le(q(2).orderColumn(c.id))}),W(8),P(),L(9,"td",67),ye("mouseout",function(){return ce(i),le(q(2).viewDup=-1)})("mouseover",function(){const c=ce(i).index;return le(q(2).viewDup=c)})("click",function(){const c=ce(i).$implicit;return le(q(2).duplicateStructure(c.id,c.description))}),J(10,o9,5,0,"svg",68),J(11,s9,3,0,"svg",69),P(),L(12,"td",70),ye("mouseover",function(){const c=ce(i).index;return le(q(2).pencilDup=c)})("mouseout",function(){return ce(i),le(q(2).pencilDup=-1)})("click",function(){const c=ce(i).$implicit;return le(q(2).orderColumn(c.id))}),J(13,a9,2,0,"svg",71),J(14,l9,2,0,"svg",72),P()(),J(15,M9,2,4,"tr",73),P()}if(2&e){const i=t.$implicit,n=t.index,o=q(2);w(1),U("ngIf",n+1==o.actId&&(0==o.state||1==o.state)),w(1),U("ngClass",ft(15,u1,o.change)),w(1),U("ngClass",ft(17,fh,o.actId==i.id&&2==o.state)),w(1),Ce(i.description),w(1),U("ngClass",ft(19,fh,o.actId==i.id&&2==o.state)),w(1),Ce(i.structure),w(1),U("ngClass",ft(21,fh,o.actId==i.id&&2==o.state)),w(1),Ce(i.initial_byte),w(1),U("ngClass",ft(23,fh,o.actId==i.id&&2==o.state)),w(1),U("ngIf",o.viewDup!=n),w(1),U("ngIf",o.viewDup==n),w(1),U("ngClass",ft(25,fh,o.actId==i.id&&2==o.state)),w(1),U("ngIf",o.pencilDup!=n),w(1),U("ngIf",o.pencilDup==n),w(1),U("ngIf",i.id==o.actId&&2==o.state)}}const T9=function(e){return{"table-hover":e}};function D9(e,t){if(1&e&&(L(0,"div",51)(1,"table",52)(2,"thead")(3,"tr")(4,"th",53),J(5,$j,2,0,"svg",54),J(6,Hj,2,0,"svg",55),W(7),te(8,"translate"),P(),L(9,"th",56),J(10,Gj,2,0,"svg",54),J(11,qj,2,0,"svg",55),W(12),te(13,"translate"),P(),L(14,"th",56),J(15,Zj,2,0,"svg",54),J(16,Wj,2,0,"svg",55),W(17),te(18,"translate"),P(),L(19,"th",57),W(20),te(21,"translate"),P(),L(22,"th",57),W(23),te(24,"translate"),P()()(),J(25,E9,16,27,"tbody",58),P()()),2&e){const i=q();w(1),U("ngClass",ft(26,T9,!i.change)),w(3),U("ngClass",ft(28,fh,"description"==i.order)),w(1),U("ngIf",i.alt1),w(1),U("ngIf",!i.alt1),w(1),jt(" ",ne(8,16,"sensors.description")," "),w(2),U("ngClass",ft(30,fh,"structure"==i.order)),w(1),U("ngIf",i.alt2),w(1),U("ngIf",!i.alt2),w(1),jt(" ",ne(13,18,"structure.structure")," "),w(2),U("ngClass",ft(32,fh,"initial_byte"==i.order)),w(1),U("ngIf",i.alt3),w(1),U("ngIf",!i.alt3),w(1),jt(" ",ne(18,20,"structure.initial_byte")," "),w(3),Ce(ne(21,22,"sensors.duplicate")),w(3),Ce(ne(24,24,"sensors.edit")),w(2),U("ngForOf",i.data)}}function S9(e,t){if(1&e&&(L(0,"option",126),W(1),te(2,"translate"),P()),2&e){const i=t.$implicit;U("value",i)("selected",15==i),w(1),pn("",i," ",ne(2,4,"res"),"")}}function I9(e,t){if(1&e){const i=Ke();L(0,"li",128)(1,"a",129),ye("click",function(){return ce(i),le(q(2).previousPage10())}),L(2,"span",130),W(3,"\xab 10"),P()()()}}function A9(e,t){if(1&e){const i=Ke();L(0,"li",128)(1,"a",134),ye("click",function(){return ce(i),le(q(2).previousPage())}),W(2),P()()}if(2&e){const i=q(2);w(2),Ce(i.currentPage-1)}}function P9(e,t){if(1&e){const i=Ke();L(0,"li",128)(1,"a",134),ye("click",function(){return ce(i),le(q(2).nextPage())}),W(2),P()()}if(2&e){const i=q(2);w(2),Ce(i.currentPage+1)}}function k9(e,t){if(1&e){const i=Ke();L(0,"li",128)(1,"a",133),ye("click",function(){return ce(i),le(q(2).nextPage10())}),L(2,"span",130),W(3,"10 \xbb"),P()()()}}function O9(e,t){if(1&e){const i=Ke();L(0,"ul",127)(1,"li",128)(2,"a",129),ye("click",function(){return ce(i),le(q().firstPage())}),L(3,"span",130),W(4),te(5,"translate"),P()()(),J(6,I9,4,0,"li",131),J(7,A9,3,1,"li",131),L(8,"li",128)(9,"a",132),ye("click",function(){ce(i);const o=q();return le(o.Page(o.currentPage))}),L(10,"strong"),W(11),P()()(),J(12,P9,3,1,"li",131),J(13,k9,4,0,"li",131),L(14,"li",128)(15,"a",133),ye("click",function(){return ce(i),le(q().lastPage())}),L(16,"span",130),W(17),te(18,"translate"),P()()()()}if(2&e){const i=q();w(4),Ce(ne(5,7,"first")),w(2),U("ngIf",i.currentPage-10>0),w(1),U("ngIf",i.currentPage-1!=0),w(4),Ce(i.currentPage),w(1),U("ngIf",i.currentPage!=i.totalPages),w(1),U("ngIf",i.currentPage+10<i.totalPages),w(4),Ce(ne(18,9,"last"))}}function L9(e,t){if(1&e){const i=Ke();L(0,"button",135),ye("click",function(){ce(i);const o=q();return le(o.deleteStructure(o.id))}),W(1),te(2,"translate"),P()}2&e&&(w(1),Ce(ne(2,1,"sensors.delete")))}function R9(e,t){if(1&e){const i=Ke();L(0,"button",136),ye("click",function(){ce(i);const o=q();return le(o.deleteStructure(o.id))}),W(1),te(2,"translate"),P()}2&e&&(w(1),Ce(ne(2,1,"sensors.delete")))}function F9(e,t){1&e&&(L(0,"div",137)(1,"div",138)(2,"div",139)(3,"div",140),W(4),te(5,"translate"),P(),He(6,"button",141),P()()()),2&e&&(w(4),jt(" ",ne(5,1,"structure.e7")," "))}function N9(e,t){1&e&&(L(0,"div",142)(1,"div",143)(2,"div",139)(3,"div",140),W(4),te(5,"translate"),P(),He(6,"button",141),P()()()),2&e&&(w(4),jt(" ",ne(5,1,"structure.e8")," "))}function z9(e,t){1&e&&(L(0,"div",142)(1,"div",138)(2,"div",139)(3,"div",140),W(4),te(5,"translate"),P(),He(6,"button",141),P()()()),2&e&&(w(4),jt(" ",ne(5,1,"structure.e3")," "))}function B9(e,t){1&e&&(L(0,"div",142)(1,"div",143)(2,"div",139)(3,"div",140),W(4),te(5,"translate"),P(),He(6,"button",141),P()()()),2&e&&(w(4),jt(" ",ne(5,1,"structure.e6")," "))}function V9(e,t){1&e&&(L(0,"div",142)(1,"div",138)(2,"div",139)(3,"div",140),W(4),te(5,"translate"),P(),He(6,"button",141),P()()()),2&e&&(w(4),jt(" ",ne(5,1,"structure.e4")," "))}function U9(e,t){1&e&&(L(0,"div",142)(1,"div",143)(2,"div",139)(3,"div",140),W(4),te(5,"translate"),P(),He(6,"button",141),P()()()),2&e&&(w(4),jt(" ",ne(5,1,"structure.e5")," "))}function j9(e,t){1&e&&(L(0,"div",142)(1,"div",138)(2,"div",139)(3,"div",140),W(4),te(5,"translate"),P(),He(6,"button",141),P()()()),2&e&&(w(4),jt(" ",ne(5,1,"structure.e2")," "))}function $9(e,t){1&e&&(L(0,"div",142)(1,"div",143)(2,"div",139)(3,"div",140),W(4),te(5,"translate"),P(),He(6,"button",141),P()()()),2&e&&(w(4),jt(" ",ne(5,1,"structure.e1")," "))}const H9=[{path:"devices",component:kC,children:[{path:"",component:(()=>{var e;class t{constructor(n,o,c){this.http=n,this.router=o,this.translate=c,this.maxDevice=qt_baseUrl+"/device_configurations/max",this.getDevice=qt_baseUrl+"/device_configurations/get",this.getSensorsList=qt_baseUrl+"/sensors_types/get_list",this.zoom=7,this.markers=[],this.colorMap="streets-v12",this.currentLngLat=new Tr.LngLat(-.5098796883778505,38.3855908932305),this.currentRotation=0,this.currentPitch=0,this.pass2=!1,this.resultsPerPag=qt_resultsPerPag,this.data=[],this.rute="",this.id=1,this.timeout=null,this.searchAux=!1,this.viewList=!1,this.viewMap=!1,this.searchText="search",this.ordAux="ASC",this.searched=!1,this.charging=!1,this.mark="uid",this.posX1="0",this.posX2="0",this.posY1="0",this.posY2="0",this.dupOk=!1,this.dupNot=!1,this.openAux=!0,this.viewDup=-10,this.pencilDup=-10,this.totalPages=5,this.currentPage=1,this.quantPage=15,this.page=1,this.total=0,this.totalPage=0,this.alt1=!0,this.alt2=!0,this.alt3=!0,this.alt4=!0,this.alt5=!0,this.selectSensors={sensors:[{id:-1,name:"Cualquier sensor",metric:"",description:"",errorvalue:1,valuemax:1,valuemin:1,position:"",correction_general:null,correction_time_general:null,id_data_structure:1}]},this.selectSensorsCopy={sensors:[{id:-1,name:"Cualquier sensor",metric:"",description:"",errorvalue:1,valuemax:1,valuemin:1,position:"",correction_general:null,correction_time_general:null,id_data_structure:1,data_estructure:"",variable_data_structure:""}]},this.selectSensorsAux={sensors:[{id:-1,name:"",metric:"",description:"",errorvalue:1,valuemax:1,valuemin:1,position:"",correction_general:null,correction_time_general:null,id_data_structure:1}]},this.sensor={id:0,enable:0,type_name:""},this.search={value:"",sel_type:0,sensorsAct:2,devicesAct:2}}ngOnInit(){this.initFilters(),this.selectSensors.sensors=[],this.readStorage(),this.http.get(this.getSensorsList).subscribe(n=>{n.unshift({id:-3,type:this.translate.instant("text_1")}),n.unshift({id:-2,type:this.translate.instant("text_2")}),this.selectSensorsCopy.sensors=n;for(let o=0;o<n.length;o++)this.selectSensorsCopy.sensors[o].name=n[o].type},n=>{console.error("Error al obtener datos:",n)})}ngAfterViewInit(){this.createMap()}auxInit(){null!=this.map&&(this.map.addControl(new Tr.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0})),this.map.addControl(new Tr.NavigationControl)),this.mapListeners()}orderDevices(n,o){this.mark=n,this.ordAux=o,this.getDevices("0")}getDevices(n){setTimeout(()=>{this.searchText=""==this.search.value?"search":this.search.value;let E=[];for(let A=0;A<this.selectSensorsAux.sensors.length;A++)E.push(this.selectSensorsAux.sensors[A].id);this.arraySensors=E.join(","),this.pagTam=1,this.pag=1e5,0==this.openAux&&this.getMapDevices("1").then(A=>{if(A||this.searched){this.searched=!1;for(let z=0;z<this.markers.length;z++)this.markers[z].marker.remove();this.markers=[];for(let z of this.data){let H="#198754";0==z.enable&&(H="#dc3545"),1==z.enable&&(H="#198754");let oe=new Tr.LngLat(z.lon,z.lat),pe=z.uid,Ie=parseInt(z.id);this.addMarker(oe,H,pe,Ie,z)}setTimeout(()=>{if(null!=this.map){let oe,pe=[],Ie="";for(let Ve=0;Ve<this.markers.length;Ve++){if(Ie="",null!=this.data&&null!=this.data&&null!=this.data[Ve]&&null!=this.data[Ve])for(let We=0;We<this.data[Ve].sensors.length;We++)0==this.data[Ve].sensors[We].enable&&(Ie+=`<span class="badge rounded-pill text-bg-danger d-inline-block me-2 mb-1">\n                                    <p style="font-size: small;" class="mb-0">${this.data[Ve].sensors[We].type_name}</p>\n                                  </span>`),1==this.data[Ve].sensors[We].enable&&(Ie+=`<span class="badge rounded-pill text-bg-success d-inline-block me-2 mb-1">\n                                    <p style="font-size: small; font-weight: 500;" class="mb-0">${this.data[Ve].sensors[We].type_name}</p>\n                                  </span>`);oe="",""!=this.markers[Ve].data.uid&&(oe+=`<p style="font-size: large;" class="p-0 m-0" ><strong>${this.markers[Ve].data.uid}</strong> (Uid)</p>`),""!=this.markers[Ve].data.alias&&(oe+=`<p style="font-size: medium;" class="p-0 m-0" ><strong>${this.markers[Ve].data.alias}</strong> (Alias)</p>`),Ie.length>0&&(oe+=`<div style="display: inline-block; height: min-content;" class="pt-3">${Ie}</div>`),pe.push({type:"Feature",properties:{description:oe},geometry:{type:"Point",coordinates:[this.markers[Ve].marker.getLngLat().lng,this.markers[Ve].marker.getLngLat().lat]}})}this.geojsonAux={features:pe},this.map.getLayer("places")&&this.map.removeLayer("places"),this.map.getSource("places")&&this.map.removeSource("places"),null!=this.map&&!this.map.getSource("places")&&this.map.addSource("places",{type:"geojson",data:{type:"FeatureCollection",features:this.geojsonAux.features}})}let z,H;if(null!=this.map&&!this.map.getLayer("places")&&this.map.addLayer({id:"places",type:"circle",source:"places",paint:{"circle-radius":50,"circle-color":"#FFFFFF","circle-opacity":0}}),null!=this.map&&(z=this.map.getStyle().layers),void 0!==z){const oe=z.find(pe=>"symbol"==pe.type&&pe.layout&&pe.layout["text-field"]);oe&&(H=oe.id),null!=this.map&&!this.map.getLayer("add-3d-buildings")&&this.map.addLayer({id:"add-3d-buildings",source:"composite","source-layer":"building",filter:["==","extrude","true"],type:"fill-extrusion",minzoom:15,paint:{"fill-extrusion-color":"#aaa","fill-extrusion-height":["interpolate",["linear"],["zoom"],15,0,15.05,["get","height"]],"fill-extrusion-base":["interpolate",["linear"],["zoom"],15,0,15.05,["get","min_height"]],"fill-extrusion-opacity":.6}},H)}},100)}}).catch(A=>{console.error("Error al obtener los datos:",A)}),1==this.openAux&&(this.data=[],this.charging=!0,this.http.get(`${this.getDevice}/0/${this.searchText}/${this.mark}/${this.ordAux}/${this.arraySensors}/${this.search.sensorsAct}/${this.search.devicesAct}/${this.currentPage}/${this.quantPage}/0/0/0/0`).subscribe(A=>{this.charging=!1,A&&A.length>0&&A[0].total?(this.totalPages=Math.ceil(A[0].total/this.quantPage),this.total=A[0].total):(this.totalPages=0,this.total=0),this.data=A;const z=this.data.map(H=>H.id);this.idsParam=z.join(","),this.totalPage=this.data.length<this.quantPage?this.total:this.quantPage*this.currentPage},A=>{console.error("Error al obtener datos:",A)}))},1)}getMapDevices(n){this.getCornerCoordinates();let o="0",c="0",f="0",y="0";return this.pagTam=this.currentPage,this.pag=this.quantPage,"1"==n&&(o=this.posX1,c=this.posX2,f=this.posY1,y=this.posY2,this.pagTam=1,this.pag=1e4),this.charging=!0,new Promise((E,A)=>{this.http.get(`${this.getDevice}/1/${this.searchText}/${this.mark}/${this.ordAux}/${this.arraySensors}/${this.search.sensorsAct}/${this.search.devicesAct}/${this.pagTam}/${this.pag}/${o}/${c}/${f}/${y}`).subscribe(z=>{let H=!1;this.charging=!1;const oe=z.map(pe=>pe.id);if(this.idsParam1=oe.join(","),this.idsParam!=this.idsParam1||this.searched){if(H=!0,this.searched){this.data=[],this.data=z;const pe=this.data.map(Ie=>Ie.id);this.idsParam=pe.join(",")}else{const pe=z.map(et=>et.id),Ie=z.filter(et=>!this.data.some(qe=>qe.id===et.id)),Ve=this.data.filter(et=>!pe.includes(et.id));this.data.push(...Ie),this.data=z.filter(et=>!Ve.some(qe=>qe.id===et.id)),this.data.map(et=>et.id),this.idsParam=this.idsParam1}this.searched&&this.cleanMap(),E(H)}},z=>{console.error(z),A(z)})})}createMap(){this.searched?(this.map=new Tr.Map({container:this.divMap?.nativeElement,style:"mapbox://styles/mapbox/"+this.colorMap,center:[this.currentLngLat.lng,this.currentLngLat.lat],zoom:this.zoom,bearing:this.currentRotation,pitch:this.currentPitch}),this.auxInit()):navigator.geolocation?navigator.geolocation.getCurrentPosition(n=>{this.map=new Tr.Map({container:this.divMap?.nativeElement,style:"mapbox://styles/mapbox/"+this.colorMap,center:[n.coords.longitude,n.coords.latitude],zoom:this.zoom,bearing:this.currentRotation,pitch:this.currentPitch}),this.auxInit()},n=>{this.map=new Tr.Map({container:this.divMap?.nativeElement,style:"mapbox://styles/mapbox/"+this.colorMap,center:[-3.7034137886912504,40.41697654880073],zoom:this.zoom,bearing:this.currentRotation,pitch:this.currentPitch}),console.log("Error geo",n),this.auxInit()}):(this.map=new Tr.Map({container:this.divMap?.nativeElement,style:"mapbox://styles/mapbox/"+this.colorMap,center:[-3.7034137886912504,40.41697654880073],zoom:this.zoom,bearing:this.currentRotation,pitch:this.currentPitch}),console.log("Geo no compatible"),this.auxInit())}mapListeners(){null!=this.map&&(this.map.on("zoom",n=>{this.zoom=this.map.getZoom()}),this.map.on("zoomend",n=>{this.map.getZoom()<18||this.map.zoomTo(18)}),this.map.on("move",()=>{this.currentLngLat=this.map.getCenter()}),this.map.on("rotate",()=>{this.currentRotation=this.map.getBearing()}),this.map.on("pitch",()=>{this.currentPitch=this.map.getPitch()}),this.map.on("moveend",()=>{0==this.openAux&&this.getDevices("0")}),this.showPop=new Tr.Popup({closeButton:!1,closeOnClick:!1}),this.map.on("mouseenter","places",n=>{if(null!=this.map&&(this.map.getCanvas().style.cursor="pointer",null!=n&&null!=n.features&&null!=n.features[0]&&null!=n.features[0].geometry&&null!=n.features[0].properties)){let o;"Point"==n.features[0].geometry.type&&(o=n.features[0].geometry.coordinates.slice());const c=n.features[0].properties.description;if(null!=o){for(;Math.abs(n.lngLat.lng-o[0])>180;)o[0]+=n.lngLat.lng>o[0]?360:-360;const[f,y]=o;this.showPop.setLngLat([f,y]).setHTML(c).addTo(this.map)}}}),this.map.on("mouseleave","places",()=>{null!=this.map&&(this.map.getCanvas().style.cursor="",this.showPop.remove())}))}getCornerCoordinates(){let n;null!=this.map&&(n=this.map.getBounds()),null!=n&&(this.posX1=n.getSouthWest().lng.toFixed(6),this.posX2=n.getNorthEast().lng.toFixed(6),this.posY1=n.getSouthWest().lat.toFixed(6),this.posY2=n.getNorthEast().lat.toFixed(6))}changeMapStyle(n){this.map&&(this.colorMap=n,this.saveStorage(),this.map.setStyle("mapbox://styles/mapbox/"+n)),this.searched=!0,this.getDevices("0")}cleanMap(){if(null!=this.map){this.map.getLayer("places")&&this.map.removeLayer("places"),this.map.getSource("places")&&this.map.removeSource("places"),document.querySelectorAll(".marker_text").forEach(o=>{o.remove()});for(let o=0;o<this.markers.length;o++)this.markers[o].marker.remove()}}ngOnDestroy(){this.map?.remove()}initFilters(){this.rute=this.router.routerState.snapshot.url,this.http.get(this.maxDevice).subscribe(n=>{this.id=parseInt(n.id)},n=>{console.error("Error al obtener datos:",n)}),this.orderDevices("uid","ASC")}filterDevices(){if(this.searched=!0,this.searchAux=!0,this.selectSensorsAux.sensors=[],0==this.selectSensors.sensors.length)this.selectSensorsAux.sensors.push({id:-1,name:"",metric:"",description:"",errorvalue:1,valuemax:1,valuemin:1,position:"",correction_general:null,correction_time_general:null,id_data_structure:1}),this.getDevices("1");else{this.selectSensorsAux.sensors=[];for(let n=0;n<this.selectSensors.sensors.length;n++)this.selectSensors.sensors[n].id>=0&&(this.selectSensorsAux.sensors.push(this.selectSensors.sensors[n]),this.getDevices("1")),1==this.selectSensors.sensors.length&&this.selectSensors.sensors[n].id<0&&(this.selectSensorsAux.sensors.push(this.selectSensors.sensors[n]),this.selectSensors.sensors=[],this.selectSensors.sensors.push(this.selectSensorsAux.sensors[n]),this.getDevices("1")),this.selectSensors.sensors.length>1&&this.selectSensors.sensors[n].id<0&&(this.selectSensors.sensors=[],this.selectSensors.sensors=this.selectSensorsAux.sensors),0==this.selectSensors.sensors.length&&(this.selectSensors.sensors=[],this.selectSensorsAux.sensors.push({id:-1,name:"",metric:"",description:"",errorvalue:1,valuemax:1,valuemin:1,position:"",correction_general:null,correction_time_general:null,id_data_structure:1}),this.getDevices("1"))}}getDevicesLocal(n,o){this.orderDevices(n,o)}addMarker(n,o,c,f,y){if(!this.map)return;const E=new Tr.Marker({color:o,draggable:!1}).setLngLat(n).addTo(this.map);E.on("click",function(){}),this.geojson={id:"FeatureCollection",type:"FeatureCollection",features:[{type:"Feature",properties:{id:f,color:o,name:c,description:""},geometry:{type:"Point",coordinates1:n.lng,coordinates2:n.lat}}]};for(const A of this.geojson.features){const z=document.createElement("div");z.className="marker_text",z.style.backgroundSize="100%",z.style.marginTop="10px",z.innerHTML=`<p class="p-0 m-0" style="font-size:large; color:white; -webkit-text-stroke: 0.5px black">${A.properties.name}</p>`,z.addEventListener("click",()=>{window.open(`/devices/edit/${A.properties.id}`,"_blank")});const H=new Tr.LngLat(A.geometry.coordinates1,A.geometry.coordinates2);new Tr.Marker(z).setLngLat(H).addTo(this.map)}this.markers.push({color:o,marker:E,name:c,enable:f,data:y})}onKeySearch(n){this.searched=!0,this.currentPage=1,this.deleteSearch(),clearTimeout(this.timeout);var o=this;this.timeout=setTimeout(function(){13!=n.keyCode&&o.getDevices("1")},1)}deleteSearch(){this.totalPages=5,this.currentPage=1,this.quantPage=15,this.page=1,this.selectSensors.sensors=[],this.selectSensorsAux.sensors=[],this.selectSensorsAux.sensors.push({id:-1,name:"",metric:"",description:"",errorvalue:1,valuemax:1,valuemin:1,position:"",correction_general:null,correction_time_general:null,id_data_structure:1}),this.search.devicesAct=2,this.search.sensorsAct=2,this.Page(1)}deleteText(){this.search.value=""}openMap(){this.openAux=!1,this.getDevices("1"),this.saveStorage()}openList(){this.openAux=!0,this.getDevices("0"),this.saveStorage()}firstPage(){1!=this.currentPage&&(this.currentPage=1,this.getDevices("0"))}previousPage10(){this.currentPage-10>1?(this.currentPage=this.currentPage-10,this.getDevices("0")):(this.currentPage=1,this.getDevices("0"))}previousPage(){this.currentPage>1&&(this.currentPage--,this.getDevices("0"))}Page(n){this.currentPage=n,this.getDevices("0")}nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.getDevices("0"))}nextPage10(){this.currentPage+10<this.totalPages?(this.currentPage=this.currentPage+10,this.getDevices("0")):(this.currentPage=this.totalPages,this.getDevices("0"))}lastPage(){this.currentPage!=this.totalPages&&(this.currentPage=this.totalPages,this.getDevices("0"))}saveStorage(){localStorage.setItem("openAux",this.openAux.toString()),localStorage.setItem("colorMap",this.colorMap)}readStorage(){this.openAux=JSON.parse(localStorage.getItem("openAux")??""),this.colorMap=localStorage.getItem("colorMap")??"0"}formatDateTime(n){let o="";const c=new Date(n);return o=`${c.getFullYear()}-${(c.getMonth()+1).toString().padStart(2,"0")}-${c.getDate().toString().padStart(2,"0")} ${c.getHours().toString().padStart(2,"0")}:${c.getMinutes().toString().padStart(2,"0")}:${c.getSeconds().toString().padStart(2,"0")}`,isNaN(c.getFullYear())&&(o=""),o}}return(e=t).\u0275fac=function(n){return new(n||e)(G(dh),G(Zr),G(wm))},e.\u0275cmp=mi({type:e,selectors:[["app-devices"]],viewQuery:function(n,o){if(1&n&&Xd(fV,5),2&n){let c;Cr(c=Mr())&&(o.divMap=c.first)}},decls:81,vars:61,consts:[[1,"m-0","p-0","row","d-flex"],[1,"cc2","cont","me-0","c100","cont_recto"],[1,"p-3","pb-0","row"],[1,"col-12","col-lg-3","pb-3","d-flex"],["type","button",1,"btn","hov",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","25","height","25","fill","currentColor","class","bi bi-list-task mb-1","viewBox","0 0 16 16",3,"mouseover",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","25","height","25","fill","currentColor","class","bi bi-list-task mb-1","viewBox","0 0 16 16",3,"mouseout",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","22","height","22","fill","currentColor","class","bi bi-map mb-2","viewBox","0 0 16 16",3,"mouseover",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","22","height","22","fill","currentColor","class","bi bi-map-fill mb-2","viewBox","0 0 16 16",3,"mouseout",4,"ngIf"],[1,"ps-2","w-100",2,"position","relative"],["id","search_1","name","search_1","type","text","aria-label","Recipient's username","aria-DESCcribedby","basic-addon2",1,"form-control",2,"height","40px",3,"ngModel","placeholder","keyup","ngModelChange"],["aria-label","Close",1,"btn-close",2,"position","absolute","cursor","pointer","top","7px","right","7px",3,"click"],[1,"col-12","col-lg-4"],[1,"row","d-flex","px-3"],[1,"col-8","col-lg-9","p-0","m-0","mb-3",2,"position","relative","border-radius","6px","border","1px solid #d8d8d8","border-top-right-radius","0em","border-bottom-right-radius","0em"],["bindLabel","name","appendTo","ng-select","aria-label","Default select example","id","sensors_1","name","sensors_1",1,"selectpicker",2,"height","fit-content",3,"items","multiple","ngModel","change","ngModelChange"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-chevron-down",2,"position","absolute","top","10px","right","40px"],["fill-rule","evenodd","d","M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"],[1,"col-4","col-lg-3","p-0","m-0","pb-3"],["style","border-top-left-radius: 0em; border-bottom-left-radius: 0em;","class","form-select","aria-label","Default select example","id","sensors_2","name","sensors_2",3,"ngModel","change","ngModelChange",4,"ngIf"],["disabled","","disabled","","style","border-top-left-radius: 0em; border-bottom-left-radius: 0em;","class","form-select","aria-label","Default select example","id","sensors_3","name","sensors_3",3,"ngModel","change","ngModelChange",4,"ngIf"],[1,"col-12","col-lg-2","p-0","m-0","pb-3","px-3"],["aria-label","Default select example","id","devicesAct","name","devicesAct",1,"form-select",3,"ngModel","change","ngModelChange"],["selected","",3,"ngValue"],[3,"ngValue"],[1,"col-12","col-lg-3","pb-3"],[1,"row","d-flex"],[1,"col-6"],["type","button",1,"btn","btn-secondary",2,"width","-webkit-fill-available",3,"click"],["type","button",1,"btn","btn-info",2,"width","-webkit-fill-available",3,"routerLink"],["class","p-4 pt-0 mb-5","style","position: fixed; z-index: 1000; width: 97vw",4,"ngIf"],[1,"p-4","pt-0",2,"z-index","-10000"],[1,"row",2,"height","76vh"],["id","map",2,"height","76vh"],["map",""],["id","menu",2,"position","absolute"],["id","streets-v12","name","streets-v12","type","radio","name","rtoggle","value","streets","checked","checked",4,"ngIf"],["id","streets-v12","type","radio","name","rtoggle","value","streets",3,"click",4,"ngIf"],["for","streets-v12"],["id","satellite-streets-v12","name","satellite-streets-v12","type","radio","name","rtoggle","class","ms-3","value","satellite","checked","checked",4,"ngIf"],["id","satellite-streets-v12","type","radio","name","rtoggle","class","ms-3","value","satellite",3,"click",4,"ngIf"],["for","satellite-streets-v12"],["id","outdoors-v12","name","outdoors-v12","type","radio","name","rtoggle","value","outdoors","class","ms-3","checked","checked",4,"ngIf"],["id","outdoors-v12","type","radio","name","rtoggle","value","outdoors","class","ms-3",3,"click",4,"ngIf"],["for","outdoors-v12"],["id","light-v11","name","light-v11","type","radio","name","rtoggle","value","light","class","ms-3","checked","checked",4,"ngIf"],["id","light-v11","type","radio","name","rtoggle","value","light","class","ms-3",3,"click",4,"ngIf"],["for","light-v11"],["id","dark-v11","name","dark-v11","type","radio","name","rtoggle","value","dark","class","ms-3","checked","checked",4,"ngIf"],["id","dark-v11","type","radio","name","rtoggle","value","dark","class","ms-3",3,"click",4,"ngIf"],["for","dark-v11"],[1,"toast-cont","w-96",2,"background-color","#fff"],["class","top-0 end-0 p-3 w-96","style","background-color: #fff;",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","25","height","25","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-list-task","mb-1",3,"mouseover"],["fill-rule","evenodd","d","M2 2.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5V3a.5.5 0 0 0-.5-.5H2zM3 3H2v1h1V3z"],["d","M5 3.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM5.5 7a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1h-9zm0 4a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1h-9z"],["fill-rule","evenodd","d","M1.5 7a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5V7zM2 7h1v1H2V7zm0 3.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5H2zm1 .5H2v1h1v-1z"],["xmlns","http://www.w3.org/2000/svg","width","25","height","25","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-list-task","mb-1",3,"mouseout"],["fill-rule","evenodd","d","M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"],["xmlns","http://www.w3.org/2000/svg","width","22","height","22","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-map","mb-2",3,"mouseover"],["fill-rule","evenodd","d","M15.817.113A.5.5 0 0 1 16 .5v14a.5.5 0 0 1-.402.49l-5 1a.502.502 0 0 1-.196 0L5.5 15.01l-4.902.98A.5.5 0 0 1 0 15.5v-14a.5.5 0 0 1 .402-.49l5-1a.5.5 0 0 1 .196 0L10.5.99l4.902-.98a.5.5 0 0 1 .415.103zM10 1.91l-4-.8v12.98l4 .8V1.91zm1 12.98 4-.8V1.11l-4 .8v12.98zm-6-.8V1.11l-4 .8v12.98l4-.8z"],["xmlns","http://www.w3.org/2000/svg","width","22","height","22","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-map-fill","mb-2",3,"mouseout"],["fill-rule","evenodd","d","M16 .5a.5.5 0 0 0-.598-.49L10.5.99 5.598.01a.5.5 0 0 0-.196 0l-5 1A.5.5 0 0 0 0 1.5v14a.5.5 0 0 0 .598.49l4.902-.98 4.902.98a.502.502 0 0 0 .196 0l5-1A.5.5 0 0 0 16 14.5V.5zM5 14.09V1.11l.5-.1.5.1v12.98l-.402-.08a.498.498 0 0 0-.196 0L5 14.09zm5 .8V1.91l.402.08a.5.5 0 0 0 .196 0L11 1.91v12.98l-.5.1-.5-.1z"],["aria-label","Default select example","id","sensors_2","name","sensors_2",1,"form-select",2,"border-top-left-radius","0em","border-bottom-left-radius","0em",3,"ngModel","change","ngModelChange"],["disabled","","disabled","","aria-label","Default select example","id","sensors_3","name","sensors_3",1,"form-select",2,"border-top-left-radius","0em","border-bottom-left-radius","0em",3,"ngModel","change","ngModelChange"],[1,"p-4","pt-0","mb-5",2,"position","fixed","z-index","1000","width","97vw"],[1,"row"],[1,"over","p-0",2,"height","71vh","background-color","#fff"],["class","col-12 d-flex","style","justify-content: center; align-content: center;align-items: center; height: 74vh; background-color: white;",4,"ngIf"],["class","col-12 table-container",4,"ngIf"],["class","row","style","background-color: #fff;",4,"ngIf"],[1,"col-12","d-flex",2,"justify-content","center","align-content","center","align-items","center","height","74vh","background-color","white"],[2,"height","min-content"],[2,"font-size","x-large"],["role","status",1,"spinner-border","text-secondary"],[1,"visually-hidden"],[1,"col-12","table-container"],[1,"table","table-hover"],["scope","col",1,"single-line",2,"cursor","pointer","width","10%","z-index","100",3,"ngClass"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","class","bi bi-caret-up-fill","viewBox","0 0 16 16",3,"click",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","class","bi bi-caret-down-fill","viewBox","0 0 16 16",3,"click",4,"ngIf"],["scope","col",1,"single-line",2,"cursor","pointer",3,"ngClass"],[1,"single-line",2,"text-align","left","cursor","pointer",3,"ngClass"],["scope","col",1,"d-none","d-lg-none","d-xl-table-cell","d-flex",2,"cursor","pointer"],[1,"single-line"],[1,"d-none","d-md-none","d-lg-none","d-xl-table-cell","d-flex",2,"text-align","left","cursor","pointer"],[1,"single-line",2,"text-align","center","cursor","pointer",3,"ngClass"],["scope","col",1,"single-line",2,"text-align","center"],[1,"single-line",2,"text-align","center"],["class","over","tyle","display: block;","style","cursor: pointer;",4,"ngFor","ngForOf"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-caret-up-fill",3,"click"],["d","m7.247 4.86-4.796 5.481c-.566.647-.106 1.659.753 1.659h9.592a1 1 0 0 0 .753-1.659l-4.796-5.48a1 1 0 0 0-1.506 0z"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-caret-down-fill",3,"click"],["d","M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"],["tyle","display: block;",1,"over",2,"cursor","pointer"],["scope","col",1,"rounded-0",3,"routerLink"],["scope","col",3,"routerLink"],[1,"badge","rounded-pill","text-bg-success","d-inline-block"],[1,"mb-0","d-none","d-md-none","d-lg-block"],[1,"badge","rounded-pill","text-bg-danger","d-inline-block"],["scope","col",1,"d-none","d-lg-none","d-xl-table-cell","d-flex",3,"routerLink"],[4,"ngIf"],["class","d-none d-lg-none d-xl-table-cell d-flex","scope","col",3,"routerLink",4,"ngIf"],["scope","col",2,"text-align","center",3,"routerLink"],[2,"text-align","center",3,"routerLink","mouseout","mouseover"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","class","bi bi-clipboard-plus","viewBox","0 0 16 16",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","class","bi bi-clipboard2-plus-fill","viewBox","0 0 16 16",4,"ngIf"],[2,"text-align","center",3,"routerLink","mouseover","mouseout"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","class","bi bi-pencil","viewBox","0 0 16 16",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","class","bi bi-pencil-fill","viewBox","0 0 16 16",4,"ngIf"],["style","display: inline-block; height: min-content;",4,"ngIf"],["style","display: inline-block; height: min-content;",4,"ngFor","ngForOf"],[2,"display","inline-block","height","min-content"],[1,"badge","rounded-pill","text-bg-success","d-inline-block","me-2"],[1,"badge","rounded-pill","text-bg-danger","d-inline-block","me-2"],[1,"m-0"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-clipboard-plus"],["fill-rule","evenodd","d","M8 7a.5.5 0 0 1 .5.5V9H10a.5.5 0 0 1 0 1H8.5v1.5a.5.5 0 0 1-1 0V10H6a.5.5 0 0 1 0-1h1.5V7.5A.5.5 0 0 1 8 7z"],["d","M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"],["d","M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-clipboard2-plus-fill"],["d","M10 .5a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5.5.5 0 0 1-.5.5.5.5 0 0 0-.5.5V2a.5.5 0 0 0 .5.5h5A.5.5 0 0 0 11 2v-.5a.5.5 0 0 0-.5-.5.5.5 0 0 1-.5-.5Z"],["d","M4.085 1H3.5A1.5 1.5 0 0 0 2 2.5v12A1.5 1.5 0 0 0 3.5 16h9a1.5 1.5 0 0 0 1.5-1.5v-12A1.5 1.5 0 0 0 12.5 1h-.585c.055.156.085.325.085.5V2a1.5 1.5 0 0 1-1.5 1.5h-5A1.5 1.5 0 0 1 4 2v-.5c0-.175.03-.344.085-.5ZM8.5 6.5V8H10a.5.5 0 0 1 0 1H8.5v1.5a.5.5 0 0 1-1 0V9H6a.5.5 0 0 1 0-1h1.5V6.5a.5.5 0 0 1 1 0Z"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-pencil"],["d","M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-pencil-fill"],["d","M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708l-3-3zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207l6.5-6.5zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.499.499 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11l.178-.178z"],[1,"row",2,"background-color","#fff"],[1,"col-12","col-lg-6","d-flex","mt-3"],[1,"p-0","mt-1"],["aria-label","Default select example","id","quantPage","name","quantPage",1,"form-select","ms-3",3,"ngModel","change","ngModelChange"],[3,"value","selected",4,"ngFor","ngForOf"],[1,"col-12","col-lg-6","d-flex",2,"justify-content","flex-end"],["aria-label","Page navigation example"],["class","pagination mt-3 mb-0",4,"ngIf"],[3,"value","selected"],[1,"pagination","mt-3","mb-0"],[1,"page-item"],["aria-label","Previous",1,"page-link",2,"cursor","pointer",3,"click"],["aria-hidden","true"],["class","page-item",4,"ngIf"],[1,"page-link","mark",2,"cursor","pointer",3,"click"],["aria-label","Next",1,"page-link",2,"cursor","pointer",3,"click"],[1,"page-link",2,"cursor","pointer",3,"click"],["id","streets-v12","name","streets-v12","type","radio","name","rtoggle","value","streets","checked","checked"],["id","streets-v12","type","radio","name","rtoggle","value","streets",3,"click"],["id","satellite-streets-v12","name","satellite-streets-v12","type","radio","name","rtoggle","value","satellite","checked","checked",1,"ms-3"],["id","satellite-streets-v12","type","radio","name","rtoggle","value","satellite",1,"ms-3",3,"click"],["id","outdoors-v12","name","outdoors-v12","type","radio","name","rtoggle","value","outdoors","checked","checked",1,"ms-3"],["id","outdoors-v12","type","radio","name","rtoggle","value","outdoors",1,"ms-3",3,"click"],["id","light-v11","name","light-v11","type","radio","name","rtoggle","value","light","checked","checked",1,"ms-3"],["id","light-v11","type","radio","name","rtoggle","value","light",1,"ms-3",3,"click"],["id","dark-v11","name","dark-v11","type","radio","name","rtoggle","value","dark","checked","checked",1,"ms-3"],["id","dark-v11","type","radio","name","rtoggle","value","dark",1,"ms-3",3,"click"],[1,"top-0","end-0","p-3","w-96",2,"background-color","#fff"],["role","alert","role","alert","aria-live","assertive","aria-atomic","true",1,"toast","show","align-items-center","text-bg-primary","border-0"],[1,"d-flex"],[1,"toast-body"],["type","button","data-bs-dismiss","toast","aria-label","Close",1,"btn-close","btn-close-white","me-2","m-auto"],["role","alert","role","alert","aria-live","assertive","aria-atomic","true",1,"toast","show","align-items-center","text-bg-danger","border-0"]],template:function(n,o){1&n&&(He(0,"app-navbar"),L(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3)(5,"div")(6,"button",4),ye("click",function(){return o.openList()}),J(7,gV,4,0,"svg",5),J(8,mV,2,0,"svg",6),P()(),L(9,"div")(10,"button",4),ye("click",function(){return o.openMap()}),J(11,_V,2,0,"svg",7),J(12,vV,2,0,"svg",8),P()(),L(13,"div",9)(14,"input",10),ye("keyup",function(f){return o.onKeySearch(f)})("ngModelChange",function(f){return o.search.value=f}),te(15,"translate"),P(),L(16,"p",11),ye("click",function(){return o.deleteText()}),P()()(),L(17,"div",12)(18,"div",13)(19,"div",14)(20,"ng-select",15),ye("change",function(){return o.filterDevices(),o.search.value="",o.currentPage=1})("ngModelChange",function(f){return o.selectSensors.sensors=f}),P(),xt(),L(21,"svg",16),He(22,"path",17),P()(),eo(),L(23,"div",18),J(24,yV,10,13,"select",19),J(25,xV,10,13,"select",20),P()()(),L(26,"div",21)(27,"select",22),ye("change",function(){return o.filterDevices(),o.search.value="",o.currentPage=1})("ngModelChange",function(f){return o.search.devicesAct=f}),L(28,"option",23),W(29),te(30,"translate"),P(),L(31,"option",24),W(32),te(33,"translate"),P(),L(34,"option",24),W(35),te(36,"translate"),P()()(),L(37,"div",25)(38,"div",26)(39,"div",27)(40,"button",28),ye("click",function(){return o.deleteSearch(),o.search.value=""}),W(41),te(42,"translate"),P()(),L(43,"div",27)(44,"button",29),W(45),te(46,"translate"),P()()()()(),J(47,JV,7,4,"div",30),L(48,"div",31)(49,"div",32)(50,"div",33,34)(52,"div",35),J(53,QV,1,0,"input",36),J(54,e7,1,0,"input",37),L(55,"label",38),W(56),te(57,"translate"),P(),J(58,t7,1,0,"input",39),J(59,n7,1,0,"input",40),L(60,"label",41),W(61),te(62,"translate"),P(),J(63,i7,1,0,"input",42),J(64,r7,1,0,"input",43),L(65,"label",44),W(66),te(67,"translate"),P(),J(68,o7,1,0,"input",45),J(69,s7,1,0,"input",46),L(70,"label",47),W(71),te(72,"translate"),P(),J(73,a7,1,0,"input",48),J(74,l7,1,0,"input",49),L(75,"label",50),W(76),te(77,"translate"),P()()()()(),L(78,"div",51),J(79,c7,7,3,"div",52),J(80,u7,7,3,"div",52),P()()()),2&n&&(w(7),U("ngIf",!o.viewList&&!o.openAux),w(1),U("ngIf",o.viewList||o.openAux),w(3),U("ngIf",!o.viewMap&&o.openAux),w(1),U("ngIf",o.viewMap||!o.openAux),w(2),vn("placeholder",ne(15,39,"sensors.buscar_dispositivos")),U("ngModel",o.search.value),w(6),U("items",o.selectSensorsCopy.sensors)("multiple",!0)("ngModel",o.selectSensors.sensors),w(4),U("ngIf",0!=o.selectSensors.sensors.length),w(1),U("ngIf",0==o.selectSensors.sensors.length),w(2),U("ngModel",o.search.devicesAct),w(1),U("ngValue",2),w(1),Ce(ne(30,41,"sensors.all_devices")),w(2),U("ngValue",1),w(1),Ce(ne(33,43,"sensors.enable")),w(2),U("ngValue",0),w(1),Ce(ne(36,45,"sensors.disable")),w(6),Ce(ne(42,47,"sensors.erase")),w(3),cv("routerLink","/devices/new/",o.id,""),w(1),Ce(ne(46,49,"devices.edit.new_device")),w(2),U("ngIf",1==o.openAux),w(6),U("ngIf","streets-v12"==o.colorMap),w(1),U("ngIf","streets-v12"!=o.colorMap),w(2),Ce(ne(57,51,"predeterminado")),w(2),U("ngIf","satellite-streets-v12"==o.colorMap),w(1),U("ngIf","satellite-streets-v12"!=o.colorMap),w(2),Ce(ne(62,53,"satelite")),w(2),U("ngIf","outdoors-v12"==o.colorMap),w(1),U("ngIf","outdoors-v12"!=o.colorMap),w(2),Ce(ne(67,55,"relieve")),w(2),U("ngIf","light-v11"==o.colorMap),w(1),U("ngIf","light-v11"!=o.colorMap),w(2),Ce(ne(72,57,"claro")),w(2),U("ngIf","dark-v11"==o.colorMap),w(1),U("ngIf","dark-v11"!=o.colorMap),w(2),Ce(ne(77,59,"oscuro")),w(3),U("ngIf",o.dupOk),w(1),U("ngIf",o.dupNot))},dependencies:[uV,Qd,eh,Mc,Np,zp,nh,Ru,Lp,sh,ym,n1,Zp],styles:['*[_ngcontent-%COMP%]{font-family:system-ui}.input-1[_ngcontent-%COMP%]{width:15%}.input-0[_ngcontent-%COMP%]{width:10%}.input-00[_ngcontent-%COMP%]{width:5em}.input-2[_ngcontent-%COMP%]{width:30%}#map[_ngcontent-%COMP%]{width:100%;height:100%;position:relative}.floating-range[_ngcontent-%COMP%]{position:relative;bottom:0;z-index:999;width:40%}.toast-cont[_ngcontent-%COMP%]{top:-10px;right:0;position:fixed}.btn[_ngcontent-%COMP%]:hover{border-color:#fff}.mapboxgl-canvas[_ngcontent-%COMP%]{width:100%}.form-range[_ngcontent-%COMP%]::-moz-range-thumb{background-color:#6c757d}.form-range[_ngcontent-%COMP%]::-webkit-slider-thumb{background-color:#6c757d}.mark[_ngcontent-%COMP%]{background-color:#e3e3e3}th[_ngcontent-%COMP%]{border-radius:7px}.floating-content[_ngcontent-%COMP%]{display:flex}#menu[_ngcontent-%COMP%]{margin:.5em;font-size:medium;background-color:#fff;position:relative;width:max-content;padding:5px;top:0;left:0;z-index:999;border-radius:5px;border:1px #afafaf solid}#menu[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin-right:.5em}.list-group[_ngcontent-%COMP%]{z-index:999;position:absolute;top:0;right:0;cursor:pointer;height:85%}.botoncito[_ngcontent-%COMP%]{z-index:1000;position:absolute;top:30px;left:20px}.nav[_ngcontent-%COMP%]{margin:1em}.cc2[_ngcontent-%COMP%]{margin:0 1em 1em}h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%], h4[_ngcontent-%COMP%], p[_ngcontent-%COMP%], a[_ngcontent-%COMP%], .btn[_ngcontent-%COMP%], span[_ngcontent-%COMP%], label[_ngcontent-%COMP%]{font-weight:500}.navb[_ngcontent-%COMP%]{width:49%}.cont[_ngcontent-%COMP%]{background-color:#fff;border-radius:10px;min-height:88vh}.cont_recto[_ngcontent-%COMP%]{border-top-left-radius:0}.cont0[_ngcontent-%COMP%]{margin:0 1em}.c10[_ngcontent-%COMP%]{width:68.5%}.c100[_ngcontent-%COMP%]{width:98%}.sensores_2_20[_ngcontent-%COMP%]{width:29%}.sensores_2_100[_ngcontent-%COMP%]{width:96%}.c20[_ngcontent-%COMP%]{width:50%}.c200[_ngcontent-%COMP%]{width:100%}.single-line[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.rev[_ngcontent-%COMP%]{flex-direction:column-reverse}.cont1[_ngcontent-%COMP%]{background-color:#fff;padding:1em;border-radius:10px;margin-bottom:1em}.cont2[_ngcontent-%COMP%]{background-color:#fff;border-radius:10px;height:max-content;margin-bottom:1em}.alt[_ngcontent-%COMP%]{height:82vh}.cont3[_ngcontent-%COMP%]{padding:0 1em 1em;background-color:#fff;border-radius:10px;height:min-content;margin-bottom:1em}.over[_ngcontent-%COMP%]{overflow-y:scroll}thead[_ngcontent-%COMP%]{background-color:#f2f2f2;border-radius:10px}.half[_ngcontent-%COMP%]{width:50%}app-devices-edit[_ngcontent-%COMP%]{display:flex}a[_ngcontent-%COMP%]{text-decoration:none;color:#000}.c1[_ngcontent-%COMP%]{height:min-content}.c2[_ngcontent-%COMP%]{padding-top:1em;height:max-content}.c3[_ngcontent-%COMP%]{height:-moz-fit-content;height:fit-content}.c4[_ngcontent-%COMP%]{padding:.8em 1em .5em;height:-moz-fit-content;height:fit-content}.c5[_ngcontent-%COMP%]{height:62vh}.c6[_ngcontent-%COMP%]{padding:1em 1em .5em}.nuevo[_ngcontent-%COMP%]{border-radius:10px;background-color:#f2f2f2;padding:1em;margin:.01em .01em 1em}.not[_ngcontent-%COMP%]{font-size:large}.tt1[_ngcontent-%COMP%]{--width: 130px;--height: calc(var(--width) / 3.5)}.tt2[_ngcontent-%COMP%]{--width: 100px;--height: calc(var(--width) / 3.3)}.toggle[_ngcontent-%COMP%]{position:relative;display:inline-block;width:var(--width);height:var(--height);box-shadow:0 1px 3px #0000004d;border-radius:var(--height);cursor:pointer}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.toggle[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;border-radius:var(--height);background-color:#dc3545;transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;width:calc(var(--height));height:calc(var(--height));border-radius:calc(var(--height) / 2);background-color:#fff;box-shadow:0 1px 3px #0000004d;transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]{background-color:#198754}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]:before{transform:translate(calc(var(--width) - var(--height)))}.toggle[_ngcontent-%COMP%]   .labels[_ngcontent-%COMP%]{position:absolute;top:8px;left:0;width:100%;height:100%;font-weight:600;transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   .labels[_ngcontent-%COMP%]:after{content:attr(data-off);position:absolute;right:25px;color:#fff;opacity:1;text-shadow:1px 1px 2px rgba(0,0,0,.4);transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   .labels[_ngcontent-%COMP%]:before{content:attr(data-on);position:absolute;left:25px;color:#fff;opacity:0;text-shadow:1px 1px 2px rgba(255,255,255,.4);transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked ~ .labels[_ngcontent-%COMP%]:after{opacity:0}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked ~ .labels[_ngcontent-%COMP%]:before{opacity:1}.mapboxgl-popup[_ngcontent-%COMP%]{max-width:400px;font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif}.t1[_ngcontent-%COMP%]{font-size:15px}.t2[_ngcontent-%COMP%]{font-size:11px}  .ng-select .ng-clear-wrapper .ng-clear{font-size:40px!important;color:#969696;right:7px;line-height:.7!important}  .ng-select .ng-clear-wrapper{height:34px;line-height:.5;width:30px!important}  .ng-value{background-color:#e3e3e3;border-radius:6px;margin-right:.5em;padding-bottom:.2em}  .ng-dropdown-panel{background-color:#f5f5f5}  .ng-option{padding:0 .7em .7em}  .ng-value-icon{font-size:22px;padding-left:.4em;padding-right:.4em}  .ng-value-label{padding-right:1em}.mapbox-popup-anchor-bottom[_ngcontent-%COMP%]{max-width:400px}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}tbody[_ngcontent-%COMP%]{max-height:600px;overflow-y:scroll}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:left;position:sticky;top:0;z-index:1}']}),t})()},{path:"new",children:[{path:":id",component:GC},{path:"**",component:GC}]},{path:"edit",children:[{path:":id",component:GC},{path:"**",component:kC}]},{path:"**",component:kC}]},{path:"sensors",component:(()=>{var e;class t{onResize(){window.resizeBy(-1,0),this.resize()}constructor(n,o,c){this.http=n,this.rutaActiva=o,this.elementRef=c,this.resultsPerPag=qt_resultsPerPag,this.getSensor=qt_baseUrl+"/sensors_types/get",this.postSensors=qt_baseUrl+"/sensors_types",this.duplicateSensor=qt_baseUrl+"/sensors_types/duplicate",this.getId=qt_baseUrl+"/sensors_types/id",this.totalPages=5,this.currentPage=1,this.quantPage=15,this.page=1,this.total=0,this.totalPage=0,this.alt1=!0,this.alt2=!0,this.alt3=!0,this.alt4=!0,this.alt5=!0,this.alt6=!0,this.alt7=!0,this.actId=0,this.id=0,this.state=1,this.rute="",this.charging=!1,this.saved=!1,this.change=!1,this.width=0,this.timeout=null,this.show=!1,this.showAux=!0,this.dupOk=!1,this.dupNot=!1,this.viewDup=-1,this.pencilDup=-1,this.searchAux="search",this.order="position",this.ordAux="ASC",this.alertDelete=!1,this.notDelete=!1,this.alertNew=!1,this.notNew=!1,this.saveOk=!1,this.saveNot=!1,this.sensors={id:0,type:"",metric:"",description:"",errorvalue:null,valuemax:null,valuemin:null,position:0,correction_general:"",correction_time_general:"",discard_value:""},this.sensorsCopy={id:0,type:"",metric:"",description:"",errorvalue:null,valuemax:null,valuemin:null,position:0,correction_general:"",correction_time_general:"",discard_value:""},this.searchAuxArray={value:""},this.resize()}ngOnInit(){this.getSensors(this.order,this.ordAux)}getSensorsVoid(){this.getSensors(this.order,this.ordAux)}getSensorsLocal(n,o){this.order=n,this.getSensors(n,o);const c=this.elementRef.nativeElement.querySelector(".mark_select");c&&c.scrollIntoView({behavior:"smooth"})}getSensors(n,o){this.order=n,this.rute=this.rutaActiva.routerState.snapshot.url,this.searchAux=this.searchAuxArray.value||"search",this.charging=!0,this.data=[],this.http.get(`${this.getSensor}/${this.searchAux}/${this.order}/${o}/${this.currentPage}/${this.quantPage}`).subscribe(f=>{this.charging=!1,f&&f.length>0&&f[0].total?(this.totalPages=Math.ceil(f[0].total/this.quantPage),this.total=f[0].total):(this.totalPages=0,this.total=0),this.data=f,this.totalPage=this.data.length<this.quantPage?this.total:this.quantPage*this.currentPage},f=>{console.error(f)});const c=this.elementRef.nativeElement.querySelector(".mark_select");c&&c.scrollIntoView({behavior:"smooth"})}orderColumn(n){!this.change&&n!=this.actId&&this.http.get(`${this.getId}/${n}`).subscribe(o=>{this.sensors=o[0],this.actId=n,this.id=n,this.openEdit(),this.state=2;let c={...this.sensors};this.sensorsCopy={id:c.id,type:c.type,metric:c.metric,description:c.description,errorvalue:c.errorvalue,valuemax:c.valuemax,valuemin:c.valuemin,position:c.position,correction_general:c.correction_general,correction_time_general:c.correction_time_general,discard_value:c.discard_value},this.openClouse()},o=>{console.error(o)})}newSensor(n){if(this.state=1,n.valid){const o={headers:new rr({"Content-Type":"application/json; charset=UTF-8"})};this.http.post(this.postSensors,JSON.stringify(this.sensors),o).subscribe(c=>{this.id=c.id,this.alertNew=!0,setTimeout(()=>{this.alertNew=!1},2e3),this.openClouse(),this.sensors.id=c.id;let f={...this.sensors};this.data.push(f),this.data.sort((y,E)=>"string"==typeof y.position&&"string"==typeof E.position?y.position.localeCompare(E.position):1),this.actId=this.id,this.openEdit(),this.state=2},c=>{console.error("Error:",c)}),this.change=!1}}openNew(n,o,c,f,y,E,A,z,H,oe,pe){this.sensors={id:n,type:o,metric:c,description:f,errorvalue:y,valuemax:E,valuemin:A,position:z,correction_general:H,correction_time_general:oe,discard_value:pe},this.show=!0,this.openClouse()}editSensor(n){if(n.valid){const o={headers:new rr({"Content-Type":"application/json; charset=UTF-8"})};this.http.put(this.postSensors,JSON.stringify(this.sensors),o).subscribe(f=>{},f=>{console.error("Error:",f)}),this.data=this.data.filter(f=>f.id!==this.sensors.id),this.data.push(this.sensors),this.data.sort((f,y)=>f.position-y.position),this.actId=this.sensors.id,this.openEdit(),this.state=2,this.saveOk=!0,setTimeout(()=>{this.saveOk=!1},2e3)}this.saved=!0,this.change=!1}openEdit(){this.show=!0,this.state=2,this.showAux=!1}duplicateSensors(n,o){!this.change&&!this.change&&this.http.get(`${this.duplicateSensor}/${o}`).subscribe(c=>{this.sensors=this.data.find(f=>f.id==n),this.openClouse(),this.state=0,this.http.get(`${this.getId}/${this.sensors.id}`).subscribe(f=>{this.sensors=f[0],this.actId=this.sensors.id,this.id=this.sensors.id;let y={...this.sensors};this.sensorsCopy={id:y.id,type:y.type,metric:y.metric,description:y.description,errorvalue:y.errorvalue,valuemax:y.valuemax,valuemin:y.valuemin,position:y.position,correction_general:y.correction_general,correction_time_general:y.correction_time_general,discard_value:y.discard_value},this.openNew("",c.duplicatedSensor,this.sensors.metric,this.sensors.description,this.sensors.errorvalue,this.sensors.valuemax,this.sensors.valuemin,this.sensors.position,this.sensors.correction_general,this.sensors.correction_time_general,this.sensors.discard_value)},f=>{console.error(f)}),this.change=!0},c=>{console.error("Error al verificar la descripci\xf3n duplicada:",c)})}deleteSensors(n){var o={id:this.id};const c={headers:new rr({"Content-Type":"application/json; charset=UTF-8"}),body:o};this.http.delete(this.postSensors,c).subscribe(f=>{console.log("Sensors eliminados:",f)},f=>{console.error("Error al eliminar sensores:",f)}),this.alertDelete=!0,setTimeout(()=>{this.alertDelete=!1},2e3),this.data=this.data.filter(f=>f.id!=n),this.clouse()}textSearch(n){this.currentPage=1,clearTimeout(this.timeout);var o=this;this.timeout=setTimeout(()=>{13!=n.keyCode&&(o.getSensors(this.order,this.ordAux),o.openClouse())},500)}rechargeForm(){this.sensors={id:this.sensorsCopy.id,type:this.sensorsCopy.type,metric:this.sensorsCopy.metric,description:this.sensorsCopy.description,errorvalue:this.sensorsCopy.errorvalue,valuemax:this.sensorsCopy.valuemax,valuemin:this.sensorsCopy.valuemin,position:this.sensorsCopy.position,correction_general:this.sensorsCopy.correction_general,correction_time_general:this.sensorsCopy.correction_time_general,discard_value:this.sensorsCopy.discard_value},this.change=!1}deleteSearch(){this.Page(1),this.totalPages=5,this.currentPage=1,this.quantPage=15,this.page=1,this.searchAuxArray.value="",this.getSensors(this.order,this.ordAux)}openClouse(){this.showAux=1!=this.show}clouse(){this.show=!1,this.state=-1,this.openClouse(),this.change=!1,this.actId=-1}clouseAll(){this.showAux=!1,this.show=!1,this.openClouse(),this.change=!1}resize(){this.width=window.innerWidth}firstPage(){1!=this.currentPage&&(this.currentPage=1,this.getSensorsVoid())}previousPage10(){this.currentPage-10>1?(this.currentPage=this.currentPage-10,this.getSensorsVoid()):(this.currentPage=1,this.getSensorsVoid())}previousPage(){this.currentPage>1&&(this.currentPage--,this.getSensorsVoid())}Page(n){this.currentPage=n,this.getSensorsVoid()}nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.getSensorsVoid())}nextPage10(){this.currentPage+10<this.totalPages?(this.currentPage=this.currentPage+10,this.getSensorsVoid()):(this.currentPage=this.totalPages,this.getSensorsVoid())}lastPage(){this.currentPage!=this.totalPages&&(this.currentPage=this.totalPages,this.getSensorsVoid())}}return(e=t).\u0275fac=function(n){return new(n||e)(G(dh),G(Zr),G(Bi))},e.\u0275cmp=mi({type:e,selectors:[["app-sensors"]],hostBindings:function(n,o){1&n&&ye("resize",function(f){return o.onResize(f)},0,Rg)},decls:83,vars:60,consts:[[1,"m-0","p-0","row","d-flex",2,"justify-content","space-evenly",3,"ngClass"],[1,"cc2","cont","mx-0",3,"ngClass"],[1,"p-3","pb-0","pe-2"],[1,"row","d-flex"],[1,"col-6","col-sm-6","col-lg-3","mb-3"],[1,"w-100","d-flex",2,"position","relative"],["id","searchAux","name","searchAux","type","text","class","form-control","aria-label","Recipient's username","aria-describedby","basic-addon2","readonly","",3,"ngModel","placeholder","keyup","ngModelChange",4,"ngIf"],["id","searchAux","name","searchAux","type","text","class","form-control","aria-label","Recipient's username","aria-describedby","basic-addon2",3,"ngModel","placeholder","keyup","ngModelChange",4,"ngIf"],["aria-label","Close",1,"btn-close",2,"cursor","pointer","position","absolute","top","7px","right","7px",3,"click"],[1,"col-6","col-sm-6","col-lg-9","d-flex",2,"justify-content","flex-end"],["type","button",1,"btn","btn-info",3,"ngClass","click"],[1,"row","flex-row-reverse","pe-3",2,"height","72vh"],["class","col-12 d-flex","style","justify-content: center; align-content: center;align-items: center; height: 74vh; background-color: white;",4,"ngIf"],["class","col-12 pe-0 over","style","max-height: 71vh;",4,"ngIf"],[1,"row",2,"background-color","#fff","border-bottom-right-radius","15px","border-bottom-left-radius","15px"],[1,"col-12","col-lg-6","d-flex","mt-3"],[1,"p-0","mt-1"],["aria-label","Default select example","id","quantPage","name","quantPage",1,"form-select","ms-3",3,"ngModel","change","ngModelChange"],[3,"value","selected",4,"ngFor","ngForOf"],[1,"col-12","col-lg-6","d-flex",2,"justify-content","flex-end"],["aria-label","Page navigation example"],["class","pagination mt-3 mb-0",4,"ngIf"],["class","cc2 cont mx-0",3,"ngClass",4,"ngIf"],["id","exampleModal","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header",2,"border-bottom","0px"],[1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"not"],[1,"modal-footer",2,"border-top","0px"],[1,"row"],[1,"col-6"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary","text-light"],["type","button","data-bs-toggle","modal","data-bs-target","#exampleModal","class","btn btn-danger","data-bs-dismiss","modal","disabled","",3,"click",4,"ngIf"],["type","button","data-bs-toggle","modal","data-bs-target","#exampleModal","class","btn btn-danger","data-bs-dismiss","modal",3,"click",4,"ngIf"],["id","exampleModal1","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],[1,"col-7"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary","pe-4",2,"width","max-content",3,"click"],[1,"col-5"],["type","button navb","data-bs-toggle","modal","data-bs-target","#exampleModal1",1,"btn","btn-info",2,"width","100%",3,"ngClass"],[1,"toast-cont"],["class","top-0 right-0 p-3",4,"ngIf"],["class","top-0 end-0 p-3",4,"ngIf"],["id","searchAux","name","searchAux","type","text","aria-label","Recipient's username","aria-describedby","basic-addon2","readonly","",1,"form-control",3,"ngModel","placeholder","keyup","ngModelChange"],["id","searchAux","name","searchAux","type","text","aria-label","Recipient's username","aria-describedby","basic-addon2",1,"form-control",3,"ngModel","placeholder","keyup","ngModelChange"],[1,"col-12","d-flex",2,"justify-content","center","align-content","center","align-items","center","height","74vh","background-color","white"],["role","status",1,"spinner-border","text-secondary"],[1,"visually-hidden"],[2,"height","min-content"],[2,"font-size","x-large"],[1,"col-12","pe-0","over",2,"max-height","71vh"],[1,"table",3,"ngClass"],[2,"background-color","#fff"],["scope","col",2,"cursor","pointer","z-index","100",3,"ngClass"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","class","bi bi-caret-up-fill","viewBox","0 0 16 16",3,"click",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","class","bi bi-caret-down-fill","viewBox","0 0 16 16",3,"click",4,"ngIf"],["scope","col",2,"cursor","pointer",3,"ngClass"],["scope","col",1,"d-none","d-md-none","d-lg-table-cell",2,"cursor","pointer",3,"ngClass"],["scope","col","style","cursor: pointer; text-align: center;",3,"ngClass",4,"ngIf"],["style","cursor: pointer;","scope","col",3,"ngClass",4,"ngIf"],["scope","col",2,"text-align","center"],[4,"ngFor","ngForOf"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-caret-up-fill",3,"click"],["d","m7.247 4.86-4.796 5.481c-.566.647-.106 1.659.753 1.659h9.592a1 1 0 0 0 .753-1.659l-4.796-5.48a1 1 0 0 0-1.506 0z"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-caret-down-fill",3,"click"],["d","M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"],["scope","col",2,"cursor","pointer","text-align","center",3,"ngClass"],[2,"cursor","pointer",3,"ngClass"],[1,"rounded-0",3,"ngClass","click"],[1,"d-table-cell",3,"ngClass","click"],[1,"d-none","d-md-none","d-lg-table-cell",3,"ngClass","click"],["class","d-table-cell",3,"ngClass","click",4,"ngIf"],[1,"d-table-cell",2,"text-align","center",3,"ngClass","mouseout","mouseover","click"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","class","bi bi-clipboard-plus","viewBox","0 0 16 16",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","class","bi bi-clipboard2-plus-fill","viewBox","0 0 16 16",4,"ngIf"],[1,"d-table-cell",2,"color","black","text-align","center",3,"ngClass","mouseover","mouseout","click"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","class","bi bi-pencil","viewBox","0 0 16 16",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","class","bi bi-pencil-fill","viewBox","0 0 16 16",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-clipboard-plus"],["fill-rule","evenodd","d","M8 7a.5.5 0 0 1 .5.5V9H10a.5.5 0 0 1 0 1H8.5v1.5a.5.5 0 0 1-1 0V10H6a.5.5 0 0 1 0-1h1.5V7.5A.5.5 0 0 1 8 7z"],["d","M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"],["d","M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-clipboard2-plus-fill"],["d","M10 .5a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5.5.5 0 0 1-.5.5.5.5 0 0 0-.5.5V2a.5.5 0 0 0 .5.5h5A.5.5 0 0 0 11 2v-.5a.5.5 0 0 0-.5-.5.5.5 0 0 1-.5-.5Z"],["d","M4.085 1H3.5A1.5 1.5 0 0 0 2 2.5v12A1.5 1.5 0 0 0 3.5 16h9a1.5 1.5 0 0 0 1.5-1.5v-12A1.5 1.5 0 0 0 12.5 1h-.585c.055.156.085.325.085.5V2a1.5 1.5 0 0 1-1.5 1.5h-5A1.5 1.5 0 0 1 4 2v-.5c0-.175.03-.344.085-.5ZM8.5 6.5V8H10a.5.5 0 0 1 0 1H8.5v1.5a.5.5 0 0 1-1 0V9H6a.5.5 0 0 1 0-1h1.5V6.5a.5.5 0 0 1 1 0Z"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-pencil"],["d","M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-pencil-fill"],["d","M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708l-3-3zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207l6.5-6.5zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.499.499 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11l.178-.178z"],[3,"value","selected"],[1,"pagination","mt-3","mb-0"],[1,"page-item"],["aria-label","Previous",1,"page-link",2,"cursor","pointer",3,"click"],["aria-hidden","true"],["class","page-item",4,"ngIf"],[1,"page-link","mark",2,"cursor","pointer",3,"click"],["aria-label","Next",1,"page-link",2,"cursor","pointer",3,"click"],[1,"page-link",2,"cursor","pointer",3,"click"],[1,"row","needs-validation","p-3"],["form","ngForm"],[1,"col-12"],[1,"row",2,"white-space","nowrap","overflow","hidden","text-overflow","ellipsis"],["class","mb-0",4,"ngIf"],["ng-class","myForm.input.$valid ? '' : 'has-danger'","type","text","class","form-control d-none","id","id","name","id",3,"value","ngModel","ngModelChange",4,"ngIf"],[1,"col-12","pt-2","form-group"],["for","type"],["maxlength","45","type","text","id","type","name","type","required","","type","",1,"form-control",3,"value","ngModel","ngModelChange"],["class","text-danger",4,"ngIf"],[1,"col-12","col-md-6","mt-2"],["for","metric"],["maxlength","45","type","text","id","metric","name","metric","required","","type","",1,"form-control",3,"value","ngModel","ngModelChange"],[1,"col-md-6","mt-2"],["for","position"],["type","number","min","0","maxlength","11","id","position","name","position",1,"form-control",3,"value","ngModel","ngModelChange"],[1,"col-md-12","mt-2"],["for","description"],["maxlength","45","type","text","id","description","name","description","type","",1,"form-control",3,"value","ngModel","ngModelChange"],[1,"col-md-6","mt-2",3,"ngClass"],["for","errorvalue"],["type","number","id","errorvalue","name","errorvalue",1,"form-control",3,"value","ngModel","ngModelChange"],["for","time_general"],["placeholder","ej: +4","type","text","id","time_general","name","time_general","type","",1,"form-control",3,"value","ngModel","ngModelChange"],[1,"col-6","mt-2"],["for","valuemin"],["step","0.01","type","number","id","valuemin","name","valuemin",1,"form-control",3,"value","ngModel","ngModelChange"],["for","valuemax"],["step","0.01","type","number","id","valuemax","name","valuemax",1,"form-control",3,"value","ngModel","ngModelChange"],["for","general"],["placeholder","ej: value/3","type","text","id","general","name","general","type","",1,"form-control",3,"value","ngModel","ngModelChange"],["for","discard_value"],["type","text","id","discard_value","name","discard_value","type","",1,"form-control",3,"value","ngModel","ngModelChange"],[1,"col-12","mt-3"],["class","row",4,"ngIf"],[1,"mb-0"],["ng-class","myForm.input.$valid ? '' : 'has-danger'","type","text","id","id","name","id",1,"form-control","d-none",3,"value","ngModel","ngModelChange"],["campo","ngModel"],[1,"text-danger"],[4,"ngIf"],["type","button navb",1,"btn","btn-secondary","text-light","navb",2,"width","100%",3,"click"],["ng-click","ocultar = true","type","button navb submit",1,"btn","btn-info","navb","me-3",2,"width","100%",3,"ngClass","click"],["type","button navb","class","btn btn-secondary text-light navb","style","width: 100%",3,"click",4,"ngIf"],["type","button navb","class","btn btn-secondary text-light navb","style","width: 100%","data-bs-toggle","modal","data-bs-target","#exampleModal1",4,"ngIf"],["type","submit","type","button navb submit",1,"btn","btn-info",2,"width","100%",3,"ngClass","click"],[1,"row","d-flex",2,"justify-content","flex-end"],["type","button","class","btn btn-danger navb me-3","data-bs-toggle","modal","style","width: 100%","data-bs-target","#exampleModal","disabled","",4,"ngIf"],["type","button","class","btn btn-danger navb me-3","data-bs-toggle","modal","style","width: 100%","data-bs-target","#exampleModal",4,"ngIf"],["type","button navb","data-bs-toggle","modal","data-bs-target","#exampleModal1",1,"btn","btn-secondary","text-light","navb",2,"width","100%"],["type","button","data-bs-toggle","modal","data-bs-target","#exampleModal","disabled","",1,"btn","btn-danger","navb","me-3",2,"width","100%"],["type","button","data-bs-toggle","modal","data-bs-target","#exampleModal",1,"btn","btn-danger","navb","me-3",2,"width","100%"],["type","button","data-bs-toggle","modal","data-bs-target","#exampleModal","data-bs-dismiss","modal","disabled","",1,"btn","btn-danger",3,"click"],["type","button","data-bs-toggle","modal","data-bs-target","#exampleModal","data-bs-dismiss","modal",1,"btn","btn-danger",3,"click"],[1,"top-0","right-0","p-3"],["role","alert","role","alert","aria-live","assertive","aria-atomic","true",1,"toast","show","align-items-center","text-bg-success","border-0"],[1,"d-flex"],[1,"toast-body"],["type","button","data-bs-dismiss","toast","aria-label","Close",1,"btn-close","btn-close-white","me-2","m-auto"],[1,"top-0","end-0","p-3"],["role","alert","role","alert","aria-live","assertive","aria-atomic","true",1,"toast","show","align-items-center","text-bg-danger","border-0"]],template:function(n,o){1&n&&(He(0,"app-navbar"),L(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3)(5,"div",4)(6,"div",5),J(7,h7,2,4,"input",6),J(8,p7,2,4,"input",7),L(9,"p",8),ye("click",function(){return o.deleteSearch()}),P()()(),L(10,"div",9)(11,"div")(12,"button",10),ye("click",function(){return o.openNew("","","","",null,null,null,0,"","",""),o.state=1}),W(13),te(14,"translate"),P()()()()(),L(15,"div",11),J(16,f7,5,3,"div",12),J(17,g7,5,3,"div",12),J(18,B7,33,44,"div",13),P(),L(19,"div",14)(20,"div",15)(21,"div")(22,"p",16),W(23),P()(),L(24,"div")(25,"select",17),ye("change",function(){return o.currentPage=1,o.getSensorsLocal("position","ASC")})("ngModelChange",function(f){return o.quantPage=f}),J(26,V7,3,6,"option",18),P()()(),L(27,"div",19)(28,"nav",20),J(29,G7,19,11,"ul",21),P()()()(),J(30,CU,73,76,"div",22),P(),L(31,"div",23)(32,"div",24)(33,"div",25)(34,"div",26)(35,"h3",27),W(36),te(37,"translate"),P(),He(38,"button",28),P(),L(39,"div",29)(40,"p",30),W(41),te(42,"translate"),P()(),L(43,"div",31)(44,"div",32)(45,"div",33)(46,"button",34),W(47),te(48,"translate"),P()(),L(49,"div",33),J(50,MU,3,3,"button",35),J(51,EU,3,3,"button",36),P()()()()()(),L(52,"div",37)(53,"div",24)(54,"div",25)(55,"div",26)(56,"h3",27),W(57),te(58,"translate"),P(),He(59,"button",28),P(),L(60,"div",29)(61,"p",30),W(62),te(63,"translate"),P()(),L(64,"div",31)(65,"div",32)(66,"div",38)(67,"button",39),ye("click",function(){return o.rechargeForm()}),W(68),te(69,"translate"),P()(),L(70,"div",40)(71,"button",41),W(72),te(73,"translate"),P()()()()()()(),L(74,"div",42),J(75,TU,7,3,"div",43),J(76,DU,7,3,"div",44),J(77,SU,7,3,"div",44),J(78,IU,7,3,"div",44),J(79,AU,7,3,"div",44),J(80,PU,7,3,"div",44),J(81,kU,7,3,"div",44),J(82,OU,7,3,"div",44),P()),2&n&&(w(1),U("ngClass",Ap(50,LU,o.width<965,o.width>=965)),w(1),U("ngClass",Ap(53,RU,1==o.showAux||o.width<965,0==o.showAux)),w(5),U("ngIf",o.change||o.change),w(1),U("ngIf",!o.change&&!o.change),w(4),U("ngClass",ft(56,l1,o.change||o.change)),w(1),Ce(ne(14,34,"sensors.nuevo_sensor")),w(3),U("ngIf",o.charging),w(1),U("ngIf",o.data.length<=0&&0==o.charging),w(1),U("ngIf",o.data.length>0),w(5),Qg("",o.quantPage*(o.currentPage-1)+1," - ",o.totalPage," de ",o.total,""),w(2),U("ngModel",o.quantPage),w(1),U("ngForOf",o.resultsPerPag),w(3),U("ngIf",o.data.length>0),w(1),U("ngIf",o.show),w(6),Ce(ne(37,36,"sensors.m1.1")),w(5),Ce(ne(42,38,"sensors.m1.2")),w(6),Ce(ne(48,40,"sensors.exit")),w(3),U("ngIf",o.change),w(1),U("ngIf",!o.change),w(6),Ce(ne(58,42,"reset.data2")),w(5),Ce(ne(63,44,"irreversible")),w(6),Ce(ne(69,46,"reset.data")),w(3),U("ngClass",ft(58,l1,!o.change)),w(1),Ce(ne(73,48,"sensors.cancel")),w(3),U("ngIf",o.dupOk),w(1),U("ngIf",o.dupNot),w(1),U("ngIf",o.alertDelete),w(1),U("ngIf",o.notDelete),w(1),U("ngIf",o.alertNew),w(1),U("ngIf",o.notNew),w(1),U("ngIf",o.saveOk),w(1),U("ngIf",o.saveNot))},dependencies:[Qd,eh,Mc,kv,Np,zp,nh,cm,Ru,Lp,Tv,um,dm,Ov,sh,Fp,n1,Zp],styles:['*[_ngcontent-%COMP%]{font-family:system-ui}.input-1[_ngcontent-%COMP%]{width:15%}.input-0[_ngcontent-%COMP%]{width:10%}.input-00[_ngcontent-%COMP%]{width:5em}.input-2[_ngcontent-%COMP%]{width:30%}#map[_ngcontent-%COMP%]{width:100%;height:100%;position:relative}.floating-range[_ngcontent-%COMP%]{position:relative;bottom:0;z-index:999;width:40%}.toast-cont[_ngcontent-%COMP%]{top:-10px;right:0;position:fixed}.btn[_ngcontent-%COMP%]:hover{border-color:#fff}.mapboxgl-canvas[_ngcontent-%COMP%]{width:100%}.form-range[_ngcontent-%COMP%]::-moz-range-thumb{background-color:#6c757d}.form-range[_ngcontent-%COMP%]::-webkit-slider-thumb{background-color:#6c757d}.mark[_ngcontent-%COMP%]{background-color:#e3e3e3}th[_ngcontent-%COMP%]{border-radius:7px}.floating-content[_ngcontent-%COMP%]{display:flex}#menu[_ngcontent-%COMP%]{margin:.5em;font-size:medium;background-color:#fff;position:relative;width:max-content;padding:5px;top:0;left:0;z-index:999;border-radius:5px;border:1px #afafaf solid}#menu[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin-right:.5em}.list-group[_ngcontent-%COMP%]{z-index:999;position:absolute;top:0;right:0;cursor:pointer;height:85%}.botoncito[_ngcontent-%COMP%]{z-index:1000;position:absolute;top:30px;left:20px}.nav[_ngcontent-%COMP%]{margin:1em}.cc2[_ngcontent-%COMP%]{margin:0 1em 1em}h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%], h4[_ngcontent-%COMP%], p[_ngcontent-%COMP%], a[_ngcontent-%COMP%], .btn[_ngcontent-%COMP%], span[_ngcontent-%COMP%], label[_ngcontent-%COMP%]{font-weight:500}.navb[_ngcontent-%COMP%]{width:49%}.cont[_ngcontent-%COMP%]{background-color:#fff;border-radius:10px;min-height:88vh}.cont_recto[_ngcontent-%COMP%]{border-top-left-radius:0}.cont0[_ngcontent-%COMP%]{margin:0 1em}.c10[_ngcontent-%COMP%]{width:68.5%}.c100[_ngcontent-%COMP%]{width:98%}.sensores_2_20[_ngcontent-%COMP%]{width:29%}.sensores_2_100[_ngcontent-%COMP%]{width:96%}.c20[_ngcontent-%COMP%]{width:50%}.c200[_ngcontent-%COMP%]{width:100%}.single-line[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.rev[_ngcontent-%COMP%]{flex-direction:column-reverse}.cont1[_ngcontent-%COMP%]{background-color:#fff;padding:1em;border-radius:10px;margin-bottom:1em}.cont2[_ngcontent-%COMP%]{background-color:#fff;border-radius:10px;height:max-content;margin-bottom:1em}.alt[_ngcontent-%COMP%]{height:82vh}.cont3[_ngcontent-%COMP%]{padding:0 1em 1em;background-color:#fff;border-radius:10px;height:min-content;margin-bottom:1em}.over[_ngcontent-%COMP%]{overflow-y:scroll}thead[_ngcontent-%COMP%]{background-color:#f2f2f2;border-radius:10px}.half[_ngcontent-%COMP%]{width:50%}app-devices-edit[_ngcontent-%COMP%]{display:flex}a[_ngcontent-%COMP%]{text-decoration:none;color:#000}.c1[_ngcontent-%COMP%]{height:min-content}.c2[_ngcontent-%COMP%]{padding-top:1em;height:max-content}.c3[_ngcontent-%COMP%]{height:-moz-fit-content;height:fit-content}.c4[_ngcontent-%COMP%]{padding:.8em 1em .5em;height:-moz-fit-content;height:fit-content}.c5[_ngcontent-%COMP%]{height:62vh}.c6[_ngcontent-%COMP%]{padding:1em 1em .5em}.nuevo[_ngcontent-%COMP%]{border-radius:10px;background-color:#f2f2f2;padding:1em;margin:.01em .01em 1em}.not[_ngcontent-%COMP%]{font-size:large}.tt1[_ngcontent-%COMP%]{--width: 130px;--height: calc(var(--width) / 3.5)}.tt2[_ngcontent-%COMP%]{--width: 100px;--height: calc(var(--width) / 3.3)}.toggle[_ngcontent-%COMP%]{position:relative;display:inline-block;width:var(--width);height:var(--height);box-shadow:0 1px 3px #0000004d;border-radius:var(--height);cursor:pointer}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.toggle[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;border-radius:var(--height);background-color:#dc3545;transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;width:calc(var(--height));height:calc(var(--height));border-radius:calc(var(--height) / 2);background-color:#fff;box-shadow:0 1px 3px #0000004d;transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]{background-color:#198754}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]:before{transform:translate(calc(var(--width) - var(--height)))}.toggle[_ngcontent-%COMP%]   .labels[_ngcontent-%COMP%]{position:absolute;top:8px;left:0;width:100%;height:100%;font-weight:600;transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   .labels[_ngcontent-%COMP%]:after{content:attr(data-off);position:absolute;right:25px;color:#fff;opacity:1;text-shadow:1px 1px 2px rgba(0,0,0,.4);transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   .labels[_ngcontent-%COMP%]:before{content:attr(data-on);position:absolute;left:25px;color:#fff;opacity:0;text-shadow:1px 1px 2px rgba(255,255,255,.4);transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked ~ .labels[_ngcontent-%COMP%]:after{opacity:0}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked ~ .labels[_ngcontent-%COMP%]:before{opacity:1}.mapboxgl-popup[_ngcontent-%COMP%]{max-width:400px;font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif}.t1[_ngcontent-%COMP%]{font-size:15px}.t2[_ngcontent-%COMP%]{font-size:11px}  .ng-select .ng-clear-wrapper .ng-clear{font-size:40px!important;color:#969696;right:7px;line-height:.7!important}  .ng-select .ng-clear-wrapper{height:34px;line-height:.5;width:30px!important}  .ng-value{background-color:#e3e3e3;border-radius:6px;margin-right:.5em;padding-bottom:.2em}  .ng-dropdown-panel{background-color:#f5f5f5}  .ng-option{padding:0 .7em .7em}  .ng-value-icon{font-size:22px;padding-left:.4em;padding-right:.4em}  .ng-value-label{padding-right:1em}.mapbox-popup-anchor-bottom[_ngcontent-%COMP%]{max-width:400px}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}tbody[_ngcontent-%COMP%]{max-height:600px;overflow-y:scroll}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:left;position:sticky;top:0;z-index:1}']}),t})()},{path:"structure",component:(()=>{var e;class t{constructor(n,o,c){this.http=n,this.rutaActiva=o,this.elementRef=c,this.resultsPerPag=qt_resultsPerPag,this.getVariableStructureList=qt_baseUrl+"/variable_data_structure/get_list",this.getEstructure=qt_baseUrl+"/data_structure/get",this.postEstructure=qt_baseUrl+"/data_structure",this.duplicateEstructure=qt_baseUrl+"/data_structure/duplicate",this.totalPages=5,this.currentPage=1,this.quantPage=15,this.page=1,this.total=0,this.totalPage=0,this.aux=1,this.alt1=!0,this.alt2=!0,this.alt3=!0,this.alt4=!0,this.actId=0,this.id=0,this.state=1,this.rute="",this.charging=!1,this.saved=!1,this.change=!1,this.width=0,this.timeout=null,this.show=!1,this.showAux=!0,this.dupOk=!1,this.dupNot=!1,this.viewDup=-1,this.pencilDup=-1,this.searchAux="search",this.order="description",this.ordAux="ASC",this.alertDelete=!1,this.notDelete=!1,this.alertNew=!1,this.notNew=!1,this.saveOk=!1,this.saveNot=!1,this.estructure={id_estructure:"",description:null,configuration:null,identifier_code:null,id_variable_data_structure:1,variable_description:""},this.estructureCopy={id_estructure:"",description:null,configuration:null,identifier_code:null,id_variable_data_structure:1,variable_description:""},this.estructureVariable={structure:[{id:1,description:"",structure:"",initial_byte:0}]},this.search={value:""},this.http.get(`${this.getVariableStructureList}`).subscribe(f=>{this.aux=f[0].id},f=>{console.error("Error al obtener datos de estructura variable:",f)})}ngOnInit(){this.getStructures(this.order,this.ordAux),this.getStructuresList()}getStructuresVoid(){this.getStructures(this.order,this.ordAux)}getStructures(n,o){this.order=n,this.rute=this.rutaActiva.routerState.snapshot.url,this.searchAux=""==this.search.value?"search":this.search.value,this.charging=!0,this.data=[],this.http.get(`${this.getEstructure}/${this.searchAux}/${this.order}/${o}/${this.currentPage}/${this.quantPage}`).subscribe(c=>{this.charging=!1,c&&c.length>0&&c[0].total?(this.totalPages=Math.ceil(c[0].total/this.quantPage),this.total=c[0].total):(this.totalPages=0,this.total=0),this.data=c,this.totalPage=this.data.length<this.quantPage?this.total:this.quantPage*this.currentPage},c=>{console.error("Error al obtener datos de estructura:",c)})}getStructuresLocal(n,o){this.order=n,this.getStructures(n,o);const c=this.elementRef.nativeElement.querySelector(".mark_select");c&&c.scrollIntoView({behavior:"smooth"})}orderColumn(n){if(this.show=!0,!this.change&&!this.change&&n!=this.actId){this.actId=n,this.id=n,this.openEdit(),this.state=2;const o=this.data.find(c=>c.id_estructure==n);this.estructure={...o},this.estructureCopy={id_estructure:this.estructure.id_estructure,description:this.estructure.description,configuration:this.estructure.configuration,identifier_code:this.estructure.identifier_code,id_variable_data_structure:this.estructure.id_variable_data_structure,variable_description:this.estructure.variable_description},this.openClouse()}}getStructuresList(){this.http.get(`${this.getVariableStructureList}`).subscribe(n=>{this.estructureVariable.structure=n},n=>{console.error("Error al obtener datos de estructura variable:",n)})}newStructures(n){if(this.state=1,n.valid){const o={headers:new rr({"Content-Type":"application/json; charset=UTF-8"})};this.http.post(this.postEstructure,JSON.stringify(this.estructure),o).subscribe(c=>{this.id=c.id,this.alertNew=!0,setTimeout(()=>{this.alertNew=!1},2e3),this.openClouse(),this.data.push({id_estructure:this.id,description:this.estructure.description,configuration:this.estructure.configuration,identifier_code:this.estructure.identifier_code,id_variable_data_structure:this.estructure.id_variable_data_structure}),this.data.sort((y,E)=>y.description.localeCompare(E.description)),this.actId=this.id,this.openEdit(),this.state=2},c=>{console.error("Error:",c)}),this.change=!1}}openNew(n,o,c,f,y,E){""==n?(this.estructureCopy.id_variable_data_structure=this.aux,this.estructure={id_estructure:n,description:o,configuration:c,identifier_code:f,id_variable_data_structure:this.aux,variable_description:E}):(this.estructureCopy.id_variable_data_structure=y,this.estructure={id_estructure:n,description:o,configuration:c,identifier_code:f,id_variable_data_structure:y,variable_description:E}),this.actId=1,this.show=!0,this.openClouse(),this.state=1}editStructures(){1==this.show&&(0==this.state||1==this.state)&&this.newStructures(this.estructure),0==this.show&&2==this.state&&this.editStructuresAux(this.estructure,-1)}editStructuresAux(n,o){if(n.valid){const c={headers:new rr({"Content-Type":"application/json; charset=UTF-8"})};this.http.put(this.postEstructure,JSON.stringify(this.estructure),c).subscribe(y=>{},y=>{console.error("Error:",y)}),this.data=this.data.filter(y=>y.id_estructure!==this.estructure.id_estructure),this.data.push(this.estructure),this.data.sort((y,E)=>y.description.localeCompare(E.description)),this.actId=parseInt(this.estructure.id_estructure),this.openEdit(),this.state=2,o>=0&&(this.data[o].variable_description=this.estructure.variable_description),this.saveOk=!0,setTimeout(()=>{this.saveOk=!1},2e3),this.saved=!0,this.change=!1}}openEdit(){this.show=!0,this.state=2,this.showAux=!1}duplicateStructures(n,o){!this.change&&!this.change&&this.http.get(`${this.duplicateEstructure}/${o}`).subscribe(c=>{this.openClouse(),this.state=0,this.openNew("1",c.duplicatedDescription,this.estructure.configuration,this.estructure.identifier_code,this.estructure.id_variable_data_structure,this.estructure.variable_description),this.change=!0},c=>{console.error("Error al verificar la descripci\xf3n duplicada:",c)})}deleteStructures(n){var o={id_estructure:this.id};const c={headers:new rr({"Content-Type":"application/json; charset=UTF-8"}),body:JSON.stringify(o)};this.http.delete(this.postEstructure,c).subscribe(f=>{},f=>{console.error("Error:",f)}),this.alertDelete=!0,setTimeout(()=>{this.alertDelete=!1},2e3),this.data=this.data.filter(f=>f.id_estructure!=n),this.openClouse()}textSearch(n){this.currentPage=1,clearTimeout(this.timeout);var o=this;this.timeout=setTimeout(()=>{13!=n.keyCode&&(o.getStructures(this.order,this.ordAux),o.openClouse())},500)}rechargeForm(){this.change=!1,this.estructure={id_estructure:this.estructureCopy.id_estructure,description:this.estructureCopy.description,configuration:this.estructureCopy.configuration,identifier_code:this.estructureCopy.identifier_code,id_variable_data_structure:this.estructureCopy.id_variable_data_structure,variable_description:this.estructureCopy.variable_description}}deleteSearch(){this.Page(1),this.totalPages=5,this.currentPage=1,this.quantPage=15,this.page=1,this.search.value="",this.getStructures(this.order,this.ordAux)}clouse(){this.show=!1,this.openClouse(),this.change=!1,this.actId=-1}openClouse(){this.showAux=1!=this.show}clouseAll(){this.showAux=!1,this.show=!1,this.openClouse(),this.change=!1}firstPage(){1!=this.currentPage&&(this.currentPage=1,this.getStructuresVoid())}previousPage10(){this.currentPage-10>1?(this.currentPage=this.currentPage-10,this.getStructuresVoid()):(this.currentPage=1,this.getStructuresVoid())}previousPage(){this.currentPage>1&&(this.currentPage--,this.getStructuresVoid())}Page(n){this.currentPage=n,this.getStructuresVoid()}nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.getStructuresVoid())}nextPage10(){this.currentPage+10<this.totalPages?(this.currentPage=this.currentPage+10,this.getStructuresVoid()):(this.currentPage=this.totalPages,this.getStructuresVoid())}lastPage(){this.currentPage!=this.totalPages&&(this.currentPage=this.totalPages,this.getStructuresVoid())}}return(e=t).\u0275fac=function(n){return new(n||e)(G(dh),G(Zr),G(Bi))},e.\u0275cmp=mi({type:e,selectors:[["app-structure"]],decls:82,vars:51,consts:[[1,"m-0","p-0","row","d-flex"],[1,"cc2","cont","me-0","c100"],[1,"p-3","pb-0","pe-2"],[1,"row","d-flex"],[1,"col-6","col-sm-6","col-lg-3","mb-3"],[1,"w-100","d-flex",2,"position","relative"],["id","search","name","search","type","text","class","form-control","aria-label","Recipient's username","aria-describedby","basic-addon2","readonly","",3,"ngModel","placeholder","keyup","ngModelChange",4,"ngIf"],["id","search","name","search","type","text","class","form-control","aria-label","Recipient's username","aria-describedby","basic-addon2",3,"ngModel","placeholder","keyup","ngModelChange",4,"ngIf"],["aria-label","Close",1,"btn-close",2,"cursor","pointer","position","absolute","top","7px","right","7px",3,"click"],[1,"col-6","col-sm-6","col-lg-9","d-flex",2,"justify-content","flex-end"],["type","button",1,"btn","btn-info",3,"ngClass","click"],[1,"row","flex-row-reverse","pe-3",2,"height","72vh"],["class","col-12 d-flex","style","justify-content: center; align-content: center;align-items: center; height: 74vh; background-color: white;",4,"ngIf"],["class","col-12 pe-0 over","style","max-height: 71vh;",4,"ngIf"],[1,"row",2,"background-color","#fff","border-bottom-right-radius","15px","border-bottom-left-radius","15px"],[1,"col-12","col-lg-6","d-flex","mt-3"],[1,"p-0","mt-1"],["aria-label","Default select example","id","quantPage","name","quantPage",1,"form-select","ms-3",3,"ngModel","change","ngModelChange"],[3,"value","selected",4,"ngFor","ngForOf"],[1,"col-12","col-lg-6","d-flex",2,"justify-content","flex-end"],["aria-label","Page navigation example"],["class","pagination mt-3 mb-0",4,"ngIf"],["id","exampleModal","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header",2,"border-bottom","0px"],[1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"not"],[1,"modal-footer",2,"border-top","0px"],[1,"row"],[1,"col-6"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary","text-light"],["type","button","data-bs-toggle","modal","data-bs-target","#exampleModal","class","btn btn-danger","data-bs-dismiss","modal","disabled","",3,"click",4,"ngIf"],["type","button","data-bs-toggle","modal","data-bs-target","#exampleModal","class","btn btn-danger","data-bs-dismiss","modal",3,"click",4,"ngIf"],["id","exampleModal1","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],[1,"col-7"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary","me-4",2,"width","max-content",3,"click"],[1,"col-5"],["type","button navb","data-bs-toggle","modal","data-bs-target","#exampleModal1",1,"btn","btn-info",2,"width","100%",3,"ngClass","click"],[1,"toast-cont"],["class","top-0 right-0 p-3",4,"ngIf"],["class","top-0 end-0 p-3",4,"ngIf"],["id","search","name","search","type","text","aria-label","Recipient's username","aria-describedby","basic-addon2","readonly","",1,"form-control",3,"ngModel","placeholder","keyup","ngModelChange"],["id","search","name","search","type","text","aria-label","Recipient's username","aria-describedby","basic-addon2",1,"form-control",3,"ngModel","placeholder","keyup","ngModelChange"],[1,"col-12","d-flex",2,"justify-content","center","align-content","center","align-items","center","height","74vh","background-color","white"],["role","status",1,"spinner-border","text-secondary"],[1,"visually-hidden"],[2,"height","min-content"],[2,"font-size","x-large"],[1,"col-12","pe-0","over",2,"max-height","71vh"],["id","miTabla",1,"table",3,"ngClass"],["scope","col",2,"cursor","pointer","z-index","100",3,"ngClass"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","class","bi bi-caret-up-fill","viewBox","0 0 16 16",3,"click",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","class","bi bi-caret-down-fill","viewBox","0 0 16 16",3,"click",4,"ngIf"],["scope","col",2,"cursor","pointer",3,"ngClass"],["scope","col",2,"text-align","center"],[4,"ngFor","ngForOf"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-caret-up-fill",3,"click"],["d","m7.247 4.86-4.796 5.481c-.566.647-.106 1.659.753 1.659h9.592a1 1 0 0 0 .753-1.659l-4.796-5.48a1 1 0 0 0-1.506 0z"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-caret-down-fill",3,"click"],["d","M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"],["id","primera",4,"ngIf"],[2,"cursor","pointer",3,"ngClass"],[2,"border-radius","0px",3,"ngClass","click"],[2,"width","300px",3,"ngClass","click"],[3,"ngClass","click"],[2,"text-align","center",3,"ngClass","mouseout","mouseover","click"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","class","bi bi-clipboard-plus","viewBox","0 0 16 16",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","class","bi bi-clipboard2-plus-fill","viewBox","0 0 16 16",4,"ngIf"],[2,"color","black","text-align","center",3,"ngClass","mouseover","mouseout","click"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","class","bi bi-pencil","viewBox","0 0 16 16",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","class","bi bi-pencil-fill","viewBox","0 0 16 16",4,"ngIf"],["id","primera",3,"ngClass",4,"ngIf"],["id","primera"],["colspan","6","style","cursor: pointer;","class","mark",4,"ngIf"],["colspan","6",1,"mark",2,"cursor","pointer"],[1,"needs-validation","m-0","p-3","pt-2","pb-0","row","w-100",2,"display","flex","justify-content","flex-end"],["form","ngForm"],[1,"col-12","col-lg-3","pe-3"],["for","description"],["maxlength","45","type","text","id","description","name","description",1,"form-control",3,"value","ngModel","ngModelChange"],["for","configuration"],["type","text","id","configuration","name","configuration",1,"form-control",3,"value","ngModel","ngModelChange"],[1,"col-12","col-lg-2","pe-3"],["for","identifier_code"],["type","number","maxlength","11","id","identifier_code","name","identifier_code",1,"form-control",3,"value","ngModel","ngModelChange"],[1,"col-12","col-lg-4","pe-3",2,"position","relative"],["for","id_variable_data_structure"],["type","select","type","text","id","id_variable_data_structure","name","id_variable_data_structure",1,"form-control",3,"value","ngModel","ngModelChange"],[2,"position","absolute","top","29px","right","29px"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-chevron-down"],["fill-rule","evenodd","d","M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"],["class","text-danger",4,"ngIf"],["class","col-12 col-lg-12 mt-4",4,"ngIf"],[3,"selected","value"],[1,"text-danger"],[4,"ngIf"],[1,"col-12","col-lg-12","mt-4"],[1,"col-6","col-lg-2",3,"ngClass"],["type","button navb",1,"btn","btn-secondary","text-light","navb",2,"width","100%",3,"click"],[1,"col-6","col-lg-2"],["ng-click","ocultar = true","type","button navb submit",1,"btn","btn-info","navb","me-3",2,"width","100%",3,"ngClass","click"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-clipboard-plus"],["fill-rule","evenodd","d","M8 7a.5.5 0 0 1 .5.5V9H10a.5.5 0 0 1 0 1H8.5v1.5a.5.5 0 0 1-1 0V10H6a.5.5 0 0 1 0-1h1.5V7.5A.5.5 0 0 1 8 7z"],["d","M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"],["d","M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-clipboard2-plus-fill"],["d","M10 .5a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5.5.5 0 0 1-.5.5.5.5 0 0 0-.5.5V2a.5.5 0 0 0 .5.5h5A.5.5 0 0 0 11 2v-.5a.5.5 0 0 0-.5-.5.5.5 0 0 1-.5-.5Z"],["d","M4.085 1H3.5A1.5 1.5 0 0 0 2 2.5v12A1.5 1.5 0 0 0 3.5 16h9a1.5 1.5 0 0 0 1.5-1.5v-12A1.5 1.5 0 0 0 12.5 1h-.585c.055.156.085.325.085.5V2a1.5 1.5 0 0 1-1.5 1.5h-5A1.5 1.5 0 0 1 4 2v-.5c0-.175.03-.344.085-.5ZM8.5 6.5V8H10a.5.5 0 0 1 0 1H8.5v1.5a.5.5 0 0 1-1 0V9H6a.5.5 0 0 1 0-1h1.5V6.5a.5.5 0 0 1 1 0Z"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-pencil"],["d","M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-pencil-fill"],["d","M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708l-3-3zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207l6.5-6.5zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.499.499 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11l.178-.178z"],["id","primera",3,"ngClass"],[1,"needs-validation","p-3","pt-2","pb-0","m-0","row","w-100",2,"display","flex","justify-content","flex-end"],["ng-class","myForm.input.$valid ? '' : 'has-danger'","type","text","class","form-control d-none","id","id_estructure","name","id_estructure",3,"value","ngModel","ngModelChange",4,"ngIf"],["ng-class","myForm.input.$valid ? '' : 'has-danger'","type","text","id","id_estructure","name","id_estructure",1,"form-control","d-none",3,"value","ngModel","ngModelChange"],["campo","ngModel"],[1,"col-lg-6","col-12"],[1,"col-6","col-lg-4"],["type","button navb","class","btn btn-secondary text-light navb","style","width: 100%",3,"click",4,"ngIf"],["type","button navb","class","btn btn-secondary text-light navb","style","width: 100%","data-bs-toggle","modal","data-bs-target","#exampleModal1",4,"ngIf"],[1,"col-6","col-lg-4","mb-3"],["type","submit","type","button navb submit",1,"btn","btn-info",2,"width","100%",3,"ngClass","click"],[1,"col-12","col-lg-6",3,"ngClass"],[1,"row",2,"display","flex","justify-content","end"],[1,"col-12","col-lg-4"],["type","button","class","btn btn-danger navb me-3","data-bs-toggle","modal","style","width: 100%","disabled","","data-bs-target","#exampleModal",4,"ngIf"],["type","button","class","btn btn-danger navb me-3","data-bs-toggle","modal","style","width: 100%","data-bs-target","#exampleModal",4,"ngIf"],["type","button navb","data-bs-toggle","modal","data-bs-target","#exampleModal1",1,"btn","btn-secondary","text-light","navb",2,"width","100%"],["type","button","data-bs-toggle","modal","disabled","","data-bs-target","#exampleModal",1,"btn","btn-danger","navb","me-3",2,"width","100%"],["type","button","data-bs-toggle","modal","data-bs-target","#exampleModal",1,"btn","btn-danger","navb","me-3",2,"width","100%"],[3,"value","selected"],[1,"pagination","mt-3","mb-0"],[1,"page-item"],["aria-label","Previous",1,"page-link",2,"cursor","pointer",3,"click"],["aria-hidden","true"],["class","page-item",4,"ngIf"],[1,"page-link","mark",2,"cursor","pointer",3,"click"],["aria-label","Next",1,"page-link",2,"cursor","pointer",3,"click"],[1,"page-link",2,"cursor","pointer",3,"click"],["type","button","data-bs-toggle","modal","data-bs-target","#exampleModal","data-bs-dismiss","modal","disabled","",1,"btn","btn-danger",3,"click"],["type","button","data-bs-toggle","modal","data-bs-target","#exampleModal","data-bs-dismiss","modal",1,"btn","btn-danger",3,"click"],[1,"top-0","right-0","p-3"],["role","alert","role","alert","aria-live","assertive","aria-atomic","true",1,"toast","show","align-items-center","text-bg-success","border-0"],[1,"d-flex"],[1,"toast-body"],["type","button","data-bs-dismiss","toast","aria-label","Close",1,"btn-close","btn-close-white","me-2","m-auto"],[1,"top-0","end-0","p-3"],["role","alert","role","alert","aria-live","assertive","aria-atomic","true",1,"toast","show","align-items-center","text-bg-danger","border-0"]],template:function(n,o){1&n&&(He(0,"app-navbar"),L(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3)(5,"div",4)(6,"div",5),J(7,NU,2,4,"input",6),J(8,zU,2,4,"input",7),L(9,"p",8),ye("click",function(){return o.deleteSearch()}),P()()(),L(10,"div",9)(11,"div")(12,"button",10),ye("click",function(){return o.openNew("",null,null,null,1,"")}),W(13),te(14,"translate"),P()()()()(),L(15,"div",11),J(16,BU,5,3,"div",12),J(17,VU,5,3,"div",12),J(18,bj,31,42,"div",13),P(),L(19,"div",14)(20,"div",15)(21,"div")(22,"p",16),W(23),P()(),L(24,"div")(25,"select",17),ye("change",function(){return o.currentPage=1,o.getStructuresLocal("description","ASC")})("ngModelChange",function(f){return o.quantPage=f}),J(26,wj,3,6,"option",18),P()()(),L(27,"div",19)(28,"nav",20),J(29,Dj,19,11,"ul",21),P()()()()(),L(30,"div",22)(31,"div",23)(32,"div",24)(33,"div",25)(34,"h3",26),W(35),te(36,"translate"),P(),He(37,"button",27),P(),L(38,"div",28)(39,"p",29),W(40),te(41,"translate"),P()(),L(42,"div",30)(43,"div",31)(44,"div",32)(45,"button",33),W(46),te(47,"translate"),P()(),L(48,"div",32),J(49,Sj,3,3,"button",34),J(50,Ij,3,3,"button",35),P()()()()()(),L(51,"div",36)(52,"div",23)(53,"div",24)(54,"div",25)(55,"h3",26),W(56),te(57,"translate"),P(),He(58,"button",27),P(),L(59,"div",28)(60,"p",29),W(61),te(62,"translate"),P()(),L(63,"div",30)(64,"div",31)(65,"div",37)(66,"button",38),ye("click",function(){return o.rechargeForm()}),W(67),te(68,"translate"),P()(),L(69,"div",39)(70,"button",40),ye("click",function(){return o.editStructures()}),W(71),te(72,"translate"),P()()()()()()(),L(73,"div",41),J(74,Aj,7,3,"div",42),J(75,Pj,7,3,"div",43),J(76,kj,7,3,"div",43),J(77,Oj,7,3,"div",43),J(78,Lj,7,3,"div",43),J(79,Rj,7,3,"div",43),J(80,Fj,7,3,"div",43),J(81,Nj,7,3,"div",43),P()),2&n&&(w(7),U("ngIf",o.change||o.change),w(1),U("ngIf",!o.change&&!o.change),w(4),U("ngClass",ft(47,c1,o.change)),w(1),Ce(ne(14,31,"structure.new")),w(3),U("ngIf",o.charging),w(1),U("ngIf",o.data.length<=0&&0==o.charging),w(1),U("ngIf",o.data.length>0),w(5),Qg("",o.quantPage*(o.currentPage-1)+1," - ",o.totalPage," de ",o.total,""),w(2),U("ngModel",o.quantPage),w(1),U("ngForOf",o.resultsPerPag),w(3),U("ngIf",o.data.length>0),w(6),Ce(ne(36,33,"structure.m1.1")),w(5),Ce(ne(41,35,"structure.m1.2")),w(6),Ce(ne(47,37,"sensors.exit")),w(3),U("ngIf",o.change||o.change),w(1),U("ngIf",!o.change&&!o.change),w(6),Ce(ne(57,39,"reset.data2")),w(5),Ce(ne(62,41,"irreversible")),w(6),Ce(ne(68,43,"reset.data")),w(3),U("ngClass",ft(49,c1,!o.change)),w(1),Ce(ne(72,45,"sensors.exit")),w(3),U("ngIf",o.dupOk),w(1),U("ngIf",o.dupNot),w(1),U("ngIf",o.alertDelete),w(1),U("ngIf",o.notDelete),w(1),U("ngIf",o.alertNew),w(1),U("ngIf",o.notNew),w(1),U("ngIf",o.saveOk),w(1),U("ngIf",o.saveNot))},dependencies:[Qd,eh,Mc,kv,Np,zp,nh,cm,Ru,Lp,Tv,dm,sh,Fp,n1,Zp],styles:['*[_ngcontent-%COMP%]{font-family:system-ui}.input-1[_ngcontent-%COMP%]{width:15%}.input-0[_ngcontent-%COMP%]{width:10%}.input-00[_ngcontent-%COMP%]{width:5em}.input-2[_ngcontent-%COMP%]{width:30%}#map[_ngcontent-%COMP%]{width:100%;height:100%;position:relative}.floating-range[_ngcontent-%COMP%]{position:relative;bottom:0;z-index:999;width:40%}.toast-cont[_ngcontent-%COMP%]{top:-10px;right:0;position:fixed}.btn[_ngcontent-%COMP%]:hover{border-color:#fff}.mapboxgl-canvas[_ngcontent-%COMP%]{width:100%}.form-range[_ngcontent-%COMP%]::-moz-range-thumb{background-color:#6c757d}.form-range[_ngcontent-%COMP%]::-webkit-slider-thumb{background-color:#6c757d}.mark[_ngcontent-%COMP%]{background-color:#e3e3e3}th[_ngcontent-%COMP%]{border-radius:7px}.floating-content[_ngcontent-%COMP%]{display:flex}#menu[_ngcontent-%COMP%]{margin:.5em;font-size:medium;background-color:#fff;position:relative;width:max-content;padding:5px;top:0;left:0;z-index:999;border-radius:5px;border:1px #afafaf solid}#menu[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin-right:.5em}.list-group[_ngcontent-%COMP%]{z-index:999;position:absolute;top:0;right:0;cursor:pointer;height:85%}.botoncito[_ngcontent-%COMP%]{z-index:1000;position:absolute;top:30px;left:20px}.nav[_ngcontent-%COMP%]{margin:1em}.cc2[_ngcontent-%COMP%]{margin:0 1em 1em}h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%], h4[_ngcontent-%COMP%], p[_ngcontent-%COMP%], a[_ngcontent-%COMP%], .btn[_ngcontent-%COMP%], span[_ngcontent-%COMP%], label[_ngcontent-%COMP%]{font-weight:500}.navb[_ngcontent-%COMP%]{width:49%}.cont[_ngcontent-%COMP%]{background-color:#fff;border-radius:10px;min-height:88vh}.cont_recto[_ngcontent-%COMP%]{border-top-left-radius:0}.cont0[_ngcontent-%COMP%]{margin:0 1em}.c10[_ngcontent-%COMP%]{width:68.5%}.c100[_ngcontent-%COMP%]{width:98%}.sensores_2_20[_ngcontent-%COMP%]{width:29%}.sensores_2_100[_ngcontent-%COMP%]{width:96%}.c20[_ngcontent-%COMP%]{width:50%}.c200[_ngcontent-%COMP%]{width:100%}.single-line[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.rev[_ngcontent-%COMP%]{flex-direction:column-reverse}.cont1[_ngcontent-%COMP%]{background-color:#fff;padding:1em;border-radius:10px;margin-bottom:1em}.cont2[_ngcontent-%COMP%]{background-color:#fff;border-radius:10px;height:max-content;margin-bottom:1em}.alt[_ngcontent-%COMP%]{height:82vh}.cont3[_ngcontent-%COMP%]{padding:0 1em 1em;background-color:#fff;border-radius:10px;height:min-content;margin-bottom:1em}.over[_ngcontent-%COMP%]{overflow-y:scroll}thead[_ngcontent-%COMP%]{background-color:#f2f2f2;border-radius:10px}.half[_ngcontent-%COMP%]{width:50%}app-devices-edit[_ngcontent-%COMP%]{display:flex}a[_ngcontent-%COMP%]{text-decoration:none;color:#000}.c1[_ngcontent-%COMP%]{height:min-content}.c2[_ngcontent-%COMP%]{padding-top:1em;height:max-content}.c3[_ngcontent-%COMP%]{height:-moz-fit-content;height:fit-content}.c4[_ngcontent-%COMP%]{padding:.8em 1em .5em;height:-moz-fit-content;height:fit-content}.c5[_ngcontent-%COMP%]{height:62vh}.c6[_ngcontent-%COMP%]{padding:1em 1em .5em}.nuevo[_ngcontent-%COMP%]{border-radius:10px;background-color:#f2f2f2;padding:1em;margin:.01em .01em 1em}.not[_ngcontent-%COMP%]{font-size:large}.tt1[_ngcontent-%COMP%]{--width: 130px;--height: calc(var(--width) / 3.5)}.tt2[_ngcontent-%COMP%]{--width: 100px;--height: calc(var(--width) / 3.3)}.toggle[_ngcontent-%COMP%]{position:relative;display:inline-block;width:var(--width);height:var(--height);box-shadow:0 1px 3px #0000004d;border-radius:var(--height);cursor:pointer}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.toggle[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;border-radius:var(--height);background-color:#dc3545;transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;width:calc(var(--height));height:calc(var(--height));border-radius:calc(var(--height) / 2);background-color:#fff;box-shadow:0 1px 3px #0000004d;transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]{background-color:#198754}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]:before{transform:translate(calc(var(--width) - var(--height)))}.toggle[_ngcontent-%COMP%]   .labels[_ngcontent-%COMP%]{position:absolute;top:8px;left:0;width:100%;height:100%;font-weight:600;transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   .labels[_ngcontent-%COMP%]:after{content:attr(data-off);position:absolute;right:25px;color:#fff;opacity:1;text-shadow:1px 1px 2px rgba(0,0,0,.4);transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   .labels[_ngcontent-%COMP%]:before{content:attr(data-on);position:absolute;left:25px;color:#fff;opacity:0;text-shadow:1px 1px 2px rgba(255,255,255,.4);transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked ~ .labels[_ngcontent-%COMP%]:after{opacity:0}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked ~ .labels[_ngcontent-%COMP%]:before{opacity:1}.mapboxgl-popup[_ngcontent-%COMP%]{max-width:400px;font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif}.t1[_ngcontent-%COMP%]{font-size:15px}.t2[_ngcontent-%COMP%]{font-size:11px}  .ng-select .ng-clear-wrapper .ng-clear{font-size:40px!important;color:#969696;right:7px;line-height:.7!important}  .ng-select .ng-clear-wrapper{height:34px;line-height:.5;width:30px!important}  .ng-value{background-color:#e3e3e3;border-radius:6px;margin-right:.5em;padding-bottom:.2em}  .ng-dropdown-panel{background-color:#f5f5f5}  .ng-option{padding:0 .7em .7em}  .ng-value-icon{font-size:22px;padding-left:.4em;padding-right:.4em}  .ng-value-label{padding-right:1em}.mapbox-popup-anchor-bottom[_ngcontent-%COMP%]{max-width:400px}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}tbody[_ngcontent-%COMP%]{max-height:600px;overflow-y:scroll}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:left;position:sticky;top:0;z-index:1}']}),t})()},{path:"variable-structure",component:(()=>{var e;class t{constructor(n,o,c){this.http=n,this.rutaActiva=o,this.elementRef=c,this.resultsPerPag=qt_resultsPerPag,this.getEstructure=qt_baseUrl+"/variable_data_structure/get",this.postStructure=qt_baseUrl+"/variable_data_structure",this.duplicateEstructure=qt_baseUrl+"/variable_data_structure/duplicate",this.totalPages=5,this.currentPage=1,this.quantPage=15,this.page=1,this.total=0,this.totalPage=0,this.alt1=!0,this.alt2=!0,this.alt3=!0,this.actId=0,this.id=0,this.state=1,this.rute="",this.charging=!1,this.saved=!1,this.change=!1,this.width=0,this.timeout=null,this.show=!1,this.showAux=!0,this.dupOk=!1,this.dupNot=!1,this.viewDup=-1,this.pencilDup=-1,this.searchParameter="search",this.order="description",this.ordAux="ASC",this.alertDelete=!1,this.notDelete=!1,this.alertNew=!1,this.notNew=!1,this.saveOk=!1,this.saveNot=!1,this.structure={id:0,description:"",structure:"",initial_byte:""},this.structureCopy={id:0,description:"",structure:"",initial_byte:""},this.search={value:""}}ngOnInit(){this.getStructure(this.order,this.ordAux)}getStructureVoid(){this.getStructure(this.order,this.ordAux)}getStructureLocal(n,o){this.order=n,this.getStructure(n,o);const c=this.elementRef.nativeElement.querySelector(".mark_select");c&&c.scrollIntoView({behavior:"smooth"})}getStructure(n,o){this.order=n,this.rute=this.rutaActiva.routerState.snapshot.url,this.searchParameter=""==this.search.value?"search":this.search.value,this.charging=!0,this.data=[],this.http.get(`${this.getEstructure}/${this.searchParameter}/${this.order}/${o}/${this.currentPage}/${this.quantPage}`).subscribe(c=>{this.charging=!1,c&&c.length>0&&c[0].total?(this.totalPages=Math.ceil(c[0].total/this.quantPage),this.total=c[0].total):(this.totalPages=0,this.total=0),this.data=c,this.totalPage=this.data.length<this.quantPage?this.total:this.quantPage*this.currentPage},c=>{console.error(c)})}orderColumn(n){if(this.show=!0,!this.change&&!this.change&&n!=this.actId){this.actId=n,this.id=n,this.openEdit(),this.state=2;const o=this.data.find(c=>c.id==n);this.structure={...o},this.structureCopy={id:this.structure.id,description:this.structure.description,structure:this.structure.structure,initial_byte:this.structure.initial_byte},this.openClouse()}}newStructure(n){if(this.state=1,n.valid){const o={headers:new rr({"Content-Type":"application/json; charset=UTF-8"})};this.http.post(this.postStructure,this.structure,o).subscribe(c=>{this.id=c.id,this.alertNew=!0,setTimeout(()=>{this.alertNew=!1},2e3),this.openClouse(),this.data.push({id:this.id,description:this.structure.description,structure:this.structure.structure,initial_byte:this.structure.initial_byte}),this.data.sort((y,E)=>y.description.localeCompare(E.description)),this.actId=this.id,this.openEdit(),this.state=2},c=>{console.error("Error:",c)}),this.change=!1}}openNew(n,o,c,f){this.structure={id:n,description:o,structure:c,initial_byte:f},this.actId=1,this.show=!0,this.openClouse(),this.state=1}editStructure(){1==this.show&&(0==this.state||1==this.state)&&this.newStructure(this.structure),0==this.show&&2==this.state&&this.editStructureAux(this.structure)}editStructureAux(n){if(n.valid){const o={headers:new rr({"Content-Type":"application/json; charset=UTF-8"})};this.http.put(this.postStructure,this.structure,o).subscribe(f=>{},f=>{console.error(f)}),this.data=this.data.filter(f=>parseInt(f.id)!==this.structure.id),this.data.push(this.structure),this.data.sort((f,y)=>f.description.localeCompare(y.description)),this.actId=this.structure.id,this.openEdit(),this.state=2,this.saveOk=!0,setTimeout(()=>{this.saveOk=!1},2e3),this.saved=!0,this.change=!1}}openEdit(){this.show=!0,this.state=2,this.showAux=!1}duplicateStructure(n,o){!this.change&&!this.change&&this.http.get(`${this.duplicateEstructure}/${o}`).subscribe(c=>{this.structure=this.data.find(f=>f.id==n),this.openClouse(),this.state=0,this.openNew("",c.duplicatedDescription,this.structure.structure,this.structure.initial_byte),this.change=!0},c=>{console.error("Error al verificar la descripci\xf3n duplicada:",c)})}deleteStructure(n){var o={id:this.id};const c={headers:new rr({"Content-Type":"application/json; charset=UTF-8"}),body:JSON.stringify(o)};this.http.delete(this.postStructure,c).subscribe(f=>{},f=>{console.error(f)}),this.alertDelete=!0,setTimeout(()=>{this.alertDelete=!1},2e3),this.data=this.data.filter(f=>f.id!=n),this.openClouse()}textSearch(n){this.currentPage=1,clearTimeout(this.timeout);var o=this;this.timeout=setTimeout(()=>{13!=n.keyCode&&(o.getStructure(this.order,this.ordAux),o.openClouse())},500)}rechargeForm(){this.change=!1,this.structure={id:this.structureCopy.id,description:this.structureCopy.description,structure:this.structureCopy.structure,initial_byte:this.structureCopy.initial_byte}}deleteSearch(){this.Page(1),this.totalPages=5,this.currentPage=1,this.quantPage=15,this.page=1,this.search.value="",this.getStructure(this.order,this.ordAux)}openClouse(){this.showAux=1!=this.show}clouse(){this.show=!1,this.openClouse(),this.change=!1,this.actId=-1}clouseAll(){this.showAux=!1,this.show=!1,this.openClouse(),this.change=!1}firstPage(){1!=this.currentPage&&(this.currentPage=1,this.getStructureVoid())}previousPage10(){this.currentPage-10>1?(this.currentPage=this.currentPage-10,this.getStructureVoid()):(this.currentPage=1,this.getStructureVoid())}previousPage(){this.currentPage>1&&(this.currentPage--,this.getStructureVoid())}Page(n){this.currentPage=n,this.getStructureVoid()}nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.getStructureVoid())}nextPage10(){this.currentPage+10<this.totalPages?(this.currentPage=this.currentPage+10,this.getStructureVoid()):(this.currentPage=this.totalPages,this.getStructureVoid())}lastPage(){this.currentPage!=this.totalPages&&(this.currentPage=this.totalPages,this.getStructureVoid())}}return(e=t).\u0275fac=function(n){return new(n||e)(G(dh),G(Zr),G(Bi))},e.\u0275cmp=mi({type:e,selectors:[["app-variable-structure"]],decls:82,vars:51,consts:[[1,"m-0","p-0","row","d-flex"],[1,"cc2","cont","me-0","c100"],[1,"p-3","pb-0","pe-2"],[1,"row","d-flex"],[1,"col-6","col-sm-6","col-lg-3","mb-3"],[1,"w-100","d-flex",2,"position","relative"],["id","search","name","search","type","text","class","form-control","aria-label","Recipient's username","aria-describedby","basic-addon2","readonly","",3,"ngModel","placeholder","keyup","ngModelChange",4,"ngIf"],["id","search","name","search","type","text","class","form-control","aria-label","Recipient's username","aria-describedby","basic-addon2",3,"ngModel","placeholder","keyup","ngModelChange",4,"ngIf"],["aria-label","Close",1,"btn-close",2,"cursor","pointer","position","absolute","top","7px","right","7px",3,"click"],[1,"col-6","col-sm-6","col-lg-9","d-flex",2,"justify-content","flex-end"],["type","button",1,"btn","btn-info",3,"ngClass","click"],[1,"row","flex-row-reverse","pe-3",2,"height","72vh"],["class","col-12 d-flex","style","justify-content: center; align-content: center;align-items: center; height: 74vh; background-color: white;",4,"ngIf"],["class","col-12 pe-0 over","style","max-height: 71vh;",4,"ngIf"],[1,"row",2,"background-color","#fff","border-bottom-right-radius","15px","border-bottom-left-radius","15px"],[1,"col-12","col-lg-6","d-flex","mt-3"],[1,"p-0","mt-1"],["aria-label","Default select example","id","quantPage","name","quantPage",1,"form-select","ms-3",3,"ngModel","change","ngModelChange"],[3,"value","selected",4,"ngFor","ngForOf"],[1,"col-12","col-lg-6","d-flex",2,"justify-content","flex-end"],["aria-label","Page navigation example"],["class","pagination mt-3 mb-0",4,"ngIf"],["id","exampleModal","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header",2,"border-bottom","0px"],[1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"not"],[1,"modal-footer",2,"border-top","0px"],[1,"row"],[1,"col-6"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary","text-light"],["type","button","data-bs-toggle","modal","data-bs-target","#exampleModal","class","btn btn-danger","data-bs-dismiss","modal","disabled","",3,"click",4,"ngIf"],["type","button","data-bs-toggle","modal","data-bs-target","#exampleModal","class","btn btn-danger","data-bs-dismiss","modal",3,"click",4,"ngIf"],["id","exampleModal1","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],[1,"col-7"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary","me-4",2,"width","max-content",3,"click"],[1,"col-5"],["type","button navb","data-bs-toggle","modal","data-bs-target","#exampleModal1",1,"btn","btn-info",2,"width","100%",3,"ngClass","click"],[1,"toast-cont"],["class","top-0 right-0 p-3",4,"ngIf"],["class","top-0 end-0 p-3",4,"ngIf"],["id","search","name","search","type","text","aria-label","Recipient's username","aria-describedby","basic-addon2","readonly","",1,"form-control",3,"ngModel","placeholder","keyup","ngModelChange"],["id","search","name","search","type","text","aria-label","Recipient's username","aria-describedby","basic-addon2",1,"form-control",3,"ngModel","placeholder","keyup","ngModelChange"],[1,"col-12","d-flex",2,"justify-content","center","align-content","center","align-items","center","height","74vh","background-color","white"],["role","status",1,"spinner-border","text-secondary"],[1,"visually-hidden"],[2,"height","min-content"],[2,"font-size","x-large"],[1,"col-12","pe-0","over",2,"max-height","71vh"],["id","miTabla",1,"table",3,"ngClass"],["scope","col",2,"cursor","pointer","z-index","100",3,"ngClass"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","class","bi bi-caret-up-fill","viewBox","0 0 16 16",3,"click",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","class","bi bi-caret-down-fill","viewBox","0 0 16 16",3,"click",4,"ngIf"],["scope","col",2,"cursor","pointer",3,"ngClass"],["scope","col",2,"text-align","center"],[4,"ngFor","ngForOf"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-caret-up-fill",3,"click"],["d","m7.247 4.86-4.796 5.481c-.566.647-.106 1.659.753 1.659h9.592a1 1 0 0 0 .753-1.659l-4.796-5.48a1 1 0 0 0-1.506 0z"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-caret-down-fill",3,"click"],["d","M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"],["id","primera",4,"ngIf"],[2,"cursor","pointer",3,"ngClass"],[2,"border-radius","0px",3,"ngClass","click"],[3,"ngClass","click"],[2,"text-align","center",3,"ngClass","mouseout","mouseover","click"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","class","bi bi-clipboard-plus","viewBox","0 0 16 16",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","class","bi bi-clipboard2-plus-fill","viewBox","0 0 16 16",4,"ngIf"],[2,"color","black","text-align","center",3,"ngClass","mouseover","mouseout","click"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","class","bi bi-pencil","viewBox","0 0 16 16",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","class","bi bi-pencil-fill","viewBox","0 0 16 16",4,"ngIf"],["id","primera",3,"ngClass",4,"ngIf"],["id","primera"],["colspan","5","style","cursor: pointer;","class","mark",4,"ngIf"],["colspan","5",1,"mark",2,"cursor","pointer"],[1,"needs-validation","m-0","p-3","pt-2","pb-0","row","w-100",2,"display","flex","justify-content","flex-end"],["form","ngForm"],[1,"col-12","col-lg-3","pe-3"],["for","description"],["maxlength","45","type","text","id","description","name","description","required","",1,"form-control",3,"value","ngModel","ngModelChange"],["class","text-danger",4,"ngIf"],[1,"col-12","col-lg-6","pe-3"],["for","structure"],["type","text","id","structure","name","structure","required","",1,"form-control",3,"value","ngModel","ngModelChange"],["for","initial_byte"],["type","number","maxlength","11","min","0","id","initial_byte","name","initial_byte","required","",1,"form-control",3,"value","ngModel","ngModelChange"],["class","col-12 col-lg-12 mt-4",4,"ngIf"],[1,"text-danger"],[4,"ngIf"],[1,"col-12","col-lg-12","mt-4"],[1,"col-6","col-lg-2",3,"ngClass"],["type","button navb",1,"btn","btn-secondary","text-light","navb",2,"width","100%",3,"click"],[1,"col-6","col-lg-2"],["ng-click","ocultar = true","type","button navb submit",1,"btn","btn-info","navb","me-3",2,"width","100%",3,"ngClass","click"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-clipboard-plus"],["fill-rule","evenodd","d","M8 7a.5.5 0 0 1 .5.5V9H10a.5.5 0 0 1 0 1H8.5v1.5a.5.5 0 0 1-1 0V10H6a.5.5 0 0 1 0-1h1.5V7.5A.5.5 0 0 1 8 7z"],["d","M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"],["d","M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-clipboard2-plus-fill"],["d","M10 .5a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5.5.5 0 0 1-.5.5.5.5 0 0 0-.5.5V2a.5.5 0 0 0 .5.5h5A.5.5 0 0 0 11 2v-.5a.5.5 0 0 0-.5-.5.5.5 0 0 1-.5-.5Z"],["d","M4.085 1H3.5A1.5 1.5 0 0 0 2 2.5v12A1.5 1.5 0 0 0 3.5 16h9a1.5 1.5 0 0 0 1.5-1.5v-12A1.5 1.5 0 0 0 12.5 1h-.585c.055.156.085.325.085.5V2a1.5 1.5 0 0 1-1.5 1.5h-5A1.5 1.5 0 0 1 4 2v-.5c0-.175.03-.344.085-.5ZM8.5 6.5V8H10a.5.5 0 0 1 0 1H8.5v1.5a.5.5 0 0 1-1 0V9H6a.5.5 0 0 1 0-1h1.5V6.5a.5.5 0 0 1 1 0Z"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-pencil"],["d","M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-pencil-fill"],["d","M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708l-3-3zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207l6.5-6.5zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.499.499 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11l.178-.178z"],["id","primera",3,"ngClass"],[1,"needs-validation","p-3","pt-2","pb-0","m-0","row","w-100",2,"display","flex","justify-content","flex-end"],["ng-class","myForm.input.$valid ? '' : 'has-danger'","type","text","class","form-control d-none","id","id","name","id",3,"value","ngModel","ngModelChange",4,"ngIf"],["ng-class","myForm.input.$valid ? '' : 'has-danger'","type","text","id","id","name","id",1,"form-control","d-none",3,"value","ngModel","ngModelChange"],["campo","ngModel"],[1,"col-lg-6","col-12"],[1,"col-6","col-lg-4"],["type","button navb","class","btn btn-secondary text-light navb","style","width: 100%",3,"click",4,"ngIf"],["type","button navb","class","btn btn-secondary text-light navb","style","width: 100%","data-bs-toggle","modal","data-bs-target","#exampleModal1",4,"ngIf"],[1,"col-6","col-lg-4","mb-3"],["type","submit","type","button navb submit",1,"btn","btn-info",2,"width","100%",3,"ngClass","click"],[1,"col-12","col-lg-6",3,"ngClass"],[1,"row",2,"display","flex","justify-content","end"],[1,"col-12","col-lg-4"],["type","button","class","btn btn-danger navb me-3","data-bs-toggle","modal","style","width: 100%","disabled","","data-bs-target","#exampleModal",4,"ngIf"],["type","button","class","btn btn-danger navb me-3","data-bs-toggle","modal","style","width: 100%","data-bs-target","#exampleModal",4,"ngIf"],["type","button navb","data-bs-toggle","modal","data-bs-target","#exampleModal1",1,"btn","btn-secondary","text-light","navb",2,"width","100%"],["type","button","data-bs-toggle","modal","disabled","","data-bs-target","#exampleModal",1,"btn","btn-danger","navb","me-3",2,"width","100%"],["type","button","data-bs-toggle","modal","data-bs-target","#exampleModal",1,"btn","btn-danger","navb","me-3",2,"width","100%"],[3,"value","selected"],[1,"pagination","mt-3","mb-0"],[1,"page-item"],["aria-label","Previous",1,"page-link",2,"cursor","pointer",3,"click"],["aria-hidden","true"],["class","page-item",4,"ngIf"],[1,"page-link","mark",2,"cursor","pointer",3,"click"],["aria-label","Next",1,"page-link",2,"cursor","pointer",3,"click"],[1,"page-link",2,"cursor","pointer",3,"click"],["type","button","data-bs-toggle","modal","data-bs-target","#exampleModal","data-bs-dismiss","modal","disabled","",1,"btn","btn-danger",3,"click"],["type","button","data-bs-toggle","modal","data-bs-target","#exampleModal","data-bs-dismiss","modal",1,"btn","btn-danger",3,"click"],[1,"top-0","right-0","p-3"],["role","alert","role","alert","aria-live","assertive","aria-atomic","true",1,"toast","show","align-items-center","text-bg-success","border-0"],[1,"d-flex"],[1,"toast-body"],["type","button","data-bs-dismiss","toast","aria-label","Close",1,"btn-close","btn-close-white","me-2","m-auto"],[1,"top-0","end-0","p-3"],["role","alert","role","alert","aria-live","assertive","aria-atomic","true",1,"toast","show","align-items-center","text-bg-danger","border-0"]],template:function(n,o){1&n&&(He(0,"app-navbar"),L(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3)(5,"div",4)(6,"div",5),J(7,Bj,2,4,"input",6),J(8,Vj,2,4,"input",7),L(9,"p",8),ye("click",function(){return o.deleteSearch()}),P()()(),L(10,"div",9)(11,"div")(12,"button",10),ye("click",function(){return o.openNew("","","","")}),W(13),te(14,"translate"),P()()()()(),L(15,"div",11),J(16,Uj,5,3,"div",12),J(17,jj,5,3,"div",12),J(18,D9,26,34,"div",13),P(),L(19,"div",14)(20,"div",15)(21,"div")(22,"p",16),W(23),P()(),L(24,"div")(25,"select",17),ye("change",function(){return o.currentPage=1,o.getStructureLocal("description","ASC")})("ngModelChange",function(f){return o.quantPage=f}),J(26,S9,3,6,"option",18),P()()(),L(27,"div",19)(28,"nav",20),J(29,O9,19,11,"ul",21),P()()()()(),L(30,"div",22)(31,"div",23)(32,"div",24)(33,"div",25)(34,"h3",26),W(35),te(36,"translate"),P(),He(37,"button",27),P(),L(38,"div",28)(39,"p",29),W(40),te(41,"translate"),P()(),L(42,"div",30)(43,"div",31)(44,"div",32)(45,"button",33),W(46),te(47,"translate"),P()(),L(48,"div",32),J(49,L9,3,3,"button",34),J(50,R9,3,3,"button",35),P()()()()()(),L(51,"div",36)(52,"div",23)(53,"div",24)(54,"div",25)(55,"h3",26),W(56),te(57,"translate"),P(),He(58,"button",27),P(),L(59,"div",28)(60,"p",29),W(61),te(62,"translate"),P()(),L(63,"div",30)(64,"div",31)(65,"div",37)(66,"button",38),ye("click",function(){return o.rechargeForm()}),W(67),te(68,"translate"),P()(),L(69,"div",39)(70,"button",40),ye("click",function(){return o.editStructure()}),W(71),te(72,"translate"),P()()()()()()(),L(73,"div",41),J(74,F9,7,3,"div",42),J(75,N9,7,3,"div",43),J(76,z9,7,3,"div",43),J(77,B9,7,3,"div",43),J(78,V9,7,3,"div",43),J(79,U9,7,3,"div",43),J(80,j9,7,3,"div",43),J(81,$9,7,3,"div",43),P()),2&n&&(w(7),U("ngIf",o.change||o.change),w(1),U("ngIf",!o.change&&!o.change),w(4),U("ngClass",ft(47,u1,o.change)),w(1),Ce(ne(14,31,"structure.new")),w(3),U("ngIf",o.charging),w(1),U("ngIf",o.data.length<=0&&0==o.charging),w(1),U("ngIf",o.data.length>0),w(5),Qg("",o.quantPage*(o.currentPage-1)+1," - ",o.totalPage," de ",o.total,""),w(2),U("ngModel",o.quantPage),w(1),U("ngForOf",o.resultsPerPag),w(3),U("ngIf",o.data.length>0),w(6),Ce(ne(36,33,"structure.m1.1")),w(5),Ce(ne(41,35,"structure.m1.2")),w(6),Ce(ne(47,37,"sensors.exit")),w(3),U("ngIf",o.change),w(1),U("ngIf",!o.change),w(6),Ce(ne(57,39,"reset.data2")),w(5),Ce(ne(62,41,"irreversible")),w(6),Ce(ne(68,43,"reset.data")),w(3),U("ngClass",ft(49,u1,!o.change)),w(1),Ce(ne(72,45,"sensors.exit")),w(3),U("ngIf",o.dupOk),w(1),U("ngIf",o.dupNot),w(1),U("ngIf",o.alertDelete),w(1),U("ngIf",o.notDelete),w(1),U("ngIf",o.alertNew),w(1),U("ngIf",o.notNew),w(1),U("ngIf",o.saveOk),w(1),U("ngIf",o.saveNot))},dependencies:[Qd,eh,Mc,kv,Np,zp,nh,cm,Ru,Lp,Tv,um,dm,Ov,sh,Fp,n1,Zp],styles:['*[_ngcontent-%COMP%]{font-family:system-ui}.input-1[_ngcontent-%COMP%]{width:15%}.input-0[_ngcontent-%COMP%]{width:10%}.input-00[_ngcontent-%COMP%]{width:5em}.input-2[_ngcontent-%COMP%]{width:30%}#map[_ngcontent-%COMP%]{width:100%;height:100%;position:relative}.floating-range[_ngcontent-%COMP%]{position:relative;bottom:0;z-index:999;width:40%}.toast-cont[_ngcontent-%COMP%]{top:-10px;right:0;position:fixed}.btn[_ngcontent-%COMP%]:hover{border-color:#fff}.mapboxgl-canvas[_ngcontent-%COMP%]{width:100%}.form-range[_ngcontent-%COMP%]::-moz-range-thumb{background-color:#6c757d}.form-range[_ngcontent-%COMP%]::-webkit-slider-thumb{background-color:#6c757d}.mark[_ngcontent-%COMP%]{background-color:#e3e3e3}th[_ngcontent-%COMP%]{border-radius:7px}.floating-content[_ngcontent-%COMP%]{display:flex}#menu[_ngcontent-%COMP%]{margin:.5em;font-size:medium;background-color:#fff;position:relative;width:max-content;padding:5px;top:0;left:0;z-index:999;border-radius:5px;border:1px #afafaf solid}#menu[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin-right:.5em}.list-group[_ngcontent-%COMP%]{z-index:999;position:absolute;top:0;right:0;cursor:pointer;height:85%}.botoncito[_ngcontent-%COMP%]{z-index:1000;position:absolute;top:30px;left:20px}.nav[_ngcontent-%COMP%]{margin:1em}.cc2[_ngcontent-%COMP%]{margin:0 1em 1em}h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%], h4[_ngcontent-%COMP%], p[_ngcontent-%COMP%], a[_ngcontent-%COMP%], .btn[_ngcontent-%COMP%], span[_ngcontent-%COMP%], label[_ngcontent-%COMP%]{font-weight:500}.navb[_ngcontent-%COMP%]{width:49%}.cont[_ngcontent-%COMP%]{background-color:#fff;border-radius:10px;min-height:88vh}.cont_recto[_ngcontent-%COMP%]{border-top-left-radius:0}.cont0[_ngcontent-%COMP%]{margin:0 1em}.c10[_ngcontent-%COMP%]{width:68.5%}.c100[_ngcontent-%COMP%]{width:98%}.sensores_2_20[_ngcontent-%COMP%]{width:29%}.sensores_2_100[_ngcontent-%COMP%]{width:96%}.c20[_ngcontent-%COMP%]{width:50%}.c200[_ngcontent-%COMP%]{width:100%}.single-line[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.rev[_ngcontent-%COMP%]{flex-direction:column-reverse}.cont1[_ngcontent-%COMP%]{background-color:#fff;padding:1em;border-radius:10px;margin-bottom:1em}.cont2[_ngcontent-%COMP%]{background-color:#fff;border-radius:10px;height:max-content;margin-bottom:1em}.alt[_ngcontent-%COMP%]{height:82vh}.cont3[_ngcontent-%COMP%]{padding:0 1em 1em;background-color:#fff;border-radius:10px;height:min-content;margin-bottom:1em}.over[_ngcontent-%COMP%]{overflow-y:scroll}thead[_ngcontent-%COMP%]{background-color:#f2f2f2;border-radius:10px}.half[_ngcontent-%COMP%]{width:50%}app-devices-edit[_ngcontent-%COMP%]{display:flex}a[_ngcontent-%COMP%]{text-decoration:none;color:#000}.c1[_ngcontent-%COMP%]{height:min-content}.c2[_ngcontent-%COMP%]{padding-top:1em;height:max-content}.c3[_ngcontent-%COMP%]{height:-moz-fit-content;height:fit-content}.c4[_ngcontent-%COMP%]{padding:.8em 1em .5em;height:-moz-fit-content;height:fit-content}.c5[_ngcontent-%COMP%]{height:62vh}.c6[_ngcontent-%COMP%]{padding:1em 1em .5em}.nuevo[_ngcontent-%COMP%]{border-radius:10px;background-color:#f2f2f2;padding:1em;margin:.01em .01em 1em}.not[_ngcontent-%COMP%]{font-size:large}.tt1[_ngcontent-%COMP%]{--width: 130px;--height: calc(var(--width) / 3.5)}.tt2[_ngcontent-%COMP%]{--width: 100px;--height: calc(var(--width) / 3.3)}.toggle[_ngcontent-%COMP%]{position:relative;display:inline-block;width:var(--width);height:var(--height);box-shadow:0 1px 3px #0000004d;border-radius:var(--height);cursor:pointer}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.toggle[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;border-radius:var(--height);background-color:#dc3545;transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;width:calc(var(--height));height:calc(var(--height));border-radius:calc(var(--height) / 2);background-color:#fff;box-shadow:0 1px 3px #0000004d;transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]{background-color:#198754}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]:before{transform:translate(calc(var(--width) - var(--height)))}.toggle[_ngcontent-%COMP%]   .labels[_ngcontent-%COMP%]{position:absolute;top:8px;left:0;width:100%;height:100%;font-weight:600;transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   .labels[_ngcontent-%COMP%]:after{content:attr(data-off);position:absolute;right:25px;color:#fff;opacity:1;text-shadow:1px 1px 2px rgba(0,0,0,.4);transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   .labels[_ngcontent-%COMP%]:before{content:attr(data-on);position:absolute;left:25px;color:#fff;opacity:0;text-shadow:1px 1px 2px rgba(255,255,255,.4);transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked ~ .labels[_ngcontent-%COMP%]:after{opacity:0}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked ~ .labels[_ngcontent-%COMP%]:before{opacity:1}.mapboxgl-popup[_ngcontent-%COMP%]{max-width:400px;font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif}.t1[_ngcontent-%COMP%]{font-size:15px}.t2[_ngcontent-%COMP%]{font-size:11px}  .ng-select .ng-clear-wrapper .ng-clear{font-size:40px!important;color:#969696;right:7px;line-height:.7!important}  .ng-select .ng-clear-wrapper{height:34px;line-height:.5;width:30px!important}  .ng-value{background-color:#e3e3e3;border-radius:6px;margin-right:.5em;padding-bottom:.2em}  .ng-dropdown-panel{background-color:#f5f5f5}  .ng-option{padding:0 .7em .7em}  .ng-value-icon{font-size:22px;padding-left:.4em;padding-right:.4em}  .ng-value-label{padding-right:1em}.mapbox-popup-anchor-bottom[_ngcontent-%COMP%]{max-width:400px}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}tbody[_ngcontent-%COMP%]{max-height:600px;overflow-y:scroll}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:left;position:sticky;top:0;z-index:1}']}),t})()},{path:"**",redirectTo:"devices"}];let G9=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=cr({type:e}),e.\u0275inj=lr({imports:[wI.forRoot(H9),wI]}),t})(),q9=(()=>{var e;class t{constructor(n){this.translate=n,this.activeLang=qt_languageLang,this.title="Sensors IoT",this.translate.setDefaultLang(this.activeLang[0])}changeLenguaje(n){this.activeLang=n,this.translate.use(n)}}return(e=t).\u0275fac=function(n){return new(n||e)(G(wm))},e.\u0275cmp=mi({type:e,selectors:[["app-root"]],decls:1,vars:0,template:function(n,o){1&n&&He(0,"router-outlet")},dependencies:[jy],styles:['*[_ngcontent-%COMP%]{font-family:system-ui}.input-1[_ngcontent-%COMP%]{width:15%}.input-0[_ngcontent-%COMP%]{width:10%}.input-00[_ngcontent-%COMP%]{width:5em}.input-2[_ngcontent-%COMP%]{width:30%}#map[_ngcontent-%COMP%]{width:100%;height:100%;position:relative}.floating-range[_ngcontent-%COMP%]{position:relative;bottom:0;z-index:999;width:40%}.toast-cont[_ngcontent-%COMP%]{top:-10px;right:0;position:fixed}.btn[_ngcontent-%COMP%]:hover{border-color:#fff}.mapboxgl-canvas[_ngcontent-%COMP%]{width:100%}.form-range[_ngcontent-%COMP%]::-moz-range-thumb{background-color:#6c757d}.form-range[_ngcontent-%COMP%]::-webkit-slider-thumb{background-color:#6c757d}.mark[_ngcontent-%COMP%]{background-color:#e3e3e3}th[_ngcontent-%COMP%]{border-radius:7px}.floating-content[_ngcontent-%COMP%]{display:flex}#menu[_ngcontent-%COMP%]{margin:.5em;font-size:medium;background-color:#fff;position:relative;width:max-content;padding:5px;top:0;left:0;z-index:999;border-radius:5px;border:1px #afafaf solid}#menu[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin-right:.5em}.list-group[_ngcontent-%COMP%]{z-index:999;position:absolute;top:0;right:0;cursor:pointer;height:85%}.botoncito[_ngcontent-%COMP%]{z-index:1000;position:absolute;top:30px;left:20px}.nav[_ngcontent-%COMP%]{margin:1em}.cc2[_ngcontent-%COMP%]{margin:0 1em 1em}h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%], h4[_ngcontent-%COMP%], p[_ngcontent-%COMP%], a[_ngcontent-%COMP%], .btn[_ngcontent-%COMP%], span[_ngcontent-%COMP%], label[_ngcontent-%COMP%]{font-weight:500}.navb[_ngcontent-%COMP%]{width:49%}.cont[_ngcontent-%COMP%]{background-color:#fff;border-radius:10px;min-height:88vh}.cont_recto[_ngcontent-%COMP%]{border-top-left-radius:0}.cont0[_ngcontent-%COMP%]{margin:0 1em}.c10[_ngcontent-%COMP%]{width:68.5%}.c100[_ngcontent-%COMP%]{width:98%}.sensores_2_20[_ngcontent-%COMP%]{width:29%}.sensores_2_100[_ngcontent-%COMP%]{width:96%}.c20[_ngcontent-%COMP%]{width:50%}.c200[_ngcontent-%COMP%]{width:100%}.single-line[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.rev[_ngcontent-%COMP%]{flex-direction:column-reverse}.cont1[_ngcontent-%COMP%]{background-color:#fff;padding:1em;border-radius:10px;margin-bottom:1em}.cont2[_ngcontent-%COMP%]{background-color:#fff;border-radius:10px;height:max-content;margin-bottom:1em}.alt[_ngcontent-%COMP%]{height:82vh}.cont3[_ngcontent-%COMP%]{padding:0 1em 1em;background-color:#fff;border-radius:10px;height:min-content;margin-bottom:1em}.over[_ngcontent-%COMP%]{overflow-y:scroll}thead[_ngcontent-%COMP%]{background-color:#f2f2f2;border-radius:10px}.half[_ngcontent-%COMP%]{width:50%}app-devices-edit[_ngcontent-%COMP%]{display:flex}a[_ngcontent-%COMP%]{text-decoration:none;color:#000}.c1[_ngcontent-%COMP%]{height:min-content}.c2[_ngcontent-%COMP%]{padding-top:1em;height:max-content}.c3[_ngcontent-%COMP%]{height:-moz-fit-content;height:fit-content}.c4[_ngcontent-%COMP%]{padding:.8em 1em .5em;height:-moz-fit-content;height:fit-content}.c5[_ngcontent-%COMP%]{height:62vh}.c6[_ngcontent-%COMP%]{padding:1em 1em .5em}.nuevo[_ngcontent-%COMP%]{border-radius:10px;background-color:#f2f2f2;padding:1em;margin:.01em .01em 1em}.not[_ngcontent-%COMP%]{font-size:large}.tt1[_ngcontent-%COMP%]{--width: 130px;--height: calc(var(--width) / 3.5)}.tt2[_ngcontent-%COMP%]{--width: 100px;--height: calc(var(--width) / 3.3)}.toggle[_ngcontent-%COMP%]{position:relative;display:inline-block;width:var(--width);height:var(--height);box-shadow:0 1px 3px #0000004d;border-radius:var(--height);cursor:pointer}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{display:none}.toggle[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;border-radius:var(--height);background-color:#dc3545;transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   .slider[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;width:calc(var(--height));height:calc(var(--height));border-radius:calc(var(--height) / 2);background-color:#fff;box-shadow:0 1px 3px #0000004d;transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]{background-color:#198754}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]:before{transform:translate(calc(var(--width) - var(--height)))}.toggle[_ngcontent-%COMP%]   .labels[_ngcontent-%COMP%]{position:absolute;top:8px;left:0;width:100%;height:100%;font-weight:600;transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   .labels[_ngcontent-%COMP%]:after{content:attr(data-off);position:absolute;right:25px;color:#fff;opacity:1;text-shadow:1px 1px 2px rgba(0,0,0,.4);transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   .labels[_ngcontent-%COMP%]:before{content:attr(data-on);position:absolute;left:25px;color:#fff;opacity:0;text-shadow:1px 1px 2px rgba(255,255,255,.4);transition:all .4s ease-in-out}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked ~ .labels[_ngcontent-%COMP%]:after{opacity:0}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked ~ .labels[_ngcontent-%COMP%]:before{opacity:1}.mapboxgl-popup[_ngcontent-%COMP%]{max-width:400px;font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif}.t1[_ngcontent-%COMP%]{font-size:15px}.t2[_ngcontent-%COMP%]{font-size:11px}  .ng-select .ng-clear-wrapper .ng-clear{font-size:40px!important;color:#969696;right:7px;line-height:.7!important}  .ng-select .ng-clear-wrapper{height:34px;line-height:.5;width:30px!important}  .ng-value{background-color:#e3e3e3;border-radius:6px;margin-right:.5em;padding-bottom:.2em}  .ng-dropdown-panel{background-color:#f5f5f5}  .ng-option{padding:0 .7em .7em}  .ng-value-icon{font-size:22px;padding-left:.4em;padding-right:.4em}  .ng-value-label{padding-right:1em}.mapbox-popup-anchor-bottom[_ngcontent-%COMP%]{max-width:400px}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}tbody[_ngcontent-%COMP%]{max-height:600px;overflow-y:scroll}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:left;position:sticky;top:0;z-index:1}']}),t})();class Z9{constructor(t,i="/assets/i18n/",n=".json"){tn(this,"http",void 0),tn(this,"prefix",void 0),tn(this,"suffix",void 0),this.http=t,this.prefix=i,this.suffix=n}getTranslation(t){return this.http.get(`${this.prefix}${t}${this.suffix}`)}}let W9=(()=>{var e;class t{}return(e=t).\u0275fac=function(n){return new(n||e)},e.\u0275mod=cr({type:e,bootstrap:[q9]}),e.\u0275inj=lr({providers:[NC],imports:[pV,PL,NR,A6,G9,zR,B6.forRoot({loader:{provide:t1,useFactory:i=>new Z9(i),deps:[dh]}})]}),t})();IL().bootstrapModule(W9).catch(e=>console.error(e))},574:function(Em){Em.exports=function(){"use strict";var Vu,Uu,Rn;function gh(p,Je){if(Vu)if(Uu){var us="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Vu+")(sharedChunk); ("+Uu+")(sharedChunk); self.onerror = null;",mo={};Vu(mo),Rn=Je(mo),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(Rn.workerUrl=window.URL.createObjectURL(new Blob([us],{type:"text/javascript"})))}else Uu=Je;else Vu=Je}return gh(0,function(p){var Je=typeof self<"u"?self:{},us="2.15.0";let mo;const an={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==mo){const s=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{mo=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):s}catch{mo=s}}return mo},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!an.API_URL)return null;try{const s=new URL(an.API_URL);return"api.mapbox.cn"===s.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===s.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},on={supported:!1,testSupport:function(s){!Bo&&zr&&(Rs?Ac(s):or=s)}};let or,zr,Bo=!1,Rs=!1;function Ac(s){const r=s.createTexture();s.bindTexture(s.TEXTURE_2D,r);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,zr),s.isContextLost())return;on.supported=!0}catch{}s.deleteTexture(r),Bo=!0}Je.document&&(zr=Je.document.createElement("img"),zr.onload=function(){or&&Ac(or),or=null,Rs=!0},zr.onerror=function(){Bo=!0,or=null},zr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Sl="01";function io(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var _o=Wr;function Wr(s,r,a,u){this.cx=3*s,this.bx=3*(a-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(u-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=r,this.p2x=a,this.p2y=u}Wr.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,r){if(void 0===r&&(r=1e-6),s<0)return 0;if(s>1)return 1;for(var a=s,u=0;u<8;u++){var h=this.sampleCurveX(a)-s;if(Math.abs(h)<r)return a;var m=this.sampleCurveDerivativeX(a);if(Math.abs(m)<1e-6)break;a-=h/m}var v=0,b=1;for(a=s,u=0;u<20&&(h=this.sampleCurveX(a),!(Math.abs(h-s)<r));u++)s>h?v=a:b=a,a=.5*(b-v)+v;return a},solve:function(s,r){return this.sampleCurveY(this.solveCurveX(s,r))}};var Ra=io(_o),Fs=Vo;function Vo(s,r){this.x=s,this.y=r}Vo.prototype={clone:function(){return new Vo(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,r){return this.clone()._rotateAround(s,r)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var r=s.x-this.x,a=s.y-this.y;return r*r+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,r){return Math.atan2(this.x*r-this.y*s,this.x*s+this.y*r)},_matMult:function(s){var r=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=r,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var r=Math.cos(s),a=Math.sin(s),u=a*this.x+r*this.y;return this.x=r*this.x-a*this.y,this.y=u,this},_rotateAround:function(s,r){var a=Math.cos(s),u=Math.sin(s),h=r.y+u*(this.x-r.x)+a*(this.y-r.y);return this.x=r.x+a*(this.x-r.x)-u*(this.y-r.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Vo.convert=function(s){return s instanceof Vo?s:Array.isArray(s)?new Vo(s[0],s[1]):s};var _t=io(Fs);const mh=Math.PI/180,Fa=180/Math.PI;function fn(s){return s*mh}function gr(s){return s*Fa}const Pc=[[0,0],[1,0],[1,1],[0,1]];function ju(s){if(s<=0)return 0;if(s>=1)return 1;const r=s*s,a=r*s;return 4*(s<.5?a:3*(s-r)+a-.75)}function Na(s,r,a,u){const h=new Ra(s,r,a,u);return function(m){return h.solve(m)}}const Uo=Na(.25,.1,.25,1);function yn(s,r,a){return Math.min(a,Math.max(r,s))}function za(s,r,a){return(a=yn((a-s)/(r-s),0,1))*a*(3-2*a)}function xn(s,r,a){const u=a-r,h=((s-r)%u+u)%u+r;return h===r?a:h}function sr(s,r,a){if(!s.length)return a(null,[]);let u=s.length;const h=new Array(s.length);let m=null;s.forEach((v,b)=>{r(v,(M,T)=>{M&&(m=M),h[b]=T,0==--u&&a(m,h)})})}function sa(s){const r=[];for(const a in s)r.push(s[a]);return r}function $i(s,...r){for(const a of r)for(const u in a)s[u]=a[u];return s}let aa=1;function ar(){return aa++}function Ns(){return function s(r){return r?(r^Math.random()*(16>>r/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()}function Ei(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function kc(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)}function ri(s,r){s.forEach(a=>{r[a]&&(r[a]=r[a].bind(r))})}function ei(s,r){return-1!==s.indexOf(r,s.length-r.length)}function Cn(s,r,a){const u={};for(const h in s)u[h]=r.call(a||this,s[h],h,s);return u}function En(s,r,a){const u={};for(const h in s)r.call(a||this,s[h],h,s)&&(u[h]=s[h]);return u}function Br(s){return Array.isArray(s)?s.map(Br):"object"==typeof s&&s?Cn(s,Br):s}const Oc={};function oi(s){Oc[s]||(typeof console<"u"&&console.warn(s),Oc[s]=!0)}function vo(s,r,a){return(a.y-s.y)*(r.x-s.x)>(r.y-s.y)*(a.x-s.x)}function $u(s){let r=0;for(let a,u,h=0,m=s.length,v=m-1;h<m;v=h++)a=s[h],u=s[v],r+=(u.x-a.x)*(a.y+u.y);return r}function zs(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function yo(s){const r={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,u,h,m)=>{const v=h||m;return r[u]=!v||v.toLowerCase(),""}),r["max-age"]){const a=parseInt(r["max-age"],10);isNaN(a)?delete r["max-age"]:r["max-age"]=a}return r}let Hu=null;function Lc(s){if(null==Hu){const r=s.navigator?s.navigator.userAgent:null;Hu=!!s.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return Hu}function Gu(s){try{const r=Je[s];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch{return!1}}function la(s,r){return[s[4*r],s[4*r+1],s[4*r+2],s[4*r+3]]}const Ba="mapbox-tiles";let xo,ds,qu=500,Il=50;function Al(){try{return Je.caches}catch{}}function Va(){Al()&&!xo&&(xo=Je.caches.open(Ba))}function Pl(s){const r=s.indexOf("?");if(r<0)return s;const u=function(h){const m=h.indexOf("?");return m>0?h.slice(m+1).split("&"):[]}(s).filter(h=>{const m=h.split("=");return"language"===m[0]||"worldview"===m[0]});return u.length?`${s.slice(0,r)}?${u.join("&")}`:s.slice(0,r)}let Rc=1/0;const Xr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Xr);class Bs extends Error{constructor(r,a,u){401===a&&Pe(u)&&(r+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(r),this.status=a,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ua=zs()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Je.location.protocol?Je.parent:Je).location.href,ca=function(s,r){if(!(/^file:/.test(a=s.url)||/^file:/.test(Ua())&&!/^\w+:/.test(a))){if(Je.fetch&&Je.Request&&Je.AbortController&&Je.Request.prototype.hasOwnProperty("signal"))return function(u,h){const m=new Je.AbortController,v=new Je.Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:Ua(),referrerPolicy:u.referrerPolicy,signal:m.signal});let b=!1,M=!1;const T=(I=v.url).indexOf("sku=")>0&&Pe(I);var I;"json"===u.type&&v.headers.set("Accept","application/json");const O=(B,V,w)=>{if(M)return;if(B&&"SecurityError"!==B.message&&oi(B.toString()),V&&w)return R(V);const K=Date.now();Je.fetch(v).then(G=>{if(G.ok){const me=T?G.clone():null;return R(G,me,K)}return h(new Bs(G.statusText,G.status,u.url))}).catch(G=>{"AbortError"!==G.name&&h(new Error(`${G.message} ${u.url}`))})},R=(B,V,w)=>{("arrayBuffer"===u.type?B.arrayBuffer():"json"===u.type?B.json():B.text()).then(K=>{M||(V&&w&&function(G,me,ae){if(Va(),!xo)return;const fe={status:me.status,statusText:me.statusText,headers:new Je.Headers};me.headers.forEach((Re,ke)=>fe.headers.set(ke,Re));const _e=yo(me.headers.get("Cache-Control")||"");if(_e["no-store"])return;_e["max-age"]&&fe.headers.set("Expires",new Date(ae+1e3*_e["max-age"]).toUTCString());const ve=fe.headers.get("Expires");ve&&(new Date(ve).getTime()-ae<42e4||function(Re,ke){if(void 0===ds)try{new Response(new ReadableStream),ds=!0}catch{ds=!1}ds?ke(Re.body):Re.blob().then(ke)}(me,Re=>{const ke=new Je.Response(Re,fe);Va(),xo&&xo.then($e=>$e.put(Pl(G.url),ke)).catch($e=>oi($e.message))}))}(v,V,w),b=!0,h(null,K,B.headers.get("Cache-Control"),B.headers.get("Expires")))}).catch(K=>{M||h(new Error(K.message))})};return T?function(B,V){if(Va(),!xo)return V(null);const w=Pl(B.url);xo.then(K=>{K.match(w).then(G=>{const me=function(ae){if(!ae)return!1;const fe=new Date(ae.headers.get("Expires")||0),_e=yo(ae.headers.get("Cache-Control")||"");return fe>Date.now()&&!_e["no-cache"]}(G);K.delete(w),me&&K.put(w,G.clone()),V(null,G,me)}).catch(V)}).catch(V)}(v,O):O(null,null),{cancel:()=>{M=!0,b||m.abort()}}}(s,r);if(zs()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,r,void 0,!0)}var a;return function(u,h){const m=new Je.XMLHttpRequest;m.open(u.method||"GET",u.url,!0),"arrayBuffer"===u.type&&(m.responseType="arraybuffer");for(const v in u.headers)m.setRequestHeader(v,u.headers[v]);return"json"===u.type&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials="include"===u.credentials,m.onerror=()=>{h(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||0===m.status)&&null!==m.response){let v=m.response;if("json"===u.type)try{v=JSON.parse(m.response)}catch(b){return h(b)}h(null,v,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else h(new Bs(m.statusText,m.status,u.url))},m.send(u.body),{cancel:()=>m.abort()}}(s,r)},kl=function(s,r){return ca($i(s,{type:"arrayBuffer"}),r)};function Zu(s){const r=Je.document.createElement("a");return r.href=s,r.protocol===Je.document.location.protocol&&r.host===Je.document.location.host}const ge="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Z,X;Z=[],X=0;const he=function(s,r){if(on.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),X>=an.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:s,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return Z.push(m),m}X++;let a=!1;const u=()=>{if(!a)for(a=!0,X--;Z.length&&X<an.MAX_PARALLEL_IMAGE_REQUESTS;){const m=Z.shift(),{requestParameters:v,callback:b,cancelled:M}=m;M||(m.cancel=he(v,b).cancel)}},h=kl(s,(m,v,b,M)=>{u(),m?r(m):v&&(Je.createImageBitmap?function(T,I){const O=new Je.Blob([new Uint8Array(T)],{type:"image/png"});Je.createImageBitmap(O).then(R=>{I(null,R)}).catch(R=>{I(new Error(`Could not load image because of ${R.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(v,(T,I)=>r(T,I,b,M)):function(T,I){const O=new Je.Image,R=Je.URL;O.onload=()=>{I(null,O),R.revokeObjectURL(O.src),O.onload=null,Je.requestAnimationFrame(()=>{O.src=ge})},O.onerror=()=>I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const B=new Je.Blob([new Uint8Array(T)],{type:"image/png"});O.src=T.byteLength?R.createObjectURL(B):ge}(v,(T,I)=>r(T,I,b,M)))});return{cancel:()=>{h.cancel(),u()}}},xe="NO_ACCESS_TOKEN";function Te(s){return 0===s.indexOf("mapbox:")}function Pe(s){return an.API_URL_REGEX.test(s)}function Ae(s){return an.API_CDN_URL_REGEX.test(s)}function De(s){return an.API_STYLE_REGEX.test(s)&&!ze(s)}function ze(s){return an.API_SPRITE_REGEX.test(s)}const ht=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function gt(s){const r=s.match(ht);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function at(s){const r=s.params.length?`?${s.params.join("&")}`:"";return`${s.protocol}://${s.authority}${s.path}${r}`}const Yt="mapbox.eventData";function hn(s){if(!s)return null;const r=s.split(".");if(!r||3!==r.length)return null;try{return JSON.parse(decodeURIComponent(Je.atob(r[1]).split("").map(a=>"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Kt{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const a=hn(an.ACCESS_TOKEN);let u="";return u=a&&a.u?Je.btoa(encodeURIComponent(a.u).replace(/%([0-9A-F]{2})/g,(h,m)=>String.fromCharCode(+("0x"+m)))):an.ACCESS_TOKEN||"",r?`${Yt}.${r}:${u}`:`${Yt}:${u}`}fetchEventData(){const r=Gu("localStorage"),a=this.getStorageKey(),u=this.getStorageKey("uuid");if(r)try{const h=Je.localStorage.getItem(a);h&&(this.eventData=JSON.parse(h));const m=Je.localStorage.getItem(u);m&&(this.anonId=m)}catch{oi("Unable to read from LocalStorage")}}saveEventData(){const r=Gu("localStorage"),a=this.getStorageKey(),u=this.getStorageKey("uuid");if(r)try{Je.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&Je.localStorage.setItem(a,JSON.stringify(this.eventData))}catch{oi("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,a,u,h){if(!an.EVENTS_URL)return;const m=gt(an.EVENTS_URL);m.params.push(`access_token=${h||an.ACCESS_TOKEN||""}`);const v={event:this.type,created:new Date(r).toISOString()},b=a?$i(v,a):v,M={url:at(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([b])};var I;this.pendingRequest=(I=T=>{this.pendingRequest=null,u(T),this.saveEventData(),this.processRequests(h)},ca($i(M,{method:"POST"}),I))}queueRequest(r,a){this.queue.push(r),this.processRequests(a)}}const ln=new class extends Kt{constructor(s){super("appUserTurnstile"),this._customAccessToken=s}postTurnstileEvent(s,r){an.EVENTS_URL&&an.ACCESS_TOKEN&&Array.isArray(s)&&s.some(a=>Te(a)||Pe(a))&&this.queueRequest(Date.now(),r)}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=hn(an.ACCESS_TOKEN),a=r?r.u:an.ACCESS_TOKEN;let u=a!==this.eventData.tokenU;kc(this.anonId)||(this.anonId=Ns(),u=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const m=new Date(this.eventData.lastSuccess),v=new Date(h),b=(h-this.eventData.lastSuccess)/864e5;u=u||b>=1||b<-1||m.getDate()!==v.getDate()}else u=!0;u?this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:us,skuId:Sl,"enabled.telemetry":!1,userId:this.anonId},m=>{m||(this.eventData.lastSuccess=h,this.eventData.tokenU=a)},s):this.processRequests()}},bn=ln.postTurnstileEvent.bind(ln),di=new class extends Kt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(s,r,a,u){this.skuToken=r,this.errorCb=u,an.EVENTS_URL&&(a||an.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},a):this.errorCb(new Error(xe)))}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:a}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),kc(this.anonId)||(this.anonId=Ns()),this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:us,skuId:Sl,skuToken:this.skuToken,userId:this.anonId},u=>{u?this.errorCb(u):r&&(this.success[r]=!0)},s))}},An=di.postMapLoadEvent.bind(di),Dr=new class extends Kt{constructor(){super("gljs.performance")}postPerformanceEvent(s,r){an.EVENTS_URL&&(s||an.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:r},s)}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:r,performanceData:a}=this.queue.shift(),u=function(h){const m=Je.performance.getEntriesByType("resource"),v=Je.performance.getEntriesByType("mark"),b=function(R){const B={};if(R)for(const V in R)if("other"!==V)for(const w of R[V]){const K=`${V}ResolveRangeMin`,G=`${V}ResolveRangeMax`,me=`${V}RequestCount`,ae=`${V}RequestCachedCount`;B[K]=Math.min(B[K]||1/0,w.startTime),B[G]=Math.max(B[G]||-1/0,w.responseEnd);const fe=_e=>{void 0===B[_e]&&(B[_e]=0),++B[_e]};void 0!==w.transferSize&&0===w.transferSize&&fe(ae),fe(me)}return B}(function(R,B){const V={};if(R)for(const w of R){const K=B(w);void 0===V[K]&&(V[K]=[]),V[K].push(w)}return V}(m,ps)),M=Je.devicePixelRatio,T=Je.navigator.connection||Je.navigator.mozConnection||Je.navigator.webkitConnection,I={counters:[],metadata:[],attributes:[]},O=(R,B,V)=>{null!=V&&R.push({name:B,value:V.toString()})};for(const R in b)O(I.counters,R,b[R]);if(h.interactionRange[0]!==1/0&&h.interactionRange[1]!==-1/0&&(O(I.counters,"interactionRangeMin",h.interactionRange[0]),O(I.counters,"interactionRangeMax",h.interactionRange[1])),v)for(const R of Object.keys(Ol)){const B=Ol[R],V=v.find(w=>w.name===B);V&&O(I.counters,B,V.startTime)}return O(I.counters,"visibilityHidden",h.visibilityHidden),O(I.attributes,"style",function(R){if(R)for(const B of R){const V=B.name.split("?")[0];if(De(V)){const w=V.split("/").slice(-2);if(2===w.length)return`mapbox://styles/${w[0]}/${w[1]}`}}}(m)),O(I.attributes,"terrainEnabled",h.terrainEnabled?"true":"false"),O(I.attributes,"fogEnabled",h.fogEnabled?"true":"false"),O(I.attributes,"projection",h.projection),O(I.attributes,"zoom",h.zoom),O(I.metadata,"devicePixelRatio",M),O(I.metadata,"connectionEffectiveType",T?T.effectiveType:void 0),O(I.metadata,"navigatorUserAgent",Je.navigator.userAgent),O(I.metadata,"screenWidth",Je.screen.width),O(I.metadata,"screenHeight",Je.screen.height),O(I.metadata,"windowWidth",Je.innerWidth),O(I.metadata,"windowHeight",Je.innerHeight),O(I.metadata,"mapWidth",h.width/M),O(I.metadata,"mapHeight",h.height/M),O(I.metadata,"webglRenderer",h.renderer),O(I.metadata,"webglVendor",h.vendor),O(I.metadata,"sdkVersion",us),O(I.metadata,"sdkIdentifier","mapbox-gl-js"),I}(a);for(const h of u.metadata);for(const h of u.counters);for(const h of u.attributes);this.postEvent(r,u,()=>{},s)}},Ki=Dr.postPerformanceEvent.bind(Dr),hs=new class extends Kt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(s,r,a,u){if(!an.API_URL||!an.SESSION_PATH)return;const h=gt(an.API_URL+an.SESSION_PATH);h.params.push(`sku=${r||""}`),h.params.push(`access_token=${u||an.ACCESS_TOKEN||""}`);const m={url:at(h),headers:{"Content-Type":"text/plain"}};var b;this.pendingRequest=(b=v=>{this.pendingRequest=null,a(v),this.saveEventData(),this.processRequests(u)},ca($i(m,{method:"GET"}),b))}getSessionAPI(s,r,a,u){this.skuToken=r,this.errorCb=u,an.SESSION_PATH&&an.API_URL&&(a||an.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},a):this.errorCb(new Error(xe)))}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:a}=this.queue.shift();r&&this.success[r]||this.getSession(a,this.skuToken,u=>{u?this.errorCb(u):r&&(this.success[r]=!0)},s)}},mr=hs.getSessionAPI.bind(hs),Sr=new Set,Ol={create:"create",load:"load",fullLoad:"fullLoad"},Dm={mark(s){Je.performance.mark(s)},measure(s,r,a){Je.performance.measure(s,r,a)}};function ps(s){const r=s.name.split("?")[0];return Ae(r)&&r.includes("mapbox-gl.js")?"javascript":Ae(r)&&r.includes("mapbox-gl.css")?"css":an.API_FONTS_REGEX.test(r)?"fontRange":ze(r)?"sprite":De(r)?"style":an.API_TILEJSON_REGEX.test(r)?"tilejson":"other"}const Fn=Je.performance;function Ji(s){const r=s?s.url.toString():void 0;return Fn.getEntriesByName(r)}let fs,bo,_h,gs;const ms={now:()=>void 0!==_h?_h:Je.performance.now(),setNow(s){_h=s},restoreNow(){_h=void 0},frame(s){const r=Je.requestAnimationFrame(s);return{cancel:()=>Je.cancelAnimationFrame(r)}},getImageData(s,r=0){const{width:a,height:u}=s;gs||(gs=Je.document.createElement("canvas"));const h=gs.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(a>gs.width||u>gs.height)&&(gs.width=a,gs.height=u),h.clearRect(-r,-r,a+2*r,u+2*r),h.drawImage(s,0,0,a,u),h.getImageData(-r,-r,a+2*r,u+2*r)},resolveURL:s=>(fs||(fs=Je.document.createElement("a")),fs.href=s,fs.href),get devicePixelRatio(){return Je.devicePixelRatio},get prefersReducedMotion(){return!!Je.matchMedia&&(null==bo&&(bo=Je.matchMedia("(prefers-reduced-motion: reduce)")),bo.matches)}};function Fc(s,r,a){a[s]&&-1!==a[s].indexOf(r)||(a[s]=a[s]||[],a[s].push(r))}function Wu(s,r,a){if(a&&a[s]){const u=a[s].indexOf(r);-1!==u&&a[s].splice(u,1)}}class jo{constructor(r,a={}){$i(this,a),this.type=r}}class Vs extends jo{constructor(r,a={}){super("error",$i({error:r},a))}}class Ll{on(r,a){return this._listeners=this._listeners||{},Fc(r,a,this._listeners),this}off(r,a){return Wu(r,a,this._listeners),Wu(r,a,this._oneTimeListeners),this}once(r,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},Fc(r,a,this._oneTimeListeners),this):new Promise(u=>this.once(r,u))}fire(r,a){"string"==typeof r&&(r=new jo(r,a||{}));const u=r.type;if(this.listens(u)){r.target=this;const h=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const b of h)b.call(this,r);const m=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const b of m)Wu(u,b,this._oneTimeListeners),b.call(this,r);const v=this._eventedParent;v&&($i(r,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),v.fire(r))}else r instanceof Vs&&console.error(r.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,a){return this._eventedParent=r,this._eventedParentData=a,this}}var je=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Us(s,...r){for(const a of r)for(const u in a)s[u]=a[u];return s}function Hi(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function _r(s){if(Array.isArray(s))return s.map(_r);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const r={};for(const a in s)r[a]=_r(s[a]);return r}return Hi(s)}class Xp extends Error{constructor(r,a){super(a),this.message=a,this.key=r}}var $o=Xp;class vh{constructor(r,a=[]){this.parent=r,this.bindings={};for(const[u,h]of a)this.bindings[u]=h}concat(r){return new vh(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}var Yp=vh;const bi={kind:"null"},bt={kind:"number"},pt={kind:"string"},cn={kind:"boolean"},Vr={kind:"color"},Ti={kind:"object"},gn={kind:"value"},ro={kind:"collator"},zn={kind:"formatted"},_s={kind:"resolvedImage"};function jn(s,r){return{kind:"array",itemType:s,N:r}}function ti(s){if("array"===s.kind){const r=ti(s.itemType);return"number"==typeof s.N?`array<${r}, ${s.N}>`:"value"===s.itemType.kind?"array":`array<${r}>`}return s.kind}const Kp=[bi,bt,pt,cn,Vr,zn,Ti,jn(gn),_s];function Pn(s,r){if("error"===r.kind)return null;if("array"===s.kind){if("array"===r.kind&&(0===r.N&&"value"===r.itemType.kind||!Pn(s.itemType,r.itemType))&&("number"!=typeof s.N||s.N===r.N))return null}else{if(s.kind===r.kind)return null;if("value"===s.kind)for(const a of Kp)if(!Pn(a,r))return null}return`Expected ${ti(s)} but found ${ti(r)} instead.`}function Gt(s,r){return r.some(a=>a.kind===s.kind)}function ja(s,r){return r.some(a=>"null"===a?null===s:"array"===a?Array.isArray(s):"object"===a?s&&!Array.isArray(s)&&"object"==typeof s:a===typeof s)}var Nc,Sm={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Rl(s){return(s=Math.round(s))<0?0:s>255?255:s}function ut(s){return Rl("%"===s[s.length-1]?parseFloat(s)/100*255:parseInt(s))}function $a(s){return(r="%"===s[s.length-1]?parseFloat(s)/100:parseFloat(s))<0?0:r>1?1:r;var r}function Zt(s,r,a){return a<0?a+=1:a>1&&(a-=1),6*a<1?s+(r-s)*a*6:2*a<1?r:3*a<2?s+(r-s)*(2/3-a)*6:s}try{Nc={}.parseCSSColor=function(s){var r,a=s.replace(/ /g,"").toLowerCase();if(a in Sm)return Sm[a].slice();if("#"===a[0])return 4===a.length?(r=parseInt(a.substr(1),16))>=0&&r<=4095?[(3840&r)>>4|(3840&r)>>8,240&r|(240&r)>>4,15&r|(15&r)<<4,1]:null:7===a.length&&(r=parseInt(a.substr(1),16))>=0&&r<=16777215?[(16711680&r)>>16,(65280&r)>>8,255&r,1]:null;var u=a.indexOf("("),h=a.indexOf(")");if(-1!==u&&h+1===a.length){var m=a.substr(0,u),v=a.substr(u+1,h-(u+1)).split(","),b=1;switch(m){case"rgba":if(4!==v.length)return null;b=$a(v.pop());case"rgb":return 3!==v.length?null:[ut(v[0]),ut(v[1]),ut(v[2]),b];case"hsla":if(4!==v.length)return null;b=$a(v.pop());case"hsl":if(3!==v.length)return null;var M=(parseFloat(v[0])%360+360)%360/360,T=$a(v[1]),I=$a(v[2]),O=I<=.5?I*(T+1):I+T-I*T,R=2*I-O;return[Rl(255*Zt(R,O,M+1/3)),Rl(255*Zt(R,O,M)),Rl(255*Zt(R,O,M-1/3)),b];default:return null}}return null}}catch{}class mn{constructor(r,a,u,h=1){this.r=r,this.g=a,this.b=u,this.a=h}static parse(r){if(!r)return;if(r instanceof mn)return r;if("string"!=typeof r)return;const a=Nc(r);return a?new mn(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3]):void 0}toString(){const[r,a,u,h]=this.toArray();return`rgba(${Math.round(r)},${Math.round(a)},${Math.round(u)},${h})`}toArray(){const{r,g:a,b:u,a:h}=this;return 0===h?[0,0,0,0]:[255*r/h,255*a/h,255*u/h,h]}toArray01(){const{r,g:a,b:u,a:h}=this;return 0===h?[0,0,0,0]:[r/h,a/h,u/h,h]}toArray01PremultipliedAlpha(){const{r,g:a,b:u,a:h}=this;return[r,a,u,h]}}mn.black=new mn(0,0,0,1),mn.white=new mn(1,1,1,1),mn.transparent=new mn(0,0,0,0),mn.red=new mn(1,0,0,1),mn.blue=new mn(0,0,1,1);var Oi=mn;class Jp{constructor(r,a,u){this.sensitivity=r?a?"variant":"case":a?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,a){return this.collator.compare(r,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class yh{constructor(r,a,u,h,m){this.text=r.normalize?r.normalize():r,this.image=a,this.scale=u,this.fontStack=h,this.textColor=m}}class Ir{constructor(r){this.sections=r}static fromString(r){return new Ir([new yh(r,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(r=>0!==r.text.length||r.image&&0!==r.image.name.length)}static factory(r){return r instanceof Ir?r:Ir.fromString(r)}toString(){return 0===this.sections.length?"":this.sections.map(r=>r.text).join("")}serialize(){const r=["format"];for(const a of this.sections){if(a.image){r.push(["image",a.image.name]);continue}r.push(a.text);const u={};a.fontStack&&(u["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(u["font-scale"]=a.scale),a.textColor&&(u["text-color"]=["rgba"].concat(a.textColor.toArray())),r.push(u)}return r}}class wi{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new wi({name:r,available:!1}):null}serialize(){return["image",this.name]}}function Im(s,r,a,u){return"number"==typeof s&&s>=0&&s<=255&&"number"==typeof r&&r>=0&&r<=255&&"number"==typeof a&&a>=0&&a<=255?void 0===u||"number"==typeof u&&u>=0&&u<=1?null:`Invalid rgba value [${[s,r,a,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof u?[s,r,a,u]:[s,r,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function zc(s){if(null===s||"string"==typeof s||"boolean"==typeof s||"number"==typeof s||s instanceof Oi||s instanceof Jp||s instanceof Ir||s instanceof wi)return!0;if(Array.isArray(s)){for(const r of s)if(!zc(r))return!1;return!0}if("object"==typeof s){for(const r in s)if(!zc(s[r]))return!1;return!0}return!1}function Li(s){if(null===s)return bi;if("string"==typeof s)return pt;if("boolean"==typeof s)return cn;if("number"==typeof s)return bt;if(s instanceof Oi)return Vr;if(s instanceof Jp)return ro;if(s instanceof Ir)return zn;if(s instanceof wi)return _s;if(Array.isArray(s)){const r=s.length;let a;for(const u of s){const h=Li(u);if(a){if(a===h)continue;a=gn;break}a=h}return jn(a||gn,r)}return Ti}function Ho(s){const r=typeof s;return null===s?"":"string"===r||"number"===r||"boolean"===r?String(s):s instanceof Oi||s instanceof Ir||s instanceof wi?s.toString():JSON.stringify(s)}class Qp{constructor(r,a){this.type=r,this.value=a}static parse(r,a){if(2!==r.length)return a.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!zc(r[1]))return a.error("invalid value");const u=r[1];let h=Li(u);const m=a.expectedType;return"array"!==h.kind||0!==h.N||!m||"array"!==m.kind||"number"==typeof m.N&&0!==m.N||(h=m),new Qp(h,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Oi?["rgba"].concat(this.value.toArray()):this.value instanceof Ir?this.value.serialize():this.value}}var Fl=Qp,Ar=class{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}};const ef={string:pt,number:bt,boolean:cn,object:Ti};class xh{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");let u,h=1;const m=r[0];if("array"===m){let b,M;if(r.length>2){const T=r[1];if("string"!=typeof T||!(T in ef)||"object"===T)return a.error('The item type argument of "array" must be one of string, number, boolean',1);b=ef[T],h++}else b=gn;if(r.length>3){if(null!==r[2]&&("number"!=typeof r[2]||r[2]<0||r[2]!==Math.floor(r[2])))return a.error('The length argument to "array" must be a positive integer literal',2);M=r[2],h++}u=jn(b,M)}else u=ef[m];const v=[];for(;h<r.length;h++){const b=a.parse(r[h],h,gn);if(!b)return null;v.push(b)}return new xh(u,v)}evaluate(r){for(let a=0;a<this.args.length;a++){const u=this.args[a].evaluate(r);if(!Pn(this.type,Li(u)))return u;if(a===this.args.length-1)throw new Ar(`Expected value to be of type ${ti(this.type)}, but found ${ti(Li(u))} instead.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=this.type,a=[r.kind];if("array"===r.kind){const u=r.itemType;if("string"===u.kind||"number"===u.kind||"boolean"===u.kind){a.push(u.kind);const h=r.N;("number"==typeof h||this.args.length>1)&&a.push(h)}}return a.concat(this.args.map(u=>u.serialize()))}}var ua=xh;class da{constructor(r){this.type=zn,this.sections=r}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");const u=r[1];if(!Array.isArray(u)&&"object"==typeof u)return a.error("First argument must be an image or text section.");const h=[];let m=!1;for(let v=1;v<=r.length-1;++v){const b=r[v];if(m&&"object"==typeof b&&!Array.isArray(b)){m=!1;let M=null;if(b["font-scale"]&&(M=a.parse(b["font-scale"],1,bt),!M))return null;let T=null;if(b["text-font"]&&(T=a.parse(b["text-font"],1,jn(pt)),!T))return null;let I=null;if(b["text-color"]&&(I=a.parse(b["text-color"],1,Vr),!I))return null;const O=h[h.length-1];O.scale=M,O.font=T,O.textColor=I}else{const M=a.parse(r[v],1,gn);if(!M)return null;const T=M.type.kind;if("string"!==T&&"value"!==T&&"null"!==T&&"resolvedImage"!==T)return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,h.push({content:M,scale:null,font:null,textColor:null})}}return new da(h)}evaluate(r){return new Ir(this.sections.map(a=>{const u=a.content.evaluate(r);return Li(u)===_s?new yh("",u,null,null,null):new yh(Ho(u),null,a.scale?a.scale.evaluate(r):null,a.font?a.font.evaluate(r).join(","):null,a.textColor?a.textColor.evaluate(r):null)}))}eachChild(r){for(const a of this.sections)r(a.content),a.scale&&r(a.scale),a.font&&r(a.font),a.textColor&&r(a.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const a of this.sections){r.push(a.content.serialize());const u={};a.scale&&(u["font-scale"]=a.scale.serialize()),a.font&&(u["text-font"]=a.font.serialize()),a.textColor&&(u["text-color"]=a.textColor.serialize()),r.push(u)}return r}}class bh{constructor(r){this.type=_s,this.input=r}static parse(r,a){if(2!==r.length)return a.error("Expected two arguments.");const u=a.parse(r[1],1,pt);return u?new bh(u):a.error("No image name provided.")}evaluate(r){const a=this.input.evaluate(r),u=wi.fromString(a);return u&&r.availableImages&&(u.available=r.availableImages.indexOf(a)>-1),u}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const wo={"to-boolean":cn,"to-color":Vr,"to-number":bt,"to-string":pt};class Wt{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");const u=r[0];if(("to-boolean"===u||"to-string"===u)&&2!==r.length)return a.error("Expected one argument.");const h=wo[u],m=[];for(let v=1;v<r.length;v++){const b=a.parse(r[v],v,gn);if(!b)return null;m.push(b)}return new Wt(h,m)}evaluate(r){if("boolean"===this.type.kind)return!!this.args[0].evaluate(r);if("color"===this.type.kind){let a,u;for(const h of this.args){if(a=h.evaluate(r),u=null,a instanceof Oi)return a;if("string"==typeof a){const m=r.parseColor(a);if(m)return m}else if(Array.isArray(a)&&(u=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:Im(a[0],a[1],a[2],a[3]),!u))return new Oi(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new Ar(u||`Could not parse color from value '${"string"==typeof a?a:String(JSON.stringify(a))}'`)}if("number"===this.type.kind){let a=null;for(const u of this.args){if(a=u.evaluate(r),null===a)return 0;const h=Number(a);if(!isNaN(h))return h}throw new Ar(`Could not convert ${JSON.stringify(a)} to number.`)}return"formatted"===this.type.kind?Ir.fromString(Ho(this.args[0].evaluate(r))):"resolvedImage"===this.type.kind?wi.fromString(Ho(this.args[0].evaluate(r))):Ho(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){if("formatted"===this.type.kind)return new da([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new bh(this.args[0]).serialize();const r=[`to-${this.type.kind}`];return this.eachChild(a=>{r.push(a.serialize())}),r}}var Bc=Wt;const js=["Unknown","Point","LineString","Polygon"];var tf=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?js[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const s=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:a,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*r-s[0])+this.featureDistanceData.bearing[1]*(u*r-s[1])}return 0}parseColor(s){let r=this._parseColorCache[s];return r||(r=this._parseColorCache[s]=Oi.parse(s)),r}};class Lt{constructor(r,a,u,h){this.name=r,this.type=a,this._evaluate=u,this.args=h}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(r=>r.serialize()))}static parse(r,a){const u=r[0],h=Lt.definitions[u];if(!h)return a.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(h)?h[0]:h.type,v=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,b=v.filter(([T])=>!Array.isArray(T)||T.length===r.length-1);let M=null;for(const[T,I]of b){M=new rf(a.registry,a.path,null,a.scope);const O=[];let R=!1;for(let B=1;B<r.length;B++){const V=r[B],w=Array.isArray(T)?T[B-1]:T.type,K=M.parse(V,1+O.length,w);if(!K){R=!0;break}O.push(K)}if(!R)if(Array.isArray(T)&&T.length!==O.length)M.error(`Expected ${T.length} arguments, but found ${O.length} instead.`);else{for(let B=0;B<O.length;B++){const V=Array.isArray(T)?T[B]:T.type,w=O[B];M.concat(B+1).checkSubtype(V,w.type)}if(0===M.errors.length)return new Lt(u,m,I,O)}}if(1===b.length)a.errors.push(...M.errors);else{const T=(b.length?b:v).map(([O])=>{return R=O,Array.isArray(R)?`(${R.map(ti).join(", ")})`:`(${ti(R.type)}...)`;var R}).join(" | "),I=[];for(let O=1;O<r.length;O++){const R=a.parse(r[O],1+I.length);if(!R)return null;I.push(ti(R.type))}a.error(`Expected arguments of type ${T}, but found (${I.join(", ")}) instead.`)}return null}static register(r,a){Lt.definitions=a;for(const u in a)r[u]=Lt}}var ha=Lt;class lr{constructor(r,a,u){this.type=ro,this.locale=u,this.caseSensitive=r,this.diacriticSensitive=a}static parse(r,a){if(2!==r.length)return a.error("Expected one argument.");const u=r[1];if("object"!=typeof u||Array.isArray(u))return a.error("Collator options argument must be an object.");const h=a.parse(void 0!==u["case-sensitive"]&&u["case-sensitive"],1,cn);if(!h)return null;const m=a.parse(void 0!==u["diacritic-sensitive"]&&u["diacritic-sensitive"],1,cn);if(!m)return null;let v=null;return u.locale&&(v=a.parse(u.locale,1,pt),!v)?null:new lr(h,m,v)}evaluate(r){return new Jp(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}const Co=8192;function Xu(s,r){s[0]=Math.min(s[0],r[0]),s[1]=Math.min(s[1],r[1]),s[2]=Math.max(s[2],r[0]),s[3]=Math.max(s[3],r[1])}function Ha(s,r){return!(s[0]<=r[0]||s[2]>=r[2]||s[1]<=r[1]||s[3]>=r[3])}function Vc(s,r){const a=(180+s[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,h=Math.pow(2,r.z);return[Math.round(a*h*Co),Math.round(u*h*Co)]}function Uc(s,r,a){const u=s[0]-r[0],h=s[1]-r[1],m=s[0]-a[0],v=s[1]-a[1];return u*v-m*h==0&&u*m<=0&&h*v<=0}function Ga(s,r){let a=!1;for(let v=0,b=r.length;v<b;v++){const M=r[v];for(let T=0,I=M.length;T<I-1;T++){if(Uc(s,M[T],M[T+1]))return!1;(h=M[T])[1]>(u=s)[1]!=(m=M[T+1])[1]>u[1]&&u[0]<(m[0]-h[0])*(u[1]-h[1])/(m[1]-h[1])+h[0]&&(a=!a)}}var u,h,m;return a}function jc(s,r){for(let a=0;a<r.length;a++)if(Ga(s,r[a]))return!0;return!1}function Yu(s,r,a,u){const h=u[0]-a[0],m=u[1]-a[1],v=(s[0]-a[0])*m-h*(s[1]-a[1]),b=(r[0]-a[0])*m-h*(r[1]-a[1]);return v>0&&b<0||v<0&&b>0}function Nl(s,r,a){for(const T of a)for(let I=0;I<T.length-1;++I)if((b=[(v=T[I+1])[0]-(m=T[I])[0],v[1]-m[1]])[0]*(M=[(h=r)[0]-(u=s)[0],h[1]-u[1]])[1]-b[1]*M[0]!=0&&Yu(u,h,m,v)&&Yu(m,v,u,h))return!0;var u,h,m,v,b,M;return!1}function kt(s,r){for(let a=0;a<s.length;++a)if(!Ga(s[a],r))return!1;for(let a=0;a<s.length-1;++a)if(Nl(s[a],s[a+1],r))return!1;return!0}function wh(s,r){for(let a=0;a<r.length;a++)if(kt(s,r[a]))return!0;return!1}function Ku(s,r,a){const u=[];for(let h=0;h<s.length;h++){const m=[];for(let v=0;v<s[h].length;v++){const b=Vc(s[h][v],a);Xu(r,b),m.push(b)}u.push(m)}return u}function Ur(s,r,a){const u=[];for(let h=0;h<s.length;h++){const m=Ku(s[h],r,a);u.push(m)}return u}function Ju(s,r,a,u){if(s[0]<a[0]||s[0]>a[2]){const h=.5*u;let m=s[0]-a[0]>h?-u:a[0]-s[0]>h?u:0;0===m&&(m=s[0]-a[2]>h?-u:a[2]-s[0]>h?u:0),s[0]+=m}Xu(r,s)}function Am(s,r,a,u){const h=Math.pow(2,u.z)*Co,m=[u.x*Co,u.y*Co],v=[];if(!s)return v;for(const b of s)for(const M of b){const T=[M.x+m[0],M.y+m[1]];Ju(T,r,a,h),v.push(T)}return v}function Kn(s,r,a,u){const h=Math.pow(2,u.z)*Co,m=[u.x*Co,u.y*Co],v=[];if(!s)return v;for(const M of s){const T=[];for(const I of M){const O=[I.x+m[0],I.y+m[1]];Xu(r,O),T.push(O)}v.push(T)}if(r[2]-r[0]<=h/2){(b=r)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const M of v)for(const T of M)Ju(T,r,a,h)}var b;return v}class $c{constructor(r,a){this.type=cn,this.geojson=r,this.geometries=a}static parse(r,a){if(2!==r.length)return a.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(zc(r[1])){const u=r[1];if("FeatureCollection"===u.type)for(let h=0;h<u.features.length;++h){const m=u.features[h].geometry.type;if("Polygon"===m||"MultiPolygon"===m)return new $c(u,u.features[h].geometry)}else if("Feature"===u.type){const h=u.geometry.type;if("Polygon"===h||"MultiPolygon"===h)return new $c(u,u.geometry)}else if("Polygon"===u.type||"MultiPolygon"===u.type)return new $c(u,u)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(null!=r.geometry()&&null!=r.canonicalID()){if("Point"===r.geometryType())return function(a,u){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],v=a.canonicalID();if(!v)return!1;if("Polygon"===u.type){const b=Ku(u.coordinates,m,v),M=Am(a.geometry(),h,m,v);if(!Ha(h,m))return!1;for(const T of M)if(!Ga(T,b))return!1}if("MultiPolygon"===u.type){const b=Ur(u.coordinates,m,v),M=Am(a.geometry(),h,m,v);if(!Ha(h,m))return!1;for(const T of M)if(!jc(T,b))return!1}return!0}(r,this.geometries);if("LineString"===r.geometryType())return function(a,u){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],v=a.canonicalID();if(!v)return!1;if("Polygon"===u.type){const b=Ku(u.coordinates,m,v),M=Kn(a.geometry(),h,m,v);if(!Ha(h,m))return!1;for(const T of M)if(!kt(T,b))return!1}if("MultiPolygon"===u.type){const b=Ur(u.coordinates,m,v),M=Kn(a.geometry(),h,m,v);if(!Ha(h,m))return!1;for(const T of M)if(!wh(T,b))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Ch=$c;function pa(s){if(s instanceof ha&&("get"===s.name&&1===s.args.length||"feature-state"===s.name||"has"===s.name&&1===s.args.length||"properties"===s.name||"geometry-type"===s.name||"id"===s.name||/^filter-/.test(s.name))||s instanceof Ch)return!1;let r=!0;return s.eachChild(a=>{r&&!pa(a)&&(r=!1)}),r}function Go(s){if(s instanceof ha&&"feature-state"===s.name)return!1;let r=!0;return s.eachChild(a=>{r&&!Go(a)&&(r=!1)}),r}function fa(s,r){if(s instanceof ha&&r.indexOf(s.name)>=0)return!1;let a=!0;return s.eachChild(u=>{a&&!fa(u,r)&&(a=!1)}),a}class zl{constructor(r,a){this.type=a.type,this.name=r,this.boundExpression=a}static parse(r,a){if(2!==r.length||"string"!=typeof r[1])return a.error("'var' expression requires exactly one string literal argument.");const u=r[1];return a.scope.has(u)?new zl(u,a.scope.get(u)):a.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var nf=zl;class qa{constructor(r,a=[],u,h=new Yp,m=[]){this.registry=r,this.path=a,this.key=a.map(v=>`[${v}]`).join(""),this.scope=h,this.errors=m,this.expectedType=u}parse(r,a,u,h,m={}){return a?this.concat(a,u,h)._parse(r,m):this._parse(r,m)}_parse(r,a){function u(h,m,v){return"assert"===v?new ua(m,[h]):"coerce"===v?new Bc(m,[h]):h}if(null!==r&&"string"!=typeof r&&"boolean"!=typeof r&&"number"!=typeof r||(r=["literal",r]),Array.isArray(r)){if(0===r.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=r[0];if("string"!=typeof h)return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[h];if(m){let v=m.parse(r,this);if(!v)return null;if(this.expectedType){const b=this.expectedType,M=v.type;if("string"!==b.kind&&"number"!==b.kind&&"boolean"!==b.kind&&"object"!==b.kind&&"array"!==b.kind||"value"!==M.kind)if("color"!==b.kind&&"formatted"!==b.kind&&"resolvedImage"!==b.kind||"value"!==M.kind&&"string"!==M.kind){if(this.checkSubtype(b,M))return null}else v=u(v,b,a.typeAnnotation||"coerce");else v=u(v,b,a.typeAnnotation||"assert")}if(!(v instanceof Fl)&&"resolvedImage"!==v.type.kind&&sf(v)){const b=new tf;try{v=new Fl(v.type,v.evaluate(b))}catch(M){return this.error(M.message),null}}return v}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===r?"'undefined' value invalid. Use null instead.":"object"==typeof r?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,a,u){const h="number"==typeof r?this.path.concat(r):this.path,m=u?this.scope.concat(u):this.scope;return new qa(this.registry,h,a||null,m,this.errors)}error(r,...a){const u=`${this.key}${a.map(h=>`[${h}]`).join("")}`;this.errors.push(new $o(u,r))}checkSubtype(r,a){const u=Pn(r,a);return u&&this.error(u),u}}var rf=qa;function sf(s){if(s instanceof nf)return sf(s.boundExpression);if(s instanceof ha&&"error"===s.name||s instanceof lr||s instanceof Ch)return!1;const r=s instanceof Bc||s instanceof ua;let a=!0;return s.eachChild(u=>{a=r?a&&sf(u):a&&u instanceof Fl}),!!a&&pa(s)&&fa(s,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Mh(s,r){const a=s.length-1;let u,h,m=0,v=a,b=0;for(;m<=v;)if(b=Math.floor((m+v)/2),u=s[b],h=s[b+1],u<=r){if(b===a||r<h)return b;m=b+1}else{if(!(u>r))throw new Ar("Input is not a number.");v=b-1}return 0}class Eh{constructor(r,a,u){this.type=r,this.input=a,this.labels=[],this.outputs=[];for(const[h,m]of u)this.labels.push(h),this.outputs.push(m)}static parse(r,a){if(r.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return a.error("Expected an even number of arguments.");const u=a.parse(r[1],1,bt);if(!u)return null;const h=[];let m=null;a.expectedType&&"value"!==a.expectedType.kind&&(m=a.expectedType);for(let v=1;v<r.length;v+=2){const b=1===v?-1/0:r[v],M=r[v+1],T=v,I=v+1;if("number"!=typeof b)return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(h.length&&h[h.length-1][0]>=b)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const O=a.parse(M,I,m);if(!O)return null;m=m||O.type,h.push([b,O])}return new Eh(m,u,h)}evaluate(r){const a=this.labels,u=this.outputs;if(1===a.length)return u[0].evaluate(r);const h=this.input.evaluate(r);if(h<=a[0])return u[0].evaluate(r);const m=a.length;return h>=a[m-1]?u[m-1].evaluate(r):u[Mh(a,h)].evaluate(r)}eachChild(r){r(this.input);for(const a of this.outputs)r(a)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){const r=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&r.push(this.labels[a]),r.push(this.outputs[a].serialize());return r}}var af=Eh;function wn(s,r,a){return s*(1-a)+r*a}var Za=Object.freeze({__proto__:null,array:function(s,r,a){return s.map((u,h)=>wn(u,r[h],a))},color:function(s,r,a){return new Oi(wn(s.r,r.r,a),wn(s.g,r.g,a),wn(s.b,r.b,a),wn(s.a,r.a,a))},number:wn});const lf=4/29,Wa=6/29,Qu=3*Wa*Wa,Bl=Wa*Wa*Wa,Pm=Math.PI/180,ga=180/Math.PI;function Dh(s){return s>Bl?Math.pow(s,1/3):s/Qu+lf}function Ft(s){return s>Wa?s*s*s:Qu*(s-lf)}function ed(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function It(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function Gc(s){const r=It(s.r),a=It(s.g),u=It(s.b),h=Dh((.4124564*r+.3575761*a+.1804375*u)/.95047),m=Dh((.2126729*r+.7151522*a+.072175*u)/1);return{l:116*m-16,a:500*(h-m),b:200*(m-Dh((.0193339*r+.119192*a+.9503041*u)/1.08883)),alpha:s.a}}function td(s){let r=(s.l+16)/116,a=isNaN(s.a)?r:r+s.a/500,u=isNaN(s.b)?r:r-s.b/200;return r=1*Ft(r),a=.95047*Ft(a),u=1.08883*Ft(u),new Oi(ed(3.2404542*a-1.5371385*r-.4985314*u),ed(-.969266*a+1.8760108*r+.041556*u),ed(.0556434*a-.2040259*r+1.0572252*u),s.alpha)}function qc(s,r,a){const u=r-s;return s+a*(u>180||u<-180?u-360*Math.round(u/360):u)}const Zc={forward:Gc,reverse:td,interpolate:function(s,r,a){return{l:wn(s.l,r.l,a),a:wn(s.a,r.a,a),b:wn(s.b,r.b,a),alpha:wn(s.alpha,r.alpha,a)}}},Vl={forward:function(s){const{l:r,a,b:u}=Gc(s),h=Math.atan2(u,a)*ga;return{h:h<0?h+360:h,c:Math.sqrt(a*a+u*u),l:r,alpha:s.a}},reverse:function(s){const r=s.h*Pm,a=s.c;return td({l:s.l,a:Math.cos(r)*a,b:Math.sin(r)*a,alpha:s.alpha})},interpolate:function(s,r,a){return{h:qc(s.h,r.h,a),c:wn(s.c,r.c,a),l:wn(s.l,r.l,a),alpha:wn(s.alpha,r.alpha,a)}}};var Sh=Object.freeze({__proto__:null,hcl:Vl,lab:Zc});class oo{constructor(r,a,u,h,m){this.type=r,this.operator=a,this.interpolation=u,this.input=h,this.labels=[],this.outputs=[];for(const[v,b]of m)this.labels.push(v),this.outputs.push(b)}static interpolationFactor(r,a,u,h){let m=0;if("exponential"===r.name)m=Ul(a,r.base,u,h);else if("linear"===r.name)m=Ul(a,1,u,h);else if("cubic-bezier"===r.name){const v=r.controlPoints;m=new Ra(v[0],v[1],v[2],v[3]).solve(Ul(a,1,u,h))}return m}static parse(r,a){let[u,h,m,...v]=r;if(!Array.isArray(h)||0===h.length)return a.error("Expected an interpolation type expression.",1);if("linear"===h[0])h={name:"linear"};else if("exponential"===h[0]){const T=h[1];if("number"!=typeof T)return a.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:T}}else{if("cubic-bezier"!==h[0])return a.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const T=h.slice(1);if(4!==T.length||T.some(I=>"number"!=typeof I||I<0||I>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:T}}}if(r.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(m=a.parse(m,2,bt),!m)return null;const b=[];let M=null;"interpolate-hcl"===u||"interpolate-lab"===u?M=Vr:a.expectedType&&"value"!==a.expectedType.kind&&(M=a.expectedType);for(let T=0;T<v.length;T+=2){const I=v[T],O=v[T+1],R=T+3,B=T+4;if("number"!=typeof I)return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(b.length&&b[b.length-1][0]>=I)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',R);const V=a.parse(O,B,M);if(!V)return null;M=M||V.type,b.push([I,V])}return"number"===M.kind||"color"===M.kind||"array"===M.kind&&"number"===M.itemType.kind&&"number"==typeof M.N?new oo(M,u,h,m,b):a.error(`Type ${ti(M)} is not interpolatable.`)}evaluate(r){const a=this.labels,u=this.outputs;if(1===a.length)return u[0].evaluate(r);const h=this.input.evaluate(r);if(h<=a[0])return u[0].evaluate(r);const m=a.length;if(h>=a[m-1])return u[m-1].evaluate(r);const v=Mh(a,h),b=oo.interpolationFactor(this.interpolation,h,a[v],a[v+1]),M=u[v].evaluate(r),T=u[v+1].evaluate(r);return"interpolate"===this.operator?Za[this.type.kind.toLowerCase()](M,T,b):"interpolate-hcl"===this.operator?Vl.reverse(Vl.interpolate(Vl.forward(M),Vl.forward(T),b)):Zc.reverse(Zc.interpolate(Zc.forward(M),Zc.forward(T),b))}eachChild(r){r(this.input);for(const a of this.outputs)r(a)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){let r;r="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const a=[this.operator,r,this.input.serialize()];for(let u=0;u<this.labels.length;u++)a.push(this.labels[u],this.outputs[u].serialize());return a}}function Ul(s,r,a,u){const h=u-a,m=s-a;return 0===h?0:1===r?m/h:(Math.pow(r,m)-1)/(Math.pow(r,h)-1)}var Qi=oo;class so{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expectected at least one argument.");let u=null;const h=a.expectedType;h&&"value"!==h.kind&&(u=h);const m=[];for(const b of r.slice(1)){const M=a.parse(b,1+m.length,u,void 0,{typeAnnotation:"omit"});if(!M)return null;u=u||M.type,m.push(M)}const v=h&&m.some(b=>Pn(h,b.type));return new so(v?gn:u,m)}evaluate(r){let a,u=null,h=0;for(const m of this.args){if(h++,u=m.evaluate(r),u&&u instanceof wi&&!u.available&&(a||(a=u),u=null,h===this.args.length))return a;if(null!==u)break}return u}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=["coalesce"];return this.eachChild(a=>{r.push(a.serialize())}),r}}var Nn=so;class Xa{constructor(r,a){this.type=a.type,this.bindings=[].concat(r),this.result=a}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const a of this.bindings)r(a[1]);r(this.result)}static parse(r,a){if(r.length<4)return a.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const u=[];for(let m=1;m<r.length-1;m+=2){const v=r[m];if("string"!=typeof v)return a.error(`Expected string, but found ${typeof v} instead.`,m);if(/[^a-zA-Z0-9_]/.test(v))return a.error("Variable names must contain only alphanumeric characters or '_'.",m);const b=a.parse(r[m+1],m+1);if(!b)return null;u.push([v,b])}const h=a.parse(r[r.length-1],r.length-1,a.expectedType,u);return h?new Xa(u,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[a,u]of this.bindings)r.push(a,u.serialize());return r.push(this.result.serialize()),r}}var nd=Xa;class Wc{constructor(r,a,u){this.type=r,this.index=a,this.input=u}static parse(r,a){if(3!==r.length)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=a.parse(r[1],1,bt),h=a.parse(r[2],2,jn(a.expectedType||gn));return u&&h?new Wc(h.type.itemType,u,h):null}evaluate(r){const a=this.index.evaluate(r),u=this.input.evaluate(r);if(a<0)throw new Ar(`Array index out of bounds: ${a} < 0.`);if(a>=u.length)throw new Ar(`Array index out of bounds: ${a} > ${u.length-1}.`);if(a!==Math.floor(a))throw new Ar(`Array index must be an integer, but found ${a} instead.`);return u[a]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var cf=Wc;class qo{constructor(r,a){this.type=cn,this.needle=r,this.haystack=a}static parse(r,a){if(3!==r.length)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const u=a.parse(r[1],1,gn),h=a.parse(r[2],2,gn);return u&&h?Gt(u.type,[cn,pt,bt,bi,gn])?new qo(u,h):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${ti(u.type)} instead`):null}evaluate(r){const a=this.needle.evaluate(r),u=this.haystack.evaluate(r);if(null==u)return!1;if(!ja(a,["boolean","string","number","null"]))throw new Ar(`Expected first argument to be of type boolean, string, number or null, but found ${ti(Li(a))} instead.`);if(!ja(u,["string","array"]))throw new Ar(`Expected second argument to be of type array or string, but found ${ti(Li(u))} instead.`);return u.indexOf(a)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var ma=qo;class jl{constructor(r,a,u){this.type=bt,this.needle=r,this.haystack=a,this.fromIndex=u}static parse(r,a){if(r.length<=2||r.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const u=a.parse(r[1],1,gn),h=a.parse(r[2],2,gn);if(!u||!h)return null;if(!Gt(u.type,[cn,pt,bt,bi,gn]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${ti(u.type)} instead`);if(4===r.length){const m=a.parse(r[3],3,bt);return m?new jl(u,h,m):null}return new jl(u,h)}evaluate(r){const a=this.needle.evaluate(r),u=this.haystack.evaluate(r);if(!ja(a,["boolean","string","number","null"]))throw new Ar(`Expected first argument to be of type boolean, string, number or null, but found ${ti(Li(a))} instead.`);if(!ja(u,["string","array"]))throw new Ar(`Expected second argument to be of type array or string, but found ${ti(Li(u))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(r);return u.indexOf(a,h)}return u.indexOf(a)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Ih=jl;class Xc{constructor(r,a,u,h,m,v){this.inputType=r,this.type=a,this.input=u,this.cases=h,this.outputs=m,this.otherwise=v}static parse(r,a){if(r.length<5)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return a.error("Expected an even number of arguments.");let u,h;a.expectedType&&"value"!==a.expectedType.kind&&(h=a.expectedType);const m={},v=[];for(let T=2;T<r.length-1;T+=2){let I=r[T];const O=r[T+1];Array.isArray(I)||(I=[I]);const R=a.concat(T);if(0===I.length)return R.error("Expected at least one branch label.");for(const V of I){if("number"!=typeof V&&"string"!=typeof V)return R.error("Branch labels must be numbers or strings.");if("number"==typeof V&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return R.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof V&&Math.floor(V)!==V)return R.error("Numeric branch labels must be integer values.");if(u){if(R.checkSubtype(u,Li(V)))return null}else u=Li(V);if(void 0!==m[String(V)])return R.error("Branch labels must be unique.");m[String(V)]=v.length}const B=a.parse(O,T,h);if(!B)return null;h=h||B.type,v.push(B)}const b=a.parse(r[1],1,gn);if(!b)return null;const M=a.parse(r[r.length-1],r.length-1,h);return M?"value"!==b.type.kind&&a.concat(1).checkSubtype(u,b.type)?null:new Xc(u,h,b,m,v,M):null}evaluate(r){const a=this.input.evaluate(r);return(Li(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),u=[],h={};for(const v of a){const b=h[this.cases[v]];void 0===b?(h[this.cases[v]]=u.length,u.push([this.cases[v],[v]])):u[b][1].push(v)}const m=v=>"number"===this.inputType.kind?Number(v):v;for(const[v,b]of u)r.push(1===b.length?m(b[0]):b.map(m)),r.push(this.outputs[v].serialize());return r.push(this.otherwise.serialize()),r}}var uf=Xc;class id{constructor(r,a,u){this.type=r,this.branches=a,this.otherwise=u}static parse(r,a){if(r.length<4)return a.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return a.error("Expected an odd number of arguments.");let u;a.expectedType&&"value"!==a.expectedType.kind&&(u=a.expectedType);const h=[];for(let v=1;v<r.length-1;v+=2){const b=a.parse(r[v],v,cn);if(!b)return null;const M=a.parse(r[v+1],v+1,u);if(!M)return null;h.push([b,M]),u=u||M.type}const m=a.parse(r[r.length-1],r.length-1,u);return m?new id(u,h,m):null}evaluate(r){for(const[a,u]of this.branches)if(a.evaluate(r))return u.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[a,u]of this.branches)r(a),r(u);r(this.otherwise)}outputDefined(){return this.branches.every(([r,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild(a=>{r.push(a.serialize())}),r}}var $l=id;class Hl{constructor(r,a,u,h){this.type=r,this.input=a,this.beginIndex=u,this.endIndex=h}static parse(r,a){if(r.length<=2||r.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const u=a.parse(r[1],1,gn),h=a.parse(r[2],2,bt);if(!u||!h)return null;if(!Gt(u.type,[jn(gn),pt,gn]))return a.error(`Expected first argument to be of type array or string, but found ${ti(u.type)} instead`);if(4===r.length){const m=a.parse(r[3],3,bt);return m?new Hl(u.type,u,h,m):null}return new Hl(u.type,u,h)}evaluate(r){const a=this.input.evaluate(r),u=this.beginIndex.evaluate(r);if(!ja(a,["string","array"]))throw new Ar(`Expected first argument to be of type array or string, but found ${ti(Li(a))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(r);return a.slice(u,h)}return a.slice(u)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Ah=Hl;function rd(s,r){return"=="===s||"!="===s?"boolean"===r.kind||"string"===r.kind||"number"===r.kind||"null"===r.kind||"value"===r.kind:"string"===r.kind||"number"===r.kind||"value"===r.kind}function Ph(s,r,a,u){return 0===u.compare(r,a)}function Gl(s,r,a){const u="=="!==s&&"!="!==s;return class sA{constructor(m,v,b){this.type=cn,this.lhs=m,this.rhs=v,this.collator=b,this.hasUntypedArgument="value"===m.type.kind||"value"===v.type.kind}static parse(m,v){if(3!==m.length&&4!==m.length)return v.error("Expected two or three arguments.");const b=m[0];let M=v.parse(m[1],1,gn);if(!M)return null;if(!rd(b,M.type))return v.concat(1).error(`"${b}" comparisons are not supported for type '${ti(M.type)}'.`);let T=v.parse(m[2],2,gn);if(!T)return null;if(!rd(b,T.type))return v.concat(2).error(`"${b}" comparisons are not supported for type '${ti(T.type)}'.`);if(M.type.kind!==T.type.kind&&"value"!==M.type.kind&&"value"!==T.type.kind)return v.error(`Cannot compare types '${ti(M.type)}' and '${ti(T.type)}'.`);u&&("value"===M.type.kind&&"value"!==T.type.kind?M=new ua(T.type,[M]):"value"!==M.type.kind&&"value"===T.type.kind&&(T=new ua(M.type,[T])));let I=null;if(4===m.length){if("string"!==M.type.kind&&"string"!==T.type.kind&&"value"!==M.type.kind&&"value"!==T.type.kind)return v.error("Cannot use collator to compare non-string types.");if(I=v.parse(m[3],3,ro),!I)return null}return new sA(M,T,I)}evaluate(m){const v=this.lhs.evaluate(m),b=this.rhs.evaluate(m);if(u&&this.hasUntypedArgument){const M=Li(v),T=Li(b);if(M.kind!==T.kind||"string"!==M.kind&&"number"!==M.kind)throw new Ar(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${M.kind}, ${T.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const M=Li(v),T=Li(b);if("string"!==M.kind||"string"!==T.kind)return r(m,v,b)}return this.collator?a(m,v,b,this.collator.evaluate(m)):r(m,v,b)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){const m=[s];return this.eachChild(v=>{m.push(v.serialize())}),m}}}const km=Gl("==",function(s,r,a){return r===a},Ph),Zo=Gl("!=",function(s,r,a){return r!==a},function(s,r,a,u){return!Ph(0,r,a,u)}),Om=Gl("<",function(s,r,a){return r<a},function(s,r,a,u){return u.compare(r,a)<0}),df=Gl(">",function(s,r,a){return r>a},function(s,r,a,u){return u.compare(r,a)>0}),Lm=Gl("<=",function(s,r,a){return r<=a},function(s,r,a,u){return u.compare(r,a)<=0}),hf=Gl(">=",function(s,r,a){return r>=a},function(s,r,a,u){return u.compare(r,a)>=0});class od{constructor(r,a,u,h,m,v){this.type=pt,this.number=r,this.locale=a,this.currency=u,this.unit=h,this.minFractionDigits=m,this.maxFractionDigits=v}static parse(r,a){if(3!==r.length)return a.error("Expected two arguments.");const u=a.parse(r[1],1,bt);if(!u)return null;const h=r[2];if("object"!=typeof h||Array.isArray(h))return a.error("NumberFormat options argument must be an object.");let m=null;if(h.locale&&(m=a.parse(h.locale,1,pt),!m))return null;let v=null;if(h.currency&&(v=a.parse(h.currency,1,pt),!v))return null;let b=null;if(h.unit&&(b=a.parse(h.unit,1,pt),!b))return null;let M=null;if(h["min-fraction-digits"]&&(M=a.parse(h["min-fraction-digits"],1,bt),!M))return null;let T=null;return h["max-fraction-digits"]&&(T=a.parse(h["max-fraction-digits"],1,bt),!T)?null:new od(u,m,v,b,M,T)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(r):void 0,unit:this.unit?this.unit.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.unit&&r(this.unit),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.unit&&(r.unit=this.unit.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class ql{constructor(r){this.type=bt,this.input=r}static parse(r,a){if(2!==r.length)return a.error(`Expected 1 argument, but found ${r.length-1} instead.`);const u=a.parse(r[1],1);return u?"array"!==u.type.kind&&"string"!==u.type.kind&&"value"!==u.type.kind?a.error(`Expected argument of type string or array, but found ${ti(u.type)} instead.`):new ql(u):null}evaluate(r){const a=this.input.evaluate(r);if("string"==typeof a||Array.isArray(a))return a.length;throw new Ar(`Expected value to be of type string or array, but found ${ti(Li(a))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild(a=>{r.push(a.serialize())}),r}}const kh={"==":km,"!=":Zo,">":df,"<":Om,">=":hf,"<=":Lm,array:ua,at:cf,boolean:ua,case:$l,coalesce:Nn,collator:lr,format:da,image:bh,in:ma,"index-of":Ih,interpolate:Qi,"interpolate-hcl":Qi,"interpolate-lab":Qi,length:ql,let:nd,literal:Fl,match:uf,number:ua,"number-format":od,object:ua,slice:Ah,step:af,string:ua,"to-boolean":Bc,"to-color":Bc,"to-number":Bc,"to-string":Bc,var:nf,within:Ch};function pf(s,[r,a,u,h]){r=r.evaluate(s),a=a.evaluate(s),u=u.evaluate(s);const m=h?h.evaluate(s):1,v=Im(r,a,u,m);if(v)throw new Ar(v);return new Oi(r/255*m,a/255*m,u/255*m,m)}function $s(s,r){return s in r}function sd(s,r){const a=r[s];return void 0===a?null:a}function mi(s){return{type:s}}ha.register(kh,{error:[{kind:"error"},[pt],(s,[r])=>{throw new Ar(r.evaluate(s))}],typeof:[pt,[gn],(s,[r])=>ti(Li(r.evaluate(s)))],"to-rgba":[jn(bt,4),[Vr],(s,[r])=>r.evaluate(s).toArray()],rgb:[Vr,[bt,bt,bt],pf],rgba:[Vr,[bt,bt,bt,bt],pf],has:{type:cn,overloads:[[[pt],(s,[r])=>$s(r.evaluate(s),s.properties())],[[pt,Ti],(s,[r,a])=>$s(r.evaluate(s),a.evaluate(s))]]},get:{type:gn,overloads:[[[pt],(s,[r])=>sd(r.evaluate(s),s.properties())],[[pt,Ti],(s,[r,a])=>sd(r.evaluate(s),a.evaluate(s))]]},"feature-state":[gn,[pt],(s,[r])=>sd(r.evaluate(s),s.featureState||{})],properties:[Ti,[],s=>s.properties()],"geometry-type":[pt,[],s=>s.geometryType()],id:[gn,[],s=>s.id()],zoom:[bt,[],s=>s.globals.zoom],pitch:[bt,[],s=>s.globals.pitch||0],"distance-from-center":[bt,[],s=>s.distanceFromCenter()],"heatmap-density":[bt,[],s=>s.globals.heatmapDensity||0],"line-progress":[bt,[],s=>s.globals.lineProgress||0],"sky-radial-progress":[bt,[],s=>s.globals.skyRadialProgress||0],accumulated:[gn,[],s=>void 0===s.globals.accumulated?null:s.globals.accumulated],"+":[bt,mi(bt),(s,r)=>{let a=0;for(const u of r)a+=u.evaluate(s);return a}],"*":[bt,mi(bt),(s,r)=>{let a=1;for(const u of r)a*=u.evaluate(s);return a}],"-":{type:bt,overloads:[[[bt,bt],(s,[r,a])=>r.evaluate(s)-a.evaluate(s)],[[bt],(s,[r])=>-r.evaluate(s)]]},"/":[bt,[bt,bt],(s,[r,a])=>r.evaluate(s)/a.evaluate(s)],"%":[bt,[bt,bt],(s,[r,a])=>r.evaluate(s)%a.evaluate(s)],ln2:[bt,[],()=>Math.LN2],pi:[bt,[],()=>Math.PI],e:[bt,[],()=>Math.E],"^":[bt,[bt,bt],(s,[r,a])=>Math.pow(r.evaluate(s),a.evaluate(s))],sqrt:[bt,[bt],(s,[r])=>Math.sqrt(r.evaluate(s))],log10:[bt,[bt],(s,[r])=>Math.log(r.evaluate(s))/Math.LN10],ln:[bt,[bt],(s,[r])=>Math.log(r.evaluate(s))],log2:[bt,[bt],(s,[r])=>Math.log(r.evaluate(s))/Math.LN2],sin:[bt,[bt],(s,[r])=>Math.sin(r.evaluate(s))],cos:[bt,[bt],(s,[r])=>Math.cos(r.evaluate(s))],tan:[bt,[bt],(s,[r])=>Math.tan(r.evaluate(s))],asin:[bt,[bt],(s,[r])=>Math.asin(r.evaluate(s))],acos:[bt,[bt],(s,[r])=>Math.acos(r.evaluate(s))],atan:[bt,[bt],(s,[r])=>Math.atan(r.evaluate(s))],min:[bt,mi(bt),(s,r)=>Math.min(...r.map(a=>a.evaluate(s)))],max:[bt,mi(bt),(s,r)=>Math.max(...r.map(a=>a.evaluate(s)))],abs:[bt,[bt],(s,[r])=>Math.abs(r.evaluate(s))],round:[bt,[bt],(s,[r])=>{const a=r.evaluate(s);return a<0?-Math.round(-a):Math.round(a)}],floor:[bt,[bt],(s,[r])=>Math.floor(r.evaluate(s))],ceil:[bt,[bt],(s,[r])=>Math.ceil(r.evaluate(s))],"filter-==":[cn,[pt,gn],(s,[r,a])=>s.properties()[r.value]===a.value],"filter-id-==":[cn,[gn],(s,[r])=>s.id()===r.value],"filter-type-==":[cn,[pt],(s,[r])=>s.geometryType()===r.value],"filter-<":[cn,[pt,gn],(s,[r,a])=>{const u=s.properties()[r.value],h=a.value;return typeof u==typeof h&&u<h}],"filter-id-<":[cn,[gn],(s,[r])=>{const a=s.id(),u=r.value;return typeof a==typeof u&&a<u}],"filter->":[cn,[pt,gn],(s,[r,a])=>{const u=s.properties()[r.value],h=a.value;return typeof u==typeof h&&u>h}],"filter-id->":[cn,[gn],(s,[r])=>{const a=s.id(),u=r.value;return typeof a==typeof u&&a>u}],"filter-<=":[cn,[pt,gn],(s,[r,a])=>{const u=s.properties()[r.value],h=a.value;return typeof u==typeof h&&u<=h}],"filter-id-<=":[cn,[gn],(s,[r])=>{const a=s.id(),u=r.value;return typeof a==typeof u&&a<=u}],"filter->=":[cn,[pt,gn],(s,[r,a])=>{const u=s.properties()[r.value],h=a.value;return typeof u==typeof h&&u>=h}],"filter-id->=":[cn,[gn],(s,[r])=>{const a=s.id(),u=r.value;return typeof a==typeof u&&a>=u}],"filter-has":[cn,[gn],(s,[r])=>r.value in s.properties()],"filter-has-id":[cn,[],s=>null!==s.id()&&void 0!==s.id()],"filter-type-in":[cn,[jn(pt)],(s,[r])=>r.value.indexOf(s.geometryType())>=0],"filter-id-in":[cn,[jn(gn)],(s,[r])=>r.value.indexOf(s.id())>=0],"filter-in-small":[cn,[pt,jn(gn)],(s,[r,a])=>a.value.indexOf(s.properties()[r.value])>=0],"filter-in-large":[cn,[pt,jn(gn)],(s,[r,a])=>function(u,h,m,v){for(;m<=v;){const b=m+v>>1;if(h[b]===u)return!0;h[b]>u?v=b-1:m=b+1}return!1}(s.properties()[r.value],a.value,0,a.value.length-1)],all:{type:cn,overloads:[[[cn,cn],(s,[r,a])=>r.evaluate(s)&&a.evaluate(s)],[mi(cn),(s,r)=>{for(const a of r)if(!a.evaluate(s))return!1;return!0}]]},any:{type:cn,overloads:[[[cn,cn],(s,[r,a])=>r.evaluate(s)||a.evaluate(s)],[mi(cn),(s,r)=>{for(const a of r)if(a.evaluate(s))return!0;return!1}]]},"!":[cn,[cn],(s,[r])=>!r.evaluate(s)],"is-supported-script":[cn,[pt],(s,[r])=>{const a=s.globals&&s.globals.isSupportedScript;return!a||a(r.evaluate(s))}],upcase:[pt,[pt],(s,[r])=>r.evaluate(s).toUpperCase()],downcase:[pt,[pt],(s,[r])=>r.evaluate(s).toLowerCase()],concat:[pt,mi(gn),(s,r)=>r.map(a=>Ho(a.evaluate(s))).join("")],"resolved-locale":[pt,[ro],(s,[r])=>r.evaluate(s).resolvedLocale()]});var Yc=kh;function ff(s){return{result:"success",value:s}}function Ya(s){return{result:"error",value:s}}function cr(s){return"data-driven"===s["property-type"]}function ad(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function Kc(s){return!!s.expression&&s.expression.interpolated}function mt(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":null===s?"null":typeof s}function ur(s){return"object"==typeof s&&null!==s&&!Array.isArray(s)}function kn(s){return s}function er(s,r){const a="color"===r.type,u=s.stops&&"object"==typeof s.stops[0][0],h=u||!(u||void 0!==s.property),m=s.type||(Kc(r)?"exponential":"interval");if(a&&((s=Us({},s)).stops&&(s.stops=s.stops.map(T=>[T[0],Oi.parse(T[1])])),s.default=Oi.parse(s.default?s.default:r.default)),s.colorSpace&&"rgb"!==s.colorSpace&&!Sh[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let v,b,M;if("exponential"===m)v=vs;else if("interval"===m)v=Pr;else if("categorical"===m){v=Ka,b=Object.create(null);for(const T of s.stops)b[T[0]]=T[1];M=typeof s.stops[0][0]}else{if("identity"!==m)throw new Error(`Unknown function type "${m}"`);v=Oh}if(u){const T={},I=[];for(let B=0;B<s.stops.length;B++){const V=s.stops[B],w=V[0].zoom;void 0===T[w]&&(T[w]={zoom:w,type:s.type,property:s.property,default:s.default,stops:[]},I.push(w)),T[w].stops.push([V[0].value,V[1]])}const O=[];for(const B of I)O.push([T[B].zoom,er(T[B],r)]);const R={name:"linear"};return{kind:"composite",interpolationType:R,interpolationFactor:Qi.interpolationFactor.bind(void 0,R),zoomStops:O.map(B=>B[0]),evaluate:({zoom:B},V)=>vs({stops:O,base:s.base},r,B).evaluate(B,V)}}if(h){const T="exponential"===m?{name:"exponential",base:void 0!==s.base?s.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:Qi.interpolationFactor.bind(void 0,T),zoomStops:s.stops.map(I=>I[0]),evaluate:({zoom:I})=>v(s,r,I,b,M)}}return{kind:"source",evaluate(T,I){const O=I&&I.properties?I.properties[s.property]:void 0;return void 0===O?tr(s.default,r.default):v(s,r,O,b,M)}}}function tr(s,r,a){return void 0!==s?s:void 0!==r?r:void 0!==a?a:void 0}function Ka(s,r,a,u,h){return tr(typeof a===h?u[a]:void 0,s.default,r.default)}function Pr(s,r,a){if("number"!==mt(a))return tr(s.default,r.default);const u=s.stops.length;if(1===u||a<=s.stops[0][0])return s.stops[0][1];if(a>=s.stops[u-1][0])return s.stops[u-1][1];const h=Mh(s.stops.map(m=>m[0]),a);return s.stops[h][1]}function vs(s,r,a){const u=void 0!==s.base?s.base:1;if("number"!==mt(a))return tr(s.default,r.default);const h=s.stops.length;if(1===h||a<=s.stops[0][0])return s.stops[0][1];if(a>=s.stops[h-1][0])return s.stops[h-1][1];const m=Mh(s.stops.map(I=>I[0]),a),v=function(I,O,R,B){const V=B-R,w=I-R;return 0===V?0:1===O?w/V:(Math.pow(O,w)-1)/(Math.pow(O,V)-1)}(a,u,s.stops[m][0],s.stops[m+1][0]),b=s.stops[m][1],M=s.stops[m+1][1];let T=Za[r.type]||kn;if(s.colorSpace&&"rgb"!==s.colorSpace){const I=Sh[s.colorSpace];T=(O,R)=>I.reverse(I.interpolate(I.forward(O),I.forward(R),v))}return"function"==typeof b.evaluate?{evaluate(...I){const O=b.evaluate.apply(void 0,I),R=M.evaluate.apply(void 0,I);if(void 0!==O&&void 0!==R)return T(O,R,v)}}:T(b,M,v)}function Oh(s,r,a){return"color"===r.type?a=Oi.parse(a):"formatted"===r.type?a=Ir.fromString(a.toString()):"resolvedImage"===r.type?a=wi.fromString(a.toString()):mt(a)===r.type||"enum"===r.type&&r.values[a]||(a=void 0),tr(a,s.default,r.default)}class Ja{constructor(r,a){var u;this.expression=r,this._warningHistory={},this._evaluator=new tf,this._defaultValue=a?"color"===(u=a).type&&(ur(u.default)||Array.isArray(u.default))?new Oi(0,0,0,0):"color"===u.type?Oi.parse(u.default)||null:void 0===u.default?null:u.default:null,this._enumValues=a&&"enum"===a.type?a.values:null}evaluateWithoutErrorHandling(r,a,u,h,m,v,b,M){return this._evaluator.globals=r,this._evaluator.feature=a,this._evaluator.featureState=u,this._evaluator.canonical=h||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=v,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=M||null,this.expression.evaluate(this._evaluator)}evaluate(r,a,u,h,m,v,b,M){this._evaluator.globals=r,this._evaluator.feature=a||null,this._evaluator.featureState=u||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=v||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=M||null;try{const T=this.expression.evaluate(this._evaluator);if(null==T||"number"==typeof T&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new Ar(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function Zl(s){return Array.isArray(s)&&s.length>0&&"string"==typeof s[0]&&s[0]in Yc}function Wl(s,r){const a=new rf(Yc,[],r?function(h){const m={color:Vr,string:pt,number:bt,enum:pt,boolean:cn,formatted:zn,resolvedImage:_s};return"array"===h.type?jn(m[h.value]||gn,h.length):m[h.type]}(r):void 0),u=a.parse(s,void 0,void 0,void 0,r&&"string"===r.type?{typeAnnotation:"coerce"}:void 0);return u?ff(new Ja(u,r)):Ya(a.errors)}class Di{constructor(r,a){this.kind=r,this._styleExpression=a,this.isStateDependent="constant"!==r&&!Go(a.expression)}evaluateWithoutErrorHandling(r,a,u,h,m,v){return this._styleExpression.evaluateWithoutErrorHandling(r,a,u,h,m,v)}evaluate(r,a,u,h,m,v){return this._styleExpression.evaluate(r,a,u,h,m,v)}}class Dt{constructor(r,a,u,h){this.kind=r,this.zoomStops=u,this._styleExpression=a,this.isStateDependent="camera"!==r&&!Go(a.expression),this.interpolationType=h}evaluateWithoutErrorHandling(r,a,u,h,m,v){return this._styleExpression.evaluateWithoutErrorHandling(r,a,u,h,m,v)}evaluate(r,a,u,h,m,v){return this._styleExpression.evaluate(r,a,u,h,m,v)}interpolationFactor(r,a,u){return this.interpolationType?Qi.interpolationFactor(this.interpolationType,r,a,u):0}}function nn(s,r){if("error"===(s=Wl(s,r)).result)return s;const a=s.value.expression,u=pa(a);if(!u&&!cr(r))return Ya([new $o("","data expressions not supported")]);const h=fa(a,["zoom","pitch","distance-from-center"]);if(!h&&!ad(r))return Ya([new $o("","zoom expressions not supported")]);const m=Yr(a);return m||h?m instanceof $o?Ya([m]):m instanceof Qi&&!Kc(r)?Ya([new $o("",'"interpolate" expressions cannot be used with this property')]):ff(m?new Dt(u?"camera":"composite",s.value,m.labels,m instanceof Qi?m.interpolation:void 0):new Di(u?"constant":"source",s.value)):Ya([new $o("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class si{constructor(r,a){this._parameters=r,this._specification=a,Us(this,er(this._parameters,this._specification))}static deserialize(r){return new si(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function Yr(s){let r=null;if(s instanceof nd)r=Yr(s.result);else if(s instanceof Nn){for(const a of s.args)if(r=Yr(a),r)break}else(s instanceof af||s instanceof Qi)&&s.input instanceof ha&&"zoom"===s.input.name&&(r=s);return r instanceof $o||s.eachChild(a=>{const u=Yr(a);u instanceof $o?r=u:!r&&u?r=new $o("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&u&&r!==u&&(r=new $o("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}class wt{constructor(r,a,u,h){this.message=(r?`${r}: `:"")+u,h&&(this.identifier=h),null!=a&&a.__line__&&(this.line=a.__line__)}}function hi(s){const r=s.key,a=s.value,u=s.valueSpec||{},h=s.objectElementValidators||{},m=s.style,v=s.styleSpec;let b=[];const M=mt(a);if("object"!==M)return[new wt(r,a,`object expected, ${M} found`)];for(const T in a){const I=T.split(".")[0];let O;h[I]?O=h[I]:u[I]?O=pi:h["*"]?O=h["*"]:u["*"]&&(O=pi),O?b=b.concat(O({key:(r&&`${r}.`)+T,value:a[T],valueSpec:u[I]||u["*"],style:m,styleSpec:v,object:a,objectKey:T},a)):b.push(new wt(r,a[T],`unknown property "${T}"`))}for(const T in u)h[T]||u[T].required&&void 0===u[T].default&&void 0===a[T]&&b.push(new wt(r,a,`missing required property "${T}"`));return b}function Qa(s){const r=s.value,a=s.valueSpec,u=s.style,h=s.styleSpec,m=s.key,v=s.arrayElementValidator||pi;if("array"!==mt(r))return[new wt(m,r,`array expected, ${mt(r)} found`)];if(a.length&&r.length!==a.length)return[new wt(m,r,`array length ${a.length} expected, length ${r.length} found`)];if(a["min-length"]&&r.length<a["min-length"])return[new wt(m,r,`array length at least ${a["min-length"]} expected, length ${r.length} found`)];let b={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};h.$version<7&&(b.function=a.function),"object"===mt(a.value)&&(b=a.value);let M=[];for(let T=0;T<r.length;T++)M=M.concat(v({array:r,arrayIndex:T,value:r[T],valueSpec:b,style:u,styleSpec:h,key:`${m}[${T}]`}));return M}function _i(s){const r=s.key,a=s.value,u=s.valueSpec;let h=mt(a);if("number"===h&&a!=a&&(h="NaN"),"number"!==h)return[new wt(r,a,`number expected, ${h} found`)];if("minimum"in u){let m=u.minimum;if("array"===mt(u.minimum)&&(m=u.minimum[s.arrayIndex]),a<m)return[new wt(r,a,`${a} is less than the minimum value ${m}`)]}if("maximum"in u){let m=u.maximum;if("array"===mt(u.maximum)&&(m=u.maximum[s.arrayIndex]),a>m)return[new wt(r,a,`${a} is greater than the maximum value ${m}`)]}return[]}function Mo(s){const r=s.valueSpec,a=Hi(s.value.type);let u,h,m,v={};const b="categorical"!==a&&void 0===s.value.property,M=!b,T="array"===mt(s.value.stops)&&"array"===mt(s.value.stops[0])&&"object"===mt(s.value.stops[0][0]),I=hi({key:s.key,value:s.value,valueSpec:s.styleSpec.function,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(B){if("identity"===a)return[new wt(B.key,B.value,'identity function may not have a "stops" property')];let V=[];const w=B.value;return V=V.concat(Qa({key:B.key,value:w,valueSpec:B.valueSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:O})),"array"===mt(w)&&0===w.length&&V.push(new wt(B.key,w,"array must have at least one stop")),V},default:function(B){return pi({key:B.key,value:B.value,valueSpec:r,style:B.style,styleSpec:B.styleSpec})}}});return"identity"===a&&b&&I.push(new wt(s.key,s.value,'missing required property "property"')),"identity"===a||s.value.stops||I.push(new wt(s.key,s.value,'missing required property "stops"')),"exponential"===a&&s.valueSpec.expression&&!Kc(s.valueSpec)&&I.push(new wt(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(M&&!cr(s.valueSpec)?I.push(new wt(s.key,s.value,"property functions not supported")):b&&!ad(s.valueSpec)&&I.push(new wt(s.key,s.value,"zoom functions not supported"))),"categorical"!==a&&!T||void 0!==s.value.property||I.push(new wt(s.key,s.value,'"property" property is required')),I;function O(B){let V=[];const w=B.value,K=B.key;if("array"!==mt(w))return[new wt(K,w,`array expected, ${mt(w)} found`)];if(2!==w.length)return[new wt(K,w,`array length 2 expected, length ${w.length} found`)];if(T){if("object"!==mt(w[0]))return[new wt(K,w,`object expected, ${mt(w[0])} found`)];if(void 0===w[0].zoom)return[new wt(K,w,"object stop key must have zoom")];if(void 0===w[0].value)return[new wt(K,w,"object stop key must have value")];const G=Hi(w[0].zoom);if("number"!=typeof G)return[new wt(K,w[0].zoom,"stop zoom values must be numbers")];if(m&&m>G)return[new wt(K,w[0].zoom,"stop zoom values must appear in ascending order")];G!==m&&(m=G,h=void 0,v={}),V=V.concat(hi({key:`${K}[0]`,value:w[0],valueSpec:{zoom:{}},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:_i,value:R}}))}else V=V.concat(R({key:`${K}[0]`,value:w[0],valueSpec:{},style:B.style,styleSpec:B.styleSpec},w));return Zl(_r(w[1]))?V.concat([new wt(`${K}[1]`,w[1],"expressions are not allowed in function stops.")]):V.concat(pi({key:`${K}[1]`,value:w[1],valueSpec:r,style:B.style,styleSpec:B.styleSpec}))}function R(B,V){const w=mt(B.value),K=Hi(B.value),G=null!==B.value?B.value:V;if(u){if(w!==u)return[new wt(B.key,G,`${w} stop domain type must match previous stop domain type ${u}`)]}else u=w;if("number"!==w&&"string"!==w&&"boolean"!==w&&"number"!=typeof K&&"string"!=typeof K&&"boolean"!=typeof K)return[new wt(B.key,G,"stop domain value must be a number, string, or boolean")];if("number"!==w&&"categorical"!==a){let me=`number expected, ${w} found`;return cr(r)&&void 0===a&&(me+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new wt(B.key,G,me)]}return"categorical"!==a||"number"!==w||"number"==typeof K&&isFinite(K)&&Math.floor(K)===K?"categorical"!==a&&"number"===w&&"number"==typeof K&&"number"==typeof h&&void 0!==h&&K<h?[new wt(B.key,G,"stop domain values must appear in ascending order")]:(h=K,"categorical"===a&&K in v?[new wt(B.key,G,"stop domain values must be unique")]:(v[K]=!0,[])):[new wt(B.key,G,`integer expected, found ${String(K)}`)]}}function Si(s){const r=("property"===s.expressionContext?nn:Wl)(_r(s.value),s.valueSpec);if("error"===r.result)return r.value.map(u=>new wt(`${s.key}${u.key}`,s.value,u.message));const a=r.value.expression||r.value._styleExpression.expression;if("property"===s.expressionContext&&"text-font"===s.propertyKey&&!a.outputDefined())return[new wt(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===s.expressionContext&&"layout"===s.propertyType&&!Go(a))return[new wt(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===s.expressionContext)return Jt(a,s);if(s.expressionContext&&0===s.expressionContext.indexOf("cluster")){if(!fa(a,["zoom","feature-state"]))return[new wt(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===s.expressionContext&&!pa(a))return[new wt(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Jt(s,r){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const h of r.valueSpec.expression.parameters)a.delete(h);if(0===a.size)return[];const u=[];return s instanceof ha&&a.has(s.name)?[new wt(r.key,r.value,`["${s.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(s.eachChild(h=>{u.push(...Jt(h,r))}),u)}function _a(s){const r=s.key,a=s.value,u=s.valueSpec,h=[];return Array.isArray(u.values)?-1===u.values.indexOf(Hi(a))&&h.push(new wt(r,a,`expected one of [${u.values.join(", ")}], ${JSON.stringify(a)} found`)):-1===Object.keys(u.values).indexOf(Hi(a))&&h.push(new wt(r,a,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(a)} found`)),h}function ld(s){if(!0===s||!1===s)return!0;if(!Array.isArray(s)||0===s.length)return!1;switch(s[0]){case"has":return s.length>=2&&"$id"!==s[1]&&"$type"!==s[1];case"in":return s.length>=3&&("string"!=typeof s[1]||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==s.length||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const r of s.slice(1))if(!ld(r)&&"boolean"!=typeof r)return!1;return!0;default:return!0}}function Hs(s,r="fill"){if(null==s)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ld(s)||(s=ao(s));const a=s;let u=!0;try{u=function(T){if(!Wo(T))return T;let I=_r(T);return va(I),I=Ri(I),I}(a)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(a,null,2)}\n        `)}const h=je[`filter_${r}`],m=Wl(u,h);let v=null;if("error"===m.result)throw new Error(m.value.map(T=>`${T.key}: ${T.message}`).join(", "));v=(T,I,O)=>m.value.evaluate(T,I,{},O);let b=null,M=null;if(u!==a){const T=Wl(a,h);if("error"===T.result)throw new Error(T.value.map(I=>`${I.key}: ${I.message}`).join(", "));b=(I,O,R,B,V)=>T.value.evaluate(I,O,{},R,void 0,void 0,B,V),M=!pa(T.value.expression)}return{filter:v,dynamicFilter:b||void 0,needGeometry:Lh(u),needFeature:!!M}}function Ri(s){if(!Array.isArray(s))return s;const r=function(a){if(Eo.has(a[0]))for(let u=1;u<a.length;u++)if(Wo(a[u]))return!0;return a}(s);return!0===r?r:r.map(a=>Ri(a))}function va(s){let r=!1;const a=[];if("case"===s[0]){for(let u=1;u<s.length-1;u+=2)r=r||Wo(s[u]),a.push(s[u+1]);a.push(s[s.length-1])}else if("match"===s[0]){r=r||Wo(s[1]);for(let u=2;u<s.length-1;u+=2)a.push(s[u+1]);a.push(s[s.length-1])}else if("step"===s[0]){r=r||Wo(s[1]);for(let u=1;u<s.length-1;u+=2)a.push(s[u+1])}r&&(s.length=0,s.push("any",...a));for(let u=1;u<s.length;u++)va(s[u])}function Wo(s){if(!Array.isArray(s))return!1;if("pitch"===(r=s[0])||"distance-from-center"===r)return!0;var r;for(let a=1;a<s.length;a++)if(Wo(s[a]))return!0;return!1}const Eo=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Jc(s,r){return s<r?-1:s>r?1:0}function Lh(s){if(!Array.isArray(s))return!1;if("within"===s[0])return!0;for(let r=1;r<s.length;r++)if(Lh(s[r]))return!0;return!1}function ao(s){if(!s)return!0;const r=s[0];return s.length<=1?"any"!==r:"=="===r?Xo(s[1],s[2],"=="):"!="===r?Mn(Xo(s[1],s[2],"==")):"<"===r||">"===r||"<="===r||">="===r?Xo(s[1],s[2],r):"any"===r?(a=s.slice(1),["any"].concat(a.map(ao))):"all"===r?["all"].concat(s.slice(1).map(ao)):"none"===r?["all"].concat(s.slice(1).map(ao).map(Mn)):"in"===r?Xl(s[1],s.slice(2)):"!in"===r?Mn(Xl(s[1],s.slice(2))):"has"===r?Yl(s[1]):"!has"===r?Mn(Yl(s[1])):"within"!==r||s;var a}function Xo(s,r,a){switch(s){case"$type":return[`filter-type-${a}`,r];case"$id":return[`filter-id-${a}`,r];default:return[`filter-${a}`,s,r]}}function Xl(s,r){if(0===r.length)return!1;switch(s){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(a=>typeof a!=typeof r[0])?["filter-in-large",s,["literal",r.sort(Jc)]]:["filter-in-small",s,["literal",r]]}}function Yl(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function Mn(s){return["!",s]}function cd(s){return ld(_r(s.value))?Si(Us({},s,{expressionContext:"filter",valueSpec:s.styleSpec[`filter_${s.layerType||"fill"}`]})):el(s)}function el(s){const r=s.value,a=s.key;if("array"!==mt(r))return[new wt(a,r,`array expected, ${mt(r)} found`)];const u=s.styleSpec;let h,m=[];if(r.length<1)return[new wt(a,r,"filter array must have at least 1 element")];switch(m=m.concat(_a({key:`${a}[0]`,value:r[0],valueSpec:u.filter_operator,style:s.style,styleSpec:s.styleSpec})),Hi(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===Hi(r[1])&&m.push(new wt(a,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":3!==r.length&&m.push(new wt(a,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(h=mt(r[1]),"string"!==h&&m.push(new wt(`${a}[1]`,r[1],`string expected, ${h} found`)));for(let v=2;v<r.length;v++)h=mt(r[v]),"$type"===Hi(r[1])?m=m.concat(_a({key:`${a}[${v}]`,value:r[v],valueSpec:u.geometry_type,style:s.style,styleSpec:s.styleSpec})):"string"!==h&&"number"!==h&&"boolean"!==h&&m.push(new wt(`${a}[${v}]`,r[v],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let v=1;v<r.length;v++)m=m.concat(el({key:`${a}[${v}]`,value:r[v],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":h=mt(r[1]),2!==r.length?m.push(new wt(a,r,`filter array for "${r[0]}" operator must have 2 elements`)):"string"!==h&&m.push(new wt(`${a}[1]`,r[1],`string expected, ${h} found`));break;case"within":h=mt(r[1]),2!==r.length?m.push(new wt(a,r,`filter array for "${r[0]}" operator must have 2 elements`)):"object"!==h&&m.push(new wt(`${a}[1]`,r[1],`object expected, ${h} found`))}return m}function ud(s,r){const a=s.key,u=s.style,h=s.styleSpec,m=s.value,v=s.objectKey,b=h[`${r}_${s.layerType}`];if(!b)return[];const M=v.match(/^(.*)-transition$/);if("paint"===r&&M&&b[M[1]]&&b[M[1]].transition)return pi({key:a,value:m,valueSpec:h.transition,style:u,styleSpec:h});const T=s.valueSpec||b[v];if(!T)return[new wt(a,m,`unknown property "${v}"`)];let I;if("string"===mt(m)&&cr(T)&&!T.tokens&&(I=/^{([^}]+)}$/.exec(m))){const R=`\`{ "type": "identity", "property": ${I?JSON.stringify(I[1]):'"_"'} }\``;return[new wt(a,m,`"${v}" does not support interpolation syntax\nUse an identity property function instead: ${R}.`)]}const O=[];return"symbol"===s.layerType&&("text-field"===v&&u&&!u.glyphs&&O.push(new wt(a,m,'use of "text-field" requires a style "glyphs" property')),"text-font"===v&&ur(_r(m))&&"identity"===Hi(m.type)&&O.push(new wt(a,m,'"text-font" does not support identity functions'))),O.concat(pi({key:s.key,value:m,valueSpec:T,style:u,styleSpec:h,expressionContext:"property",propertyType:r,propertyKey:v}))}function Yo(s){return ud(s,"paint")}function Kl(s){return ud(s,"layout")}function tl(s){let r=[];const a=s.value,u=s.key,h=s.style,m=s.styleSpec;a.type||a.ref||r.push(new wt(u,a,'either "type" or "ref" is required'));let v=Hi(a.type);const b=Hi(a.ref);if(a.id){const M=Hi(a.id);for(let T=0;T<s.arrayIndex;T++){const I=h.layers[T];Hi(I.id)===M&&r.push(new wt(u,a.id,`duplicate layer id "${a.id}", previously used at line ${I.id.__line__}`))}}if("ref"in a){let M;["type","source","source-layer","filter","layout"].forEach(T=>{T in a&&r.push(new wt(u,a[T],`"${T}" is prohibited for ref layers`))}),h.layers.forEach(T=>{Hi(T.id)===b&&(M=T)}),M?M.ref?r.push(new wt(u,a.ref,"ref cannot reference another ref layer")):v=Hi(M.type):"string"==typeof b&&r.push(new wt(u,a.ref,`ref layer "${b}" not found`))}else if("background"!==v&&"sky"!==v)if(a.source){const M=h.sources&&h.sources[a.source],T=M&&Hi(M.type);M?"vector"===T&&"raster"===v?r.push(new wt(u,a.source,`layer "${a.id}" requires a raster source`)):"raster"===T&&"raster"!==v?r.push(new wt(u,a.source,`layer "${a.id}" requires a vector source`)):"vector"!==T||a["source-layer"]?"raster-dem"===T&&"hillshade"!==v?r.push(new wt(u,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==v||!a.paint||!a.paint["line-gradient"]&&!a.paint["line-trim-offset"]||"geojson"===T&&M.lineMetrics||r.push(new wt(u,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new wt(u,a,`layer "${a.id}" must specify a "source-layer"`)):r.push(new wt(u,a.source,`source "${a.source}" not found`))}else r.push(new wt(u,a,'missing required property "source"'));return r=r.concat(hi({key:u,value:a,valueSpec:m.layer,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{"*":()=>[],type:()=>pi({key:`${u}.type`,value:a.type,valueSpec:m.layer.type,style:s.style,styleSpec:s.styleSpec,object:a,objectKey:"type"}),filter:M=>cd(Us({layerType:v},M)),layout:M=>hi({layer:a,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":T=>Kl(Us({layerType:v},T))}}),paint:M=>hi({layer:a,key:M.key,value:M.value,valueSpec:{},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":T=>Yo(Us({layerType:v},T))}})}})),r}function To(s){const r=s.value,a=s.key,u=mt(r);return"string"!==u?[new wt(a,r,`string expected, ${u} found`)]:[]}const vr={promoteId:function({key:s,value:r}){if("string"===mt(r))return To({key:s,value:r});{const a=[];for(const u in r)a.push(...To({key:`${s}.${u}`,value:r[u]}));return a}}};function Rm(s){const r=s.value,a=s.key,u=s.styleSpec,h=s.style;if(!r.type)return[new wt(a,r,'"type" is required')];const m=Hi(r.type);let v;switch(m){case"vector":case"raster":case"raster-dem":return v=hi({key:a,value:r,valueSpec:u[`source_${m.replace("-","_")}`],style:s.style,styleSpec:u,objectElementValidators:vr}),v;case"geojson":if(v=hi({key:a,value:r,valueSpec:u.source_geojson,style:h,styleSpec:u,objectElementValidators:vr}),r.cluster)for(const b in r.clusterProperties){const[M,T]=r.clusterProperties[b],I="string"==typeof M?[M,["accumulated"],["get",b]]:M;v.push(...Si({key:`${a}.${b}.map`,value:T,expressionContext:"cluster-map"})),v.push(...Si({key:`${a}.${b}.reduce`,value:I,expressionContext:"cluster-reduce"}))}return v;case"video":return hi({key:a,value:r,valueSpec:u.source_video,style:h,styleSpec:u});case"image":return hi({key:a,value:r,valueSpec:u.source_image,style:h,styleSpec:u});case"canvas":return[new wt(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return _a({key:`${a}.type`,value:r.type,valueSpec:{values:Kr(u)},style:h,styleSpec:u})}}function Kr(s){return s.source.reduce((r,a)=>{const u=s[a];return"enum"===u.type.type&&(r=r.concat(Object.keys(u.type.values))),r},[])}function jr(s){const r=s.value,a=s.styleSpec,u=a.light,h=s.style;let m=[];const v=mt(r);if(void 0===r)return m;if("object"!==v)return m=m.concat([new wt("light",r,`object expected, ${v} found`)]),m;for(const b in r){const M=b.match(/^(.*)-transition$/);m=m.concat(M&&u[M[1]]&&u[M[1]].transition?pi({key:b,value:r[b],valueSpec:a.transition,style:h,styleSpec:a}):u[b]?pi({key:b,value:r[b],valueSpec:u[b],style:h,styleSpec:a}):[new wt(b,r[b],`unknown property "${b}"`)])}return m}function Qc(s){const r=s.value,a=s.key,u=s.style,h=s.styleSpec,m=h.terrain;let v=[];const b=mt(r);if(void 0===r)return v;if("object"!==b)return v=v.concat([new wt("terrain",r,`object expected, ${b} found`)]),v;for(const M in r){const T=M.match(/^(.*)-transition$/);v=v.concat(T&&m[T[1]]&&m[T[1]].transition?pi({key:M,value:r[M],valueSpec:h.transition,style:u,styleSpec:h}):m[M]?pi({key:M,value:r[M],valueSpec:m[M],style:u,styleSpec:h}):[new wt(M,r[M],`unknown property "${M}"`)])}if(r.source){const M=u.sources&&u.sources[r.source],T=M&&Hi(M.type);M?"raster-dem"!==T&&v.push(new wt(a,r.source,`terrain cannot be used with a source of type ${String(T)}, it only be used with a "raster-dem" source type`)):v.push(new wt(a,r.source,`source "${r.source}" not found`))}else v.push(new wt(a,r,'terrain is missing required property "source"'));return v}function ya(s){const r=s.value,a=s.style,u=s.styleSpec,h=u.fog;let m=[];const v=mt(r);if(void 0===r)return m;if("object"!==v)return m=m.concat([new wt("fog",r,`object expected, ${v} found`)]),m;for(const b in r){const M=b.match(/^(.*)-transition$/);m=m.concat(M&&h[M[1]]&&h[M[1]].transition?pi({key:b,value:r[b],valueSpec:u.transition,style:a,styleSpec:u}):h[b]?pi({key:b,value:r[b],valueSpec:h[b],style:a,styleSpec:u}):[new wt(b,r[b],`unknown property "${b}"`)])}return m}const eu={"*":()=>[],array:Qa,boolean:function(s){const r=s.value,a=s.key,u=mt(r);return"boolean"!==u?[new wt(a,r,`boolean expected, ${u} found`)]:[]},number:_i,color:function(s){const r=s.key,a=s.value,u=mt(a);return"string"!==u?[new wt(r,a,`color expected, ${u} found`)]:null===Nc(a)?[new wt(r,a,`color expected, "${a}" found`)]:[]},enum:_a,filter:cd,function:Mo,layer:tl,object:hi,source:Rm,light:jr,terrain:Qc,fog:ya,string:To,formatted:function(s){return 0===To(s).length?[]:Si(s)},resolvedImage:function(s){return 0===To(s).length?[]:Si(s)},projection:function(s){const r=s.value,a=s.styleSpec,u=a.projection,h=s.style;let m=[];const v=mt(r);if("object"===v)for(const b in r)m=m.concat(pi({key:b,value:r[b],valueSpec:u[b],style:h,styleSpec:a}));else"string"!==v&&(m=m.concat([new wt("projection",r,`object or string expected, ${v} found`)]));return m}};function pi(s){const r=s.value,a=s.valueSpec,u=s.styleSpec;return a.expression&&ur(Hi(r))?Mo(s):a.expression&&Zl(_r(r))?Si(s):a.type&&eu[a.type]?eu[a.type](s):hi(Us({},s,{valueSpec:a.type?u[a.type]:a}))}function Rh(s){const r=s.value,a=s.key,u=To(s);return u.length||(-1===r.indexOf("{fontstack}")&&u.push(new wt(a,r,'"glyphs" url must include a "{fontstack}" token')),-1===r.indexOf("{range}")&&u.push(new wt(a,r,'"glyphs" url must include a "{range}" token'))),u}function gf(s,r=je){return Do(pi({key:"",value:s,valueSpec:r.$root,styleSpec:r,style:s,objectElementValidators:{glyphs:Rh,"*":()=>[]}}))}const Fm=s=>Do(Yo(s)),d1=s=>Do(Kl(s));function Do(s){return s.slice().sort((r,a)=>r.line&&a.line?r.line-a.line:0)}function mf(s,r){let a=!1;if(r&&r.length)for(const u of r)s.fire(new Vs(new Error(u.message))),a=!0;return a}var h1=Gs,ys=3;function Gs(s,r,a){var u=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var h=new Int32Array(this.arrayBuffer);s=h[0],this.d=(r=h[1])+2*(a=h[2]);for(var m=0;m<this.d*this.d;m++){var v=h[ys+m],b=h[ys+m+1];u.push(v===b?null:h.subarray(v,b))}var M=h[ys+u.length+1];this.keys=h.subarray(h[ys+u.length],M),this.bboxes=h.subarray(M),this.insert=this._insertReadonly}else{this.d=r+2*a;for(var T=0;T<this.d*this.d;T++)u.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=s,this.padding=a,this.scale=r/s,this.uid=0;var I=a/r*s;this.min=-I,this.max=s+I}Gs.prototype.insert=function(s,r,a,u,h){this._forEachCell(r,a,u,h,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(h)},Gs.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Gs.prototype._insertCell=function(s,r,a,u,h,m){this.cells[h].push(m)},Gs.prototype.query=function(s,r,a,u,h){var m=this.min,v=this.max;if(s<=m&&r<=m&&v<=a&&v<=u&&!h)return Array.prototype.slice.call(this.keys);var b=[];return this._forEachCell(s,r,a,u,this._queryCell,b,{},h),b},Gs.prototype._queryCell=function(s,r,a,u,h,m,v,b){var M=this.cells[h];if(null!==M)for(var T=this.keys,I=this.bboxes,O=0;O<M.length;O++){var R=M[O];if(void 0===v[R]){var B=4*R;(b?b(I[B+0],I[B+1],I[B+2],I[B+3]):s<=I[B+2]&&r<=I[B+3]&&a>=I[B+0]&&u>=I[B+1])?(v[R]=!0,m.push(T[R])):v[R]=!1}}},Gs.prototype._forEachCell=function(s,r,a,u,h,m,v,b){for(var M=this._convertToCellCoord(s),T=this._convertToCellCoord(r),I=this._convertToCellCoord(a),O=this._convertToCellCoord(u),R=M;R<=I;R++)for(var B=T;B<=O;B++){var V=this.d*B+R;if((!b||b(this._convertFromCellCoord(R),this._convertFromCellCoord(B),this._convertFromCellCoord(R+1),this._convertFromCellCoord(B+1)))&&h.call(this,s,r,a,u,V,m,v,b))return}},Gs.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},Gs.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},Gs.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,r=ys+this.cells.length+1+1,a=0,u=0;u<this.cells.length;u++)a+=this.cells[u].length;var h=new Int32Array(r+a+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var m=r,v=0;v<s.length;v++){var b=s[v];h[ys+v]=m,h.set(b,m),m+=b.length}return h[ys+s.length]=m,h.set(this.keys,m),h[ys+s.length+1]=m+=this.keys.length,h.set(this.bboxes,m),m+=this.bboxes.length,h.buffer};var Jl=io(h1);const Fh={};function Tt(s,r,a={}){Object.defineProperty(s,"_classRegistryKey",{value:r,writeable:!1}),Fh[r]={klass:s,omit:a.omit||[]}}Tt(Object,"Object"),Jl.serialize=function(s,r){const a=s.toArrayBuffer();return r&&r.push(a),{buffer:a}},Jl.deserialize=function(s){return new Jl(s.buffer)},Object.defineProperty(Jl,"name",{value:"Grid"}),Tt(Jl,"Grid"),Tt(Oi,"Color"),Tt(Error,"Error"),Tt(Bs,"AJAXError"),Tt(wi,"ResolvedImage"),Tt(si,"StylePropertyFunction"),Tt(Ja,"StyleExpression",{omit:["_evaluator"]}),Tt(Dt,"ZoomDependentExpression"),Tt(Di,"ZoomConstantExpression"),Tt(ha,"CompoundExpression",{omit:["_evaluate"]});for(const s in Yc)Fh[Yc[s]._classRegistryKey]||Tt(Yc[s],`Expression${s}`);function _f(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&"ArrayBuffer"===s.constructor.name)}function vf(s){return Je.ImageBitmap&&s instanceof Je.ImageBitmap}function tu(s,r){if(null==s||"boolean"==typeof s||"number"==typeof s||"string"==typeof s||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(_f(s)||vf(s))return r&&r.push(s),s;if(ArrayBuffer.isView(s)){const a=s;return r&&r.push(a.buffer),a}if(s instanceof Je.ImageData)return r&&r.push(s.data.buffer),s;if(Array.isArray(s)){const a=[];for(const u of s)a.push(tu(u,r));return a}if("object"==typeof s){const a=s.constructor,u=a._classRegistryKey;if(!u)throw new Error(`can't serialize object of unregistered class ${u}`);const h=a.serialize?a.serialize(s,r):{};if(!a.serialize){for(const m in s)s.hasOwnProperty(m)&&(Fh[u].omit.indexOf(m)>=0||(h[m]=tu(s[m],r)));s instanceof Error&&(h.message=s.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==u&&(h.$name=u),h}throw new Error("can't serialize object of type "+typeof s)}function Ql(s){if(null==s||"boolean"==typeof s||"number"==typeof s||"string"==typeof s||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||_f(s)||vf(s)||ArrayBuffer.isView(s)||s instanceof Je.ImageData)return s;if(Array.isArray(s))return s.map(Ql);if("object"==typeof s){const r=s.$name||"Object",{klass:a}=Fh[r];if(!a)throw new Error(`can't deserialize unregistered class ${r}`);if(a.deserialize)return a.deserialize(s);const u=Object.create(a.prototype);for(const h of Object.keys(s))"$name"!==h&&(u[h]=Ql(s[h]));return u}throw new Error("can't deserialize object of type "+typeof s)}const Mt={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function yf(s){for(const r of s)if(bf(r.charCodeAt(0)))return!0;return!1}function xf(s){for(const r of s)if(!Nh(r.charCodeAt(0)))return!1;return!0}function Nh(s){return!(Mt.Arabic(s)||Mt["Arabic Supplement"](s)||Mt["Arabic Extended-A"](s)||Mt["Arabic Presentation Forms-A"](s)||Mt["Arabic Presentation Forms-B"](s))}function bf(s){return!(746!==s&&747!==s&&(s<4352||!(Mt["Bopomofo Extended"](s)||Mt.Bopomofo(s)||Mt["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||Mt["CJK Compatibility Ideographs"](s)||Mt["CJK Compatibility"](s)||Mt["CJK Radicals Supplement"](s)||Mt["CJK Strokes"](s)||!(!Mt["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||12336===s)||Mt["CJK Unified Ideographs Extension A"](s)||Mt["CJK Unified Ideographs"](s)||Mt["Enclosed CJK Letters and Months"](s)||Mt["Hangul Compatibility Jamo"](s)||Mt["Hangul Jamo Extended-A"](s)||Mt["Hangul Jamo Extended-B"](s)||Mt["Hangul Jamo"](s)||Mt["Hangul Syllables"](s)||Mt.Hiragana(s)||Mt["Ideographic Description Characters"](s)||Mt.Kanbun(s)||Mt["Kangxi Radicals"](s)||Mt["Katakana Phonetic Extensions"](s)||Mt.Katakana(s)&&12540!==s||!(!Mt["Halfwidth and Fullwidth Forms"](s)||65288===s||65289===s||65293===s||s>=65306&&s<=65310||65339===s||65341===s||65343===s||s>=65371&&s<=65503||65507===s||s>=65512&&s<=65519)||!(!Mt["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||Mt["Unified Canadian Aboriginal Syllabics"](s)||Mt["Unified Canadian Aboriginal Syllabics Extended"](s)||Mt["Vertical Forms"](s)||Mt["Yijing Hexagram Symbols"](s)||Mt["Yi Syllables"](s)||Mt["Yi Radicals"](s))))}function Nm(s){return!(bf(s)||(r=s,Mt["Latin-1 Supplement"](r)&&(167===r||169===r||174===r||177===r||188===r||189===r||190===r||215===r||247===r)||Mt["General Punctuation"](r)&&(8214===r||8224===r||8225===r||8240===r||8241===r||8251===r||8252===r||8258===r||8263===r||8264===r||8265===r||8273===r)||Mt["Letterlike Symbols"](r)||Mt["Number Forms"](r)||Mt["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||9003===r||r>=9085&&r<=9114||r>=9150&&r<=9165||9167===r||r>=9169&&r<=9179||r>=9186&&r<=9215)||Mt["Control Pictures"](r)&&9251!==r||Mt["Optical Character Recognition"](r)||Mt["Enclosed Alphanumerics"](r)||Mt["Geometric Shapes"](r)||Mt["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||Mt["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||Mt["CJK Symbols and Punctuation"](r)||Mt.Katakana(r)||Mt["Private Use Area"](r)||Mt["CJK Compatibility Forms"](r)||Mt["Small Form Variants"](r)||Mt["Halfwidth and Fullwidth Forms"](r)||8734===r||8756===r||8757===r||r>=9984&&r<=10087||r>=10102&&r<=10131||65532===r||65533===r));var r}function zm(s){return s>=1424&&s<=2303||Mt["Arabic Presentation Forms-A"](s)||Mt["Arabic Presentation Forms-B"](s)}function nl(s,r){return!(!r&&zm(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||Mt.Khmer(s))}function wf(s){for(const r of s)if(zm(r.charCodeAt(0)))return!0;return!1}const Cf="deferred",nu="loading",dd="loaded";let ec=null,g="unavailable",l=null;const d=function(s){s&&"string"==typeof s&&s.indexOf("NetworkError")>-1&&(g="error"),ec&&ec(s)};function _(){x.fire(new jo("pluginStateChange",{pluginStatus:g,pluginURL:l}))}const x=new Ll,C=function(){return g},D=function(){if(g!==Cf||!l)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");g=nu,_(),l&&kl({url:l},s=>{s?d(s):(g=dd,_())})},S={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>g===dd||null!=S.applyArabicShaping,isLoading:()=>g===nu,setState(s){g=s.pluginStatus,l=s.pluginURL},isParsed:()=>null!=S.applyArabicShaping&&null!=S.processBidirectionalText&&null!=S.processStyledBidirectionalText,getPluginURL:()=>l};class k{constructor(r,a){this.zoom=r,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.transition=a.transition,this.pitch=a.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(r){return function(a,u){for(const h of a)if(!nl(h.charCodeAt(0),u))return!1;return!0}(r,S.isLoaded())}}class N{constructor(r,a){this.property=r,this.value=a,this.expression=function(u,h){if(ur(u))return new si(u,h);if(Zl(u)){const m=nn(u,h);if("error"===m.result)throw new Error(m.value.map(v=>`${v.key}: ${v.message}`).join(", "));return m.value}{let m=u;return"string"==typeof u&&"color"===h.type&&(m=Oi.parse(u)),{kind:"constant",evaluate:()=>m}}}(void 0===a?r.specification.default:a,r.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(r,a,u){return this.property.possiblyEvaluate(this,r,a,u)}}class F{constructor(r){this.property=r,this.value=new N(r,void 0)}transitioned(r,a){return new Y(this.property,this.value,a,$i({},r.transition,this.transition),r.now)}untransitioned(){return new Y(this.property,this.value,null,{},0)}}class j{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return Br(this._values[r].value.value)}setValue(r,a){this._values.hasOwnProperty(r)||(this._values[r]=new F(this._values[r].property)),this._values[r].value=new N(this._values[r].property,null===a?void 0:Br(a))}getTransition(r){return Br(this._values[r].transition)}setTransition(r,a){this._values.hasOwnProperty(r)||(this._values[r]=new F(this._values[r].property)),this._values[r].transition=Br(a)||void 0}serialize(){const r={};for(const a of Object.keys(this._values)){const u=this.getValue(a);void 0!==u&&(r[a]=u);const h=this.getTransition(a);void 0!==h&&(r[`${a}-transition`]=h)}return r}transitioned(r,a){const u=new ee(this._properties);for(const h of Object.keys(this._values))u._values[h]=this._values[h].transitioned(r,a._values[h]);return u}untransitioned(){const r=new ee(this._properties);for(const a of Object.keys(this._values))r._values[a]=this._values[a].untransitioned();return r}}class Y{constructor(r,a,u,h,m){const v=h.delay||0,b=h.duration||0;m=m||0,this.property=r,this.value=a,this.begin=m+v,this.end=this.begin+b,r.specification.transition&&(h.delay||h.duration)&&(this.prior=u)}possiblyEvaluate(r,a,u){const h=r.now||0,m=this.value.possiblyEvaluate(r,a,u),v=this.prior;if(v){if(h>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(h<this.begin)return v.possiblyEvaluate(r,a,u);{const b=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(r,a,u),m,ju(b))}}return m}}class ee{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,a,u){const h=new se(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(r,a,u);return h}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class re{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}getValue(r){return Br(this._values[r].value)}setValue(r,a){this._values[r]=new N(this._values[r].property,null===a?void 0:Br(a))}serialize(){const r={};for(const a of Object.keys(this._values)){const u=this.getValue(a);void 0!==u&&(r[a]=u)}return r}possiblyEvaluate(r,a,u){const h=new se(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(r,a,u);return h}}class ie{constructor(r,a,u){this.property=r,this.value=a,this.parameters=u}isConstant(){return"constant"===this.value.kind}constantOr(r){return"constant"===this.value.kind?this.value.value:r}evaluate(r,a,u,h){return this.property.evaluate(this.value,this.parameters,r,a,u,h)}}class se{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class ${constructor(r){this.specification=r}possiblyEvaluate(r,a){return r.expression.evaluate(a)}interpolate(r,a,u){const h=Za[this.specification.type];return h?h(r,a,u):r}}class Q{constructor(r,a){this.specification=r,this.overrides=a}possiblyEvaluate(r,a,u,h){return new ie(this,"constant"===r.expression.kind||"camera"===r.expression.kind?{kind:"constant",value:r.expression.evaluate(a,null,{},u,h)}:r.expression,a)}interpolate(r,a,u){if("constant"!==r.value.kind||"constant"!==a.value.kind)return r;if(void 0===r.value.value||void 0===a.value.value)return new ie(this,{kind:"constant",value:void 0},r.parameters);const h=Za[this.specification.type];return h?new ie(this,{kind:"constant",value:h(r.value.value,a.value.value,u)},r.parameters):r}evaluate(r,a,u,h,m,v){return"constant"===r.kind?r.value:r.evaluate(a,u,h,m,v)}}class ue{constructor(r){this.specification=r}possiblyEvaluate(r,a,u,h){return!!r.expression.evaluate(a,null,{},u,h)}interpolate(){return!1}}class de{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const a=new k(0,{});for(const u in r){const h=r[u];h.specification.overridable&&this.overridableProperties.push(u);const m=this.defaultPropertyValues[u]=new N(h,void 0),v=this.defaultTransitionablePropertyValues[u]=new F(h);this.defaultTransitioningPropertyValues[u]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=m.possiblyEvaluate(a)}}}function be(s,r){return 256*(s=yn(Math.floor(s),0,255))+yn(Math.floor(r),0,255)}Tt(Q,"DataDrivenProperty"),Tt($,"DataConstantProperty"),Tt(ue,"ColorRampProperty");const Me={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class we{constructor(r,a){this._structArray=r,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Se{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,a){return r._trim(),a&&(r.isTransferred=!0,a.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const a=Object.create(this.prototype);return a.arrayBuffer=r.arrayBuffer,a.length=r.length,a.capacity=r.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ee(s,r=1){let a=0,u=0;return{members:s.map(h=>{const m=Me[h.type].BYTES_PER_ELEMENT,v=a=Fe(a,Math.max(r,m)),b=h.components||1;return u=Math.max(u,m),a+=m*b,{name:h.name,type:h.type,components:b,offset:v}}),size:Fe(a,Math.max(u,r)),alignment:r}}function Fe(s,r){return Math.ceil(s/r)*r}class ot extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a){const u=this.length;return this.resize(u+1),this.emplace(u,r,a)}emplace(r,a,u){const h=2*r;return this.int16[h+0]=a,this.int16[h+1]=u,r}}ot.prototype.bytesPerElement=4,Tt(ot,"StructArrayLayout2i4");class Oe extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,u){const h=this.length;return this.resize(h+1),this.emplace(h,r,a,u)}emplace(r,a,u,h){const m=3*r;return this.int16[m+0]=a,this.int16[m+1]=u,this.int16[m+2]=h,r}}Oe.prototype.bytesPerElement=6,Tt(Oe,"StructArrayLayout3i6");class Ze extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,u,h){const m=this.length;return this.resize(m+1),this.emplace(m,r,a,u,h)}emplace(r,a,u,h,m){const v=4*r;return this.int16[v+0]=a,this.int16[v+1]=u,this.int16[v+2]=h,this.int16[v+3]=m,r}}Ze.prototype.bytesPerElement=8,Tt(Ze,"StructArrayLayout4i8");class Be extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,h,m,v,b){const M=this.length;return this.resize(M+1),this.emplace(M,r,a,u,h,m,v,b)}emplace(r,a,u,h,m,v,b,M){const T=6*r,I=12*r,O=3*r;return this.int16[T+0]=a,this.int16[T+1]=u,this.uint8[I+4]=h,this.uint8[I+5]=m,this.uint8[I+6]=v,this.uint8[I+7]=b,this.float32[O+2]=M,r}}Be.prototype.bytesPerElement=12,Tt(Be,"StructArrayLayout2i4ub1f12");class it extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,h){const m=this.length;return this.resize(m+1),this.emplace(m,r,a,u,h)}emplace(r,a,u,h,m){const v=4*r;return this.float32[v+0]=a,this.float32[v+1]=u,this.float32[v+2]=h,this.float32[v+3]=m,r}}it.prototype.bytesPerElement=16,Tt(it,"StructArrayLayout4f16");class Le extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,r,a,u,h,m)}emplace(r,a,u,h,m,v){const b=6*r,M=3*r;return this.uint16[b+0]=a,this.uint16[b+1]=u,this.uint16[b+2]=h,this.uint16[b+3]=m,this.float32[M+2]=v,r}}Le.prototype.bytesPerElement=12,Tt(Le,"StructArrayLayout4ui1f12");class Ge extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,u,h){const m=this.length;return this.resize(m+1),this.emplace(m,r,a,u,h)}emplace(r,a,u,h,m){const v=4*r;return this.uint16[v+0]=a,this.uint16[v+1]=u,this.uint16[v+2]=h,this.uint16[v+3]=m,r}}Ge.prototype.bytesPerElement=8,Tt(Ge,"StructArrayLayout4ui8");class tt extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,u,h,m,v){const b=this.length;return this.resize(b+1),this.emplace(b,r,a,u,h,m,v)}emplace(r,a,u,h,m,v,b){const M=6*r;return this.int16[M+0]=a,this.int16[M+1]=u,this.int16[M+2]=h,this.int16[M+3]=m,this.int16[M+4]=v,this.int16[M+5]=b,r}}tt.prototype.bytesPerElement=12,Tt(tt,"StructArrayLayout6i12");class Qe extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,u,h,m,v,b,M,T,I,O,R){const B=this.length;return this.resize(B+1),this.emplace(B,r,a,u,h,m,v,b,M,T,I,O,R)}emplace(r,a,u,h,m,v,b,M,T,I,O,R,B){const V=12*r;return this.int16[V+0]=a,this.int16[V+1]=u,this.int16[V+2]=h,this.int16[V+3]=m,this.uint16[V+4]=v,this.uint16[V+5]=b,this.uint16[V+6]=M,this.uint16[V+7]=T,this.int16[V+8]=I,this.int16[V+9]=O,this.int16[V+10]=R,this.int16[V+11]=B,r}}Qe.prototype.bytesPerElement=24,Tt(Qe,"StructArrayLayout4i4ui4i24");class st extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,h,m,v){const b=this.length;return this.resize(b+1),this.emplace(b,r,a,u,h,m,v)}emplace(r,a,u,h,m,v,b){const M=10*r,T=5*r;return this.int16[M+0]=a,this.int16[M+1]=u,this.int16[M+2]=h,this.float32[T+2]=m,this.float32[T+3]=v,this.float32[T+4]=b,r}}st.prototype.bytesPerElement=20,Tt(st,"StructArrayLayout3i3f20");class vt extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.uint32[1*r+0]=a,r}}vt.prototype.bytesPerElement=4,Tt(vt,"StructArrayLayout1ul4");class Ht extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,u,h,m,v,b,M,T,I,O,R,B){const V=this.length;return this.resize(V+1),this.emplace(V,r,a,u,h,m,v,b,M,T,I,O,R,B)}emplace(r,a,u,h,m,v,b,M,T,I,O,R,B,V){const w=20*r,K=10*r;return this.int16[w+0]=a,this.int16[w+1]=u,this.int16[w+2]=h,this.int16[w+3]=m,this.int16[w+4]=v,this.float32[K+3]=b,this.float32[K+4]=M,this.float32[K+5]=T,this.float32[K+6]=I,this.int16[w+14]=O,this.uint32[K+8]=R,this.uint16[w+18]=B,this.uint16[w+19]=V,r}}Ht.prototype.bytesPerElement=40,Tt(Ht,"StructArrayLayout5i4f1i1ul2ui40");class Et extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,u,h,m,v,b){const M=this.length;return this.resize(M+1),this.emplace(M,r,a,u,h,m,v,b)}emplace(r,a,u,h,m,v,b,M){const T=8*r;return this.int16[T+0]=a,this.int16[T+1]=u,this.int16[T+2]=h,this.int16[T+4]=m,this.int16[T+5]=v,this.int16[T+6]=b,this.int16[T+7]=M,r}}Et.prototype.bytesPerElement=16,Tt(Et,"StructArrayLayout3i2i2i16");class At extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,u,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,r,a,u,h,m)}emplace(r,a,u,h,m,v){const b=4*r,M=8*r;return this.float32[b+0]=a,this.float32[b+1]=u,this.float32[b+2]=h,this.int16[M+6]=m,this.int16[M+7]=v,r}}At.prototype.bytesPerElement=16,Tt(At,"StructArrayLayout2f1f2i16");class _n extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,h){const m=this.length;return this.resize(m+1),this.emplace(m,r,a,u,h)}emplace(r,a,u,h,m){const v=12*r,b=3*r;return this.uint8[v+0]=a,this.uint8[v+1]=u,this.float32[b+1]=h,this.float32[b+2]=m,r}}_n.prototype.bytesPerElement=12,Tt(_n,"StructArrayLayout2ub2f12");class un extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u){const h=this.length;return this.resize(h+1),this.emplace(h,r,a,u)}emplace(r,a,u,h){const m=3*r;return this.float32[m+0]=a,this.float32[m+1]=u,this.float32[m+2]=h,r}}un.prototype.bytesPerElement=12,Tt(un,"StructArrayLayout3f12");class Pt extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,u){const h=this.length;return this.resize(h+1),this.emplace(h,r,a,u)}emplace(r,a,u,h){const m=3*r;return this.uint16[m+0]=a,this.uint16[m+1]=u,this.uint16[m+2]=h,r}}Pt.prototype.bytesPerElement=6,Tt(Pt,"StructArrayLayout3ui6");class dn extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,a,u,h,m,v,b,M,T,I,O,R,B,V,w,K,G,me,ae,fe,_e){const ve=this.length;return this.resize(ve+1),this.emplace(ve,r,a,u,h,m,v,b,M,T,I,O,R,B,V,w,K,G,me,ae,fe,_e)}emplace(r,a,u,h,m,v,b,M,T,I,O,R,B,V,w,K,G,me,ae,fe,_e,ve){const Re=30*r,ke=15*r,$e=60*r;return this.int16[Re+0]=a,this.int16[Re+1]=u,this.int16[Re+2]=h,this.float32[ke+2]=m,this.float32[ke+3]=v,this.uint16[Re+8]=b,this.uint16[Re+9]=M,this.uint32[ke+5]=T,this.uint32[ke+6]=I,this.uint32[ke+7]=O,this.uint16[Re+16]=R,this.uint16[Re+17]=B,this.uint16[Re+18]=V,this.float32[ke+10]=w,this.float32[ke+11]=K,this.uint8[$e+48]=G,this.uint8[$e+49]=me,this.uint8[$e+50]=ae,this.uint32[ke+13]=fe,this.int16[Re+28]=_e,this.uint8[$e+58]=ve,r}}dn.prototype.bytesPerElement=60,Tt(dn,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class $n extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,a,u,h,m,v,b,M,T,I,O,R,B,V,w,K,G,me,ae,fe,_e,ve,Re,ke,$e,rt,Ne,Ye,Xe,nt){const ct=this.length;return this.resize(ct+1),this.emplace(ct,r,a,u,h,m,v,b,M,T,I,O,R,B,V,w,K,G,me,ae,fe,_e,ve,Re,ke,$e,rt,Ne,Ye,Xe,nt)}emplace(r,a,u,h,m,v,b,M,T,I,O,R,B,V,w,K,G,me,ae,fe,_e,ve,Re,ke,$e,rt,Ne,Ye,Xe,nt,ct){const Ue=38*r,yt=19*r;return this.int16[Ue+0]=a,this.int16[Ue+1]=u,this.int16[Ue+2]=h,this.float32[yt+2]=m,this.float32[yt+3]=v,this.int16[Ue+8]=b,this.int16[Ue+9]=M,this.int16[Ue+10]=T,this.int16[Ue+11]=I,this.int16[Ue+12]=O,this.int16[Ue+13]=R,this.uint16[Ue+14]=B,this.uint16[Ue+15]=V,this.uint16[Ue+16]=w,this.uint16[Ue+17]=K,this.uint16[Ue+18]=G,this.uint16[Ue+19]=me,this.uint16[Ue+20]=ae,this.uint16[Ue+21]=fe,this.uint16[Ue+22]=_e,this.uint16[Ue+23]=ve,this.uint16[Ue+24]=Re,this.uint16[Ue+25]=ke,this.uint16[Ue+26]=$e,this.uint16[Ue+27]=rt,this.uint16[Ue+28]=Ne,this.uint32[yt+15]=Ye,this.float32[yt+16]=Xe,this.float32[yt+17]=nt,this.float32[yt+18]=ct,r}}$n.prototype.bytesPerElement=76,Tt($n,"StructArrayLayout3i2f6i15ui1ul3f76");class Hn extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.float32[1*r+0]=a,r}}Hn.prototype.bytesPerElement=4,Tt(Hn,"StructArrayLayout1f4");class Gn extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,u,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,r,a,u,h,m)}emplace(r,a,u,h,m,v){const b=5*r;return this.float32[b+0]=a,this.float32[b+1]=u,this.float32[b+2]=h,this.float32[b+3]=m,this.float32[b+4]=v,r}}Gn.prototype.bytesPerElement=20,Tt(Gn,"StructArrayLayout5f20");class Ii extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,u,h){const m=this.length;return this.resize(m+1),this.emplace(m,r,a,u,h)}emplace(r,a,u,h,m){const v=6*r;return this.uint32[3*r+0]=a,this.uint16[v+2]=u,this.uint16[v+3]=h,this.uint16[v+4]=m,r}}Ii.prototype.bytesPerElement=12,Tt(Ii,"StructArrayLayout1ul3ui12");class dr extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a){const u=this.length;return this.resize(u+1),this.emplace(u,r,a)}emplace(r,a,u){const h=2*r;return this.uint16[h+0]=a,this.uint16[h+1]=u,r}}dr.prototype.bytesPerElement=4,Tt(dr,"StructArrayLayout2ui4");class So extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.uint16[1*r+0]=a,r}}So.prototype.bytesPerElement=2,Tt(So,"StructArrayLayout1ui2");class Ko extends Se{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a){const u=this.length;return this.resize(u+1),this.emplace(u,r,a)}emplace(r,a,u){const h=2*r;return this.float32[h+0]=a,this.float32[h+1]=u,r}}Ko.prototype.bytesPerElement=8,Tt(Ko,"StructArrayLayout2f8");class ai extends we{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ai.prototype.size=40;class Un extends Ht{get(r){return new ai(this,r)}}Tt(Un,"CollisionBoxArray");class On extends we{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}On.prototype.size=60;class Nt extends dn{get(r){return new On(this,r)}}Tt(Nt,"PlacedSymbolArray");class kr extends we{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(r){this._structArray.uint32[this._pos4+15]=r}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}kr.prototype.size=76;class fi extends $n{get(r){return new kr(this,r)}}Tt(fi,"SymbolInstanceArray");class Jr extends Hn{getoffsetX(r){return this.float32[1*r+0]}}Tt(Jr,"GlyphOffsetArray");class hd extends ot{getx(r){return this.int16[2*r+0]}gety(r){return this.int16[2*r+1]}}Tt(hd,"SymbolLineVertexArray");class il extends we{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}il.prototype.size=12;class tc extends Ii{get(r){return new il(this,r)}}Tt(tc,"FeatureIndexArray");class Qr extends dr{geta_centroid_pos0(r){return this.uint16[2*r+0]}geta_centroid_pos1(r){return this.uint16[2*r+1]}}Tt(Qr,"FillExtrusionCentroidArray");const xa=Ee([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),rl=Ee([{name:"a_dash",components:4,type:"Uint16"}]);var pd={exports:{}},Bn=function(s,r){var a,u,h,m,v,b,M,T;for(u=s.length-(a=3&s.length),h=r,v=3432918353,b=461845907,T=0;T<u;)M=255&s.charCodeAt(T)|(255&s.charCodeAt(++T))<<8|(255&s.charCodeAt(++T))<<16|(255&s.charCodeAt(++T))<<24,++T,h=27492+(65535&(m=5*(65535&(h=(h^=M=(65535&(M=(M=(65535&M)*v+(((M>>>16)*v&65535)<<16)&4294967295)<<15|M>>>17))*b+(((M>>>16)*b&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(M=0,a){case 3:M^=(255&s.charCodeAt(T+2))<<16;case 2:M^=(255&s.charCodeAt(T+1))<<8;case 1:h^=M=(65535&(M=(M=(65535&(M^=255&s.charCodeAt(T)))*v+(((M>>>16)*v&65535)<<16)&4294967295)<<15|M>>>17))*b+(((M>>>16)*b&65535)<<16)&4294967295}return h^=s.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0},ce=function(s,r){for(var a,u=s.length,h=r^u,m=0;u>=4;)a=1540483477*(65535&(a=255&s.charCodeAt(m)|(255&s.charCodeAt(++m))<<8|(255&s.charCodeAt(++m))<<16|(255&s.charCodeAt(++m))<<24))+((1540483477*(a>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),u-=4,++m;switch(u){case 3:h^=(255&s.charCodeAt(m+2))<<16;case 2:h^=(255&s.charCodeAt(m+1))<<8;case 1:h=1540483477*(65535&(h^=255&s.charCodeAt(m)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0};pd.exports=Bn,pd.exports.murmur3=Bn,pd.exports.murmur2=ce;var le=io(pd.exports);class yr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,a,u,h){this.ids.push(Bm(r)),this.positions.push(a,u,h)}getPositions(r){const a=Bm(r);let u=0,h=this.ids.length-1;for(;u<h;){const v=u+h>>1;this.ids[v]>=a?h=v:u=v+1}const m=[];for(;this.ids[u]===a;)m.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return m}static serialize(r,a){const u=new Float64Array(r.ids),h=new Uint32Array(r.positions);return ru(u,h,0,u.length-1),a&&a.push(u.buffer,h.buffer),{ids:u,positions:h}}static deserialize(r){const a=new yr;return a.ids=r.ids,a.positions=r.positions,a.indexed=!0,a}}function Bm(s){const r=+s;return!isNaN(r)&&Number.MIN_SAFE_INTEGER<=r&&r<=Number.MAX_SAFE_INTEGER?r:le(String(s))}function ru(s,r,a,u){for(;a<u;){const h=s[a+u>>1];let m=a-1,v=u+1;for(;;){do{m++}while(s[m]<h);do{v--}while(s[v]>h);if(m>=v)break;Jo(s,m,v),Jo(r,3*m,3*v),Jo(r,3*m+1,3*v+1),Jo(r,3*m+2,3*v+2)}v-a<u-v?(ru(s,r,a,v),a=v+1):(ru(s,r,v+1,u),u=v)}}function Jo(s,r,a){const u=s[r];s[r]=s[a],s[a]=u}Tt(yr,"FeaturePositionMap");class qs{constructor(r){this.gl=r.gl,this.initialized=!1}fetchUniformLocation(r,a){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(r,a),this.initialized=!0),!!this.location}}class fd extends qs{constructor(r){super(r),this.current=0}set(r,a,u){this.fetchUniformLocation(r,a)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class p1 extends qs{constructor(r){super(r),this.current=[0,0,0,0]}set(r,a,u){this.fetchUniformLocation(r,a)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class px extends qs{constructor(r){super(r),this.current=Oi.transparent}set(r,a,u){this.fetchUniformLocation(r,a)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const f1=new Float32Array(16),lo=new Float32Array(9),ol=new Float32Array(4);function Mf(s){return[be(255*s.r,255*s.g),be(255*s.b,255*s.a)]}class ba{constructor(r,a,u){this.value=r,this.uniformNames=a.map(h=>`u_${h}`),this.type=u}setUniform(r,a,u,h,m){a.set(r,m,h.constantOr(this.value))}getBinding(r,a){return"color"===this.type?new px(r):new fd(r)}}class Io{constructor(r,a){this.uniformNames=a.map(u=>`u_${u}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(r){this.pixelRatio=r.pixelRatio||1,this.pattern=r.tl.concat(r.br)}setUniform(r,a,u,h,m){const v="u_pattern"===m||"u_dash"===m?this.pattern:"u_pixel_ratio"===m?this.pixelRatio:null;v&&a.set(r,m,v)}getBinding(r,a){return"u_pattern"===a||"u_dash"===a?new p1(r):new fd(r)}}class sl{constructor(r,a,u,h){this.expression=r,this.type=u,this.maxValue=0,this.paintVertexAttributes=a.map(m=>({name:`a_${m}`,type:"Float32",components:"color"===u?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(r,a,u,h,m,v){const b=this.paintVertexArray.length,M=this.expression.evaluate(new k(0),a,{},m,h,v);this.paintVertexArray.resize(r),this._setPaintValue(b,r,M)}updatePaintArray(r,a,u,h,m){const v=this.expression.evaluate({zoom:0},u,h,void 0,m);this._setPaintValue(r,a,v)}_setPaintValue(r,a,u){if("color"===this.type){const h=Mf(u);for(let m=r;m<a;m++)this.paintVertexArray.emplace(m,h[0],h[1])}else{for(let h=r;h<a;h++)this.paintVertexArray.emplace(h,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class xs{constructor(r,a,u,h,m,v){this.expression=r,this.uniformNames=a.map(b=>`u_${b}_t`),this.type=u,this.useIntegerZoom=h,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=a.map(b=>({name:`a_${b}`,type:"Float32",components:"color"===u?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(r,a,u,h,m,v){const b=this.expression.evaluate(new k(this.zoom),a,{},m,h,v),M=this.expression.evaluate(new k(this.zoom+1),a,{},m,h,v),T=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(T,r,b,M)}updatePaintArray(r,a,u,h,m){const v=this.expression.evaluate({zoom:this.zoom},u,h,void 0,m),b=this.expression.evaluate({zoom:this.zoom+1},u,h,void 0,m);this._setPaintValue(r,a,v,b)}_setPaintValue(r,a,u,h){if("color"===this.type){const m=Mf(u),v=Mf(h);for(let b=r;b<a;b++)this.paintVertexArray.emplace(b,m[0],m[1],v[0],v[1])}else{for(let m=r;m<a;m++)this.paintVertexArray.emplace(m,u,h);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(h))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,a,u,h,m){const v=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,b=yn(this.expression.interpolationFactor(v,this.zoom,this.zoom+1),0,1);a.set(r,m,b)}getBinding(r,a){return new fd(r)}}class nc{constructor(r,a,u,h,m){this.expression=r,this.layerId=m,this.paintVertexAttributes=("array"===u?rl:xa).members;for(let v=0;v<a.length;++v);this.paintVertexArray=new h}populatePaintArray(r,a,u){const h=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValues(h,r,a.patterns&&a.patterns[this.layerId],u)}updatePaintArray(r,a,u,h,m,v){this._setPaintValues(r,a,u.patterns&&u.patterns[this.layerId],v)}_setPaintValues(r,a,u,h){if(!h||!u)return;const m=h[u];if(!m)return;const{tl:v,br:b,pixelRatio:M}=m;for(let T=r;T<a;T++)this.paintVertexArray.emplace(T,v[0],v[1],b[0],b[1],M)}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ic{constructor(r,a,u=(()=>!0)){this.binders={},this._buffers=[];const h=[];for(const m in r.paint._values){if(!u(m))continue;const v=r.paint.get(m);if(!(v instanceof ie&&cr(v.property.specification)))continue;const b=g1(m,r.type),M=v.value,T=v.property.specification.type,I=!!v.property.useIntegerZoom,O="line-dasharray"===m||m.endsWith("pattern"),R="line-dasharray"===m&&"constant"!==r.layout.get("line-cap").value.kind;if("constant"!==M.kind||R)if("source"===M.kind||R||O){const B=jm(m,T,"source");this.binders[m]=O?new nc(M,b,T,B,r.id):new sl(M,b,T,B),h.push(`/a_${m}`)}else{const B=jm(m,T,"composite");this.binders[m]=new xs(M,b,T,I,a,B),h.push(`/z_${m}`)}else this.binders[m]=O?new Io(M.value,b):new ba(M.value,b,T),h.push(`/u_${m}`)}this.cacheKey=h.sort().join("")}getMaxValue(r){const a=this.binders[r];return a instanceof sl||a instanceof xs?a.maxValue:0}populatePaintArrays(r,a,u,h,m,v){for(const b in this.binders){const M=this.binders[b];(M instanceof sl||M instanceof xs||M instanceof nc)&&M.populatePaintArray(r,a,u,h,m,v)}}setConstantPatternPositions(r){for(const a in this.binders){const u=this.binders[a];u instanceof Io&&u.setConstantPatternPositions(r)}}updatePaintArrays(r,a,u,h,m,v){let b=!1;for(const M in r){const T=a.getPositions(M);for(const I of T){const O=u.feature(I.index);for(const R in this.binders){const B=this.binders[R];if((B instanceof sl||B instanceof xs||B instanceof nc)&&!0===B.expression.isStateDependent){const V=h.paint.get(R);B.expression=V.value,B.updatePaintArray(I.start,I.end,O,r[M],m,v),b=!0}}}}return b}defines(){const r=[];for(const a in this.binders){const u=this.binders[a];(u instanceof ba||u instanceof Io)&&r.push(...u.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return r}getBinderAttributes(){const r=[];for(const a in this.binders){const u=this.binders[a];if(u instanceof sl||u instanceof xs||u instanceof nc)for(let h=0;h<u.paintVertexAttributes.length;h++)r.push(u.paintVertexAttributes[h].name)}return r}getBinderUniforms(){const r=[];for(const a in this.binders){const u=this.binders[a];if(u instanceof ba||u instanceof Io||u instanceof xs)for(const h of u.uniformNames)r.push(h)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r){const a=[];for(const u in this.binders){const h=this.binders[u];if(h instanceof ba||h instanceof Io||h instanceof xs)for(const m of h.uniformNames)a.push({name:m,property:u,binding:h.getBinding(r,m)})}return a}setUniforms(r,a,u,h,m){for(const{name:v,property:b,binding:M}of u)this.binders[b].setUniform(r,M,m,h.get(b),v)}updatePaintBuffers(){this._buffers=[];for(const r in this.binders){const a=this.binders[r];(a instanceof sl||a instanceof xs||a instanceof nc)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(r){for(const a in this.binders){const u=this.binders[a];(u instanceof sl||u instanceof xs||u instanceof nc)&&u.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const a=this.binders[r];(a instanceof sl||a instanceof xs||a instanceof nc)&&a.destroy()}}}class al{constructor(r,a,u=(()=>!0)){this.programConfigurations={};for(const h of r)this.programConfigurations[h.id]=new ic(h,a,u);this.needsUpload=!1,this._featureMap=new yr,this._bufferOffset=0}populatePaintArrays(r,a,u,h,m,v,b){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(r,a,h,m,v,b);void 0!==a.id&&this._featureMap.add(a.id,u,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,a,u,h,m){for(const v of u)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(r,this._featureMap,a,v,h,m)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const Vm={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function g1(s,r){return Vm[s]||[s.replace(`${r}-`,"").replace(/-/g,"_")]}const Um={"line-pattern":{source:Le,composite:Le},"fill-pattern":{source:Le,composite:Le},"fill-extrusion-pattern":{source:Le,composite:Le},"line-dasharray":{source:Ge,composite:Ge}},fx={color:{source:Ko,composite:it},number:{source:Hn,composite:Ko}};function jm(s,r,a){const u=Um[s];return u&&u[a]||fx[r][a]}Tt(ba,"ConstantBinder"),Tt(Io,"PatternConstantBinder"),Tt(sl,"SourceExpressionBinder"),Tt(nc,"PatternCompositeBinder"),Tt(xs,"CompositeExpressionBinder"),Tt(ic,"ProgramConfiguration",{omit:["_buffers"]}),Tt(al,"ProgramConfigurationSet");const Ef="-transition";class bs extends Ll{constructor(r,a){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==r.type&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,"background"!==r.type&&"sky"!==r.type&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),a.layout&&(this._unevaluatedLayout=new re(a.layout)),a.paint)){this._transitionablePaint=new j(a.paint);for(const u in r.paint)this.setPaintProperty(u,r.paint[u],{validate:!1});for(const u in r.layout)this.setLayoutProperty(u,r.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new se(a.paint)}}getLayoutProperty(r){return"visibility"===r?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,a,u={}){null!=a&&this._validate(d1,`layers.${this.id}.layout.${r}`,r,a,u)||("visibility"!==r?this._unevaluatedLayout.setValue(r,a):this.visibility=a)}getPaintProperty(r){return ei(r,Ef)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}setPaintProperty(r,a,u={}){if(null!=a&&this._validate(Fm,`layers.${this.id}.paint.${r}`,r,a,u))return!1;if(ei(r,Ef))return this._transitionablePaint.setTransition(r.slice(0,-11),a||void 0),!1;{const h=this._transitionablePaint._values[r],m=h.value.isDataDriven(),v=h.value;this._transitionablePaint.setValue(r,a),this._handleSpecialPaintPropertyUpdate(r);const b=this._transitionablePaint._values[r].value,M=b.isDataDriven(),T=ei(r,"pattern")||"line-dasharray"===r;return M||m||T||this._handleOverridablePaintPropertyUpdate(r,v,b)}}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getProgramConfiguration(r){return null}_handleOverridablePaintPropertyUpdate(r,a,u){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||"none"===this.visibility}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,a){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,a)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),En(r,(a,u)=>!(void 0===a||"layout"===u&&!Object.keys(a).length||"paint"===u&&!Object.keys(a).length))}_validate(r,a,u,h,m={}){return(!m||!1!==m.validate)&&mf(this,r.call(gf,{key:a,layerType:this.type,objectKey:u,value:h,styleSpec:je,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const a=this.paint.get(r);if(a instanceof ie&&cr(a.property.specification)&&("source"===a.value.kind||"composite"===a.value.kind)&&a.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Hs(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const m1=Ee([{name:"a_pos",components:2,type:"Int16"}],4),_1=Ee([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Fi{constructor(r=[]){this.segments=r}prepareSegment(r,a,u,h){let m=this.segments[this.segments.length-1];return r>Fi.MAX_VERTEX_ARRAY_LENGTH&&oi(`Max vertices per segment is ${Fi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!m||m.vertexLength+r>Fi.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==h)&&(m={vertexOffset:a.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},void 0!==h&&(m.sortKey=h),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const r of this.segments)for(const a in r.vaos)r.vaos[a].destroy()}static simpleSegment(r,a,u,h){return new Fi([{vertexOffset:r,primitiveOffset:a,vertexLength:u,primitiveLength:h,vaos:{},sortKey:0}])}}Fi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Tt(Fi,"SegmentVector");var Bt=8192;class rc{constructor(r,a){r&&(a?this.setSouthWest(r).setNorthEast(a):4===r.length?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof qn?new qn(r.lng,r.lat):qn.convert(r),this}setSouthWest(r){return this._sw=r instanceof qn?new qn(r.lng,r.lat):qn.convert(r),this}extend(r){const a=this._sw,u=this._ne;let h,m;if(r instanceof qn)h=r,m=r;else{if(!(r instanceof rc))return Array.isArray(r)?4===r.length||r.every(Array.isArray)?this.extend(rc.convert(r)):this.extend(qn.convert(r)):"object"==typeof r&&null!==r&&r.hasOwnProperty("lat")&&(r.hasOwnProperty("lon")||r.hasOwnProperty("lng"))?this.extend(qn.convert(r)):this;if(h=r._sw,m=r._ne,!h||!m)return this}return a||u?(a.lng=Math.min(h.lng,a.lng),a.lat=Math.min(h.lat,a.lat),u.lng=Math.max(m.lng,u.lng),u.lat=Math.max(m.lat,u.lat)):(this._sw=new qn(h.lng,h.lat),this._ne=new qn(m.lng,m.lat)),this}getCenter(){return new qn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new qn(this.getWest(),this.getNorth())}getSouthEast(){return new qn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:a,lat:u}=qn.convert(r);let h=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&h}static convert(r){return!r||r instanceof rc?r:new rc(r)}}var Tf=1e-6,gi=typeof Float32Array<"u"?Float32Array:Array;function oc(){var s=new gi(9);return gi!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function Ni(s,r,a){var u=r[0],h=r[1],m=r[2],v=r[3],b=r[4],M=r[5],T=r[6],I=r[7],O=r[8],R=a[0],B=a[1],V=a[2],w=a[3],K=a[4],G=a[5],me=a[6],ae=a[7],fe=a[8];return s[0]=R*u+B*v+V*T,s[1]=R*h+B*b+V*I,s[2]=R*m+B*M+V*O,s[3]=w*u+K*v+G*T,s[4]=w*h+K*b+G*I,s[5]=w*m+K*M+G*O,s[6]=me*u+ae*v+fe*T,s[7]=me*h+ae*b+fe*I,s[8]=me*m+ae*M+fe*O,s}function xt(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function $m(s,r){var a=r[0],u=r[1],h=r[2],m=r[3],v=r[4],b=r[5],M=r[6],T=r[7],I=r[8],O=r[9],R=r[10],B=r[11],V=r[12],w=r[13],K=r[14],G=r[15],me=a*b-u*v,ae=a*M-h*v,fe=a*T-m*v,_e=u*M-h*b,ve=u*T-m*b,Re=h*T-m*M,ke=I*w-O*V,$e=I*K-R*V,rt=I*G-B*V,Ne=O*K-R*w,Ye=O*G-B*w,Xe=R*G-B*K,nt=me*Xe-ae*Ye+fe*Ne+_e*rt-ve*$e+Re*ke;return nt?(s[0]=(b*Xe-M*Ye+T*Ne)*(nt=1/nt),s[1]=(h*Ye-u*Xe-m*Ne)*nt,s[2]=(w*Re-K*ve+G*_e)*nt,s[3]=(R*ve-O*Re-B*_e)*nt,s[4]=(M*rt-v*Xe-T*$e)*nt,s[5]=(a*Xe-h*rt+m*$e)*nt,s[6]=(K*fe-V*Re-G*ae)*nt,s[7]=(I*Re-R*fe+B*ae)*nt,s[8]=(v*Ye-b*rt+T*ke)*nt,s[9]=(u*rt-a*Ye-m*ke)*nt,s[10]=(V*ve-w*fe+G*me)*nt,s[11]=(O*fe-I*ve-B*me)*nt,s[12]=(b*$e-v*Ne-M*ke)*nt,s[13]=(a*Ne-u*$e+h*ke)*nt,s[14]=(w*ae-V*_e-K*me)*nt,s[15]=(I*_e-O*ae+R*me)*nt,s):null}function eo(s,r,a){var u=r[0],h=r[1],m=r[2],v=r[3],b=r[4],M=r[5],T=r[6],I=r[7],O=r[8],R=r[9],B=r[10],V=r[11],w=r[12],K=r[13],G=r[14],me=r[15],ae=a[0],fe=a[1],_e=a[2],ve=a[3];return s[0]=ae*u+fe*b+_e*O+ve*w,s[1]=ae*h+fe*M+_e*R+ve*K,s[2]=ae*m+fe*T+_e*B+ve*G,s[3]=ae*v+fe*I+_e*V+ve*me,s[4]=(ae=a[4])*u+(fe=a[5])*b+(_e=a[6])*O+(ve=a[7])*w,s[5]=ae*h+fe*M+_e*R+ve*K,s[6]=ae*m+fe*T+_e*B+ve*G,s[7]=ae*v+fe*I+_e*V+ve*me,s[8]=(ae=a[8])*u+(fe=a[9])*b+(_e=a[10])*O+(ve=a[11])*w,s[9]=ae*h+fe*M+_e*R+ve*K,s[10]=ae*m+fe*T+_e*B+ve*G,s[11]=ae*v+fe*I+_e*V+ve*me,s[12]=(ae=a[12])*u+(fe=a[13])*b+(_e=a[14])*O+(ve=a[15])*w,s[13]=ae*h+fe*M+_e*R+ve*K,s[14]=ae*m+fe*T+_e*B+ve*G,s[15]=ae*v+fe*I+_e*V+ve*me,s}function Bh(s,r,a){var u,h,m,v,b,M,T,I,O,R,B,V,w=a[0],K=a[1],G=a[2];return r===s?(s[12]=r[0]*w+r[4]*K+r[8]*G+r[12],s[13]=r[1]*w+r[5]*K+r[9]*G+r[13],s[14]=r[2]*w+r[6]*K+r[10]*G+r[14],s[15]=r[3]*w+r[7]*K+r[11]*G+r[15]):(h=r[1],m=r[2],v=r[3],b=r[4],M=r[5],T=r[6],I=r[7],O=r[8],R=r[9],B=r[10],V=r[11],s[0]=u=r[0],s[1]=h,s[2]=m,s[3]=v,s[4]=b,s[5]=M,s[6]=T,s[7]=I,s[8]=O,s[9]=R,s[10]=B,s[11]=V,s[12]=u*w+b*K+O*G+r[12],s[13]=h*w+M*K+R*G+r[13],s[14]=m*w+T*K+B*G+r[14],s[15]=v*w+I*K+V*G+r[15]),s}function sc(s,r,a){var u=a[0],h=a[1],m=a[2];return s[0]=r[0]*u,s[1]=r[1]*u,s[2]=r[2]*u,s[3]=r[3]*u,s[4]=r[4]*h,s[5]=r[5]*h,s[6]=r[6]*h,s[7]=r[7]*h,s[8]=r[8]*m,s[9]=r[9]*m,s[10]=r[10]*m,s[11]=r[11]*m,s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15],s}function Df(s,r,a){var u=Math.sin(a),h=Math.cos(a),m=r[4],v=r[5],b=r[6],M=r[7],T=r[8],I=r[9],O=r[10],R=r[11];return r!==s&&(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[4]=m*h+T*u,s[5]=v*h+I*u,s[6]=b*h+O*u,s[7]=M*h+R*u,s[8]=T*h-m*u,s[9]=I*h-v*u,s[10]=O*h-b*u,s[11]=R*h-M*u,s}function ou(s,r,a){var u=Math.sin(a),h=Math.cos(a),m=r[0],v=r[1],b=r[2],M=r[3],T=r[8],I=r[9],O=r[10],R=r[11];return r!==s&&(s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[0]=m*h-T*u,s[1]=v*h-I*u,s[2]=b*h-O*u,s[3]=M*h-R*u,s[8]=m*u+T*h,s[9]=v*u+I*h,s[10]=b*u+O*h,s[11]=M*u+R*h,s}function ll(s,r){return s[0]=r[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=r[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=r[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function v1(s,r,a){var u,h,m,v=a[0],b=a[1],M=a[2],T=Math.hypot(v,b,M);return T<Tf?null:(v*=T=1/T,b*=T,M*=T,u=Math.sin(r),h=Math.cos(r),s[0]=v*v*(m=1-h)+h,s[1]=b*v*m+M*u,s[2]=M*v*m-b*u,s[3]=0,s[4]=v*b*m-M*u,s[5]=b*b*m+h,s[6]=M*b*m+v*u,s[7]=0,s[8]=v*M*m+b*u,s[9]=b*M*m-v*u,s[10]=M*M*m+h,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s)}Math.hypot||(Math.hypot=function(){for(var s=0,r=arguments.length;r--;)s+=arguments[r]*arguments[r];return Math.sqrt(s)});var Sf=eo;function gd(){var s=new gi(3);return gi!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function Vh(s){var r=new gi(3);return r[0]=s[0],r[1]=s[1],r[2]=s[2],r}function su(s){return Math.hypot(s[0],s[1],s[2])}function au(s,r,a){var u=new gi(3);return u[0]=s,u[1]=r,u[2]=a,u}function wa(s,r,a){return s[0]=r[0]+a[0],s[1]=r[1]+a[1],s[2]=r[2]+a[2],s}function Hm(s,r,a){return s[0]=r[0]-a[0],s[1]=r[1]-a[1],s[2]=r[2]-a[2],s}function lu(s,r,a){return s[0]=r[0]*a[0],s[1]=r[1]*a[1],s[2]=r[2]*a[2],s}function cl(s,r,a){return s[0]=Math.min(r[0],a[0]),s[1]=Math.min(r[1],a[1]),s[2]=Math.min(r[2],a[2]),s}function Uh(s,r,a){return s[0]=Math.max(r[0],a[0]),s[1]=Math.max(r[1],a[1]),s[2]=Math.max(r[2],a[2]),s}function ws(s,r,a){return s[0]=r[0]*a,s[1]=r[1]*a,s[2]=r[2]*a,s}function cu(s,r,a,u){return s[0]=r[0]+a[0]*u,s[1]=r[1]+a[1]*u,s[2]=r[2]+a[2]*u,s}function co(s,r){var a=r[0],u=r[1],h=r[2],m=a*a+u*u+h*h;return m>0&&(m=1/Math.sqrt(m)),s[0]=r[0]*m,s[1]=r[1]*m,s[2]=r[2]*m,s}function Cs(s,r){return s[0]*r[0]+s[1]*r[1]+s[2]*r[2]}function Gm(s,r,a){var u=r[0],h=r[1],m=r[2],v=a[0],b=a[1],M=a[2];return s[0]=h*M-m*b,s[1]=m*v-u*M,s[2]=u*b-h*v,s}function Gi(s,r,a){var u=r[0],h=r[1],m=r[2],v=a[3]*u+a[7]*h+a[11]*m+a[15];return s[0]=(a[0]*u+a[4]*h+a[8]*m+a[12])/(v=v||1),s[1]=(a[1]*u+a[5]*h+a[9]*m+a[13])/v,s[2]=(a[2]*u+a[6]*h+a[10]*m+a[14])/v,s}function gx(s,r,a){var u=a[0],h=a[1],m=a[2],v=r[0],b=r[1],M=r[2],T=h*M-m*b,I=m*v-u*M,O=u*b-h*v,R=h*O-m*I,B=m*T-u*O,V=u*I-h*T,w=2*a[3];return I*=w,O*=w,B*=2,V*=2,s[0]=v+(T*=w)+(R*=2),s[1]=b+I+B,s[2]=M+O+V,s}var uu,uo=Hm,mx=lu,jh=su;function If(s,r,a){return s[0]=r[0]*a,s[1]=r[1]*a,s[2]=r[2]*a,s[3]=r[3]*a,s}function $h(s,r){var a=r[0],u=r[1],h=r[2],m=r[3],v=a*a+u*u+h*h+m*m;return v>0&&(v=1/Math.sqrt(v)),s[0]=a*v,s[1]=u*v,s[2]=h*v,s[3]=m*v,s}function md(s,r,a){var u=r[0],h=r[1],m=r[2],v=r[3];return s[0]=a[0]*u+a[4]*h+a[8]*m+a[12]*v,s[1]=a[1]*u+a[5]*h+a[9]*m+a[13]*v,s[2]=a[2]*u+a[6]*h+a[10]*m+a[14]*v,s[3]=a[3]*u+a[7]*h+a[11]*m+a[15]*v,s}function qm(){var s=new gi(4);return gi!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function Zm(s){return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s}function y1(s,r,a){a*=.5;var u=r[0],h=r[1],m=r[2],v=r[3],b=Math.sin(a),M=Math.cos(a);return s[0]=u*M+v*b,s[1]=h*M+m*b,s[2]=m*M-h*b,s[3]=v*M-u*b,s}function Zs(s,r,a){a*=.5;var u=r[0],h=r[1],m=r[2],v=r[3],b=Math.sin(a),M=Math.cos(a);return s[0]=u*M-m*b,s[1]=h*M+v*b,s[2]=m*M+u*b,s[3]=v*M-h*b,s}gd(),uu=new gi(4),gi!=Float32Array&&(uu[0]=0,uu[1]=0,uu[2]=0,uu[3]=0);var _x=$h;gd(),au(1,0,0),au(0,1,0),qm(),qm(),oc();const Af=Ee([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Pf}=Af,Wm=Ee([{name:"a_pos_3",components:3,type:"Int16"}]);var ac=Ee([{name:"a_pos",type:"Int16",components:2}]);class Hh{constructor(r,a){this.pos=r,this.dir=a}intersectsPlane(r,a,u){const h=Cs(a,this.dir);if(Math.abs(h)<1e-6)return!1;const m=((r[0]-this.pos[0])*a[0]+(r[1]-this.pos[1])*a[1]+(r[2]-this.pos[2])*a[2])/h;return u[0]=this.pos[0]+this.dir[0]*m,u[1]=this.pos[1]+this.dir[1]*m,u[2]=this.pos[2]+this.dir[2]*m,!0}closestPointOnSphere(r,a,u){if(w=(B=this.pos)[0],K=B[1],G=B[2],me=(V=r)[0],ae=V[1],fe=V[2],Math.abs(w-me)<=Tf*Math.max(1,Math.abs(w),Math.abs(me))&&Math.abs(K-ae)<=Tf*Math.max(1,Math.abs(K),Math.abs(ae))&&Math.abs(G-fe)<=Tf*Math.max(1,Math.abs(G),Math.abs(fe))||0===a)return u[0]=u[1]=u[2]=0,!1;var B,V,w,K,G,me,ae,fe;const[h,m,v]=this.dir,b=this.pos[0]-r[0],M=this.pos[1]-r[1],T=this.pos[2]-r[2],I=h*h+m*m+v*v,O=2*(b*h+M*m+T*v),R=O*O-4*I*(b*b+M*M+T*T-a*a);if(R<0){const B=Math.max(-O/2,0),V=b+h*B,w=M+m*B,K=T+v*B,G=Math.hypot(V,w,K);return u[0]=V*a/G,u[1]=w*a/G,u[2]=K*a/G,!1}{const B=(-O-Math.sqrt(R))/(2*I);if(B<0){const V=Math.hypot(b,M,T);return u[0]=b*a/V,u[1]=M*a/V,u[2]=T*a/V,!1}return u[0]=b+h*B,u[1]=M+m*B,u[2]=T+v*B,!0}}}class Xm{constructor(r,a,u,h,m){this.TL=r,this.TR=a,this.BR=u,this.BL=h,this.horizon=m}static fromInvProjectionMatrix(r,a,u){const h=[-1,1,1],m=[1,1,1],v=[1,-1,1],b=[-1,-1,1],M=Gi(h,h,r),T=Gi(m,m,r),I=Gi(v,v,r),O=Gi(b,b,r);return new Xm(M,T,I,O,a/u)}}class kf{constructor(r,a){this.points=r,this.planes=a}static fromInvProjectionMatrix(r,a,u,h){const m=Math.pow(2,u),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(M=>{const T=md([],M,r),I=1/T[3]/a*m;return(O=T)[0]=(R=T)[0]*(B=[I,I,h?1/T[3]:I,I])[0],O[1]=R[1]*B[1],O[2]=R[2]*B[2],O[3]=R[3]*B[3],O;var O,R,B}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(M=>{const T=co([],Gm([],uo([],v[M[0]],v[M[1]]),uo([],v[M[2]],v[M[1]]))),I=-Cs(T,v[M[1]]);return T.concat(I)});return new kf(v,b)}}class $r{static fromPoints(r){const a=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const h of r)cl(a,a,h),Uh(u,u,h);return new $r(a,u)}static applyTransform(r,a){const u=r.getCorners();for(let h=0;h<u.length;++h)Gi(u[h],u[h],a);return $r.fromPoints(u)}constructor(r,a){this.min=r,this.max=a,this.center=ws([],wa([],this.min,this.max),.5)}quadrant(r){const a=[r%2==0,r<2],u=Vh(this.min),h=Vh(this.max);for(let m=0;m<a.length;m++)u[m]=a[m]?this.min[m]:this.center[m],h[m]=a[m]?this.center[m]:this.max[m];return h[2]=this.max[2],new $r(u,h)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,a=this.max;return[[r[0],r[1],r[2]],[a[0],r[1],r[2]],[a[0],a[1],r[2]],[r[0],a[1],r[2]],[r[0],r[1],a[2]],[a[0],r[1],a[2]],[a[0],a[1],a[2]],[r[0],a[1],a[2]]]}intersects(r){const a=this.getCorners();let u=!0;for(let h=0;h<r.planes.length;h++){const m=r.planes[h];let v=0;for(let b=0;b<a.length;b++)v+=Cs(m,a[b])+m[3]>=0;if(0===v)return 0;v!==a.length&&(u=!1)}if(u)return 2;for(let h=0;h<3;h++){let m=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let b=0;b<r.points.length;b++){const M=r.points[b][h]-this.min[h];m=Math.min(m,M),v=Math.max(v,M)}if(v<0||m>this.max[h]-this.min[h])return 0}return 1}}const Of=5,Ym=6,Ca=Bt/Math.PI/2,Lf=16383,Gh=[64,32,16],es=-Ca,ts=Ca,qh=[new $r([es,es,es],[ts,ts,ts]),new $r([es,es,es],[0,0,ts]),new $r([0,es,es],[ts,0,ts]),new $r([es,0,es],[0,ts,ts]),new $r([0,0,es],[ts,ts,ts])];function Rf(s){return s*Ca/qi}function to(s,r,a,u=!0){const h=ws([],s._camera.position,s.worldSize),m=[r,a,1,1];md(m,m,s.pixelMatrixInverse),If(m,m,1/m[3]);const v=co([],uo([],m,h)),b=s.globeMatrix,M=[b[12],b[13],b[14]],T=uo([],M,h),I=su(T),O=co([],T),R=s.worldSize/(2*Math.PI),B=Cs(O,v),V=Math.asin(R/I);if(V<Math.acos(B)){if(!u)return null;const rt=[],Ne=[];ws(rt,v,I/B),co(Ne,uo(Ne,rt,T)),co(v,wa(v,T,ws(v,Ne,Math.tan(V)*I)))}const w=[];new Hh(h,v).closestPointOnSphere(M,R,w);const K=co([],la(b,0)),G=co([],la(b,1)),me=co([],la(b,2)),ae=Cs(K,w),fe=Cs(G,w),_e=Cs(me,w),ve=gr(Math.asin(-fe/R));let Re=gr(Math.atan2(ae,_e));Re=s.center.lng+function(rt,Ne){const Ye=(Ne-rt+180)%360-180;return Ye<-180?Ye+360:Ye}(s.center.lng,Re);const ke=ho(Re),$e=yn(Ws(ve),0,1);return new Rr(ke,$e)}class vx{constructor(r,a,u){this.a=uo([],r,u),this.b=uo([],a,u),this.center=u;const h=co([],this.a),m=co([],this.b);this.angle=Math.acos(Cs(h,m))}}function nr(s,r){if(0===s.angle)return null;let a;return a=0===s.a[r]?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[r]/s.a[r]/Math.sin(s.angle)-1/Math.tan(s.angle)),a<0||a>1?null:function(u,h,m,v){const b=Math.sin(m);return u*(Math.sin((1-v)*m)/b)+h*(Math.sin(v*m)/b)}(s.a[r],s.b[r],s.angle,yn(a,0,1))+s.center[r]}function Ms(s){if(s.z<=1)return qh[s.z+2*s.y+s.x];const r=lc(ul(s));return $r.fromPoints(r)}function du(s,r,a){return ws(s,s,1-a),cu(s,s,r,a)}function Km(s,r){const a=Zh(r.zoom);if(0===a)return Ms(s);const u=ul(s),h=lc(u),m=ho(u.getWest())*r.worldSize,v=ho(u.getEast())*r.worldSize,b=Ws(u.getNorth())*r.worldSize,M=Ws(u.getSouth())*r.worldSize,T=[m,b,0],I=[v,b,0],O=[m,M,0],R=[v,M,0],B=$m([],r.globeMatrix);return Gi(T,T,B),Gi(I,I,B),Gi(O,O,B),Gi(R,R,B),h[0]=du(h[0],O,a),h[1]=du(h[1],R,a),h[2]=du(h[2],I,a),h[3]=du(h[3],T,a),$r.fromPoints(h)}function hu(s,r,a){for(const u of s)Gi(u,u,r),ws(u,u,a)}function ul({x:s,y:r,z:a}){const u=1/(1<<a),h=new qn(Hr(s*u),Or((r+1)*u)),m=new qn(Hr((s+1)*u),Or(r*u));return new rc(h,m)}function lc(s){const r=fn(s.getNorth()),a=fn(s.getSouth()),u=Math.cos(r),h=Math.cos(a),m=Math.sin(r),v=Math.sin(a),b=s.getWest(),M=s.getEast();return[pu(h,v,b),pu(h,v,M),pu(u,m,M),pu(u,m,b)]}function pu(s,r,a,u=Ca){return a=fn(a),[s*Math.sin(a)*u,-r*u,s*Math.cos(a)*u]}function cc(s,r,a){return pu(Math.cos(fn(s)),Math.sin(fn(s)),r,a)}function Ma(s,r,a,u){const h=1<<a.z,m=(s/Bt+a.x)/h;return cc(Or((r/Bt+a.y)/h),Hr(m),u)}function Jm({min:s,max:r}){return Lf/Math.max(r[0]-s[0],r[1]-s[1],r[2]-s[2])}const x1=new Float64Array(16);function Ff(s){const r=Jm(s),a=ll(x1,[r,r,r]);return Bh(a,a,((u=[])[0]=-(h=s.min)[0],u[1]=-h[1],u[2]=-h[2],u));var u,h}function b1(s){const r=(u=s.min,(a=x1)[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=u[0],a[13]=u[1],a[14]=u[2],a[15]=1,a);var a,u;const h=1/Jm(s);return sc(r,r,[h,h,h])}function yx(s,r,a,u,h){const m=function(M){const T=Bt/(2*Math.PI);return M/(2*Math.PI)/T}(a),v=[s,r,-a/(2*Math.PI)],b=xt(new Float64Array(16));return Bh(b,b,v),sc(b,b,[m,m,m]),Df(b,b,fn(-h)),ou(b,b,fn(-u)),b}function Zh(s){return za(Of,Ym,s)}function xx(s,r){const a=cc(r.lat,r.lng);return v=(h=Hm([],function(V){const w=cc(V._center.lat,V._center.lng);let K=Gm([],au(0,1,0),w);const G=v1([],-V.angle,w);K=Gi(K,K,G),v1(G,-V._pitch,K);const me=co([],w);return ws(me,me,Rf(V.cameraToCenterDistance/V.pixelsPerMeter)),Gi(me,me,G),wa([],w,me)}(s),a))[0],b=h[1],M=h[2],T=(m=a)[0],I=m[1],O=m[2],B=(R=Math.sqrt(v*v+b*b+M*M)*Math.sqrt(T*T+I*I+O*O))&&Cs(h,m)/R,Math.acos(Math.min(Math.max(B,-1),1));var h,m,v,b,M,T,I,O,R,B}function w1(s,r){return xx(s,r)>Math.PI/2*1.01}const fu=fn(85),bx=Math.cos(fu),wx=Math.sin(fu),qi=6371008.8,C1=2*Math.PI*qi;class Es{constructor(r,a){if(isNaN(r)||isNaN(a))throw new Error(`Invalid LngLat object: (${r}, ${a})`);if(this.lng=+r,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Es(xn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const a=Math.PI/180,u=this.lat*a,h=r.lat*a,m=Math.sin(u)*Math.sin(h)+Math.cos(u)*Math.cos(h)*Math.cos((r.lng-this.lng)*a);return qi*Math.acos(Math.min(m,1))}toBounds(r=0){const a=360*r/40075017,u=a/Math.cos(Math.PI/180*this.lat);return new rc(new Es(this.lng-u,this.lat-a),new Es(this.lng+u,this.lat+a))}toEcef(r){const a=Rf(r);return cc(this.lat,this.lng,Ca+a)}static convert(r){if(r instanceof Es)return r;if(Array.isArray(r)&&(2===r.length||3===r.length))return new Es(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&"object"==typeof r&&null!==r)return new Es(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var qn=Es;function Ao(s){return C1*Math.cos(s*Math.PI/180)}function ho(s){return(180+s)/360}function Ws(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function Po(s,r){return s/Ao(r)}function Hr(s){return 360*s-180}function Or(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function Cx(s,r){return s*Ao(Or(r))}const Lr=85.051129;function Mx(s){return 1/Math.cos(s*Math.PI/180)}class Rr{constructor(r,a,u=0){this.x=+r,this.y=+a,this.z=+u}static fromLngLat(r,a=0){const u=qn.convert(r);return new Rr(ho(u.lng),Ws(u.lat),Po(a,u.lat))}toLngLat(){return new qn(Hr(this.x),Or(this.y))}toAltitude(){return Cx(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/C1*Mx(Or(this.y))}}function Wh(s,r,a,u,h,m,v,b,M){const T=(r+u)/2,I=(a+h)/2,O=new _t(T,I);b(O),function(R,B,V,w,K,G){const me=V-K,ae=w-G;return Math.abs((w-B)*me-(V-R)*ae)/Math.hypot(me,ae)}(O.x,O.y,m.x,m.y,v.x,v.y)>=M?(Wh(s,r,a,T,I,m,O,b,M),Wh(s,T,I,u,h,O,v,b,M)):s.push(v)}function gu(s,r,a){let u=s[0],h=u.x,m=u.y;r(u);const v=[u];for(let b=1;b<s.length;b++){const M=s[b],{x:T,y:I}=M;r(M),Wh(v,h,m,T,I,u,M,r,a),h=T,m=I,u=M}return v}function M1(s,r,a,u){if(u(r,a)){const h=r.add(a)._mult(.5);M1(s,r,h,u),M1(s,h,a,u)}else s.push(a)}function E1(s,r){let a=s[0];const u=[a];for(let h=1;h<s.length;h++){const m=s[h];M1(u,a,m,r),a=m}return u}const Qm=Math.pow(2,14)-1,T1=-Qm-1;function Ex(s,r){const a=Math.round(s.x*r),u=Math.round(s.y*r);return s.x=yn(a,T1,Qm),s.y=yn(u,T1,Qm),(a<s.x||a>s.x+1||u<s.y||u>s.y+1)&&oi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function dl(s,r,a){const u=s.loadGeometry(),h=s.extent,m=Bt/h;if(r&&a&&a.projection.isReprojectedInTileSpace){const v=1<<r.z,{scale:b,x:M,y:T,projection:I}=a,O=R=>{const B=Hr((r.x+R.x/h)/v),V=Or((r.y+R.y/h)/v),w=I.project(B,V);R.x=(w.x*b-M)*h,R.y=(w.y*b-T)*h};for(let R=0;R<u.length;R++)if(1!==s.type)u[R]=gu(u[R],O,1);else{const B=[];for(const V of u[R])V.x<0||V.x>=h||V.y<0||V.y>=h||(O(V),B.push(V));u[R]=B}}for(const v of u)for(const b of v)Ex(b,m);return u}function mu(s,r){return{type:s.type,id:s.id,properties:s.properties,geometry:r?dl(s):[]}}function Nf(s,r,a,u,h){s.emplaceBack(2*r+(u+1)/2,2*a+(h+1)/2)}function vd(s,r,a){s.emplaceBack(r.x,r.y,r.z,16384*a[0],16384*a[1],16384*a[2])}class yd{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new ot,this.indexArray=new Pt,this.segments=new Fi,this.programConfigurations=new al(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(r,a,u,h){const m=this.layers[0],v=[];let b=null;"circle"===m.type&&(b=m.layout.get("circle-sort-key"));for(const{feature:T,id:I,index:O,sourceLayerIndex:R}of r){const B=this.layers[0]._featureFilter.needGeometry,V=mu(T,B);if(!this.layers[0]._featureFilter.filter(new k(this.zoom),V,u))continue;const w=b?b.evaluate(V,{},u):void 0,K={id:I,properties:T.properties,type:T.type,sourceLayerIndex:R,index:O,geometry:B?V.geometry:dl(T,u,h),patterns:{},sortKey:w};v.push(K)}b&&v.sort((T,I)=>T.sortKey-I.sortKey);let M=null;"globe"===h.projection.name&&(this.globeExtVertexArray=new tt,M=h.projection);for(const T of v){const{geometry:I,index:O,sourceLayerIndex:R}=T,B=r[O].feature;this.addFeature(T,I,O,a.availableImages,u,M),a.featureIndex.insert(B,I,O,R,this.index)}}update(r,a,u,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,u,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,m1.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,_1.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(r,a,u,h,m,v){for(const b of a)for(const M of b){const T=M.x,I=M.y;if(T<0||T>=Bt||I<0||I>=Bt)continue;if(v){const B=v.projectTilePoint(T,I,m),V=v.upVector(m,T,I),w=this.globeExtVertexArray;vd(w,B,V),vd(w,B,V),vd(w,B,V),vd(w,B,V)}const O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),R=O.vertexLength;Nf(this.layoutVertexArray,T,I,-1,-1),Nf(this.layoutVertexArray,T,I,1,-1),Nf(this.layoutVertexArray,T,I,1,1),Nf(this.layoutVertexArray,T,I,-1,1),this.indexArray.emplaceBack(R,R+1,R+2),this.indexArray.emplaceBack(R,R+2,R+3),O.vertexLength+=4,O.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,{},h,m)}}function D1(s,r){for(let a=0;a<s.length;a++)if(_u(r,s[a]))return!0;for(let a=0;a<r.length;a++)if(_u(s,r[a]))return!0;return!!e_(s,r)}function zf(s,r,a){return!!_u(s,r)||!!Xh(r,s,a)}function S1(s,r){if(1===s.length)return t_(r,s[0]);for(let a=0;a<r.length;a++){const u=r[a];for(let h=0;h<u.length;h++)if(_u(s,u[h]))return!0}for(let a=0;a<s.length;a++)if(t_(r,s[a]))return!0;for(let a=0;a<r.length;a++)if(e_(s,r[a]))return!0;return!1}function Bf(s,r,a){if(s.length>1){if(e_(s,r))return!0;for(let u=0;u<r.length;u++)if(Xh(r[u],s,a))return!0}for(let u=0;u<s.length;u++)if(Xh(s[u],r,a))return!0;return!1}function e_(s,r){if(0===s.length||0===r.length)return!1;for(let a=0;a<s.length-1;a++){const u=s[a],h=s[a+1];for(let m=0;m<r.length-1;m++)if(I1(u,h,r[m],r[m+1]))return!0}return!1}function I1(s,r,a,u){return vo(s,a,u)!==vo(r,a,u)&&vo(s,r,a)!==vo(s,r,u)}function Xh(s,r,a){const u=a*a;if(1===r.length)return s.distSqr(r[0])<u;for(let h=1;h<r.length;h++)if(Yh(s,r[h-1],r[h])<u)return!0;return!1}function Yh(s,r,a){const u=r.distSqr(a);if(0===u)return s.distSqr(r);const h=((s.x-r.x)*(a.x-r.x)+(s.y-r.y)*(a.y-r.y))/u;return s.distSqr(h<0?r:h>1?a:a.sub(r)._mult(h)._add(r))}function t_(s,r){let a,u,h,m=!1;for(let v=0;v<s.length;v++){a=s[v];for(let b=0,M=a.length-1;b<a.length;M=b++)u=a[b],h=a[M],u.y>r.y!=h.y>r.y&&r.x<(h.x-u.x)*(r.y-u.y)/(h.y-u.y)+u.x&&(m=!m)}return m}function _u(s,r){let a=!1;for(let u=0,h=s.length-1;u<s.length;h=u++){const m=s[u],v=s[h];m.y>r.y!=v.y>r.y&&r.x<(v.x-m.x)*(r.y-m.y)/(v.y-m.y)+m.x&&(a=!a)}return a}function A1(s,r,a,u,h){for(const v of s)if(r<=v.x&&a<=v.y&&u>=v.x&&h>=v.y)return!0;const m=[new _t(r,a),new _t(r,h),new _t(u,h),new _t(u,a)];if(s.length>2)for(const v of m)if(_u(s,v))return!0;for(let v=0;v<s.length-1;v++)if(xd(s[v],s[v+1],m))return!0;return!1}function xd(s,r,a){const u=a[0],h=a[2];if(s.x<u.x&&r.x<u.x||s.x>h.x&&r.x>h.x||s.y<u.y&&r.y<u.y||s.y>h.y&&r.y>h.y)return!1;const m=vo(s,r,a[0]);return m!==vo(s,r,a[1])||m!==vo(s,r,a[2])||m!==vo(s,r,a[3])}function Ea(s,r,a){const u=r.paint.get(s).value;return"constant"===u.kind?u.value:a.programConfigurations.get(r.id).getMaxValue(s)}function Vf(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function Tx(s,r,a,u,h){if(!r[0]&&!r[1])return s;const m=_t.convert(r)._mult(h);"viewport"===a&&m._rotate(-u);const v=[];for(let b=0;b<s.length;b++)v.push(s[b].sub(m));return v}function n_(s,r,a,u){const h=_t.convert(s)._mult(u);return"viewport"===r&&h._rotate(-a),h}Tt(yd,"CircleBucket",{omit:["layers"]});const Dx=new de({"circle-sort-key":new Q(je.layout_circle["circle-sort-key"])});var YC={paint:new de({"circle-radius":new Q(je.paint_circle["circle-radius"]),"circle-color":new Q(je.paint_circle["circle-color"]),"circle-blur":new Q(je.paint_circle["circle-blur"]),"circle-opacity":new Q(je.paint_circle["circle-opacity"]),"circle-translate":new $(je.paint_circle["circle-translate"]),"circle-translate-anchor":new $(je.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new $(je.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new $(je.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Q(je.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Q(je.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Q(je.paint_circle["circle-stroke-opacity"])}),layout:Dx};function P1(s,r,a,u,h,m,v,b,M){if(m&&s.queryGeometry.isAboveHorizon)return!1;m&&(M*=s.pixelToTileUnitsFactor);const T=s.tileID.canonical,I=a.projection.upVectorScale(T,a.center.lat,a.worldSize).metersToTile;for(const O of r)for(const R of O){const B=R.add(b),V=h&&a.elevation?a.elevation.exaggeration()*h.getElevationAt(B.x,B.y,!0):0,w=a.projection.projectTilePoint(B.x,B.y,T);if(V>0){const ae=a.projection.upVector(T,B.x,B.y);w.x+=ae[0]*I*V,w.y+=ae[1]*I*V,w.z+=ae[2]*I*V}const K=m?B:Sx(w.x,w.y,w.z,u),G=m?s.tilespaceRays.map(ae=>O1(ae,V)):s.queryGeometry.screenGeometry,me=md([],[w.x,w.y,w.z,1],u);if(!v&&m?M*=me[3]/a.cameraToCenterDistance:v&&!m&&(M*=a.cameraToCenterDistance/me[3]),m){const ae=Or((R.y/Bt+T.y)/(1<<T.z));M/=a.projection.pixelsPerMeter(ae,1)/Po(1,ae)}if(zf(G,K,M))return!0}return!1}function Sx(s,r,a,u){const h=md([],[s,r,a,1],u);return new _t(h[0]/h[3],h[1]/h[3])}const k1=au(0,0,0),Uf=au(0,0,1);function O1(s,r){const a=gd();return k1[2]=r,s.intersectsPlane(k1,Uf,a),new _t(a[0],a[1])}class L1 extends yd{}function i_(s,{width:r,height:a},u,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==r*a*u)throw new RangeError("mismatched image size")}else h=new Uint8Array(r*a*u);return s.width=r,s.height=a,s.data=h,s}function Ix(s,r,a){const{width:u,height:h}=r;u===s.width&&h===s.height||(jf(s,r,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,u),height:Math.min(s.height,h)},a),s.width=u,s.height=h,s.data=r.data)}function jf(s,r,a,u,h,m){if(0===h.width||0===h.height)return r;if(h.width>s.width||h.height>s.height||a.x>s.width-h.width||a.y>s.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>r.width||h.height>r.height||u.x>r.width-h.width||u.y>r.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const v=s.data,b=r.data;for(let M=0;M<h.height;M++){const T=((a.y+M)*s.width+a.x)*m,I=((u.y+M)*r.width+u.x)*m;for(let O=0;O<h.width*m;O++)b[I+O]=v[T+O]}return r}Tt(L1,"HeatmapBucket",{omit:["layers"]});class uc{constructor(r,a){i_(this,r,1,a)}resize(r){Ix(this,new uc(r),1)}clone(){return new uc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,a,u,h,m){jf(r,a,u,h,m,1)}}class ko{constructor(r,a){i_(this,r,4,a)}resize(r){Ix(this,new ko(r),4)}replace(r,a){a?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new ko({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,a,u,h,m){jf(r,a,u,h,m,4)}}Tt(uc,"AlphaImage"),Tt(ko,"RGBAImage");var Ax={paint:new de({"heatmap-radius":new Q(je.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Q(je.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new $(je.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ue(je.paint_heatmap["heatmap-color"]),"heatmap-opacity":new $(je.paint_heatmap["heatmap-opacity"])})};function Kh(s){const r={},a=s.resolution||256,u=s.clips?s.clips.length:1,h=s.image||new ko({width:a,height:u}),m=(v,b,M)=>{r[s.evaluationKey]=M;const T=s.expression.evaluate(r);h.data[v+b+0]=Math.floor(255*T.r/T.a),h.data[v+b+1]=Math.floor(255*T.g/T.a),h.data[v+b+2]=Math.floor(255*T.b/T.a),h.data[v+b+3]=Math.floor(255*T.a)};if(s.clips)for(let v=0,b=0;v<u;++v,b+=4*a)for(let M=0,T=0;M<a;M++,T+=4){const I=M/(a-1),{start:O,end:R}=s.clips[v];m(b,T,O*(1-I)+R*I)}else for(let v=0,b=0;v<a;v++,b+=4)m(0,b,v/(a-1));return h}var KC={paint:new de({"hillshade-illumination-direction":new $(je.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new $(je.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new $(je.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new $(je.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new $(je.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new $(je.paint_hillshade["hillshade-accent-color"])})};const JC=Ee([{name:"a_pos",components:2,type:"Int16"}],4),{members:r_}=JC;var R1={exports:{}};function o_(s,r,a){a=a||2;var u,h,m,v,b,M,T,I=r&&r.length,O=I?r[0]*a:s.length,R=Px(s,0,O,a,!0),B=[];if(!R||R.next===R.prev)return B;if(I&&(R=function(w,K,G,me){var ae,fe,_e,ve=[];for(ae=0,fe=K.length;ae<fe;ae++)(_e=Px(w,K[ae]*me,ae<fe-1?K[ae+1]*me:w.length,me,!1))===_e.next&&(_e.steiner=!0),ve.push(B1(_e));for(ve.sort(N1),ae=0;ae<ve.length;ae++)G=z1(ve[ae],G);return G}(s,r,R,a)),s.length>80*a){u=m=s[0],h=v=s[1];for(var V=a;V<O;V+=a)(b=s[V])<u&&(u=b),(M=s[V+1])<h&&(h=M),b>m&&(m=b),M>v&&(v=M);T=0!==(T=Math.max(m-u,v-h))?32767/T:0}return $f(R,B,a,u,h,T,0),B}function Px(s,r,a,u,h){var m,v;if(h===s_(s,r,a,u)>0)for(m=r;m<a;m+=u)v=j1(m,s[m],s[m+1],v);else for(m=a-u;m>=r;m-=u)v=j1(m,s[m],s[m+1],v);return v&&Wf(v,v.next)&&(Qh(v),v=v.next),v}function bd(s,r){if(!s)return s;r||(r=s);var a,u=s;do{if(a=!1,u.steiner||!Wf(u,u.next)&&0!==ni(u.prev,u,u.next))u=u.next;else{if(Qh(u),(u=r=u.prev)===u.next)break;a=!0}}while(a||u!==r);return r}function $f(s,r,a,u,h,m,v){if(s){!v&&m&&function(I,O,R,B){var V=I;do{0===V.z&&(V.z=qf(V.x,V.y,O,R,B)),V.prevZ=V.prev,V.nextZ=V.next,V=V.next}while(V!==I);V.prevZ.nextZ=null,V.prevZ=null,function(w){var K,G,me,ae,fe,_e,ve,Re,ke=1;do{for(G=w,w=null,fe=null,_e=0;G;){for(_e++,me=G,ve=0,K=0;K<ke&&(ve++,me=me.nextZ);K++);for(Re=ke;ve>0||Re>0&&me;)0!==ve&&(0===Re||!me||G.z<=me.z)?(ae=G,G=G.nextZ,ve--):(ae=me,me=me.nextZ,Re--),fe?fe.nextZ=ae:w=ae,ae.prevZ=fe,fe=ae;G=me}fe.nextZ=null,ke*=2}while(_e>1)}(V)}(s,u,h,m);for(var b,M,T=s;s.prev!==s.next;)if(b=s.prev,M=s.next,m?Hf(s,u,h,m):kx(s))r.push(b.i/a|0),r.push(s.i/a|0),r.push(M.i/a|0),Qh(s),s=M.next,T=M.next;else if((s=M)===T){v?1===v?$f(s=Gf(bd(s),r,a),r,a,u,h,m,2):2===v&&F1(s,r,a,u,h,m):$f(bd(s),r,a,u,h,m,1);break}}}function kx(s){var r=s.prev,a=s,u=s.next;if(ni(r,a,u)>=0)return!1;for(var h=r.x,m=a.x,v=u.x,b=r.y,M=a.y,T=u.y,I=h<m?h<v?h:v:m<v?m:v,O=b<M?b<T?b:T:M<T?M:T,R=h>m?h>v?h:v:m>v?m:v,B=b>M?b>T?b:T:M>T?M:T,V=u.next;V!==r;){if(V.x>=I&&V.x<=R&&V.y>=O&&V.y<=B&&hl(h,b,m,M,v,T,V.x,V.y)&&ni(V.prev,V,V.next)>=0)return!1;V=V.next}return!0}function Hf(s,r,a,u){var h=s.prev,m=s,v=s.next;if(ni(h,m,v)>=0)return!1;for(var b=h.x,M=m.x,T=v.x,I=h.y,O=m.y,R=v.y,B=b<M?b<T?b:T:M<T?M:T,V=I<O?I<R?I:R:O<R?O:R,w=b>M?b>T?b:T:M>T?M:T,K=I>O?I>R?I:R:O>R?O:R,G=qf(B,V,r,a,u),me=qf(w,K,r,a,u),ae=s.prevZ,fe=s.nextZ;ae&&ae.z>=G&&fe&&fe.z<=me;){if(ae.x>=B&&ae.x<=w&&ae.y>=V&&ae.y<=K&&ae!==h&&ae!==v&&hl(b,I,M,O,T,R,ae.x,ae.y)&&ni(ae.prev,ae,ae.next)>=0||(ae=ae.prevZ,fe.x>=B&&fe.x<=w&&fe.y>=V&&fe.y<=K&&fe!==h&&fe!==v&&hl(b,I,M,O,T,R,fe.x,fe.y)&&ni(fe.prev,fe,fe.next)>=0))return!1;fe=fe.nextZ}for(;ae&&ae.z>=G;){if(ae.x>=B&&ae.x<=w&&ae.y>=V&&ae.y<=K&&ae!==h&&ae!==v&&hl(b,I,M,O,T,R,ae.x,ae.y)&&ni(ae.prev,ae,ae.next)>=0)return!1;ae=ae.prevZ}for(;fe&&fe.z<=me;){if(fe.x>=B&&fe.x<=w&&fe.y>=V&&fe.y<=K&&fe!==h&&fe!==v&&hl(b,I,M,O,T,R,fe.x,fe.y)&&ni(fe.prev,fe,fe.next)>=0)return!1;fe=fe.nextZ}return!0}function Gf(s,r,a){var u=s;do{var h=u.prev,m=u.next.next;!Wf(h,m)&&V1(h,u,u.next,m)&&vu(h,m)&&vu(m,h)&&(r.push(h.i/a|0),r.push(u.i/a|0),r.push(m.i/a|0),Qh(u),Qh(u.next),u=s=m),u=u.next}while(u!==s);return bd(u)}function F1(s,r,a,u,h,m){var v=s;do{for(var b=v.next.next;b!==v.prev;){if(v.i!==b.i&&Zf(v,b)){var M=U1(v,b);return v=bd(v,v.next),M=bd(M,M.next),$f(v,r,a,u,h,m,0),void $f(M,r,a,u,h,m,0)}b=b.next}v=v.next}while(v!==s)}function N1(s,r){return s.x-r.x}function z1(s,r){var a=function(h,m){var v,b=m,M=h.x,T=h.y,I=-1/0;do{if(T<=b.y&&T>=b.next.y&&b.next.y!==b.y){var O=b.x+(T-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(O<=M&&O>I&&(I=O,v=b.x<b.next.x?b:b.next,O===M))return v}b=b.next}while(b!==m);if(!v)return null;var R,B=v,V=v.x,w=v.y,K=1/0;b=v;do{M>=b.x&&b.x>=V&&M!==b.x&&hl(T<w?M:I,T,V,w,T<w?I:M,T,b.x,b.y)&&(R=Math.abs(T-b.y)/(M-b.x),vu(b,h)&&(R<K||R===K&&(b.x>v.x||b.x===v.x&&wd(v,b)))&&(v=b,K=R)),b=b.next}while(b!==B);return v}(s,r);if(!a)return r;var u=U1(a,s);return bd(u,u.next),bd(a,a.next)}function wd(s,r){return ni(s.prev,s,r.prev)<0&&ni(r.next,s,s.next)<0}function qf(s,r,a,u,h){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-a)*h|0)|s<<8))|s<<4))|s<<2))|s<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-u)*h|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function B1(s){var r=s,a=s;do{(r.x<a.x||r.x===a.x&&r.y<a.y)&&(a=r),r=r.next}while(r!==s);return a}function hl(s,r,a,u,h,m,v,b){return(h-v)*(r-b)>=(s-v)*(m-b)&&(s-v)*(u-b)>=(a-v)*(r-b)&&(a-v)*(m-b)>=(h-v)*(u-b)}function Zf(s,r){return s.next.i!==r.i&&s.prev.i!==r.i&&!function(a,u){var h=a;do{if(h.i!==a.i&&h.next.i!==a.i&&h.i!==u.i&&h.next.i!==u.i&&V1(h,h.next,a,u))return!0;h=h.next}while(h!==a);return!1}(s,r)&&(vu(s,r)&&vu(r,s)&&function(a,u){var h=a,m=!1,v=(a.x+u.x)/2,b=(a.y+u.y)/2;do{h.y>b!=h.next.y>b&&h.next.y!==h.y&&v<(h.next.x-h.x)*(b-h.y)/(h.next.y-h.y)+h.x&&(m=!m),h=h.next}while(h!==a);return m}(s,r)&&(ni(s.prev,s,r.prev)||ni(s,r.prev,r))||Wf(s,r)&&ni(s.prev,s,s.next)>0&&ni(r.prev,r,r.next)>0)}function ni(s,r,a){return(r.y-s.y)*(a.x-r.x)-(r.x-s.x)*(a.y-r.y)}function Wf(s,r){return s.x===r.x&&s.y===r.y}function V1(s,r,a,u){var h=Jh(ni(s,r,a)),m=Jh(ni(s,r,u)),v=Jh(ni(a,u,s)),b=Jh(ni(a,u,r));return h!==m&&v!==b||!(0!==h||!Xf(s,a,r))||!(0!==m||!Xf(s,u,r))||!(0!==v||!Xf(a,s,u))||!(0!==b||!Xf(a,r,u))}function Xf(s,r,a){return r.x<=Math.max(s.x,a.x)&&r.x>=Math.min(s.x,a.x)&&r.y<=Math.max(s.y,a.y)&&r.y>=Math.min(s.y,a.y)}function Jh(s){return s>0?1:s<0?-1:0}function vu(s,r){return ni(s.prev,s,s.next)<0?ni(s,r,s.next)>=0&&ni(s,s.prev,r)>=0:ni(s,r,s.prev)<0||ni(s,s.next,r)<0}function U1(s,r){var a=new Yf(s.i,s.x,s.y),u=new Yf(r.i,r.x,r.y),h=s.next,m=r.prev;return s.next=r,r.prev=s,a.next=h,h.prev=a,u.next=a,a.prev=u,m.next=u,u.prev=m,u}function j1(s,r,a,u){var h=new Yf(s,r,a);return u?(h.next=u.next,h.prev=u,u.next.prev=h,u.next=h):(h.prev=h,h.next=h),h}function Qh(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Yf(s,r,a){this.i=s,this.x=r,this.y=a,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function s_(s,r,a,u){for(var h=0,m=r,v=a-u;m<a;m+=u)h+=(s[v]-s[m])*(s[m+1]+s[v+1]),v=m;return h}R1.exports=o_,R1.exports.default=o_,o_.deviation=function(s,r,a,u){var h=r&&r.length,m=Math.abs(s_(s,0,h?r[0]*a:s.length,a));if(h)for(var v=0,b=r.length;v<b;v++)m-=Math.abs(s_(s,r[v]*a,v<b-1?r[v+1]*a:s.length,a));var M=0;for(v=0;v<u.length;v+=3){var T=u[v]*a,I=u[v+1]*a,O=u[v+2]*a;M+=Math.abs((s[T]-s[O])*(s[I+1]-s[T+1])-(s[T]-s[I])*(s[O+1]-s[T+1]))}return 0===m&&0===M?0:Math.abs((M-m)/m)},o_.flatten=function(s){for(var r=s[0][0].length,a={vertices:[],holes:[],dimensions:r},u=0,h=0;h<s.length;h++){for(var m=0;m<s[h].length;m++)for(var v=0;v<r;v++)a.vertices.push(s[h][m][v]);h>0&&a.holes.push(u+=s[h-1].length)}return a};var a_=io(R1.exports);function Oo(s,r,a,u,h){Kf(s,r,a||0,u||s.length-1,h||l_)}function Kf(s,r,a,u,h){for(;u>a;){if(u-a>600){var m=u-a+1,v=r-a+1,b=Math.log(m),M=.5*Math.exp(2*b/3),T=.5*Math.sqrt(b*M*(m-M)/m)*(v-m/2<0?-1:1);Kf(s,r,Math.max(a,Math.floor(r-v*M/m+T)),Math.min(u,Math.floor(r+(m-v)*M/m+T)),h)}var I=s[r],O=a,R=u;for(Cd(s,a,r),h(s[u],I)>0&&Cd(s,a,u);O<R;){for(Cd(s,O,R),O++,R--;h(s[O],I)<0;)O++;for(;h(s[R],I)>0;)R--}0===h(s[a],I)?Cd(s,a,R):Cd(s,++R,u),R<=r&&(a=R+1),r<=R&&(u=R-1)}}function Cd(s,r,a){var u=s[r];s[r]=s[a],s[a]=u}function l_(s,r){return s<r?-1:s>r?1:0}function Fr(s,r){const a=s.length;if(a<=1)return[s];const u=[];let h,m;for(let v=0;v<a;v++){const b=$u(s[v]);0!==b&&(s[v].area=Math.abs(b),void 0===m&&(m=b<0),m===b<0?(h&&u.push(h),h=[s[v]]):h.push(s[v]))}if(h&&u.push(h),r>1)for(let v=0;v<u.length;v++)u[v].length<=r||(Oo(u[v],r,1,u[v].length-1,ep),u[v]=u[v].slice(0,r));return u}function ep(s,r){return r.area-s.area}function Jf(s,r,a){const u=a.patternDependencies;let h=!1;for(const m of r){const v=m.paint.get(`${s}-pattern`);v.isConstant()||(h=!0);const b=v.constantOr(null);b&&(h=!0,u[b]=!0)}return h}function Qf(s,r,a,u,h){const m=h.patternDependencies;for(const v of r){const b=v.paint.get(`${s}-pattern`).value;if("constant"!==b.kind){let M=b.evaluate({zoom:u},a,{},h.availableImages);M=M&&M.name?M.name:M,m[M]=!0,a.patterns[v.id]=M}}return a}class eg{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ot,this.indexArray=new Pt,this.indexArray2=new dr,this.programConfigurations=new al(r.layers,r.zoom),this.segments=new Fi,this.segments2=new Fi,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=r.projection}populate(r,a,u,h){this.hasPattern=Jf("fill",this.layers,a);const m=this.layers[0].layout.get("fill-sort-key"),v=[];for(const{feature:b,id:M,index:T,sourceLayerIndex:I}of r){const O=this.layers[0]._featureFilter.needGeometry,R=mu(b,O);if(!this.layers[0]._featureFilter.filter(new k(this.zoom),R,u))continue;const B=m?m.evaluate(R,{},u,a.availableImages):void 0,V={id:M,properties:b.properties,type:b.type,sourceLayerIndex:I,index:T,geometry:O?R.geometry:dl(b,u,h),patterns:{},sortKey:B};v.push(V)}m&&v.sort((b,M)=>b.sortKey-M.sortKey);for(const b of v){const{geometry:M,index:T,sourceLayerIndex:I}=b;if(this.hasPattern){const O=Qf("fill",this.layers,b,this.zoom,a);this.patternFeatures.push(O)}else this.addFeature(b,M,T,u,{},a.availableImages);a.featureIndex.insert(r[T].feature,M,T,I,this.index)}}update(r,a,u,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,u,h)}addFeatures(r,a,u,h,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,a,u,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,r_),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,a,u,h,m,v=[]){for(const b of Fr(a,500)){let M=0;for(const V of b)M+=V.length;const T=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray),I=T.vertexLength,O=[],R=[];for(const V of b){if(0===V.length)continue;V!==b[0]&&R.push(O.length/2);const w=this.segments2.prepareSegment(V.length,this.layoutVertexArray,this.indexArray2),K=w.vertexLength;this.layoutVertexArray.emplaceBack(V[0].x,V[0].y),this.indexArray2.emplaceBack(K+V.length-1,K),O.push(V[0].x),O.push(V[0].y);for(let G=1;G<V.length;G++)this.layoutVertexArray.emplaceBack(V[G].x,V[G].y),this.indexArray2.emplaceBack(K+G-1,K+G),O.push(V[G].x),O.push(V[G].y);w.vertexLength+=V.length,w.primitiveLength+=V.length}const B=a_(O,R);for(let V=0;V<B.length;V+=3)this.indexArray.emplaceBack(I+B[V],I+B[V+1],I+B[V+2]);T.vertexLength+=M,T.primitiveLength+=B.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,m,v,h)}}Tt(eg,"FillBucket",{omit:["layers","patternFeatures"]});const $1=new de({"fill-sort-key":new Q(je.layout_fill["fill-sort-key"])});var Ox={paint:new de({"fill-antialias":new $(je.paint_fill["fill-antialias"]),"fill-opacity":new Q(je.paint_fill["fill-opacity"]),"fill-color":new Q(je.paint_fill["fill-color"]),"fill-outline-color":new Q(je.paint_fill["fill-outline-color"]),"fill-translate":new $(je.paint_fill["fill-translate"]),"fill-translate-anchor":new $(je.paint_fill["fill-translate-anchor"]),"fill-pattern":new Q(je.paint_fill["fill-pattern"])}),layout:$1};const H1=Ee([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Lx=Ee([{name:"a_centroid_pos",components:2,type:"Uint16"}]),G1=Ee([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Rx}=H1;var tg={},c_=Fs,ng=Md;function Md(s,r,a,u,h){this.properties={},this.extent=a,this.type=0,this._pbf=s,this._geometry=-1,this._keys=u,this._values=h,s.readFields(tp,this,r)}function tp(s,r,a){1==s?r.id=a.readVarint():2==s?function(u,h){for(var m=u.readVarint()+u.pos;u.pos<m;){var v=h._keys[u.readVarint()],b=h._values[u.readVarint()];h.properties[v]=b}}(a,r):3==s?r.type=a.readVarint():4==s&&(r._geometry=a.pos)}function Fx(s){for(var r,a,u=0,h=0,m=s.length,v=m-1;h<m;v=h++)u+=((a=s[v]).x-(r=s[h]).x)*(r.y+a.y);return u}Md.types=["Unknown","Point","LineString","Polygon"],Md.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var r,a=s.readVarint()+s.pos,u=1,h=0,m=0,v=0,b=[];s.pos<a;){if(h<=0){var M=s.readVarint();u=7&M,h=M>>3}if(h--,1===u||2===u)m+=s.readSVarint(),v+=s.readSVarint(),1===u&&(r&&b.push(r),r=[]),r.push(new c_(m,v));else{if(7!==u)throw new Error("unknown command "+u);r&&r.push(r[0].clone())}}return r&&b.push(r),b},Md.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var r=s.readVarint()+s.pos,a=1,u=0,h=0,m=0,v=1/0,b=-1/0,M=1/0,T=-1/0;s.pos<r;){if(u<=0){var I=s.readVarint();a=7&I,u=I>>3}if(u--,1===a||2===a)(h+=s.readSVarint())<v&&(v=h),h>b&&(b=h),(m+=s.readSVarint())<M&&(M=m),m>T&&(T=m);else if(7!==a)throw new Error("unknown command "+a)}return[v,M,b,T]},Md.prototype.toGeoJSON=function(s,r,a){var u,h,m=this.extent*Math.pow(2,a),v=this.extent*s,b=this.extent*r,M=this.loadGeometry(),T=Md.types[this.type];function I(B){for(var V=0;V<B.length;V++){var w=B[V];B[V]=[360*(w.x+v)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(w.y+b)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(u=0;u<M.length;u++)O[u]=M[u][0];I(M=O);break;case 2:for(u=0;u<M.length;u++)I(M[u]);break;case 3:for(M=function(B){var V=B.length;if(V<=1)return[B];for(var w,K,G=[],me=0;me<V;me++){var ae=Fx(B[me]);0!==ae&&(void 0===K&&(K=ae<0),K===ae<0?(w&&G.push(w),w=[B[me]]):w.push(B[me]))}return w&&G.push(w),G}(M),u=0;u<M.length;u++)for(h=0;h<M[u].length;h++)I(M[u][h])}1===M.length?M=M[0]:T="Multi"+T;var R={type:"Feature",geometry:{type:T,coordinates:M},properties:this.properties};return"id"in this&&(R.id=this.id),R};var Nx=ng,u_=d_;function d_(s,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(q1,this,r),this.length=this._features.length}function q1(s,r,a){15===s?r.version=a.readVarint():1===s?r.name=a.readString():5===s?r.extent=a.readVarint():2===s?r._features.push(a.pos):3===s?r._keys.push(a.readString()):4===s&&r._values.push(function(u){for(var h=null,m=u.readVarint()+u.pos;u.pos<m;){var v=u.readVarint()>>3;h=1===v?u.readString():2===v?u.readFloat():3===v?u.readDouble():4===v?u.readVarint64():5===v?u.readVarint():6===v?u.readSVarint():7===v?u.readBoolean():null}return h}(a))}d_.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var r=this._pbf.readVarint()+this._pbf.pos;return new Nx(this._pbf,r,this.extent,this._keys,this._values)};var Ed=u_;function ig(s,r,a){if(3===s){var u=new Ed(a,a.readVarint()+a.pos);u.length&&(r[u.name]=u)}}var rg=tg.VectorTile=function(s,r){this.layers=s.readFields(ig,{},r)},Td=tg.VectorTileFeature=ng;function yu(s,r,a,u){const h=[],m=0===u?(v,b,M,T,I,O)=>{v.push(new _t(O,M+(O-b)/(T-b)*(I-M)))}:(v,b,M,T,I,O)=>{v.push(new _t(b+(O-M)/(I-M)*(T-b),O))};for(const v of s){const b=[];for(const M of v){if(M.length<=2)continue;const T=[];for(let R=0;R<M.length-1;R++){const B=M[R].x,V=M[R].y,w=M[R+1].x,K=M[R+1].y,G=0===u?B:V,me=0===u?w:K;G<r?me>r&&m(T,B,V,w,K,r):G>a?me<a&&m(T,B,V,w,K,a):T.push(M[R]),me<r&&G>=r&&m(T,B,V,w,K,r),me>a&&G<=a&&m(T,B,V,w,K,a)}let I=M[M.length-1];const O=0===u?I.x:I.y;O>=r&&O<=a&&T.push(I),T.length&&(I=T[T.length-1],T[0].x===I.x&&T[0].y===I.y||T.push(T[0]),b.push(T))}b.length&&h.push(b)}return h}tg.VectorTileLayer=u_;const zx=Td.types,Bx=Math.pow(2,13);function np(s,r,a,u,h,m,v,b){s.emplaceBack((r<<1)+v,(a<<1)+m,(Math.floor(u*Bx)<<1)+h,Math.round(b))}function ip(s,r,a){s.emplaceBack(r.x,r.y,r.z,16384*a[0],16384*a[1],16384*a[2])}class Z1{constructor(){this.acc=new _t(0,0),this.polyCount=[]}startRing(r){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new _t(r.x,r.y),this.max=new _t(r.x,r.y))}append(r,a){this.currentPolyCount.edges++,this.acc._add(r);const u=this.min,h=this.max;r.x<u.x?u.x=r.x:r.x>h.x&&(h.x=r.x),r.y<u.y?u.y=r.y:r.y>h.y&&(h.y=r.y),((0===r.x||r.x===Bt)&&r.x===a.x)!=((0===r.y||r.y===Bt)&&r.y===a.y)&&this.processBorderOverlap(r,a),a.x<0!=r.x<0&&this.addBorderIntersection(0,wn(a.y,r.y,(0-a.x)/(r.x-a.x))),a.x>Bt!=r.x>Bt&&this.addBorderIntersection(1,wn(a.y,r.y,(Bt-a.x)/(r.x-a.x))),a.y<0!=r.y<0&&this.addBorderIntersection(2,wn(a.x,r.x,(0-a.y)/(r.y-a.y))),a.y>Bt!=r.y>Bt&&this.addBorderIntersection(3,wn(a.x,r.x,(Bt-a.y)/(r.y-a.y)))}addBorderIntersection(r,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[r];a<u[0]&&(u[0]=a),a>u[1]&&(u[1]=a)}processBorderOverlap(r,a){if(r.x===a.x){if(r.y===a.y)return;const u=0===r.x?0:1;this.addBorderIntersection(u,a.y),this.addBorderIntersection(u,r.y)}else{const u=0===r.y?2:3;this.addBorderIntersection(u,a.x),this.addBorderIntersection(u,r.x)}}centroid(){const r=this.polyCount.reduce((a,u)=>a+u.edges,0);return 0!==r?this.acc.div(r)._round():new _t(0,0)}span(){return new _t(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((r,a)=>r+ +(a[0]!==Number.MAX_VALUE),0)}}class rp{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=r.projection,this.layoutVertexArray=new Ze,this.centroidVertexArray=new Qr,this.indexArray=new Pt,this.programConfigurations=new al(r.layers,r.zoom),this.segments=new Fi,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.enableTerrain=r.enableTerrain}populate(r,a,u,h){this.features=[],this.hasPattern=Jf("fill-extrusion",this.layers,a),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(m){const v=Math.exp(Math.PI*(1-m.y/(1<<m.z)*2));return 80150034*v/(v*v+1)/Bt/(1<<m.z)}(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:m,id:v,index:b,sourceLayerIndex:M}of r){const T=this.layers[0]._featureFilter.needGeometry,I=mu(m,T);if(!this.layers[0]._featureFilter.filter(new k(this.zoom),I,u))continue;const O={id:v,sourceLayerIndex:M,index:b,geometry:T?I.geometry:dl(m,u,h),properties:m.properties,type:m.type,patterns:{}},R=this.layoutVertexArray.length;this.hasPattern?this.features.push(Qf("fill-extrusion",this.layers,O,this.zoom,a)):this.addFeature(O,O.geometry,b,u,{},a.availableImages,h),a.featureIndex.insert(m,O.geometry,b,M,this.index,R)}this.sortBorders()}addFeatures(r,a,u,h,m){for(const v of this.features){const{geometry:b}=v;this.addFeature(v,b,v.index,a,u,h,m)}this.sortBorders()}update(r,a,u,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,u,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Rx),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=r.createVertexBuffer(this.layoutVertexExtArray,G1.members,!0))),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,Lx.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,a,u,h,m,v,b){const M=[new _t(0,0),new _t(Bt,Bt)],T=b.projection,I="globe"===T.name,O=this.enableTerrain&&!I?new Z1:null,R="Polygon"===zx[r.type];I&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new tt);const B=Fr(a,500);for(let G=B.length-1;G>=0;G--){const me=B[G];(0===me.length||(V=me[0]).every(ae=>ae.x<=0)||V.every(ae=>ae.x>=Bt)||V.every(ae=>ae.y<=0)||V.every(ae=>ae.y>=Bt))&&B.splice(G,1)}var V;let w;if(I)w=p_(B,M,h);else{w=[];for(const G of B)w.push({polygon:G,bounds:M})}const K=R?this.edgeRadius:0;for(const{polygon:G,bounds:me}of w){let ae=0,fe=0;for(const ve of G)R&&!ve[0].equals(ve[ve.length-1])&&ve.push(ve[0]),fe+=R?ve.length-1:ve.length;const _e=this.segments.prepareSegment((R?5:4)*fe,this.layoutVertexArray,this.indexArray);if(R){const ve=[],Re=[];ae=_e.vertexLength;for(const $e of G){let rt,Ne;$e.length&&$e!==G[0]&&Re.push(ve.length/2),rt=$e[1].sub($e[0])._perp()._unit();for(let Ye=1;Ye<$e.length;Ye++){const Xe=$e[Ye],nt=$e[Ye===$e.length-1?1:Ye+1];let{x:ct,y:Ue}=Xe;if(K){Ne=nt.sub(Xe)._perp()._unit();const yt=rt.add(Ne)._unit(),St=K*Math.min(4,1/(rt.x*yt.x+rt.y*yt.y));ct+=St*yt.x,Ue+=St*yt.y,rt=Ne}np(this.layoutVertexArray,ct,Ue,0,0,1,1,0),_e.vertexLength++,ve.push(Xe.x,Xe.y),I&&ip(this.layoutVertexExtArray,T.projectTilePoint(ct,Ue,h),T.upVector(h,ct,Ue))}}const ke=a_(ve,Re);for(let $e=0;$e<ke.length;$e+=3)this.indexArray.emplaceBack(ae+ke[$e],ae+ke[$e+2],ae+ke[$e+1]),_e.primitiveLength++}for(const ve of G){O&&ve.length&&O.startRing(ve[0]);let Re,ke,$e,rt=ve.length>4&&W1(ve[ve.length-2],ve[0],ve[1]),Ne=K?og(ve[ve.length-2],ve[0],ve[1],K):0;ke=ve[1].sub(ve[0])._perp()._unit();let Ye=!0;for(let Xe=1,nt=0;Xe<ve.length;Xe++){let ct=ve[Xe-1],Ue=ve[Xe];const yt=ve[Xe===ve.length-1?1:Xe+1];if(O&&R&&O.currentPolyCount.top++,ag(Ue,ct,me)){K&&(ke=yt.sub(Ue)._perp()._unit(),Ye=!Ye);continue}O&&O.append(Ue,ct);const St=Ue.sub(ct)._perp(),Ct=St.x/(Math.abs(St.x)+Math.abs(St.y)),Qt=St.y>0?1:0,dt=ct.dist(Ue);if(nt+dt>32768&&(nt=0),K){$e=yt.sub(Ue)._perp()._unit();let en=sg(ct,Ue,yt,h_(ke,$e),K);isNaN(en)&&(en=0);const Rt=Ue.sub(ct)._unit();ct=ct.add(Rt.mult(Ne))._round(),Ue=Ue.add(Rt.mult(-en))._round(),Ne=en,ke=$e}const zt=_e.vertexLength,Xt=ve.length>4&&W1(ct,Ue,yt);let In=X1(nt,rt,Ye);if(np(this.layoutVertexArray,ct.x,ct.y,Ct,Qt,0,0,In),np(this.layoutVertexArray,ct.x,ct.y,Ct,Qt,0,1,In),nt+=dt,In=X1(nt,Xt,!Ye),rt=Xt,np(this.layoutVertexArray,Ue.x,Ue.y,Ct,Qt,0,0,In),np(this.layoutVertexArray,Ue.x,Ue.y,Ct,Qt,0,1,In),_e.vertexLength+=4,this.indexArray.emplaceBack(zt+0,zt+1,zt+2),this.indexArray.emplaceBack(zt+1,zt+3,zt+2),_e.primitiveLength+=2,K){const en=ae+(1===Xe?ve.length-2:Xe-2),Rt=1===Xe?ae:en+1;if(this.indexArray.emplaceBack(zt+1,en,zt+3),this.indexArray.emplaceBack(en,Rt,zt+3),_e.primitiveLength+=2,void 0===Re&&(Re=zt),!ag(yt,ve[Xe],me)){const ii=Xe===ve.length-1?Re:_e.vertexLength;this.indexArray.emplaceBack(zt+2,zt+3,ii),this.indexArray.emplaceBack(zt+3,ii+1,ii),this.indexArray.emplaceBack(zt+3,Rt,ii+1),_e.primitiveLength+=3}Ye=!Ye}if(I){const en=this.layoutVertexExtArray,Rt=T.projectTilePoint(ct.x,ct.y,h),ii=T.projectTilePoint(Ue.x,Ue.y,h),rn=T.upVector(h,ct.x,ct.y),sn=T.upVector(h,Ue.x,Ue.y);ip(en,Rt,rn),ip(en,Rt,rn),ip(en,ii,sn),ip(en,ii,sn)}}R&&(ae+=ve.length-1)}}if(O&&O.polyCount.length>0){if(O.borders){O.vertexArrayOffset=this.centroidVertexArray.length;const G=O.borders,me=this.featuresOnBorder.push(O)-1;for(let ae=0;ae<4;ae++)G[ae][0]!==Number.MAX_VALUE&&this.borders[ae].push(me)}this.encodeCentroid(O.borders?void 0:O.centroid(),O)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,m,v,h)}sortBorders(){for(let r=0;r<4;r++)this.borders[r].sort((a,u)=>this.featuresOnBorder[a].borders[r][0]-this.featuresOnBorder[u].borders[r][0])}encodeCentroid(r,a,u=!0){let h,m;if(r)if(0!==r.y){const b=a.span()._mult(this.tileToMeter);h=(Math.max(r.x,1)<<3)+Math.min(7,Math.round(b.x/10)),m=(Math.max(r.y,1)<<3)+Math.min(7,Math.round(b.y/10))}else h=Math.ceil(7*(r.x+450)),m=0;else h=0,m=+u;let v=u?this.centroidVertexArray.length:a.vertexArrayOffset;for(const b of a.polyCount){u&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*b.edges+b.top);for(let M=0;M<b.top;M++)this.centroidVertexArray.emplace(v++,h,m);for(let M=0;M<2*b.edges;M++)this.centroidVertexArray.emplace(v++,0,m),this.centroidVertexArray.emplace(v++,h,m)}}}function h_(s,r){const a=s.add(r)._unit();return s.x*a.x+s.y*a.y}function og(s,r,a,u){const h=r.sub(s)._perp()._unit(),m=a.sub(r)._perp()._unit();return sg(s,r,a,h_(h,m),u)}function sg(s,r,a,u,h){const m=Math.sqrt(1-u*u);return Math.min(s.dist(r)/3,r.dist(a)/3,h*m/u)}function ag(s,r,a){return s.x<a[0].x&&r.x<a[0].x||s.x>a[1].x&&r.x>a[1].x||s.y<a[0].y&&r.y<a[0].y||s.y>a[1].y&&r.y>a[1].y}function W1(s,r,a){if(s.x<0||s.x>=Bt||r.x<0||r.x>=Bt||a.x<0||a.x>=Bt)return!1;const u=a.sub(r),h=u.perp(),m=s.sub(r);return(u.x*m.x+u.y*m.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(m.x*m.x+m.y*m.y))>-.866&&h.x*m.x+h.y*m.y<0}function X1(s,r,a){const u=r?2|s:-3&s;return a?1|u:-2&u}function lg(){const s=Math.PI/32,r=Math.tan(s),a=qi;return a*Math.sqrt(1+2*r*r)-a}function p_(s,r,a){const u=1<<a.z,h=Hr(a.x/u),m=Hr((a.x+1)/u),v=Or(a.y/u),b=Or((a.y+1)/u);return function(M,T,I,O,R=0,B){const V=[];if(!M.length||!I||!O)return V;const w=(ve,Re)=>{for(const ke of ve)V.push({polygon:ke,bounds:Re})},K=Math.ceil(Math.log2(I)),G=Math.ceil(Math.log2(O)),me=K-G,ae=[];for(let ve=0;ve<Math.abs(me);ve++)ae.push(me>0?0:1);for(let ve=0;ve<Math.min(K,G);ve++)ae.push(0),ae.push(1);let fe=M;if(fe=yu(fe,T[0].y-R,T[1].y+R,1),fe=yu(fe,T[0].x-R,T[1].x+R,0),!fe.length)return V;const _e=[];for(ae.length?_e.push({polygons:fe,bounds:T,depth:0}):w(fe,T);_e.length;){const ve=_e.pop(),Re=ve.depth,ke=ae[Re],$e=ve.bounds[0],rt=ve.bounds[1],Ne=0===ke?$e.x:$e.y,Ye=0===ke?rt.x:rt.y,Xe=B?B(ke,Ne,Ye):.5*(Ne+Ye),nt=yu(ve.polygons,Ne-R,Xe+R,ke),ct=yu(ve.polygons,Xe-R,Ye+R,ke);if(nt.length){const Ue=[$e,new _t(0===ke?Xe:rt.x,1===ke?Xe:rt.y)];ae.length>Re+1?_e.push({polygons:nt,bounds:Ue,depth:Re+1}):w(nt,Ue)}if(ct.length){const Ue=[new _t(0===ke?Xe:$e.x,1===ke?Xe:$e.y),rt];ae.length>Re+1?_e.push({polygons:ct,bounds:Ue,depth:Re+1}):w(ct,Ue)}}return V}(s,r,Math.ceil((m-h)/11.25),Math.ceil((v-b)/11.25),1,(M,T,I)=>{if(0===M)return.5*(T+I);{const O=Or((a.y+T/Bt)/u);return(Ws(.5*(Or((a.y+I/Bt)/u)+O))*u-a.y)*Bt}})}Tt(rp,"FillExtrusionBucket",{omit:["layers","features"]}),Tt(Z1,"PartMetadata");const xu=new de({"fill-extrusion-edge-radius":new $(je["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Y1={paint:new de({"fill-extrusion-opacity":new $(je["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Q(je["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new $(je["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new $(je["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Q(je["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Q(je["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Q(je["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new $(je["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new $(je["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new $(je["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new $(je["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:xu};function f_(s,r,a){var u=2*Math.PI*6378137/256/Math.pow(2,a);return[s*u-2*Math.PI*6378137/2,r*u-2*Math.PI*6378137/2]}class cg{constructor(r,a,u){this.z=r,this.x=a,this.y=u,this.key=op(0,r,r,a,u)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,a){const u=(v=this.y,b=this.z,M=f_(256*(m=this.x),256*(v=Math.pow(2,b)-v-1),b),T=f_(256*(m+1),256*(v+1),b),M[0]+","+M[1]+","+T[0]+","+T[1]),h=function(m,v,b){let M,T="";for(let I=m;I>0;I--)M=1<<I-1,T+=(v&M?1:0)+(b&M?2:0);return T}(this.z,this.x,this.y);var m,v,b,M,T;return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===a?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Vx{constructor(r,a){this.wrap=r,this.canonical=a,this.key=op(r,a.z,a.z,a.x,a.y)}}class br{constructor(r,a,u,h,m){this.overscaledZ=r,this.wrap=a,this.canonical=new cg(u,+h,+m),this.key=0===a&&r===u?this.canonical.key:op(a,r,u,h,m)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const a=this.canonical.z-r;return r>this.canonical.z?new br(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new br(r,this.wrap,r,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(r,a=!0){if(this.overscaledZ===r&&a)return this.key;if(r>this.canonical.z)return op(this.wrap*+a,r,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-r;return op(this.wrap*+a,r,r,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const a=this.canonical.z-r.canonical.z;return 0===r.overscaledZ||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>a&&r.canonical.y===this.canonical.y>>a}children(r){if(this.overscaledZ>=r)return[new br(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,u=2*this.canonical.x,h=2*this.canonical.y;return[new br(a,this.wrap,a,u,h),new br(a,this.wrap,a,u+1,h),new br(a,this.wrap,a,u,h+1),new br(a,this.wrap,a,u+1,h+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new br(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new br(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Vx(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function op(s,r,a,u,h){const m=1<<Math.min(a,22);let v=m*(h%m)+u%m;return s&&a<22&&(v+=m*m*((s<0?-2*s-1:2*s)%(1<<2*(22-a)))),16*(32*v+a)+(r-a)}Tt(cg,"CanonicalTileID"),Tt(br,"OverscaledTileID",{omit:["projMatrix"]});class bu extends _t{constructor(r,a,u){super(r,a),this.z=u}}function Dd(s,r){return s.x*r.x+s.y*r.y}function g_(s,r){if(1===s.length){let a=0;const u=r[a++];let h;for(;!h||u.equals(h);)if(h=r[a++],!h)return 1/0;for(;a<r.length;a++){const m=r[a],v=s[0],b=h.sub(u),M=m.sub(u),T=v.sub(u),I=Dd(b,b),O=Dd(b,M),R=Dd(M,M),B=Dd(T,b),V=Dd(T,M),w=I*R-O*O,K=(R*B-O*V)/w,G=(I*V-O*B)/w,me=u.z*(1-K-G)+h.z*K+m.z*G;if(isFinite(me))return me}return 1/0}{let a=1/0;for(const u of r)a=Math.min(a,u.z);return a}}function ug(s,r,a,u,h,m,v,b){const M=v*h.getElevationAt(s,r,!0,!0),T=0!==m[0],I=T?0===m[1]?v*(m[0]/7-450):v*function(O,R,B){const V=Math.floor(R[0]/8),w=Math.floor(R[1]/8),K=10*(R[0]-8*V),G=10*(R[1]-8*w),me=O.getElevationAt(V,w,!0,!0),ae=O.getMeterToDEM(B),fe=Math.floor(.5*(K*ae-1)),_e=Math.floor(.5*(G*ae-1)),ve=O.tileCoordToPixel(V,w),Re=2*fe+1,ke=2*_e+1,$e=(St=Re,Ct=ke,[(ct=O).getElevationAtPixel(Ue=ve.x-fe,yt=ve.y-_e,!0),ct.getElevationAtPixel(Ue+Ct,yt,!0),ct.getElevationAtPixel(Ue,yt+Ct,!0),ct.getElevationAtPixel(Ue+St,yt+Ct,!0)]),rt=Math.abs($e[0]-$e[1]),Ne=Math.abs($e[2]-$e[3]),Ye=Math.abs($e[0]-$e[2])+Math.abs($e[1]-$e[3]),Xe=Math.min(.25,.5*ae*(rt+Ne)/Re),nt=Math.min(.25,.5*ae*Ye/ke);var ct,Ue,yt,St,Ct;return me+Math.max(Xe*K,nt*G)}(h,m,b):M;return{base:M+(0===a)?-1:a,top:T?Math.max(I+u,M+a+2):M+u}}const K1=Ee([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:dg}=K1,sp=Ee([{name:"a_packed",components:4,type:"Float32"}]),{members:J1}=sp,m_=Td.types,hg=Math.cos(Math.PI/180*37.5);class ap{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.projection=r.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new Be,this.layoutVertexArray2=new it,this.indexArray=new Pt,this.programConfigurations=new al(r.layers,r.zoom),this.segments=new Fi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(r,a,u,h){this.hasPattern=Jf("line",this.layers,a);const m=this.layers[0].layout.get("line-sort-key"),v=[];for(const{feature:I,id:O,index:R,sourceLayerIndex:B}of r){const V=this.layers[0]._featureFilter.needGeometry,w=mu(I,V);if(!this.layers[0]._featureFilter.filter(new k(this.zoom),w,u))continue;const K=m?m.evaluate(w,{},u):void 0,G={id:O,properties:I.properties,type:I.type,sourceLayerIndex:B,index:R,geometry:V?w.geometry:dl(I,u,h),patterns:{},sortKey:K};v.push(G)}m&&v.sort((I,O)=>I.sortKey-O.sortKey);const{lineAtlas:b,featureIndex:M}=a,T=this.addConstantDashes(b);for(const I of v){const{geometry:O,index:R,sourceLayerIndex:B}=I;if(T&&this.addFeatureDashes(I,b),this.hasPattern){const V=Qf("line",this.layers,I,this.zoom,a);this.patternFeatures.push(V)}else this.addFeature(I,O,R,u,b.positions,a.availableImages);M.insert(r[R].feature,O,R,B,this.index)}}addConstantDashes(r){let a=!1;for(const u of this.layers){const h=u.paint.get("line-dasharray").value,m=u.layout.get("line-cap").value;if("constant"!==h.kind||"constant"!==m.kind)a=!0;else{const v=m.value,b=h.value;if(!b)continue;r.addDash(b,v)}}return a}addFeatureDashes(r,a){const u=this.zoom;for(const h of this.layers){const m=h.paint.get("line-dasharray").value,v=h.layout.get("line-cap").value;if("constant"===m.kind&&"constant"===v.kind)continue;let b,M;if("constant"===m.kind){if(b=m.value,!b)continue}else b=m.evaluate({zoom:u},r);M="constant"===v.kind?v.value:v.evaluate({zoom:u},r),a.addDash(b,M),r.patterns[h.id]=a.getKey(b,M)}}update(r,a,u,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,u,h)}addFeatures(r,a,u,h,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,a,u,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,J1)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,dg),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&r.properties.hasOwnProperty("mapbox_clip_start")&&r.properties.hasOwnProperty("mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,a,u,h,m,v){const b=this.layers[0].layout,M=b.get("line-join").evaluate(r,{}),T=b.get("line-cap").evaluate(r,{}),I=b.get("line-miter-limit"),O=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const R of a)this.addLine(R,r,M,T,I,O);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,u,m,v,h)}addLine(r,a,u,h,m,v){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let G=0;G<r.length-1;G++)this.totalDistance+=r[G].dist(r[G+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const b="Polygon"===m_[a.type];let M=r.length;for(;M>=2&&r[M-1].equals(r[M-2]);)M--;let T=0;for(;T<M-1&&r[T].equals(r[T+1]);)T++;if(M<(b?3:2))return;"bevel"===u&&(m=1.05);const I=this.overscaling<=16?15*Bt/(512*this.overscaling):0,O=this.segments.prepareSegment(10*M,this.layoutVertexArray,this.indexArray);let R,B,V,w,K;this.e1=this.e2=-1,b&&(R=r[M-2],K=r[T].sub(R)._unit()._perp());for(let G=T;G<M;G++){if(V=G===M-1?b?r[T+1]:void 0:r[G+1],V&&r[G].equals(V))continue;K&&(w=K),R&&(B=R),R=r[G],K=V?V.sub(R)._unit()._perp():w,w=w||K;let me=w.add(K);0===me.x&&0===me.y||me._unit();const ae=w.x*K.x+w.y*K.y,fe=me.x*K.x+me.y*K.y,_e=0!==fe?1/fe:1/0,ve=2*Math.sqrt(2-2*fe),Re=fe<hg&&B&&V,ke=w.x*K.y-w.y*K.x>0;if(Re&&G>T){const Ne=R.dist(B);if(Ne>2*I){const Ye=R.sub(R.sub(B)._mult(I/Ne)._round());this.updateDistance(B,Ye),this.addCurrentVertex(Ye,w,0,0,O),B=Ye}}const $e=B&&V;let rt=$e?u:b?"butt":h;if($e&&"round"===rt&&(_e<v?rt="miter":_e<=2&&(rt="fakeround")),"miter"===rt&&_e>m&&(rt="bevel"),"bevel"===rt&&(_e>2&&(rt="flipbevel"),_e<m&&(rt="miter")),B&&this.updateDistance(B,R),"miter"===rt)me._mult(_e),this.addCurrentVertex(R,me,0,0,O);else if("flipbevel"===rt){if(_e>100)me=K.mult(-1);else{const Ne=_e*w.add(K).mag()/w.sub(K).mag();me._perp()._mult(Ne*(ke?-1:1))}this.addCurrentVertex(R,me,0,0,O),this.addCurrentVertex(R,me.mult(-1),0,0,O)}else if("bevel"===rt||"fakeround"===rt){const Ne=-Math.sqrt(_e*_e-1),Ye=ke?Ne:0,Xe=ke?0:Ne;if(B&&this.addCurrentVertex(R,w,Ye,Xe,O),"fakeround"===rt){const nt=Math.round(180*ve/Math.PI/20);for(let ct=1;ct<nt;ct++){let Ue=ct/nt;if(.5!==Ue){const St=Ue-.5;Ue+=Ue*St*(Ue-1)*((1.0904+ae*(ae*(3.55645-1.43519*ae)-3.2452))*St*St+(.848013+ae*(.215638*ae-1.06021)))}const yt=K.sub(w)._mult(Ue)._add(w)._unit()._mult(ke?-1:1);this.addHalfVertex(R,yt.x,yt.y,!1,ke,0,O)}}V&&this.addCurrentVertex(R,K,-Ye,-Xe,O)}else if("butt"===rt)this.addCurrentVertex(R,me,0,0,O);else if("square"===rt){const Ne=B?1:-1;B||this.addCurrentVertex(R,me,Ne,Ne,O),this.addCurrentVertex(R,me,0,0,O),B&&this.addCurrentVertex(R,me,Ne,Ne,O)}else"round"===rt&&(B&&(this.addCurrentVertex(R,w,0,0,O),this.addCurrentVertex(R,w,1,1,O,!0)),V&&(this.addCurrentVertex(R,K,-1,-1,O,!0),this.addCurrentVertex(R,K,0,0,O)));if(Re&&G<M-1){const Ne=R.dist(V);if(Ne>2*I){const Ye=R.add(V.sub(R)._mult(I/Ne)._round());this.updateDistance(R,Ye),this.addCurrentVertex(Ye,K,0,0,O),R=Ye}}}}addCurrentVertex(r,a,u,h,m,v=!1){const b=a.y*h-a.x,M=-a.y-a.x*h;this.addHalfVertex(r,a.x+a.y*u,a.y-a.x*u,v,!1,u,m),this.addHalfVertex(r,b,M,v,!0,-h,m)}addHalfVertex({x:r,y:a},u,h,m,v,b,M){this.layoutVertexArray.emplaceBack((r<<1)+(m?1:0),(a<<1)+(v?1:0),Math.round(63*u)+128,Math.round(63*h)+128,1+(0===b?0:b<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const T=M.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,T),M.primitiveLength++),v?this.e2=T:this.e1=T}updateScaledDistance(){if(this.lineClips){const r=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=r*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(r,a){this.distance+=r.dist(a),this.updateScaledDistance()}}Tt(ap,"LineBucket",{omit:["layers","patternFeatures"]});const __=new de({"line-cap":new Q(je.layout_line["line-cap"]),"line-join":new Q(je.layout_line["line-join"]),"line-miter-limit":new $(je.layout_line["line-miter-limit"]),"line-round-limit":new $(je.layout_line["line-round-limit"]),"line-sort-key":new Q(je.layout_line["line-sort-key"])});var Sd={paint:new de({"line-opacity":new Q(je.paint_line["line-opacity"]),"line-color":new Q(je.paint_line["line-color"]),"line-translate":new $(je.paint_line["line-translate"]),"line-translate-anchor":new $(je.paint_line["line-translate-anchor"]),"line-width":new Q(je.paint_line["line-width"]),"line-gap-width":new Q(je.paint_line["line-gap-width"]),"line-offset":new Q(je.paint_line["line-offset"]),"line-blur":new Q(je.paint_line["line-blur"]),"line-dasharray":new Q(je.paint_line["line-dasharray"]),"line-pattern":new Q(je.paint_line["line-pattern"]),"line-gradient":new ue(je.paint_line["line-gradient"]),"line-trim-offset":new $(je.paint_line["line-trim-offset"])}),layout:__};const Q1=new class extends Q{possiblyEvaluate(s,r){return r=new k(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,transition:r.transition}),super.possiblyEvaluate(s,r)}evaluate(s,r,a,u){return r=$i({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(s,r,a,u)}}(Sd.paint.properties["line-width"].specification);function v_(s,r){return r>0?r+2*s:s}Q1.useIntegerZoom=!0;const Ux=Ee([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),jx=Ee([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),$x=Ee([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ee([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const e0=Ee([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),t0=Ee([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Ee([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const lp=Ee([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),y_=Ee([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ee([{name:"triangle",components:3,type:"Uint16"}]),Ee([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ee([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ee([{type:"Float32",name:"offsetX"}]),Ee([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var zi=24;const Xs=128;function x_(s,r){const{expression:a}=r;if("constant"===a.kind)return{kind:"constant",layoutSize:a.evaluate(new k(s+1))};if("source"===a.kind)return{kind:"source"};{const{zoomStops:u,interpolationType:h}=a;let m=0;for(;m<u.length&&u[m]<=s;)m++;m=Math.max(0,m-1);let v=m;for(;v<u.length&&u[v]<s+1;)v++;v=Math.min(u.length-1,v);const b=u[m],M=u[v];return"composite"===a.kind?{kind:"composite",minZoom:b,maxZoom:M,interpolationType:h}:{kind:"camera",minZoom:b,maxZoom:M,minSize:a.evaluate(new k(b)),maxSize:a.evaluate(new k(M)),interpolationType:h}}}function b_(s,{uSize:r,uSizeT:a},{lowerSize:u,upperSize:h}){return"source"===s.kind?u/Xs:"composite"===s.kind?wn(u/Xs,h/Xs,a):r}function Id(s,r){let a=0,u=0;if("constant"===s.kind)u=s.layoutSize;else if("source"!==s.kind){const{interpolationType:h,minZoom:m,maxZoom:v}=s,b=h?yn(Qi.interpolationFactor(h,r,m,v),0,1):0;"camera"===s.kind?u=wn(s.minSize,s.maxSize,b):a=b}return{uSizeT:a,uSize:u}}var w_=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Xs,evaluateSizeForFeature:b_,evaluateSizeForZoom:Id,getSizeData:x_});function Hx(s,r,a){return s.sections.forEach(u=>{u.text=function(h,m,v){const b=m.layout.get("text-transform").evaluate(v,{});return"uppercase"===b?h=h.toLocaleUpperCase():"lowercase"===b&&(h=h.toLocaleLowerCase()),S.applyArabicShaping&&(h=S.applyArabicShaping(h)),h}(u.text,r,a)}),s}const Ta={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function pg(s){return"\ufe36"===s||"\ufe48"===s||"\ufe38"===s||"\ufe44"===s||"\ufe42"===s||"\ufe3e"===s||"\ufe3c"===s||"\ufe3a"===s||"\ufe18"===s||"\ufe40"===s||"\ufe10"===s||"\ufe13"===s||"\ufe14"===s||"\uff40"===s||"\uffe3"===s||"\ufe11"===s||"\ufe12"===s}function C_(s){return"\ufe35"===s||"\ufe47"===s||"\ufe37"===s||"\ufe43"===s||"\ufe41"===s||"\ufe3d"===s||"\ufe3b"===s||"\ufe39"===s||"\ufe17"===s||"\ufe3f"===s}var M_=Zn,E_=function(s,r,a,u,h){var m,v,b=8*h-u-1,M=(1<<b)-1,T=M>>1,I=-7,O=a?h-1:0,R=a?-1:1,B=s[r+O];for(O+=R,m=B&(1<<-I)-1,B>>=-I,I+=b;I>0;m=256*m+s[r+O],O+=R,I-=8);for(v=m&(1<<-I)-1,m>>=-I,I+=u;I>0;v=256*v+s[r+O],O+=R,I-=8);if(0===m)m=1-T;else{if(m===M)return v?NaN:1/0*(B?-1:1);v+=Math.pow(2,u),m-=T}return(B?-1:1)*v*Math.pow(2,m-u)},T_=function(s,r,a,u,h,m){var v,b,M,T=8*m-h-1,I=(1<<T)-1,O=I>>1,R=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,B=u?0:m-1,V=u?1:-1,w=r<0||0===r&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(b=isNaN(r)?1:0,v=I):(v=Math.floor(Math.log(r)/Math.LN2),r*(M=Math.pow(2,-v))<1&&(v--,M*=2),(r+=v+O>=1?R/M:R*Math.pow(2,1-O))*M>=2&&(v++,M/=2),v+O>=I?(b=0,v=I):v+O>=1?(b=(r*M-1)*Math.pow(2,h),v+=O):(b=r*Math.pow(2,O-1)*Math.pow(2,h),v=0));h>=8;s[a+B]=255&b,B+=V,b/=256,h-=8);for(v=v<<h|b,T+=h;T>0;s[a+B]=255&v,B+=V,v/=256,T-=8);s[a+B-V]|=128*w};function Zn(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}Zn.Varint=0,Zn.Fixed64=1,Zn.Bytes=2,Zn.Fixed32=5;var D_=4294967296,n0=1/D_,r0=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function pl(s){return s.type===Zn.Bytes?s.readVarint()+s.pos:s.pos+1}function fl(s,r,a){var u=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));a.realloc(u);for(var h=a.pos-1;h>=s;h--)a.buf[h+u]=a.buf[h]}function cp(s,r){for(var a=0;a<s.length;a++)r.writeVarint(s[a])}function Gx(s,r){for(var a=0;a<s.length;a++)r.writeSVarint(s[a])}function QC(s,r){for(var a=0;a<s.length;a++)r.writeFloat(s[a])}function e2(s,r){for(var a=0;a<s.length;a++)r.writeDouble(s[a])}function t2(s,r){for(var a=0;a<s.length;a++)r.writeBoolean(s[a])}function n2(s,r){for(var a=0;a<s.length;a++)r.writeFixed32(s[a])}function i2(s,r){for(var a=0;a<s.length;a++)r.writeSFixed32(s[a])}function o0(s,r){for(var a=0;a<s.length;a++)r.writeFixed64(s[a])}function qx(s,r){for(var a=0;a<s.length;a++)r.writeSFixed64(s[a])}function fg(s,r){return(s[r]|s[r+1]<<8|s[r+2]<<16)+16777216*s[r+3]}function Pd(s,r,a){s[a]=r,s[a+1]=r>>>8,s[a+2]=r>>>16,s[a+3]=r>>>24}function s0(s,r){return(s[r]|s[r+1]<<8|s[r+2]<<16)+(s[r+3]<<24)}Zn.prototype={destroy:function(){this.buf=null},readFields:function(s,r,a){for(a=a||this.length;this.pos<a;){var u=this.readVarint(),h=u>>3,m=this.pos;this.type=7&u,s(h,r,this),this.pos===m&&this.skip(u)}return r},readMessage:function(s,r){return this.readFields(s,r,this.readVarint()+this.pos)},readFixed32:function(){var s=fg(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=s0(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=fg(this.buf,this.pos)+fg(this.buf,this.pos+4)*D_;return this.pos+=8,s},readSFixed64:function(){var s=fg(this.buf,this.pos)+s0(this.buf,this.pos+4)*D_;return this.pos+=8,s},readFloat:function(){var s=E_(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=E_(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var r,a,u=this.buf;return r=127&(a=u[this.pos++]),a<128?r:(r|=(127&(a=u[this.pos++]))<<7,a<128?r:(r|=(127&(a=u[this.pos++]))<<14,a<128?r:(r|=(127&(a=u[this.pos++]))<<21,a<128?r:function(h,m,v){var b,M,T=v.buf;if(b=(112&(M=T[v.pos++]))>>4,M<128||(b|=(127&(M=T[v.pos++]))<<3,M<128)||(b|=(127&(M=T[v.pos++]))<<10,M<128)||(b|=(127&(M=T[v.pos++]))<<17,M<128)||(b|=(127&(M=T[v.pos++]))<<24,M<128)||(b|=(1&(M=T[v.pos++]))<<31,M<128))return function Ad(s,r,a){return a?4294967296*r+(s>>>0):4294967296*(r>>>0)+(s>>>0)}(h,b,m);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(a=u[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,r=this.pos;return this.pos=s,s-r>=12&&r0?r0.decode(this.buf.subarray(r,s)):function(a,u,h){for(var m="",v=u;v<h;){var b,M,T,I=a[v],O=null,R=I>239?4:I>223?3:I>191?2:1;if(v+R>h)break;1===R?I<128&&(O=I):2===R?128==(192&(b=a[v+1]))&&(O=(31&I)<<6|63&b)<=127&&(O=null):3===R?(M=a[v+2],128==(192&(b=a[v+1]))&&128==(192&M)&&((O=(15&I)<<12|(63&b)<<6|63&M)<=2047||O>=55296&&O<=57343)&&(O=null)):4===R&&(M=a[v+2],T=a[v+3],128==(192&(b=a[v+1]))&&128==(192&M)&&128==(192&T)&&((O=(15&I)<<18|(63&b)<<12|(63&M)<<6|63&T)<=65535||O>=1114112)&&(O=null)),null===O?(O=65533,R=1):O>65535&&(O-=65536,m+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),m+=String.fromCharCode(O),v+=R}return m}(this.buf,r,s)},readBytes:function(){var s=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,s);return this.pos=s,r},readPackedVarint:function(s,r){if(this.type!==Zn.Bytes)return s.push(this.readVarint(r));var a=pl(this);for(s=s||[];this.pos<a;)s.push(this.readVarint(r));return s},readPackedSVarint:function(s){if(this.type!==Zn.Bytes)return s.push(this.readSVarint());var r=pl(this);for(s=s||[];this.pos<r;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==Zn.Bytes)return s.push(this.readBoolean());var r=pl(this);for(s=s||[];this.pos<r;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==Zn.Bytes)return s.push(this.readFloat());var r=pl(this);for(s=s||[];this.pos<r;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==Zn.Bytes)return s.push(this.readDouble());var r=pl(this);for(s=s||[];this.pos<r;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==Zn.Bytes)return s.push(this.readFixed32());var r=pl(this);for(s=s||[];this.pos<r;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==Zn.Bytes)return s.push(this.readSFixed32());var r=pl(this);for(s=s||[];this.pos<r;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==Zn.Bytes)return s.push(this.readFixed64());var r=pl(this);for(s=s||[];this.pos<r;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==Zn.Bytes)return s.push(this.readSFixed64());var r=pl(this);for(s=s||[];this.pos<r;)s.push(this.readSFixed64());return s},skip:function(s){var r=7&s;if(r===Zn.Varint)for(;this.buf[this.pos++]>127;);else if(r===Zn.Bytes)this.pos=this.readVarint()+this.pos;else if(r===Zn.Fixed32)this.pos+=4;else{if(r!==Zn.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(s,r){this.writeVarint(s<<3|r)},realloc:function(s){for(var r=this.length||16;r<this.pos+s;)r*=2;if(r!==this.length){var a=new Uint8Array(r);a.set(this.buf),this.buf=a,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),Pd(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),Pd(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),Pd(this.buf,-1&s,this.pos),Pd(this.buf,Math.floor(s*n0),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),Pd(this.buf,-1&s,this.pos),Pd(this.buf,Math.floor(s*n0),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(r,a){var u,h,m,b;if(r>=0?(u=r%4294967296|0,h=r/4294967296|0):(h=~(-r/4294967296),4294967295^(u=~(-r%4294967296))?u=u+1|0:(u=0,h=h+1|0)),r>=0x10000000000000000||r<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),m=u,(b=a).buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,m>>>=7,b.buf[b.pos++]=127&m|128,b.buf[b.pos]=127&(m>>>=7),function(m,v){var b=(7&m)<<4;v.buf[v.pos++]|=b|((m>>>=3)?128:0),m&&(v.buf[v.pos++]=127&m|((m>>>=7)?128:0),m&&(v.buf[v.pos++]=127&m|((m>>>=7)?128:0),m&&(v.buf[v.pos++]=127&m|((m>>>=7)?128:0),m&&(v.buf[v.pos++]=127&m|((m>>>=7)?128:0),m&&(v.buf[v.pos++]=127&m)))))}(h,a)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var r=this.pos;this.pos=function(u,h,m){for(var v,b,M=0;M<h.length;M++){if((v=h.charCodeAt(M))>55295&&v<57344){if(!b){v>56319||M+1===h.length?(u[m++]=239,u[m++]=191,u[m++]=189):b=v;continue}if(v<56320){u[m++]=239,u[m++]=191,u[m++]=189,b=v;continue}v=b-55296<<10|v-56320|65536,b=null}else b&&(u[m++]=239,u[m++]=191,u[m++]=189,b=null);v<128?u[m++]=v:(v<2048?u[m++]=v>>6|192:(v<65536?u[m++]=v>>12|224:(u[m++]=v>>18|240,u[m++]=v>>12&63|128),u[m++]=v>>6&63|128),u[m++]=63&v|128)}return m}(this.buf,s,this.pos);var a=this.pos-r;a>=128&&fl(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeFloat:function(s){this.realloc(4),T_(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),T_(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var r=s.length;this.writeVarint(r),this.realloc(r);for(var a=0;a<r;a++)this.buf[this.pos++]=s[a]},writeRawMessage:function(s,r){this.pos++;var a=this.pos;s(r,this);var u=this.pos-a;u>=128&&fl(a,u,this),this.pos=a-1,this.writeVarint(u),this.pos+=u},writeMessage:function(s,r,a){this.writeTag(s,Zn.Bytes),this.writeRawMessage(r,a)},writePackedVarint:function(s,r){r.length&&this.writeMessage(s,cp,r)},writePackedSVarint:function(s,r){r.length&&this.writeMessage(s,Gx,r)},writePackedBoolean:function(s,r){r.length&&this.writeMessage(s,t2,r)},writePackedFloat:function(s,r){r.length&&this.writeMessage(s,QC,r)},writePackedDouble:function(s,r){r.length&&this.writeMessage(s,e2,r)},writePackedFixed32:function(s,r){r.length&&this.writeMessage(s,n2,r)},writePackedSFixed32:function(s,r){r.length&&this.writeMessage(s,i2,r)},writePackedFixed64:function(s,r){r.length&&this.writeMessage(s,o0,r)},writePackedSFixed64:function(s,r){r.length&&this.writeMessage(s,qx,r)},writeBytesField:function(s,r){this.writeTag(s,Zn.Bytes),this.writeBytes(r)},writeFixed32Field:function(s,r){this.writeTag(s,Zn.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(s,r){this.writeTag(s,Zn.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(s,r){this.writeTag(s,Zn.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(s,r){this.writeTag(s,Zn.Fixed64),this.writeSFixed64(r)},writeVarintField:function(s,r){this.writeTag(s,Zn.Varint),this.writeVarint(r)},writeSVarintField:function(s,r){this.writeTag(s,Zn.Varint),this.writeSVarint(r)},writeStringField:function(s,r){this.writeTag(s,Zn.Bytes),this.writeString(r)},writeFloatField:function(s,r){this.writeTag(s,Zn.Fixed32),this.writeFloat(r)},writeDoubleField:function(s,r){this.writeTag(s,Zn.Fixed64),this.writeDouble(r)},writeBooleanField:function(s,r){this.writeVarintField(s,!!r)}};var kd=io(M_);const Ys=3;function up(s,r,a){r.glyphs=[],1===s&&a.readMessage(a0,r)}function a0(s,r,a){if(3===s){const{id:u,bitmap:h,width:m,height:v,left:b,top:M,advance:T}=a.readMessage(l0,{});r.glyphs.push({id:u,bitmap:new uc({width:m+2*Ys,height:v+2*Ys},h),metrics:{width:m,height:v,left:b,top:M,advance:T}})}else 4===s?r.ascender=a.readSVarint():5===s&&(r.descender=a.readSVarint())}function l0(s,r,a){1===s?r.id=a.readVarint():2===s?r.bitmap=a.readBytes():3===s?r.width=a.readVarint():4===s?r.height=a.readVarint():5===s?r.left=a.readSVarint():6===s?r.top=a.readSVarint():7===s&&(r.advance=a.readVarint())}const S_=Ys;function c0(s){let r=0,a=0;for(const v of s)r+=v.w*v.h,a=Math.max(a,v.w);s.sort((v,b)=>b.h-v.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),a),h:1/0}];let h=0,m=0;for(const v of s)for(let b=u.length-1;b>=0;b--){const M=u[b];if(!(v.w>M.w||v.h>M.h)){if(v.x=M.x,v.y=M.y,m=Math.max(m,v.y+v.h),h=Math.max(h,v.x+v.w),v.w===M.w&&v.h===M.h){const T=u.pop();b<u.length&&(u[b]=T)}else v.h===M.h?(M.x+=v.w,M.w-=v.w):v.w===M.w?(M.y+=v.h,M.h-=v.h):(u.push({x:M.x+v.w,y:M.y,w:M.w-v.w,h:v.h}),M.y+=v.h,M.h-=v.h);break}}return{w:h,h:m,fill:r/(h*m)||0}}const Lo=1;class u0{constructor(r,{pixelRatio:a,version:u,stretchX:h,stretchY:m,content:v}){this.paddedRect=r,this.pixelRatio=a,this.stretchX=h,this.stretchY=m,this.content=v,this.version=u}get tl(){return[this.paddedRect.x+Lo,this.paddedRect.y+Lo]}get br(){return[this.paddedRect.x+this.paddedRect.w-Lo,this.paddedRect.y+this.paddedRect.h-Lo]}get displaySize(){return[(this.paddedRect.w-2*Lo)/this.pixelRatio,(this.paddedRect.h-2*Lo)/this.pixelRatio]}}class gg{constructor(r,a){const u={},h={};this.haveRenderCallbacks=[];const m=[];this.addImages(r,u,m),this.addImages(a,h,m);const{w:v,h:b}=c0(m),M=new ko({width:v||1,height:b||1});for(const T in r){const I=r[T],O=u[T].paddedRect;ko.copy(I.data,M,{x:0,y:0},{x:O.x+Lo,y:O.y+Lo},I.data)}for(const T in a){const I=a[T],O=h[T].paddedRect,R=O.x+Lo,B=O.y+Lo,V=I.data.width,w=I.data.height;ko.copy(I.data,M,{x:0,y:0},{x:R,y:B},I.data),ko.copy(I.data,M,{x:0,y:w-1},{x:R,y:B-1},{width:V,height:1}),ko.copy(I.data,M,{x:0,y:0},{x:R,y:B+w},{width:V,height:1}),ko.copy(I.data,M,{x:V-1,y:0},{x:R-1,y:B},{width:1,height:w}),ko.copy(I.data,M,{x:0,y:0},{x:R+V,y:B},{width:1,height:w})}this.image=M,this.iconPositions=u,this.patternPositions=h}addImages(r,a,u){for(const h in r){const m=r[h],v={x:0,y:0,w:m.data.width+2*Lo,h:m.data.height+2*Lo};u.push(v),a[h]=new u0(v,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(r,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>r.hasImage(u)),r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const u in r.updatedImages)this.patchUpdatedImage(this.iconPositions[u],r.getImage(u),a),this.patchUpdatedImage(this.patternPositions[u],r.getImage(u),a)}patchUpdatedImage(r,a,u){if(!r||!a||r.version===a.version)return;r.version=a.version;const[h,m]=r.tl;u.update(a.data,void 0,{x:h,y:m})}}Tt(u0,"ImagePosition"),Tt(gg,"ImageAtlas");const po={horizontal:1,vertical:2,horizontalOnly:3},Zx=-17;class mg{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,a){const u=new mg;return u.scale=r||1,u.fontStack=a,u}static forImage(r){const a=new mg;return a.imageName=r,a}}class wu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,a){const u=new wu;for(let h=0;h<r.sections.length;h++){const m=r.sections[h];m.image?u.addImageSection(m):u.addTextSection(m,a)}return u}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(r){this.text=function(a,u){let h="";for(let m=0;m<a.length;m++){const v=a.charCodeAt(m+1)||null,b=a.charCodeAt(m-1)||null;h+=!u&&(v&&Nm(v)&&!Ta[a[m+1]]||b&&Nm(b)&&!Ta[a[m-1]])||!Ta[a[m]]?a[m]:Ta[a[m]]}return h}(this.text,r)}trim(){let r=0;for(let u=0;u<this.text.length&&_g[this.text.charCodeAt(u)];u++)r++;let a=this.text.length;for(let u=this.text.length-1;u>=0&&u>=r&&_g[this.text.charCodeAt(u)];u--)a--;this.text=this.text.substring(r,a),this.sectionIndex=this.sectionIndex.slice(r,a)}substring(r,a){const u=new wu;return u.text=this.text.substring(r,a),u.sectionIndex=this.sectionIndex.slice(r,a),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,a)=>Math.max(r,this.sections[a].scale),0)}addTextSection(r,a){this.text+=r.text,this.sections.push(mg.forText(r.scale,r.fontStack||a));const u=this.sections.length-1;for(let h=0;h<r.text.length;++h)this.sectionIndex.push(u)}addImageSection(r){const a=r.image?r.image.name:"";if(0===a.length)return void oi("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(mg.forImage(a)),this.sectionIndex.push(this.sections.length-1)):oi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function I_(s,r,a,u,h,m,v,b,M,T,I,O,R,B,V){const w=wu.fromFeature(s,h);O===po.vertical&&w.verticalizePunctuation(R);let K=[];const G=function(ve,Re,ke,$e,rt,Ne){if(!ve)return[];const Ye=[],Xe=function(yt,St,Ct,Qt,dt,zt){let Xt=0;for(let In=0;In<yt.length();In++){const en=yt.getSection(In);Xt+=d0(yt.getCharCode(In),en,Qt,dt,St,zt)}return Xt/Math.max(1,Math.ceil(Xt/Ct))}(ve,Re,ke,$e,rt,Ne),nt=ve.text.indexOf("\u200b")>=0;let ct=0;for(let yt=0;yt<ve.length();yt++){const St=ve.getSection(yt),Ct=ve.getCharCode(yt);if(_g[Ct]||(ct+=d0(Ct,St,$e,rt,Re,Ne)),yt<ve.length()-1){const Qt=!((Ue=Ct)<11904||!(Mt["Bopomofo Extended"](Ue)||Mt.Bopomofo(Ue)||Mt["CJK Compatibility Forms"](Ue)||Mt["CJK Compatibility Ideographs"](Ue)||Mt["CJK Compatibility"](Ue)||Mt["CJK Radicals Supplement"](Ue)||Mt["CJK Strokes"](Ue)||Mt["CJK Symbols and Punctuation"](Ue)||Mt["CJK Unified Ideographs Extension A"](Ue)||Mt["CJK Unified Ideographs"](Ue)||Mt["Enclosed CJK Letters and Months"](Ue)||Mt["Halfwidth and Fullwidth Forms"](Ue)||Mt.Hiragana(Ue)||Mt["Ideographic Description Characters"](Ue)||Mt["Kangxi Radicals"](Ue)||Mt["Katakana Phonetic Extensions"](Ue)||Mt.Katakana(Ue)||Mt["Vertical Forms"](Ue)||Mt["Yi Radicals"](Ue)||Mt["Yi Syllables"](Ue)));(Wx[Ct]||Qt||St.imageName)&&Ye.push(h0(yt+1,ct,Xe,Ye,vg(Ct,ve.getCharCode(yt+1),Qt&&nt),!1))}}var Ue;return yg(h0(ve.length(),ct,Xe,Ye,0,!0))}(w,T,m,r,u,B),{processBidirectionalText:me,processStyledBidirectionalText:ae}=S;if(me&&1===w.sections.length){const ve=me(w.toString(),G);for(const Re of ve){const ke=new wu;ke.text=Re,ke.sections=w.sections;for(let $e=0;$e<Re.length;$e++)ke.sectionIndex.push(0);K.push(ke)}}else if(ae){const ve=ae(w.text,w.sectionIndex,G);for(const Re of ve){const ke=new wu;ke.text=Re[0],ke.sectionIndex=Re[1],ke.sections=w.sections,K.push(ke)}}else K=function(ve,Re){const ke=[],$e=ve.text;let rt=0;for(const Ne of Re)ke.push(ve.substring(rt,Ne)),rt=Ne;return rt<$e.length&&ke.push(ve.substring(rt,$e.length)),ke}(w,G);const fe=[],_e={positionedLines:fe,text:w.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:O,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ve,Re,ke,$e,rt,Ne,Ye,Xe,nt,ct,Ue,yt){let St=0,Ct=0,Qt=0;const dt="right"===Xe?1:"left"===Xe?0:.5;let zt=!1;for(const rn of rt){const sn=rn.getSections();for(const Vn of sn){if(Vn.imageName)continue;const Wn=Re[Vn.fontStack];if(Wn&&(zt=void 0!==Wn.ascender&&void 0!==Wn.descender,!zt))break}if(!zt)break}let Xt=0;for(const rn of rt){rn.trim();const sn=rn.getMaxScale(),Vn=(sn-1)*zi,Wn={positionedGlyphs:[],lineOffset:0};ve.positionedLines[Xt]=Wn;const Jn=Wn.positionedGlyphs;let Xn=0;if(!rn.length()){Ct+=Ne,++Xt;continue}let vi=0,Ci=0;for(let Yn=0;Yn<rn.length();Yn++){const Vi=rn.getSection(Yn),Wi=rn.getSectionIndex(Yn),Mi=rn.getCharCode(Yn);let Ln=Vi.scale,Xi=null,Qn=null,Ai=null,Pi=zi,wr=0;const hr=!(nt===po.horizontal||!Ue&&!bf(Mi)||Ue&&(_g[Mi]||(In=Mi,Mt.Arabic(In)||Mt["Arabic Supplement"](In)||Mt["Arabic Extended-A"](In)||Mt["Arabic Presentation Forms-A"](In)||Mt["Arabic Presentation Forms-B"](In))));if(Vi.imageName){const no=$e[Vi.imageName];if(!no)continue;Ai=Vi.imageName,ve.iconsInText=ve.iconsInText||!0,Qn=no.paddedRect;const pr=no.displaySize;Ln=Ln*zi/yt,Xi={width:pr[0],height:pr[1],left:Lo,top:-S_,advance:hr?pr[1]:pr[0],localGlyph:!1},wr=zt?-Xi.height*Ln:Zx+sn*zi-pr[1]*Ln,Pi=Xi.advance;const Is=(hr?pr[0]:pr[1])*Ln-zi*sn;Is>0&&Is>Xn&&(Xn=Is)}else{const no=ke[Vi.fontStack];if(!no)continue;no[Mi]&&(Qn=no[Mi]);const pr=Re[Vi.fontStack];if(!pr)continue;const Is=pr.glyphs[Mi];if(!Is)continue;if(Xi=Is.metrics,Pi=8203!==Mi?zi:0,zt){const yl=void 0!==pr.ascender?Math.abs(pr.ascender):0,Iu=void 0!==pr.descender?Math.abs(pr.descender):0,Vg=(yl+Iu)*Ln;vi<Vg&&(vi=Vg,Ci=(yl-Iu)/2*Ln),wr=-yl*Ln}else wr=Zx+(sn-Ln)*zi}hr?(ve.verticalizable=!0,Jn.push({glyph:Mi,imageName:Ai,x:St,y:Ct+wr,vertical:hr,scale:Ln,localGlyph:Xi.localGlyph,fontStack:Vi.fontStack,sectionIndex:Wi,metrics:Xi,rect:Qn}),St+=Pi*Ln+ct):(Jn.push({glyph:Mi,imageName:Ai,x:St,y:Ct+wr,vertical:hr,scale:Ln,localGlyph:Xi.localGlyph,fontStack:Vi.fontStack,sectionIndex:Wi,metrics:Xi,rect:Qn}),St+=Xi.advance*Ln+ct)}0!==Jn.length&&(Qt=Math.max(St-ct,Qt),zt?Cu(Jn,dt,Xn,Ci,Ne*sn/2):Cu(Jn,dt,Xn,0,Ne/2)),St=0;const Zi=Ne*sn+Xn;Wn.lineOffset=Math.max(Xn,Vn),Ct+=Zi,++Xt}var In;const en=Ct,{horizontalAlign:Rt,verticalAlign:ii}=P_(Ye);(function(rn,sn,Vn,Wn,Jn,Xn){const vi=(sn-Vn)*Jn,Ci=-Xn*Wn;for(const Zi of rn)for(const Yn of Zi.positionedGlyphs)Yn.x+=vi,Yn.y+=Ci})(ve.positionedLines,dt,Rt,ii,Qt,en),ve.top+=-ii*en,ve.bottom=ve.top+en,ve.left+=-Rt*Qt,ve.right=ve.left+Qt,ve.hasBaseline=zt}(_e,r,a,u,K,v,b,M,O,T,R,V),!function(ve){for(const Re of ve)if(0!==Re.positionedGlyphs.length)return!1;return!0}(fe)&&_e}const _g={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Wx={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function d0(s,r,a,u,h,m){if(r.imageName){const v=u[r.imageName];return v?v.displaySize[0]*r.scale*zi/m+h:0}{const v=a[r.fontStack],b=v&&v.glyphs[s];return b?b.metrics.advance*r.scale+h:0}}function A_(s,r,a,u){const h=Math.pow(s-r,2);return u?s<r?h/2:2*h:h+Math.abs(a)*a}function vg(s,r,a){let u=0;return 10===s&&(u-=1e4),a&&(u+=150),40!==s&&65288!==s||(u+=50),41!==r&&65289!==r||(u+=50),u}function h0(s,r,a,u,h,m){let v=null,b=A_(r,a,h,m);for(const M of u){const T=A_(r-M.x,a,h,m)+M.badness;T<=b&&(v=M,b=T)}return{index:s,x:r,priorBreak:v,badness:b}}function yg(s){return s?yg(s.priorBreak).concat(s.index):[]}function P_(s){let r=.5,a=.5;switch(s){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:r,verticalAlign:a}}function Cu(s,r,a,u,h){if(!(r||a||u||h))return;const m=s.length-1,v=s[m],b=(v.x+v.metrics.advance*v.scale)*r;for(let M=0;M<=m;M++)s[M].x-=b,s[M].y+=a+u+h}function Xx(s,r,a){const{horizontalAlign:u,verticalAlign:h}=P_(a),m=r[0]-s.displaySize[0]*u,v=r[1]-s.displaySize[1]*h;return{image:s,top:v,bottom:v+s.displaySize[1],left:m,right:m+s.displaySize[0]}}function p0(s,r,a,u,h,m){const v=s.image;let b;if(v.content){const K=v.content,G=v.pixelRatio||1;b=[K[0]/G,K[1]/G,v.displaySize[0]-K[2]/G,v.displaySize[1]-K[3]/G]}const M=r.left*m,T=r.right*m;let I,O,R,B;"width"===a||"both"===a?(B=h[0]+M-u[3],O=h[0]+T+u[1]):(B=h[0]+(M+T-v.displaySize[0])/2,O=B+v.displaySize[0]);const V=r.top*m,w=r.bottom*m;return"height"===a||"both"===a?(I=h[1]+V-u[0],R=h[1]+w+u[2]):(I=h[1]+(V+w-v.displaySize[1])/2,R=I+v.displaySize[1]),{image:v,top:I,right:O,bottom:R,left:B,collisionPadding:b}}class Da extends _t{constructor(r,a,u,h,m){super(r,a),this.angle=h,this.z=u,void 0!==m&&(this.segment=m)}clone(){return new Da(this.x,this.y,this.z,this.angle,this.segment)}}function k_(s,r,a,u,h){if(void 0===r.segment)return!0;let m=r,v=r.segment+1,b=0;for(;b>-a/2;){if(v--,v<0)return!1;b-=s[v].dist(m),m=s[v]}b+=s[v].dist(s[v+1]),v++;const M=[];let T=0;for(;b<a/2;){const I=s[v],O=s[v+1];if(!O)return!1;let R=s[v-1].angleTo(I)-I.angleTo(O);for(R=Math.abs((R+3*Math.PI)%(2*Math.PI)-Math.PI),M.push({distance:b,angleDelta:R}),T+=R;b-M[0].distance>u;)T-=M.shift().angleDelta;if(T>h)return!1;v++,b+=I.dist(O)}return!0}function f0(s){let r=0;for(let a=0;a<s.length-1;a++)r+=s[a].dist(s[a+1]);return r}function g0(s,r,a){return s?.6*r*a:0}function m0(s,r){return Math.max(s?s.right-s.left:0,r?r.right-r.left:0)}function Yx(s,r,a,u,h,m){const v=g0(a,h,m),b=m0(a,u)*m;let M=0;const T=f0(s)/2;for(let I=0;I<s.length-1;I++){const O=s[I],R=s[I+1],B=O.dist(R);if(M+B>T){const V=(T-M)/B,w=wn(O.x,R.x,V),K=wn(O.y,R.y,V),G=new Da(w,K,0,R.angleTo(O),I);return!v||k_(s,G,b,v,r)?G:void 0}M+=B}}function _0(s,r,a,u,h,m,v,b,M){const T=g0(u,m,v),I=m0(u,h),O=I*v,R=0===s[0].x||s[0].x===M||0===s[0].y||s[0].y===M;return r-O<r/4&&(r=O+r/4),Kx(s,R?r/2*b%r:(I/2+2*m)*v*b%r,r,T,a,O,R,!1,M)}function Kx(s,r,a,u,h,m,v,b,M){const T=m/2,I=f0(s);let O=0,R=r-a,B=[];for(let V=0;V<s.length-1;V++){const w=s[V],K=s[V+1],G=w.dist(K),me=K.angleTo(w);for(;R+a<O+G;){R+=a;const ae=(R-O)/G,fe=wn(w.x,K.x,ae),_e=wn(w.y,K.y,ae);if(fe>=0&&fe<M&&_e>=0&&_e<M&&R-T>=0&&R+T<=I){const ve=new Da(fe,_e,0,me,V);ve._round(),u&&!k_(s,ve,m,u,h)||B.push(ve)}}O+=G}return b||B.length||v||(B=Kx(s,O/2,a,u,h,m,v,!0,M)),B}function Jx(s,r,a,u,h){const m=[];for(let v=0;v<s.length;v++){const b=s[v];let M;for(let T=0;T<b.length-1;T++){let I=b[T],O=b[T+1];I.x<r&&O.x<r||(I.x<r?I=new _t(r,I.y+(r-I.x)/(O.x-I.x)*(O.y-I.y))._round():O.x<r&&(O=new _t(r,I.y+(r-I.x)/(O.x-I.x)*(O.y-I.y))._round()),I.y<a&&O.y<a||(I.y<a?I=new _t(I.x+(a-I.y)/(O.y-I.y)*(O.x-I.x),a)._round():O.y<a&&(O=new _t(I.x+(a-I.y)/(O.y-I.y)*(O.x-I.x),a)._round()),I.x>=u&&O.x>=u||(I.x>=u?I=new _t(u,I.y+(u-I.x)/(O.x-I.x)*(O.y-I.y))._round():O.x>=u&&(O=new _t(u,I.y+(u-I.x)/(O.x-I.x)*(O.y-I.y))._round()),I.y>=h&&O.y>=h||(I.y>=h?I=new _t(I.x+(h-I.y)/(O.y-I.y)*(O.x-I.x),h)._round():O.y>=h&&(O=new _t(I.x+(h-I.y)/(O.y-I.y)*(O.x-I.x),h)._round()),M&&I.equals(M[M.length-1])||(M=[I],m.push(M)),M.push(O)))))}}return m}Tt(Da,"Anchor");const gl=1e20;function Ot(s,r,a,u,h,m,v,b,M){for(let T=r;T<r+u;T++)Od(s,a*m+T,m,h,v,b,M);for(let T=a;T<a+h;T++)Od(s,T*m+r,1,u,v,b,M)}function Od(s,r,a,u,h,m,v){m[0]=0,v[0]=-gl,v[1]=gl,h[0]=s[r];for(let b=1,M=0,T=0;b<u;b++){h[b]=s[r+b*a];const I=b*b;do{const O=m[M];T=(h[b]-h[O]+I-O*O)/(b-O)/2}while(T<=v[M]&&--M>-1);M++,m[M]=b,v[M]=T,v[M+1]=gl}for(let b=0,M=0;b<u;b++){for(;v[M+1]<b;)M++;const T=m[M],I=b-T;s[r+b*a]=h[T]+I*I}}const Ts=2,xg={none:0,ideographs:1,all:2};class dc{constructor(r,a,u){this.requestManager=r,this.localGlyphMode=a,this.localFontFamily=u,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r){this.url=r}getGlyphs(r,a){const u=[];for(const h in r)for(const m of r[h])u.push({stack:h,id:m});sr(u,({stack:h,id:m},v)=>{let b=this.entries[h];b||(b=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let M=b.glyphs[m];if(void 0!==M)return void v(null,{stack:h,id:m,glyph:M});if(M=this._tinySDF(b,h,m),M)return b.glyphs[m]=M,void v(null,{stack:h,id:m,glyph:M});const T=Math.floor(m/256);if(256*T>65535)return void v(new Error("glyphs > 65535 not supported"));if(b.ranges[T])return void v(null,{stack:h,id:m,glyph:M});let I=b.requests[T];I||(I=b.requests[T]=[],dc.loadGlyphRange(h,T,this.url,this.requestManager,(O,R)=>{if(R){b.ascender=R.ascender,b.descender=R.descender;for(const B in R.glyphs)this._doesCharSupportLocalGlyph(+B)||(b.glyphs[+B]=R.glyphs[+B]);b.ranges[T]=!0}for(const B of I)B(O,R);delete b.requests[T]})),I.push((O,R)=>{O?v(O):R&&v(null,{stack:h,id:m,glyph:R.glyphs[m]||null})})},(h,m)=>{if(h)a(h);else if(m){const v={};for(const{stack:b,id:M,glyph:T}of m)void 0===v[b]&&(v[b]={}),void 0===v[b].glyphs&&(v[b].glyphs={}),v[b].glyphs[M]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics},v[b].ascender=this.entries[b].ascender,v[b].descender=this.entries[b].descender;a(null,v)}})}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==xg.none&&(this.localGlyphMode===xg.all?!!this.localFontFamily:!!this.localFontFamily&&(Mt["CJK Unified Ideographs"](r)||Mt["Hangul Syllables"](r)||Mt.Hiragana(r)||Mt.Katakana(r)||Mt["CJK Symbols and Punctuation"](r)))}_tinySDF(r,a,u){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(u))return;let m=r.tinySDF;if(!m){let w="400";/bold/i.test(a)?w="900":/medium/i.test(a)?w="500":/light/i.test(a)&&(w="200"),m=r.tinySDF=new dc.TinySDF({fontFamily:h,fontWeight:w,fontSize:24*Ts,buffer:3*Ts,radius:8*Ts}),m.fontWeight=w}if(this.localGlyphs[m.fontWeight][u])return this.localGlyphs[m.fontWeight][u];const v=String.fromCharCode(u),{data:b,width:M,height:T,glyphWidth:I,glyphHeight:O,glyphLeft:R,glyphTop:B,glyphAdvance:V}=m.draw(v);return this.localGlyphs[m.fontWeight][u]={id:u,bitmap:new uc({width:M,height:T},b),metrics:{width:I/Ts,height:O/Ts,left:R/Ts,top:B/Ts-27,advance:V/Ts,localGlyph:!0}}}}dc.loadGlyphRange=function(s,r,a,u,h){const m=256*r,v=m+255,b=u.transformRequest(u.normalizeGlyphsURL(a).replace("{fontstack}",s).replace("{range}",`${m}-${v}`),Xr.Glyphs);kl(b,(M,T)=>{if(M)h(M);else if(T){const I={},O=new kd(T).readFields(up,{});for(const R of O.glyphs)I[R.id]=R;h(null,{glyphs:I,ascender:O.ascender,descender:O.descender})}})},dc.TinySDF=class{constructor({fontSize:s=24,buffer:r=3,radius:a=8,cutoff:u=.25,fontFamily:h="sans-serif",fontWeight:m="normal",fontStyle:v="normal"}={}){this.buffer=r,this.cutoff=u,this.radius=a;const b=this.size=s+4*r,M=this._createCanvas(b),T=this.ctx=M.getContext("2d",{willReadFrequently:!0});T.font=`${v} ${m} ${s}px ${h}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(s){const r=document.createElement("canvas");return r.width=r.height=s,r}draw(s){const{width:r,actualBoundingBoxAscent:a,actualBoundingBoxDescent:u,actualBoundingBoxLeft:h,actualBoundingBoxRight:m}=this.ctx.measureText(s),v=Math.ceil(a),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-h))),M=Math.min(this.size-this.buffer,v+Math.ceil(u)),T=b+2*this.buffer,I=M+2*this.buffer,O=Math.max(T*I,0),R=new Uint8ClampedArray(O),B={data:R,width:T,height:I,glyphWidth:b,glyphHeight:M,glyphTop:v,glyphLeft:0,glyphAdvance:r};if(0===b||0===M)return B;const{ctx:V,buffer:w,gridInner:K,gridOuter:G}=this;V.clearRect(w,w,b,M),V.fillText(s,w,w+v);const me=V.getImageData(w,w,b,M);G.fill(gl,0,O),K.fill(0,0,O);for(let ae=0;ae<M;ae++)for(let fe=0;fe<b;fe++){const _e=me.data[4*(ae*b+fe)+3]/255;if(0===_e)continue;const ve=(ae+w)*T+fe+w;if(1===_e)G[ve]=0,K[ve]=gl;else{const Re=.5-_e;G[ve]=Re>0?Re*Re:0,K[ve]=Re<0?Re*Re:0}}Ot(G,0,0,T,I,T,this.f,this.v,this.z),Ot(K,w,w,b,M,T,this.f,this.v,this.z);for(let ae=0;ae<O;ae++){const fe=Math.sqrt(G[ae])-Math.sqrt(K[ae]);R[ae]=Math.round(255-255*(fe/this.radius+this.cutoff))}return B}};const hc=Lo;function v0(s,r,a,u){const h=[],m=s.image,v=m.pixelRatio,b=m.paddedRect.w-2*hc,M=m.paddedRect.h-2*hc,T=s.right-s.left,I=s.bottom-s.top,O=m.stretchX||[[0,b]],R=m.stretchY||[[0,M]],B=(Ne,Ye)=>Ne+Ye[1]-Ye[0],V=O.reduce(B,0),w=R.reduce(B,0),K=b-V,G=M-w;let me=0,ae=V,fe=0,_e=w,ve=0,Re=K,ke=0,$e=G;if(m.content&&u){const Ne=m.content;me=dp(O,0,Ne[0]),fe=dp(R,0,Ne[1]),ae=dp(O,Ne[0],Ne[2]),_e=dp(R,Ne[1],Ne[3]),ve=Ne[0]-me,ke=Ne[1]-fe,Re=Ne[2]-Ne[0]-ae,$e=Ne[3]-Ne[1]-_e}const rt=(Ne,Ye,Xe,nt)=>{const ct=Mu(Ne.stretch-me,ae,T,s.left),Ue=L_(Ne.fixed-ve,Re,Ne.stretch,V),yt=Mu(Ye.stretch-fe,_e,I,s.top),St=L_(Ye.fixed-ke,$e,Ye.stretch,w),Ct=Mu(Xe.stretch-me,ae,T,s.left),Qt=L_(Xe.fixed-ve,Re,Xe.stretch,V),dt=Mu(nt.stretch-fe,_e,I,s.top),zt=L_(nt.fixed-ke,$e,nt.stretch,w),Xt=new _t(ct,yt),In=new _t(Ct,yt),en=new _t(Ct,dt),Rt=new _t(ct,dt),ii=new _t(Ue/v,St/v),rn=new _t(Qt/v,zt/v),sn=r*Math.PI/180;if(sn){const Jn=Math.sin(sn),Xn=Math.cos(sn),vi=[Xn,-Jn,Jn,Xn];Xt._matMult(vi),In._matMult(vi),Rt._matMult(vi),en._matMult(vi)}const Vn=Ne.stretch+Ne.fixed,Wn=Ye.stretch+Ye.fixed;return{tl:Xt,tr:In,bl:Rt,br:en,tex:{x:m.paddedRect.x+hc+Vn,y:m.paddedRect.y+hc+Wn,w:Xe.stretch+Xe.fixed-Vn,h:nt.stretch+nt.fixed-Wn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ii,pixelOffsetBR:rn,minFontScaleX:Re/v/T,minFontScaleY:$e/v/I,isSDF:a}};if(u&&(m.stretchX||m.stretchY)){const Ne=O_(O,K,V),Ye=O_(R,G,w);for(let Xe=0;Xe<Ne.length-1;Xe++){const nt=Ne[Xe],ct=Ne[Xe+1];for(let Ue=0;Ue<Ye.length-1;Ue++)h.push(rt(nt,Ye[Ue],ct,Ye[Ue+1]))}}else h.push(rt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:M+1}));return h}function dp(s,r,a){let u=0;for(const h of s)u+=Math.max(r,Math.min(a,h[1]))-Math.max(r,Math.min(a,h[0]));return u}function O_(s,r,a){const u=[{fixed:-hc,stretch:0}];for(const[h,m]of s){const v=u[u.length-1];u.push({fixed:h-v.stretch,stretch:v.stretch}),u.push({fixed:h-v.stretch,stretch:v.stretch+(m-h)})}return u.push({fixed:r+hc,stretch:a}),u}function Mu(s,r,a,u){return s/r*a+u}function L_(s,r,a,u){return s-r*a/u}function R_(s,r,a,u){const h=r+s.positionedLines[u].lineOffset;return 0===u?a+h/2:a+(h+(r+s.positionedLines[u-1].lineOffset))/2}class Qx{constructor(r=[],a=F_){if(this.data=r,this.length=this.data.length,this.compare=a,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const r=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:a,compare:u}=this,h=a[r];for(;r>0;){const m=r-1>>1,v=a[m];if(u(h,v)>=0)break;a[r]=v,r=m}a[r]=h}_down(r){const{data:a,compare:u}=this,h=this.length>>1,m=a[r];for(;r<h;){let v=1+(r<<1),b=a[v];const M=v+1;if(M<this.length&&u(a[M],b)<0&&(v=M,b=a[M]),u(b,m)>=0)break;a[r]=b,r=v}a[r]=m}}function F_(s,r){return s<r?-1:s>r?1:0}function y0(s,r=1,a=!1){let u=1/0,h=1/0,m=-1/0,v=-1/0;const b=s[0];for(let B=0;B<b.length;B++){const V=b[B];(!B||V.x<u)&&(u=V.x),(!B||V.y<h)&&(h=V.y),(!B||V.x>m)&&(m=V.x),(!B||V.y>v)&&(v=V.y)}const M=Math.min(m-u,v-h);let T=M/2;const I=new Qx([],x0);if(0===M)return new _t(u,h);for(let B=u;B<m;B+=M)for(let V=h;V<v;V+=M)I.push(new Ds(B+T,V+T,T,s));let O=function(B){let V=0,w=0,K=0;const G=B[0];for(let me=0,ae=G.length,fe=ae-1;me<ae;fe=me++){const _e=G[me],ve=G[fe],Re=_e.x*ve.y-ve.x*_e.y;w+=(_e.x+ve.x)*Re,K+=(_e.y+ve.y)*Re,V+=3*Re}return new Ds(w/V,K/V,0,B)}(s),R=I.length;for(;I.length;){const B=I.pop();(B.d>O.d||!O.d)&&(O=B,a&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,R)),B.max-O.d<=r||(T=B.h/2,I.push(new Ds(B.p.x-T,B.p.y-T,T,s)),I.push(new Ds(B.p.x+T,B.p.y-T,T,s)),I.push(new Ds(B.p.x-T,B.p.y+T,T,s)),I.push(new Ds(B.p.x+T,B.p.y+T,T,s)),R+=4)}return a&&(console.log(`num probes: ${R}`),console.log(`best distance: ${O.d}`)),O.p}function x0(s,r){return r.max-s.max}class Ds{constructor(r,a,u,h){this.p=new _t(r,a),this.h=u,this.d=function(m,v){let b=!1,M=1/0;for(let T=0;T<v.length;T++){const I=v[T];for(let O=0,R=I.length,B=R-1;O<R;B=O++){const V=I[O],w=I[B];V.y>m.y!=w.y>m.y&&m.x<(w.x-V.x)*(m.y-V.y)/(w.y-V.y)+V.x&&(b=!b),M=Math.min(M,Yh(m,V,w))}}return(b?1:-1)*Math.sqrt(M)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const Ld=7,hp=Number.POSITIVE_INFINITY,bg=Math.sqrt(2);function b0(s,[r,a]){let u=0,h=0;if(a===hp){r<0&&(r=0);const m=r/bg;switch(s){case"top-right":case"top-left":h=m-Ld;break;case"bottom-right":case"bottom-left":h=-m+Ld;break;case"bottom":h=-r+Ld;break;case"top":h=r-Ld}switch(s){case"top-right":case"bottom-right":u=-m;break;case"top-left":case"bottom-left":u=m;break;case"left":u=r;break;case"right":u=-r}}else{switch(r=Math.abs(r),a=Math.abs(a),s){case"top-right":case"top-left":case"top":h=a-Ld;break;case"bottom-right":case"bottom-left":case"bottom":h=-a+Ld}switch(s){case"top-right":case"bottom-right":case"right":u=-r;break;case"top-left":case"bottom-left":case"left":u=r}}return[u,h]}function N_(s,r,a,u,h,m,v,b,M,T){s.createArrays(),s.tilePixelRatio=Bt/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const I=s.layers[0].layout,O=s.layers[0]._unevaluatedLayout._values,R={};if("composite"===s.textSizeData.kind){const{minZoom:w,maxZoom:K}=s.textSizeData;R.compositeTextSizes=[O["text-size"].possiblyEvaluate(new k(w),b),O["text-size"].possiblyEvaluate(new k(K),b)]}if("composite"===s.iconSizeData.kind){const{minZoom:w,maxZoom:K}=s.iconSizeData;R.compositeIconSizes=[O["icon-size"].possiblyEvaluate(new k(w),b),O["icon-size"].possiblyEvaluate(new k(K),b)]}R.layoutTextSize=O["text-size"].possiblyEvaluate(new k(M+1),b),R.layoutIconSize=O["icon-size"].possiblyEvaluate(new k(M+1),b),R.textMaxSize=O["text-size"].possiblyEvaluate(new k(18),b);const B="map"===I.get("text-rotation-alignment")&&"point"!==I.get("symbol-placement"),V=I.get("text-size");for(const w of s.features){const K=I.get("text-font").evaluate(w,{},b).join(","),G=V.evaluate(w,{},b),me=R.layoutTextSize.evaluate(w,{},b),ae=(R.layoutIconSize.evaluate(w,{},b),{horizontal:{},vertical:void 0}),fe=w.text;let _e,ve=[0,0];if(fe){const $e=fe.toString(),rt=I.get("text-letter-spacing").evaluate(w,{},b)*zi,Ne=I.get("text-line-height").evaluate(w,{},b)*zi,Ye=xf($e)?rt:0,Xe=I.get("text-anchor").evaluate(w,{},b),nt=I.get("text-variable-anchor");if(!nt){const Ct=I.get("text-radial-offset").evaluate(w,{},b);ve=Ct?b0(Xe,[Ct*zi,hp]):I.get("text-offset").evaluate(w,{},b).map(Qt=>Qt*zi)}let ct=B?"center":I.get("text-justify").evaluate(w,{},b);const Ue="point"===I.get("symbol-placement"),yt=Ue?I.get("text-max-width").evaluate(w,{},b)*zi:1/0,St=Ct=>{s.allowVerticalPlacement&&yf($e)&&(ae.vertical=I_(fe,r,a,h,K,yt,Ne,Xe,Ct,Ye,ve,po.vertical,!0,me,G))};if(!B&&nt){const Ct="auto"===ct?nt.map(dt=>Rd(dt)):[ct];let Qt=!1;for(let dt=0;dt<Ct.length;dt++){const zt=Ct[dt];if(!ae.horizontal[zt])if(Qt)ae.horizontal[zt]=ae.horizontal[0];else{const Xt=I_(fe,r,a,h,K,yt,Ne,"center",zt,Ye,ve,po.horizontal,!1,me,G);Xt&&(ae.horizontal[zt]=Xt,Qt=1===Xt.positionedLines.length)}}St("left")}else{if("auto"===ct&&(ct=Rd(Xe)),Ue||I.get("text-writing-mode").indexOf("horizontal")>=0||!yf($e)){const Ct=I_(fe,r,a,h,K,yt,Ne,Xe,ct,Ye,ve,po.horizontal,!1,me,G);Ct&&(ae.horizontal[ct]=Ct)}St(Ue?"left":ct)}}let Re=!1;if(w.icon&&w.icon.name){const $e=u[w.icon.name];$e&&(_e=Xx(h[w.icon.name],I.get("icon-offset").evaluate(w,{},b),I.get("icon-anchor").evaluate(w,{},b)),Re=$e.sdf,void 0===s.sdfIcons?s.sdfIcons=$e.sdf:s.sdfIcons!==$e.sdf&&oi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),($e.pixelRatio!==s.pixelRatio||0!==I.get("icon-rotate").constantOr(1))&&(s.iconsNeedLinear=!0))}const ke=C0(ae.horizontal)||ae.vertical;s.iconsInText||(s.iconsInText=!!ke&&ke.iconsInText),(ke||_e)&&ns(s,w,ae,_e,u,R,me,0,ve,Re,v,b,T)}m&&s.generateCollisionDebugBuffers(M,s.collisionBoxArray)}function Rd(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ns(s,r,a,u,h,m,v,b,M,T,I,O,R){let B=m.textMaxSize.evaluate(r,{},O);void 0===B&&(B=v);const V=s.layers[0].layout,w=V.get("icon-offset").evaluate(r,{},O),K=C0(a.horizontal)||a.vertical,G="globe"===R.name,me=zi,ae=v/me,fe=s.tilePixelRatio*B/me,_e=(Xe=s.overscaling,s.zoom>18&&Xe>2&&(Xe>>=1),Math.max(Bt/(512*Xe),1)*V.get("symbol-spacing")),ve=V.get("text-padding")*s.tilePixelRatio,Re=V.get("icon-padding")*s.tilePixelRatio,ke=fn(V.get("text-max-angle")),$e="map"===V.get("text-rotation-alignment")&&"point"!==V.get("symbol-placement"),rt="map"===V.get("icon-rotation-alignment")&&"point"!==V.get("symbol-placement"),Ne=V.get("symbol-placement"),Ye=_e/2;var Xe;const nt=V.get("icon-text-fit");let ct;u&&"none"!==nt&&(s.allowVerticalPlacement&&a.vertical&&(ct=p0(u,a.vertical,nt,V.get("icon-text-fit-padding"),w,ae)),K&&(u=p0(u,K,nt,V.get("icon-text-fit-padding"),w,ae)));const Ue=(yt,St,Ct)=>{if(St.x<0||St.x>=Bt||St.y<0||St.y>=Bt)return;let Qt=null;if(G){const{x:dt,y:zt,z:Xt}=R.projectTilePoint(St.x,St.y,Ct);Qt={anchor:new Da(dt,zt,Xt,0,void 0),up:R.upVector(Ct,St.x,St.y)}}!function(dt,zt,Xt,In,en,Rt,ii,rn,sn,Vn,Wn,Jn,Xn,vi,Ci,Zi,Yn,Vi,Wi,Mi,Ln,Xi,Qn,Ai,Pi){const wr=dt.addToLineVertexArray(zt,In);let hr,no,pr,Is,yl,Iu,Vg,Y_=0,K_=0,J_=0,Q_=0,Cp=-1,ta=-1;const Aa={};let z0=le("");const xl=Xt?Xt.anchor:zt;let ev=0,Ug=0;if(void 0===sn._unevaluatedLayout.getValue("text-radial-offset")?[ev,Ug]=sn.layout.get("text-offset").evaluate(Ln,{},Pi).map(Gr=>Gr*zi):(ev=sn.layout.get("text-radial-offset").evaluate(Ln,{},Pi)*zi,Ug=hp),dt.allowVerticalPlacement&&en.vertical){const Gr=en.vertical;if(Ci)Iu=fc(Gr),rn&&(Vg=fc(rn));else{const os=sn.layout.get("text-rotate").evaluate(Ln,{},Pi)+90;pr=pp(Vn,xl,zt,Wn,Jn,Xn,Gr,vi,os,Zi),rn&&(Is=pp(Vn,xl,zt,Wn,Jn,Xn,rn,Vi,os))}}if(Rt){const Gr=sn.layout.get("icon-rotate").evaluate(Ln,{},Pi),os="none"!==sn.layout.get("icon-text-fit"),Ep=v0(Rt,Gr,Qn,os),jg=rn?v0(rn,Gr,Qn,os):void 0;no=pp(Vn,xl,zt,Wn,Jn,Xn,Rt,Vi,Gr),Y_=4*Ep.length;const tv=dt.iconSizeData;let Au=null;"source"===tv.kind?(Au=[Xs*sn.layout.get("icon-size").evaluate(Ln,{},Pi)],Au[0]>Sa&&oi(`${dt.layerIds[0]}: Value for "icon-size" is >= ${pc}. Reduce your "icon-size".`)):"composite"===tv.kind&&(Au=[Xs*Xi.compositeIconSizes[0].evaluate(Ln,{},Pi),Xs*Xi.compositeIconSizes[1].evaluate(Ln,{},Pi)],(Au[0]>Sa||Au[1]>Sa)&&oi(`${dt.layerIds[0]}: Value for "icon-size" is >= ${pc}. Reduce your "icon-size".`)),dt.addSymbols(dt.icon,Ep,Au,Mi,Wi,Ln,!1,Xt,zt,wr.lineStartIndex,wr.lineLength,-1,Ai,Pi),Cp=dt.icon.placedSymbolArray.length-1,jg&&(K_=4*jg.length,dt.addSymbols(dt.icon,jg,Au,Mi,Wi,Ln,po.vertical,Xt,zt,wr.lineStartIndex,wr.lineLength,-1,Ai,Pi),ta=dt.icon.placedSymbolArray.length-1)}for(const Gr in en.horizontal){const os=en.horizontal[Gr];hr||(z0=le(os.text),Ci?yl=fc(os):hr=pp(Vn,xl,zt,Wn,Jn,Xn,os,vi,sn.layout.get("text-rotate").evaluate(Ln,{},Pi),Zi));const Ep=1===os.positionedLines.length;if(J_+=w0(dt,Xt,zt,os,ii,sn,Ci,Ln,Zi,wr,en.vertical?po.horizontal:po.horizontalOnly,Ep?Object.keys(en.horizontal):[Gr],Aa,Cp,Xi,Ai,Pi),Ep)break}en.vertical&&(Q_+=w0(dt,Xt,zt,en.vertical,ii,sn,Ci,Ln,Zi,wr,po.vertical,["vertical"],Aa,ta,Xi,Ai,Pi));let xc=-1;const Zd=(Gr,os)=>Gr?Math.max(Gr,os):os;xc=Zd(yl,xc),xc=Zd(Iu,xc),xc=Zd(Vg,xc);const Mp=xc>-1?1:0;dt.glyphOffsetArray.length>=gc.MAX_GLYPHS&&oi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Ln.sortKey&&dt.addToSortKeyRanges(dt.symbolInstances.length,Ln.sortKey),dt.symbolInstances.emplaceBack(xl.x,xl.y,xl.z,zt.x,zt.y,Aa.right>=0?Aa.right:-1,Aa.center>=0?Aa.center:-1,Aa.left>=0?Aa.left:-1,Aa.vertical>=0?Aa.vertical:-1,Cp,ta,z0,void 0!==hr?hr:dt.collisionBoxArray.length,void 0!==hr?hr+1:dt.collisionBoxArray.length,void 0!==pr?pr:dt.collisionBoxArray.length,void 0!==pr?pr+1:dt.collisionBoxArray.length,void 0!==no?no:dt.collisionBoxArray.length,void 0!==no?no+1:dt.collisionBoxArray.length,Is||dt.collisionBoxArray.length,Is?Is+1:dt.collisionBoxArray.length,Wn,J_,Q_,Y_,K_,Mp,0,ev,Ug,xc)}(s,St,Qt,yt,a,u,h,ct,s.layers[0],s.collisionBoxArray,r.index,r.sourceLayerIndex,s.index,ve,$e,M,0,Re,rt,w,r,m,T,I,O)};if("line"===Ne)for(const yt of Jx(r.geometry,0,0,Bt,Bt)){const St=_0(yt,_e,ke,a.vertical||K,u,me,fe,s.overscaling,Bt);for(const Ct of St)K&&eb(s,K.text,Ye,Ct)||Ue(yt,Ct,O)}else if("line-center"===Ne){for(const yt of r.geometry)if(yt.length>1){const St=Yx(yt,ke,a.vertical||K,u,me,fe);St&&Ue(yt,St,O)}}else if("Polygon"===r.type)for(const yt of Fr(r.geometry,0)){const St=y0(yt,16);Ue(yt[0],new Da(St.x,St.y,0,0,void 0),O)}else if("LineString"===r.type)for(const yt of r.geometry)Ue(yt,new Da(yt[0].x,yt[0].y,0,0,void 0),O);else if("Point"===r.type)for(const yt of r.geometry)for(const St of yt)Ue([St],new Da(St.x,St.y,0,0,void 0),O)}const pc=255,Sa=pc*Xs;function w0(s,r,a,u,h,m,v,b,M,T,I,O,R,B,V,w,K){const G=function(fe,_e,ve,Re,ke,$e,rt,Ne){const Ye=[];if(0===_e.positionedLines.length)return Ye;const Xe=Re.layout.get("text-rotate").evaluate($e,{})*Math.PI/180,nt=function(Ct){const Qt=Ct[0],dt=Ct[1],zt=Qt*dt;return zt>0?[Qt,-dt]:zt<0?[-Qt,dt]:0===Qt?[dt,Qt]:[dt,-Qt]}(ve);let ct=Math.abs(_e.top-_e.bottom);for(const Ct of _e.positionedLines)ct-=Ct.lineOffset;const Ue=_e.positionedLines.length,yt=ct/Ue;let St=_e.top-ve[1];for(let Ct=0;Ct<Ue;++Ct){const Qt=_e.positionedLines[Ct];St=R_(_e,yt,St,Ct);for(const dt of Qt.positionedGlyphs){if(!dt.rect)continue;const zt=dt.rect||{};let Xt=S_+1,In=!0,en=1,Rt=0;if(dt.imageName){const Qn=rt[dt.imageName];if(!Qn)continue;if(Qn.sdf){oi("SDF images are not supported in formatted text and will be ignored.");continue}In=!1,en=Qn.pixelRatio,Xt=Lo/en}const ii=(ke||Ne)&&dt.vertical,rn=dt.metrics.advance*dt.scale/2,sn=dt.metrics,Vn=dt.rect;if(null===Vn)continue;Ne&&_e.verticalizable&&(Rt=dt.imageName?rn-dt.metrics.width*dt.scale/2:0);const Wn=ke?[dt.x+rn,dt.y]:[0,0];let Jn=[0,0],Xn=[0,0],vi=!1;ke||(ii?(Xn=[dt.x+rn+nt[0],dt.y+nt[1]-Rt],vi=!0):Jn=[dt.x+rn+ve[0],dt.y+ve[1]-Rt]);const Ci=Vn.w*dt.scale/(en*(dt.localGlyph?Ts:1)),Zi=Vn.h*dt.scale/(en*(dt.localGlyph?Ts:1));let Yn,Vi,Wi,Mi;if(ii){const Qn=dt.y-St,Ai=new _t(-rn,rn-Qn),Pi=-Math.PI/2,wr=new _t(...Xn);Yn=new _t(-rn+Jn[0],Jn[1]),Yn._rotateAround(Pi,Ai)._add(wr),Yn.x+=-Qn+rn,Yn.y-=(sn.left-Xt)*dt.scale;const hr=dt.imageName?sn.advance*dt.scale:zi*dt.scale,no=String.fromCharCode(dt.glyph);pg(no)?Yn.x+=(1-Xt)*dt.scale:C_(no)?Yn.x+=hr-sn.height*dt.scale+(-Xt-1)*dt.scale:Yn.x+=dt.imageName||sn.width+2*Xt===Vn.w&&sn.height+2*Xt===Vn.h?(hr-Zi)/2:(hr-(sn.height+2*Xt)*dt.scale)/2,Vi=new _t(Yn.x,Yn.y-Ci),Wi=new _t(Yn.x+Zi,Yn.y),Mi=new _t(Yn.x+Zi,Yn.y-Ci)}else{const Qn=(sn.left-Xt)*dt.scale-rn+Jn[0],Ai=(-sn.top-Xt)*dt.scale+Jn[1],Pi=Qn+Ci,wr=Ai+Zi;Yn=new _t(Qn,Ai),Vi=new _t(Pi,Ai),Wi=new _t(Qn,wr),Mi=new _t(Pi,wr)}if(Xe){let Qn;Qn=ke?new _t(0,0):vi?new _t(nt[0],nt[1]):new _t(ve[0],ve[1]),Yn._rotateAround(Xe,Qn),Vi._rotateAround(Xe,Qn),Wi._rotateAround(Xe,Qn),Mi._rotateAround(Xe,Qn)}const Ln=new _t(0,0),Xi=new _t(0,0);Ye.push({tl:Yn,tr:Vi,bl:Wi,br:Mi,tex:zt,writingMode:_e.writingMode,glyphOffset:Wn,sectionIndex:dt.sectionIndex,isSDF:In,pixelOffsetTL:Ln,pixelOffsetBR:Xi,minFontScaleX:0,minFontScaleY:0})}}return Ye}(0,u,M,m,v,b,h,s.allowVerticalPlacement),me=s.textSizeData;let ae=null;"source"===me.kind?(ae=[Xs*m.layout.get("text-size").evaluate(b,{},K)],ae[0]>Sa&&oi(`${s.layerIds[0]}: Value for "text-size" is >= ${pc}. Reduce your "text-size".`)):"composite"===me.kind&&(ae=[Xs*V.compositeTextSizes[0].evaluate(b,{},K),Xs*V.compositeTextSizes[1].evaluate(b,{},K)],(ae[0]>Sa||ae[1]>Sa)&&oi(`${s.layerIds[0]}: Value for "text-size" is >= ${pc}. Reduce your "text-size".`)),s.addSymbols(s.text,G,ae,M,v,b,I,r,a,T.lineStartIndex,T.lineLength,B,w,K);for(const fe of O)R[fe]=s.text.placedSymbolArray.length-1;return 4*G.length}function C0(s){for(const r in s)return s[r];return null}function pp(s,r,a,u,h,m,v,b,M,T){let I=v.top,O=v.bottom,R=v.left,B=v.right;const V=v.collisionPadding;if(V&&(R-=V[0],I-=V[1],B+=V[2],O+=V[3]),M){const w=new _t(R,I),K=new _t(B,I),G=new _t(R,O),me=new _t(B,O),ae=fn(M);let fe=new _t(0,0);T&&(fe=new _t(T[0],T[1])),w._rotateAround(ae,fe),K._rotateAround(ae,fe),G._rotateAround(ae,fe),me._rotateAround(ae,fe),R=Math.min(w.x,K.x,G.x,me.x),B=Math.max(w.x,K.x,G.x,me.x),I=Math.min(w.y,K.y,G.y,me.y),O=Math.max(w.y,K.y,G.y,me.y)}return s.emplaceBack(r.x,r.y,r.z,a.x,a.y,R,I,B,O,b,u,h,m),s.length-1}function fc(s){s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const r=s.bottom-s.top;return r>0?Math.max(10,r):null}function eb(s,r,a,u){const h=s.compareText;if(r in h){const m=h[r];for(let v=m.length-1;v>=0;v--)if(u.dist(m[v])<a)return!0}else h[r]=[];return h[r].push(u),!1}function M0(s,r){const a=s.fovAboveCenter,u=s.elevation?s.elevation.getMinElevationBelowMSL()*r:0,h=(s._camera.position[2]*s.worldSize-u)/Math.cos(s._pitch),m=Math.sin(a)*h/Math.sin(Math.max(Math.PI/2-s._pitch-a,.01)),v=Math.sin(s._pitch)*m+h;return Math.min(1.01*v,h*(1/s._horizonShift))}function Eu(s,r){if(!r.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:r};const a=Math.pow(2,-s.z),u=s.x*a,h=(s.x+1)*a,m=s.y*a,v=(s.y+1)*a,b=Hr(u),M=Hr(h),T=Or(m),I=Or(v),O=r.project(b,T),R=r.project(M,T),B=r.project(M,I),V=r.project(b,I);let w=Math.min(O.x,R.x,B.x,V.x),K=Math.min(O.y,R.y,B.y,V.y),G=Math.max(O.x,R.x,B.x,V.x),me=Math.max(O.y,R.y,B.y,V.y);const ae=a/16;function fe(ve,Re,ke,$e,rt,Ne){const Ye=(ke+rt)/2,Xe=($e+Ne)/2,nt=r.project(Hr(Ye),Or(Xe)),ct=Math.max(0,w-nt.x,K-nt.y,nt.x-G,nt.y-me);w=Math.min(w,nt.x),G=Math.max(G,nt.x),K=Math.min(K,nt.y),me=Math.max(me,nt.y),ct>ae&&(fe(ve,nt,ke,$e,Ye,Xe),fe(nt,Re,Ye,Xe,rt,Ne))}fe(O,R,u,m,h,m),fe(R,B,h,m,h,v),fe(B,V,h,v,u,v),fe(V,O,u,v,u,m),w-=ae,K-=ae,G+=ae,me+=ae;const _e=1/Math.max(G-w,me-K);return{scale:_e,x:w*_e,y:K*_e,x2:G*_e,y2:me*_e,projection:r}}const z_=xt(new Float32Array(16));class Ks{constructor(r){this.spec=r,this.name=r.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(r,a){return{x:0,y:0,z:0}}unproject(r,a){return new qn(0,0)}projectTilePoint(r,a,u){return{x:r,y:a,z:0}}locationPoint(r,a,u=!0){return r._coordinatePoint(r.locationCoordinate(a),u)}pixelsPerMeter(r,a){return Po(1,r)*a}pixelSpaceConversion(r,a,u){return 1}farthestPixelDistance(r){return M0(r,r.pixelsPerMeter)}pointCoordinate(r,a,u,h){const m=r.horizonLineFromTop(!1),v=new _t(a,Math.max(m,u));return r.rayIntersectionCoordinate(r.pointRayIntersection(v,h))}pointCoordinate3D(r,a,u){const h=new _t(a,u);if(r.elevation)return r.elevation.pointCoordinate(h);{const m=this.pointCoordinate(r,h.x,h.y,0);return[m.x,m.y,m.z]}}isPointAboveHorizon(r,a){if(r.elevation)return!this.pointCoordinate3D(r,a.x,a.y);const u=r.horizonLineFromTop();return a.y<u}createInversionMatrix(r,a){return z_}createTileMatrix(r,a,u){let h,m,v;const b=u.canonical,M=xt(new Float64Array(16));if(this.isReprojectedInTileSpace){const T=Eu(b,this);h=1,m=T.x+u.wrap*T.scale,v=T.y,sc(M,M,[h/T.scale,h/T.scale,r.pixelsPerMeter/a])}else h=a/r.zoomScale(b.z),m=(b.x+Math.pow(2,b.z)*u.wrap)*h,v=b.y*h;return Bh(M,M,[m,v,0]),sc(M,M,[h/Bt,h/Bt,1]),M}upVector(r,a,u){return[0,0,1]}upVectorScale(r,a,u){return{metersToTile:1}}}class tb extends Ks{constructor(r){super(r),this.range=[4,7],this.center=r.center||[-96,37.5];const[a,u]=this.parallels=r.parallels||[29.5,45.5],h=Math.sin(fn(a));this.n=(h+Math.sin(fn(u)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(r,a){const{n:u,c:h,r0:m}=this,v=fn(r-this.center[0]),b=fn(a),M=Math.sqrt(h-2*u*Math.sin(b))/u;return{x:M*Math.sin(v*u),y:M*Math.cos(v*u)-m,z:0}}unproject(r,a){const{n:u,c:h,r0:m}=this,v=m+a;let b=Math.atan2(r,Math.abs(v))*Math.sign(v);v*u<0&&(b-=Math.PI*Math.sign(r)*Math.sign(v));const M=fn(this.center[0])*u;b=xn(b,-Math.PI-M,Math.PI-M);const T=yn(gr(b/u)+this.center[0],-180,180),I=Math.asin(yn((h-(r*r+v*v)*u*u)/(2*u),-1,1)),O=yn(gr(I),-Lr,Lr);return new qn(T,O)}}const Fd=1.340264,Js=-.081106,wg=893e-6,Cg=.003796,fp=Math.sqrt(3)/2;class nb extends Ks{project(r,a){a=a/180*Math.PI,r=r/180*Math.PI;const u=Math.asin(fp*Math.sin(a)),h=u*u,m=h*h*h;return{x:.5*(r*Math.cos(u)/(fp*(Fd+3*Js*h+m*(7*wg+9*Cg*h)))/Math.PI+.5),y:1-.5*(u*(Fd+Js*h+m*(wg+Cg*h))/Math.PI+1),z:0}}unproject(r,a){r=(2*r-.5)*Math.PI;let u=a=(2*(1-a)-1)*Math.PI,h=u*u,m=h*h*h;for(let I,O,R,B=0;B<12&&(O=u*(Fd+Js*h+m*(wg+Cg*h))-a,R=Fd+3*Js*h+m*(7*wg+9*Cg*h),I=O/R,u=yn(u-I,-Math.PI/3,Math.PI/3),h=u*u,m=h*h*h,!(Math.abs(I)<1e-12));++B);const v=fp*r*(Fd+3*Js*h+m*(7*wg+9*Cg*h))/Math.cos(u),b=Math.asin(Math.sin(u)/fp),M=yn(180*v/Math.PI,-180,180),T=yn(180*b/Math.PI,-Lr,Lr);return new qn(M,T)}}class r2 extends Ks{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0}project(r,a){return{x:.5+r/360,y:.5-a/360,z:0}}unproject(r,a){const u=360*(r-.5),h=yn(360*(.5-a),-Lr,Lr);return new qn(u,h)}}const gp=Math.PI/2;function Tu(s){return Math.tan((gp+s)/2)}class ib extends Ks{constructor(r){super(r),this.center=r.center||[0,30];const[a,u]=this.parallels=r.parallels||[30,30];let h=fn(a),m=fn(u);this.southernCenter=h+m<0,this.southernCenter&&(h=-h,m=-m);const v=Math.cos(h),b=Tu(h);this.n=h===m?Math.sin(h):Math.log(v/Math.cos(m))/Math.log(Tu(m)/b),this.f=v*Math.pow(Tu(h),this.n)/this.n}project(r,a){a=fn(a),this.southernCenter&&(a=-a),r=fn(r-this.center[0]);const u=1e-6,{n:h,f:m}=this;m>0?a<-gp+u&&(a=-gp+u):a>gp-u&&(a=gp-u);const v=m/Math.pow(Tu(a),h);let b=v*Math.sin(h*r),M=m-v*Math.cos(h*r);return b=.5*(b/Math.PI+.5),M=.5*(M/Math.PI+.5),{x:b,y:this.southernCenter?M:1-M,z:0}}unproject(r,a){r=(2*r-.5)*Math.PI,this.southernCenter&&(a=1-a),a=(2*(1-a)-.5)*Math.PI;const{n:u,f:h}=this,m=h-a,v=Math.sign(m),b=Math.sign(u)*Math.sqrt(r*r+m*m);let M=Math.atan2(r,Math.abs(m))*v;m*u<0&&(M-=Math.PI*Math.sign(r)*v);const T=yn(gr(M/u)+this.center[0],-180,180),I=yn(gr(2*Math.atan(Math.pow(h/b,1/u))-gp),-Lr,Lr);return new qn(T,this.southernCenter?-I:I)}}class Mg extends Ks{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(r,a){return{x:ho(r),y:Ws(a),z:0}}unproject(r,a){const u=Hr(r),h=Or(a);return new qn(u,h)}}const Eg=fn(Lr);class Nd extends Ks{project(r,a){const u=(a=fn(a))*a,h=u*u;return{x:.5*((r=fn(r))*(.8707-.131979*u+h*(h*(.003971*u-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+u*(.015085+h*(.028874*u-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(r,a){r=(2*r-.5)*Math.PI;let u=a=(2*(1-a)-1)*Math.PI,h=25,m=0,v=u*u;do{v=u*u;const T=v*v;m=(u*(1.007226+v*(.015085+T*(.028874*v-.044475-.005916*T)))-a)/(1.007226+v*(.045255+T*(.259866*v-.311325-.005916*11*T))),u=yn(u-m,-Eg,Eg)}while(Math.abs(m)>1e-6&&--h>0);v=u*u;const b=yn(gr(r/(.8707+v*(v*(v*v*v*(.003971-.001529*v)-.013791)-.131979))),-180,180),M=gr(u);return new qn(b,M)}}const Tg=fn(Lr);class B_ extends Ks{project(r,a){a=fn(a),r=fn(r);const u=Math.cos(a),h=2/Math.PI,m=Math.acos(u*Math.cos(r/2)),v=Math.sin(m)/m,b=.5*(r*h+2*u*Math.sin(r/2)/v)||0,M=.5*(a+Math.sin(a)/v)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(M/Math.PI+1),z:0}}unproject(r,a){let u=r=(2*r-.5)*Math.PI,h=a=(2*(1-a)-1)*Math.PI,m=25;const v=1e-6;let b=0,M=0;do{const T=Math.cos(h),I=Math.sin(h),O=2*I*T,R=I*I,B=T*T,V=Math.cos(u/2),w=Math.sin(u/2),K=2*V*w,G=w*w,me=1-B*V*V,ae=me?1/me:0,fe=me?Math.acos(T*V)*Math.sqrt(1/me):0,_e=.5*(2*fe*T*w+2*u/Math.PI)-r,ve=.5*(fe*I+h)-a,Re=.5*ae*(B*G+fe*T*V*R)+1/Math.PI,ke=ae*(K*O/4-fe*I*w),$e=.125*ae*(O*w-fe*I*B*K),rt=.5*ae*(R*V+fe*G*T)+.5,Ne=ke*$e-rt*Re;b=(ve*ke-_e*rt)/Ne,M=(_e*$e-ve*Re)/Ne,u=yn(u-b,-Math.PI,Math.PI),h=yn(h-M,-Tg,Tg)}while((Math.abs(b)>v||Math.abs(M)>v)&&--m>0);return new qn(gr(u),gr(h))}}class zd extends Ks{constructor(r){super(r),this.center=r.center||[0,0],this.parallels=r.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(fn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(r,a){const{scale:u,cosPhi:h}=this;return{x:fn(r)*h*u+.5,y:-Math.sin(fn(a))/h*u+.5,z:0}}unproject(r,a){const{scale:u,cosPhi:h}=this,m=-(a-.5)/u,v=yn(gr((r-.5)/u)/h,-180,180),b=Math.asin(yn(m*h,-1,1)),M=yn(gr(b),-Lr,Lr);return new qn(v,M)}}class Dg extends Mg{constructor(r){super(r),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(r,a,u){const h=Ma(r,a,u);return Gi(h,h,Ff(Ms(u))),{x:h[0],y:h[1],z:h[2]}}locationPoint(r,a){const u=cc(a.lat,a.lng),h=co([],u),m=r.elevation?r.elevation.getAtPointOrZero(r.locationCoordinate(a),r._centerAltitude):r._centerAltitude;cu(u,u,h,Po(1,0)*Bt*m);const v=xt(new Float64Array(16));return eo(v,r.pixelMatrix,r.globeMatrix),Gi(u,u,v),new _t(u[0],u[1])}pixelsPerMeter(r,a){return Po(1,0)*a}pixelSpaceConversion(r,a,u){const h=Po(1,r)*a,m=wn(Po(1,45)*a,h,u);return this.pixelsPerMeter(r,a)/m}createTileMatrix(r,a,u){const h=b1(Ms(u.canonical));return eo(new Float64Array(16),r.globeMatrix,h)}createInversionMatrix(r,a){const{center:u}=r,h=Ff(Ms(a));return ou(h,h,fn(u.lng)),Df(h,h,fn(u.lat)),sc(h,h,[r._pixelsPerMercatorPixel,r._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(r,a,u,h){return to(r,a,u,!0)||new Rr(0,0)}pointCoordinate3D(r,a,u){const h=this.pointCoordinate(r,a,u,0);return[h.x,h.y,h.z]}isPointAboveHorizon(r,a){return!to(r,a.x,a.y,!1)}farthestPixelDistance(r){const a=function(h,m){const v=h.cameraToCenterDistance,b=h._centerAltitude*m,M=h._camera,T=h._camera.forward(),I=wa([],ws([],T,-v),[0,0,b]),O=h.worldSize/(2*Math.PI),R=[0,0,-O],B=h.width/h.height,V=Math.tan(h.fovAboveCenter),w=ws([],M.up(),V),K=ws([],M.right(),V*B),G=co([],wa([],wa([],T,w),K)),me=[];let ae;if(new Hh(I,G).closestPointOnSphere(R,O,me)){const fe=wa([],me,R),_e=uo([],fe,I);ae=Math.cos(h.fovAboveCenter)*su(_e)}else{const fe=uo([],I,R),_e=uo([],R,I);co(_e,_e);const ve=su(fe)-O;ae=Math.sqrt(ve*(ve+2*O));const Re=Math.acos(ae/(O+ve))-Math.acos(Cs(T,_e));ae*=Math.cos(Re)}return 1.01*ae}(r,this.pixelsPerMeter(r.center.lat,r.worldSize)),u=Zh(r.zoom);if(u>0){const h=M0(r,Po(1,r.center.lat)*r.worldSize),m=r.worldSize/(2*Math.PI),v=Math.max(r.width,r.height)/r.worldSize*Math.PI;return wn(a,h+m*(1-Math.cos(v)),Math.pow(u,10))}return a}upVector(r,a,u){return Ma(a,u,r,1)}upVectorScale(r){return{metersToTile:Rf(Jm(Ms(r)))}}}function Bd(s){const r=s.parallels,a=!!r&&Math.abs(r[0]+r[1])<.01;switch(s.name){case"mercator":return new Mg(s);case"equirectangular":return new r2(s);case"naturalEarth":return new Nd(s);case"equalEarth":return new nb(s);case"winkelTripel":return new B_(s);case"albers":return a?new zd(s):new tb(s);case"lambertConformalConic":return a?new zd(s):new ib(s);case"globe":return new Dg(s)}throw new Error(`Invalid projection name: ${s.name}`)}const E0=Td.types,V_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Du(s,r,a,u,h,m,v,b,M,T,I,O,R){const B=b?Math.min(Sa,Math.round(b[0])):0,V=b?Math.min(Sa,Math.round(b[1])):0;s.emplaceBack(r,a,Math.round(32*u),Math.round(32*h),m,v,(B<<1)+(M?1:0),V,16*T,16*I,256*O,256*R)}function U_(s,r,a,u,h,m,v){s.emplaceBack(r,a,u,h,m,v)}function Vd(s,r,a,u,h){s.emplaceBack(r,a,u,h),s.emplaceBack(r,a,u,h),s.emplaceBack(r,a,u,h),s.emplaceBack(r,a,u,h)}function mp(s){for(const r of s.sections)if(wf(r.text))return!0;return!1}class j_{constructor(r){this.layoutVertexArray=new Qe,this.indexArray=new Pt,this.programConfigurations=r,this.segments=new Fi,this.dynamicLayoutVertexArray=new it,this.opacityVertexArray=new vt,this.placedSymbolArray=new Nt,this.globeExtVertexArray=new st}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(r,a,u,h){this.isEmpty()||(u&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Ux.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,$x.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,V_,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,jx.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||h)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Tt(j_,"SymbolBuffers");class Sg{constructor(r,a,u){this.layoutVertexArray=new r,this.layoutAttributes=a,this.indexArray=new u,this.segments=new Fi,this.collisionVertexArray=new _n,this.collisionVertexArrayExt=new un}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,e0.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,t0.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Tt(Sg,"CollisionBuffers");class gc{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(v=>v.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=xt([]),this.placementViewportMatrix=xt([]);const a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=x_(this.zoom,a["text-size"]),this.iconSizeData=x_(this.zoom,a["icon-size"]);const u=this.layers[0].layout,h=u.get("symbol-sort-key"),m=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==m&&void 0!==h.constantOr(1),this.sortFeaturesByY=("viewport-y"===m||"auto"===m&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(v=>po[v]),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=r.sourceID,this.projection=r.projection}createArrays(){this.text=new j_(new al(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new j_(new al(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new Jr,this.lineVertexArray=new hd,this.symbolInstances=new fi}calculateGlyphDependencies(r,a,u,h,m){for(let v=0;v<r.length;v++)if(a[r.charCodeAt(v)]=!0,h&&m){const b=Ta[r.charAt(v)];b&&(a[b.charCodeAt(0)]=!0)}}populate(r,a,u,h){const m=this.layers[0],v=m.layout,b="globe"===this.projection.name,M=v.get("text-font"),T=v.get("text-field"),I=v.get("icon-image"),O=("constant"!==T.value.kind||T.value.value instanceof Ir&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&("constant"!==M.value.kind||M.value.value.length>0),R="constant"!==I.value.kind||!!I.value.value||Object.keys(I.parameters).length>0,B=v.get("symbol-sort-key");if(this.features=[],!O&&!R)return;const V=a.iconDependencies,w=a.glyphDependencies,K=a.availableImages,G=new k(this.zoom);for(const{feature:me,id:ae,index:fe,sourceLayerIndex:_e}of r){const ve=m._featureFilter.needGeometry,Re=mu(me,ve);if(!m._featureFilter.filter(G,Re,u))continue;if(ve||(Re.geometry=dl(me,u,h)),b&&1!==me.type&&u.z<=5){const Ne=Re.geometry,Ye=.98078528056,Xe=(nt,ct)=>Cs(Ma(nt.x,nt.y,u,1),Ma(ct.x,ct.y,u,1))<Ye;for(let nt=0;nt<Ne.length;nt++)Ne[nt]=E1(Ne[nt],Xe)}let ke,$e;if(O){const Ne=m.getValueAndResolveTokens("text-field",Re,u,K),Ye=Ir.factory(Ne);mp(Ye)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===C()||this.hasRTLText&&S.isParsed())&&(ke=Hx(Ye,m,Re))}if(R){const Ne=m.getValueAndResolveTokens("icon-image",Re,u,K);$e=Ne instanceof wi?Ne:wi.fromString(Ne)}if(!ke&&!$e)continue;const rt=this.sortFeaturesByKey?B.evaluate(Re,{},u):void 0;if(this.features.push({id:ae,text:ke,icon:$e,index:fe,sourceLayerIndex:_e,geometry:Re.geometry,properties:me.properties,type:E0[me.type],sortKey:rt}),$e&&(V[$e.name]=!0),ke){const Ne=M.evaluate(Re,{},u).join(","),Ye="map"===v.get("text-rotation-alignment")&&"point"!==v.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(po.vertical)>=0;for(const Xe of ke.sections)if(Xe.image)V[Xe.image.name]=!0;else{const nt=yf(ke.toString()),ct=Xe.fontStack||Ne,Ue=w[ct]=w[ct]||{};this.calculateGlyphDependencies(Xe.text,Ue,Ye,this.allowVerticalPlacement,nt)}}}"line"===v.get("symbol-placement")&&(this.features=function(me){const ae={},fe={},_e=[];let ve=0;function Re(Ne){_e.push(me[Ne]),ve++}function ke(Ne,Ye,Xe){const nt=fe[Ne];return delete fe[Ne],fe[Ye]=nt,_e[nt].geometry[0].pop(),_e[nt].geometry[0]=_e[nt].geometry[0].concat(Xe[0]),nt}function $e(Ne,Ye,Xe){const nt=ae[Ye];return delete ae[Ye],ae[Ne]=nt,_e[nt].geometry[0].shift(),_e[nt].geometry[0]=Xe[0].concat(_e[nt].geometry[0]),nt}function rt(Ne,Ye,Xe){const nt=Xe?Ye[0][Ye[0].length-1]:Ye[0][0];return`${Ne}:${nt.x}:${nt.y}`}for(let Ne=0;Ne<me.length;Ne++){const Ye=me[Ne],Xe=Ye.geometry,nt=Ye.text?Ye.text.toString():null;if(!nt){Re(Ne);continue}const ct=rt(nt,Xe),Ue=rt(nt,Xe,!0);if(ct in fe&&Ue in ae&&fe[ct]!==ae[Ue]){const yt=$e(ct,Ue,Xe),St=ke(ct,Ue,_e[yt].geometry);delete ae[ct],delete fe[Ue],fe[rt(nt,_e[St].geometry,!0)]=St,_e[yt].geometry=null}else ct in fe?ke(ct,Ue,Xe):Ue in ae?$e(ct,Ue,Xe):(Re(Ne),ae[ct]=ve-1,fe[Ue]=ve-1)}return _e.filter(Ne=>Ne.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((me,ae)=>me.sortKey-ae.sortKey)}update(r,a,u,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,a,this.layers,u,h),this.icon.programConfigurations.updatePaintArrays(r,a,this.layers,u,h))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Bd(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,a){const u=this.lineVertexArray.length;if(void 0!==r.segment)for(const{x:h,y:m}of a)this.lineVertexArray.emplaceBack(h,m);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(r,a,u,h,m,v,b,M,T,I,O,R,B,V){const w=r.indexArray,K=r.layoutVertexArray,G=r.globeExtVertexArray,me=r.segments.prepareSegment(4*a.length,K,w,this.canOverlap?v.sortKey:void 0),ae=this.glyphOffsetArray.length,fe=me.vertexLength,_e=this.allowVerticalPlacement&&b===po.vertical?Math.PI/2:0,ve=v.text&&v.text.sections;for(let ke=0;ke<a.length;ke++){const{tl:$e,tr:rt,bl:Ne,br:Ye,tex:Xe,pixelOffsetTL:nt,pixelOffsetBR:ct,minFontScaleX:Ue,minFontScaleY:yt,glyphOffset:St,isSDF:Ct,sectionIndex:Qt}=a[ke],dt=me.vertexLength,zt=St[1];if(Du(K,T.x,T.y,$e.x,zt+$e.y,Xe.x,Xe.y,u,Ct,nt.x,nt.y,Ue,yt),Du(K,T.x,T.y,rt.x,zt+rt.y,Xe.x+Xe.w,Xe.y,u,Ct,ct.x,nt.y,Ue,yt),Du(K,T.x,T.y,Ne.x,zt+Ne.y,Xe.x,Xe.y+Xe.h,u,Ct,nt.x,ct.y,Ue,yt),Du(K,T.x,T.y,Ye.x,zt+Ye.y,Xe.x+Xe.w,Xe.y+Xe.h,u,Ct,ct.x,ct.y,Ue,yt),M){const{x:Xt,y:In,z:en}=M.anchor,[Rt,ii,rn]=M.up;U_(G,Xt,In,en,Rt,ii,rn),U_(G,Xt,In,en,Rt,ii,rn),U_(G,Xt,In,en,Rt,ii,rn),U_(G,Xt,In,en,Rt,ii,rn),Vd(r.dynamicLayoutVertexArray,Xt,In,en,_e)}else Vd(r.dynamicLayoutVertexArray,T.x,T.y,T.z,_e);w.emplaceBack(dt,dt+1,dt+2),w.emplaceBack(dt+1,dt+2,dt+3),me.vertexLength+=4,me.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(St[0]),ke!==a.length-1&&Qt===a[ke+1].sectionIndex||r.programConfigurations.populatePaintArrays(K.length,v,v.index,{},B,V,ve&&ve[Qt])}const Re=M?M.anchor:T;r.placedSymbolArray.emplaceBack(Re.x,Re.y,Re.z,T.x,T.y,ae,this.glyphOffsetArray.length-ae,fe,I,O,T.segment,u?u[0]:0,u?u[1]:0,h[0],h[1],b,0,!1,0,R,0)}_commitLayoutVertex(r,a,u,h,m,v,b){r.emplaceBack(a,u,h,m,v,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(r,a,u,h,m,v,b){const M=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),T=M.vertexLength,I=b.tileAnchorX,O=b.tileAnchorY;for(let B=0;B<4;B++)u.collisionVertexArray.emplaceBack(0,0,0,0);u.collisionVertexArrayExt.emplaceBack(a,-r.padding,-r.padding),u.collisionVertexArrayExt.emplaceBack(a,r.padding,-r.padding),u.collisionVertexArrayExt.emplaceBack(a,r.padding,r.padding),u.collisionVertexArrayExt.emplaceBack(a,-r.padding,r.padding),this._commitLayoutVertex(u.layoutVertexArray,h,m,v,I,O,new _t(r.x1,r.y1)),this._commitLayoutVertex(u.layoutVertexArray,h,m,v,I,O,new _t(r.x2,r.y1)),this._commitLayoutVertex(u.layoutVertexArray,h,m,v,I,O,new _t(r.x2,r.y2)),this._commitLayoutVertex(u.layoutVertexArray,h,m,v,I,O,new _t(r.x1,r.y2)),M.vertexLength+=4;const R=u.indexArray;R.emplaceBack(T,T+1),R.emplaceBack(T+1,T+2),R.emplaceBack(T+2,T+3),R.emplaceBack(T+3,T),M.primitiveLength+=4}_addTextDebugCollisionBoxes(r,a,u,h,m,v){for(let b=h;b<m;b++){const M=u.get(b),T=this.getSymbolInstanceTextSize(r,v,a,b);this._addCollisionDebugVertices(M,T,this.textCollisionBox,M.projectedAnchorX,M.projectedAnchorY,M.projectedAnchorZ,v)}}_addIconDebugCollisionBoxes(r,a,u,h,m,v){for(let b=h;b<m;b++){const M=u.get(b),T=this.getSymbolInstanceIconSize(r,a,v.placedIconSymbolIndex);this._addCollisionDebugVertices(M,T,this.iconCollisionBox,M.projectedAnchorX,M.projectedAnchorY,M.projectedAnchorZ,v)}}generateCollisionDebugBuffers(r,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Sg(Et,lp.members,dr),this.iconCollisionBox=new Sg(Et,lp.members,dr);const u=Id(this.iconSizeData,r),h=Id(this.textSizeData,r);for(let m=0;m<this.symbolInstances.length;m++){const v=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(h,r,a,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(h,r,a,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(u,r,a,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(u,r,a,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(r,a,u,h){const m=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:h),v=b_(this.textSizeData,r,m)/zi;return this.tilePixelRatio*v}getSymbolInstanceIconSize(r,a,u){const h=this.icon.placedSymbolArray.get(u),m=b_(this.iconSizeData,r,h);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(r,a,u){r.emplaceBack(a,-u,-u),r.emplaceBack(a,u,-u),r.emplaceBack(a,u,u),r.emplaceBack(a,-u,u)}_updateTextDebugCollisionBoxes(r,a,u,h,m,v){for(let b=h;b<m;b++){const M=u.get(b),T=this.getSymbolInstanceTextSize(r,v,a,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,T,M.padding)}}_updateIconDebugCollisionBoxes(r,a,u,h,m,v){for(let b=h;b<m;b++){const M=u.get(b),T=this.getSymbolInstanceIconSize(r,a,v);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,T,M.padding)}}updateCollisionDebugBuffers(r,a){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=Id(this.iconSizeData,r),h=Id(this.textSizeData,r);for(let m=0;m<this.symbolInstances.length;m++){const v=this.symbolInstances.get(m);this._updateTextDebugCollisionBoxes(h,r,a,v.textBoxStartIndex,v.textBoxEndIndex,v),this._updateTextDebugCollisionBoxes(h,r,a,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._updateIconDebugCollisionBoxes(u,r,a,v.iconBoxStartIndex,v.iconBoxEndIndex,v.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(u,r,a,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,a,u,h,m,v,b,M,T){const I={};if(a<u){const{x1:O,y1:R,x2:B,y2:V,padding:w,projectedAnchorX:K,projectedAnchorY:G,projectedAnchorZ:me,tileAnchorX:ae,tileAnchorY:fe,featureIndex:_e}=r.get(a);I.textBox={x1:O,y1:R,x2:B,y2:V,padding:w,projectedAnchorX:K,projectedAnchorY:G,projectedAnchorZ:me,tileAnchorX:ae,tileAnchorY:fe},I.textFeatureIndex=_e}if(h<m){const{x1:O,y1:R,x2:B,y2:V,padding:w,projectedAnchorX:K,projectedAnchorY:G,projectedAnchorZ:me,tileAnchorX:ae,tileAnchorY:fe,featureIndex:_e}=r.get(h);I.verticalTextBox={x1:O,y1:R,x2:B,y2:V,padding:w,projectedAnchorX:K,projectedAnchorY:G,projectedAnchorZ:me,tileAnchorX:ae,tileAnchorY:fe},I.verticalTextFeatureIndex=_e}if(v<b){const{x1:O,y1:R,x2:B,y2:V,padding:w,projectedAnchorX:K,projectedAnchorY:G,projectedAnchorZ:me,tileAnchorX:ae,tileAnchorY:fe,featureIndex:_e}=r.get(v);I.iconBox={x1:O,y1:R,x2:B,y2:V,padding:w,projectedAnchorX:K,projectedAnchorY:G,projectedAnchorZ:me,tileAnchorX:ae,tileAnchorY:fe},I.iconFeatureIndex=_e}if(M<T){const{x1:O,y1:R,x2:B,y2:V,padding:w,projectedAnchorX:K,projectedAnchorY:G,projectedAnchorZ:me,tileAnchorX:ae,tileAnchorY:fe,featureIndex:_e}=r.get(M);I.verticalIconBox={x1:O,y1:R,x2:B,y2:V,padding:w,projectedAnchorX:K,projectedAnchorY:G,projectedAnchorZ:me,tileAnchorX:ae,tileAnchorY:fe},I.verticalIconFeatureIndex=_e}return I}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const u=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,a){const u=r.placedSymbolArray.get(a),h=u.vertexStartIndex+4*u.numGlyphs;for(let m=u.vertexStartIndex;m<h;m+=4)r.indexArray.emplaceBack(m,m+1,m+2),r.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const a=Math.sin(r),u=Math.cos(r),h=[],m=[],v=[];for(let b=0;b<this.symbolInstances.length;++b){v.push(b);const M=this.symbolInstances.get(b);h.push(0|Math.round(a*M.tileAnchorX+u*M.tileAnchorY)),m.push(M.featureIndex)}return v.sort((b,M)=>h[b]-h[M]||m[M]-m[b]),v}addToSortKeyRanges(r,a){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===a?u.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const u=this.symbolInstances.get(a);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:m,leftJustifiedTextSymbolIndex:v,verticalPlacedTextSymbolIndex:b,placedIconSymbolIndex:M,verticalPlacedIconSymbolIndex:T}=u;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),m>=0&&m!==h&&this.addIndicesForPlacedSymbol(this.text,m),v>=0&&v!==m&&v!==h&&this.addIndicesForPlacedSymbol(this.text,v),b>=0&&this.addIndicesForPlacedSymbol(this.text,b),M>=0&&this.addIndicesForPlacedSymbol(this.icon,M),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Tt(gc,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),gc.MAX_GLYPHS=65535,gc.addDynamicAttributes=Vd;const rb=new de({"symbol-placement":new $(je.layout_symbol["symbol-placement"]),"symbol-spacing":new $(je.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new $(je.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Q(je.layout_symbol["symbol-sort-key"]),"symbol-z-order":new $(je.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new $(je.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new $(je.layout_symbol["icon-ignore-placement"]),"icon-optional":new $(je.layout_symbol["icon-optional"]),"icon-rotation-alignment":new $(je.layout_symbol["icon-rotation-alignment"]),"icon-size":new Q(je.layout_symbol["icon-size"]),"icon-text-fit":new $(je.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new $(je.layout_symbol["icon-text-fit-padding"]),"icon-image":new Q(je.layout_symbol["icon-image"]),"icon-rotate":new Q(je.layout_symbol["icon-rotate"]),"icon-padding":new $(je.layout_symbol["icon-padding"]),"icon-keep-upright":new $(je.layout_symbol["icon-keep-upright"]),"icon-offset":new Q(je.layout_symbol["icon-offset"]),"icon-anchor":new Q(je.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new $(je.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new $(je.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new $(je.layout_symbol["text-rotation-alignment"]),"text-field":new Q(je.layout_symbol["text-field"]),"text-font":new Q(je.layout_symbol["text-font"]),"text-size":new Q(je.layout_symbol["text-size"]),"text-max-width":new Q(je.layout_symbol["text-max-width"]),"text-line-height":new Q(je.layout_symbol["text-line-height"]),"text-letter-spacing":new Q(je.layout_symbol["text-letter-spacing"]),"text-justify":new Q(je.layout_symbol["text-justify"]),"text-radial-offset":new Q(je.layout_symbol["text-radial-offset"]),"text-variable-anchor":new $(je.layout_symbol["text-variable-anchor"]),"text-anchor":new Q(je.layout_symbol["text-anchor"]),"text-max-angle":new $(je.layout_symbol["text-max-angle"]),"text-writing-mode":new $(je.layout_symbol["text-writing-mode"]),"text-rotate":new Q(je.layout_symbol["text-rotate"]),"text-padding":new $(je.layout_symbol["text-padding"]),"text-keep-upright":new $(je.layout_symbol["text-keep-upright"]),"text-transform":new Q(je.layout_symbol["text-transform"]),"text-offset":new Q(je.layout_symbol["text-offset"]),"text-allow-overlap":new $(je.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new $(je.layout_symbol["text-ignore-placement"]),"text-optional":new $(je.layout_symbol["text-optional"])});var _p={paint:new de({"icon-opacity":new Q(je.paint_symbol["icon-opacity"]),"icon-color":new Q(je.paint_symbol["icon-color"]),"icon-halo-color":new Q(je.paint_symbol["icon-halo-color"]),"icon-halo-width":new Q(je.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Q(je.paint_symbol["icon-halo-blur"]),"icon-translate":new $(je.paint_symbol["icon-translate"]),"icon-translate-anchor":new $(je.paint_symbol["icon-translate-anchor"]),"text-opacity":new Q(je.paint_symbol["text-opacity"]),"text-color":new Q(je.paint_symbol["text-color"],{runtimeType:Vr,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new Q(je.paint_symbol["text-halo-color"]),"text-halo-width":new Q(je.paint_symbol["text-halo-width"]),"text-halo-blur":new Q(je.paint_symbol["text-halo-blur"]),"text-translate":new $(je.paint_symbol["text-translate"]),"text-translate-anchor":new $(je.paint_symbol["text-translate-anchor"])}),layout:rb};class $_{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:bi,this.defaultValue=r}evaluate(r){if(r.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(r.formattedSection))return a.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Tt($_,"FormatSectionOverride",{omit:["defaultValue"]});class Ig extends bs{constructor(r){super(r,_p)}recalculate(r,a){super.recalculate(r,a),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const h=[];for(const m of u)h.indexOf(m)<0&&h.push(m);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(r,a,u,h){const m=this.layout.get(r).evaluate(a,{},u,h),v=this._unevaluatedLayout._values[r];return v.isDataDriven()||Zl(v.value)||!m?m:(b=a.properties,m.replace(/{([^{}]+)}/g,(T,I)=>I in b?String(b[I]):""));var b}createBucket(r){return new gc(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of _p.paint.overridableProperties){if(!Ig.hasPaintOverride(this.layout,r))continue;const a=this.paint.get(r),u=new $_(a),h=new Ja(u,a.property.specification);let m=null;m="constant"===a.value.kind||"source"===a.value.kind?new Di("source",h):new Dt("composite",h,a.value.zoomStops,a.value._interpolationType),this.paint._values[r]=new ie(a.property,m,a.parameters)}}_handleOverridablePaintPropertyUpdate(r,a,u){return!(!this.layout||a.isDataDriven()||u.isDataDriven())&&Ig.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,a){const u=r.get("text-field"),h=_p.paint.properties[a];let m=!1;const v=b=>{for(const M of b)if(h.overrides&&h.overrides.hasOverride(M))return void(m=!0)};if("constant"===u.value.kind&&u.value.value instanceof Ir)v(u.value.value.sections);else if("source"===u.value.kind){const b=T=>{m||(T instanceof Fl&&Li(T.value)===zn?v(T.value.sections):T instanceof da?v(T.sections):T.eachChild(b))},M=u.value;M._styleExpression&&b(M._styleExpression.expression)}return m}getProgramConfiguration(r){return new ic(this,r)}}var ob={paint:new de({"background-color":new $(je.paint_background["background-color"]),"background-pattern":new $(je.paint_background["background-pattern"]),"background-opacity":new $(je.paint_background["background-opacity"])})},o2={paint:new de({"raster-opacity":new $(je.paint_raster["raster-opacity"]),"raster-hue-rotate":new $(je.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new $(je.paint_raster["raster-brightness-min"]),"raster-brightness-max":new $(je.paint_raster["raster-brightness-max"]),"raster-saturation":new $(je.paint_raster["raster-saturation"]),"raster-contrast":new $(je.paint_raster["raster-contrast"]),"raster-resampling":new $(je.paint_raster["raster-resampling"]),"raster-fade-duration":new $(je.paint_raster["raster-fade-duration"])})};class sb extends bs{constructor(r){super(r,{}),this.implementation=r}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}var Ag={paint:new de({"sky-type":new $(je.paint_sky["sky-type"]),"sky-atmosphere-sun":new $(je.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new $(je.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new $(je.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new $(je.paint_sky["sky-gradient-radius"]),"sky-gradient":new ue(je.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new $(je.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new $(je.paint_sky["sky-atmosphere-color"]),"sky-opacity":new $(je.paint_sky["sky-opacity"])})};function vp(s,r,a){const u=[0,0,1],h=Zm([]);return Zs(h,h,a?-fn(s)+Math.PI:fn(s)),y1(h,h,-fn(r)),gx(u,u,h),co(u,u)}const ab={circle:class extends bs{constructor(s){super(s,YC)}createBucket(s){return new yd(s)}queryRadius(s){const r=s;return Ea("circle-radius",this,r)+Ea("circle-stroke-width",this,r)+Vf(this.paint.get("circle-translate"))}queryIntersectsFeature(s,r,a,u,h,m,v,b){const M=n_(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,s.pixelToTileUnitsFactor),T=this.paint.get("circle-radius").evaluate(r,a)+this.paint.get("circle-stroke-width").evaluate(r,a);return P1(s,u,m,v,b,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),M,T)}getProgramIds(){return["circle"]}getProgramConfiguration(s){return new ic(this,s)}},heatmap:class extends bs{createBucket(s){return new L1(s)}constructor(s){super(s,Ax),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){"heatmap-color"===s&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Kh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(s){return Ea("heatmap-radius",this,s)}queryIntersectsFeature(s,r,a,u,h,m,v,b){const M=this.paint.get("heatmap-radius").evaluate(r,a);return P1(s,u,m,v,b,!0,!0,new _t(0,0),M)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(s){return new ic(this,s)}},hillshade:class extends bs{constructor(s){super(s,KC)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends bs{constructor(s){super(s,Ox)}getProgramIds(){const s=this.paint.get("fill-pattern"),r=s&&s.constantOr(1),a=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getProgramConfiguration(s){return new ic(this,s)}recalculate(s,r){super.recalculate(s,r);const a=this.paint._values["fill-outline-color"];"constant"===a.value.kind&&void 0===a.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new eg(s)}queryRadius(){return Vf(this.paint.get("fill-translate"))}queryIntersectsFeature(s,r,a,u,h,m){return!s.queryGeometry.isAboveHorizon&&S1(Tx(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,s.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}},"fill-extrusion":class extends bs{constructor(s){super(s,Y1)}createBucket(s){return new rp(s)}queryRadius(){return Vf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(s){return new ic(this,s)}queryIntersectsFeature(s,r,a,u,h,m,v,b,M){const T=n_(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,s.pixelToTileUnitsFactor),I=this.paint.get("fill-extrusion-height").evaluate(r,a),O=this.paint.get("fill-extrusion-base").evaluate(r,a),R=[0,0],B=b&&m.elevation,V=m.elevation?m.elevation.exaggeration():1,w=s.tile.getBucket(this);if(B&&w instanceof rp){const fe=w.centroidVertexArray,_e=M+1;_e<fe.length&&(R[0]=fe.geta_centroid_pos0(_e),R[1]=fe.geta_centroid_pos1(_e))}if(0===R[0]&&1===R[1])return!1;"globe"===m.projection.name&&(u=p_([u],[new _t(0,0),new _t(Bt,Bt)],s.tileID.canonical).map(fe=>fe.polygon).flat());const K=B?b:null,[G,me]=(_e=u,ve=O,Re=I,ke=T,$e=v,rt=K,Ne=R,Ye=V,Xe=m.center.lat,"globe"===(fe=m).projection.name?function(ct,Ue,yt,St,Ct,Qt,dt,zt,Xt,In,en){const Rt=[],ii=[],rn=ct.projection.upVectorScale(en,ct.center.lat,ct.worldSize).metersToTile,sn=[0,0,0,1],Vn=[0,0,0,1],Wn=(Xn,vi,Ci,Zi)=>{Xn[0]=vi,Xn[1]=Ci,Xn[2]=Zi,Xn[3]=1},Jn=lg();yt>0&&(yt+=Jn),St+=Jn;for(const Xn of Ue){const vi=[],Ci=[];for(const Zi of Xn){const Yn=Zi.x+Ct.x,Vi=Zi.y+Ct.y,Wi=ct.projection.projectTilePoint(Yn,Vi,en),Mi=ct.projection.upVector(en,Zi.x,Zi.y);let Ln=yt,Xi=St;if(dt){const Qn=ug(Yn,Vi,yt,St,dt,zt,Xt,In);Ln+=Qn.base,Xi+=Qn.top}0!==yt?Wn(sn,Wi.x+Mi[0]*rn*Ln,Wi.y+Mi[1]*rn*Ln,Wi.z+Mi[2]*rn*Ln):Wn(sn,Wi.x,Wi.y,Wi.z),Wn(Vn,Wi.x+Mi[0]*rn*Xi,Wi.y+Mi[1]*rn*Xi,Wi.z+Mi[2]*rn*Xi),Gi(sn,sn,Qt),Gi(Vn,Vn,Qt),vi.push(new bu(sn[0],sn[1],sn[2])),Ci.push(new bu(Vn[0],Vn[1],Vn[2]))}Rt.push(vi),ii.push(Ci)}return[Rt,ii]}(fe,_e,ve,Re,ke,$e,rt,Ne,Ye,Xe,s.tileID.canonical):rt?function(ct,Ue,yt,St,Ct,Qt,dt,zt,Xt){const In=[],en=[],Rt=[0,0,0,1];for(const ii of ct){const rn=[],sn=[];for(const Vn of ii){const Wn=Vn.x+St.x,Jn=Vn.y+St.y,Xn=ug(Wn,Jn,Ue,yt,Qt,dt,zt,Xt);Rt[0]=Wn,Rt[1]=Jn,Rt[2]=Xn.base,Rt[3]=1,md(Rt,Rt,Ct),Rt[3]=Math.max(Rt[3],1e-5);const vi=new bu(Rt[0]/Rt[3],Rt[1]/Rt[3],Rt[2]/Rt[3]);Rt[0]=Wn,Rt[1]=Jn,Rt[2]=Xn.top,Rt[3]=1,md(Rt,Rt,Ct),Rt[3]=Math.max(Rt[3],1e-5);const Ci=new bu(Rt[0]/Rt[3],Rt[1]/Rt[3],Rt[2]/Rt[3]);rn.push(vi),sn.push(Ci)}In.push(rn),en.push(sn)}return[In,en]}(_e,ve,Re,ke,$e,rt,Ne,Ye,Xe):function(ct,Ue,yt,St,Ct){const Qt=[],dt=[],zt=Ct[8]*Ue,Xt=Ct[9]*Ue,In=Ct[10]*Ue,en=Ct[11]*Ue,Rt=Ct[8]*yt,ii=Ct[9]*yt,rn=Ct[10]*yt,sn=Ct[11]*yt;for(const Vn of ct){const Wn=[],Jn=[];for(const Xn of Vn){const vi=Xn.x+St.x,Ci=Xn.y+St.y,Zi=Ct[0]*vi+Ct[4]*Ci+Ct[12],Yn=Ct[1]*vi+Ct[5]*Ci+Ct[13],Vi=Ct[2]*vi+Ct[6]*Ci+Ct[14],Wi=Ct[3]*vi+Ct[7]*Ci+Ct[15],Mi=Zi+zt,Ln=Yn+Xt,Xi=Vi+In,Qn=Math.max(Wi+en,1e-5),Ai=Zi+Rt,Pi=Yn+ii,wr=Vi+rn,hr=Math.max(Wi+sn,1e-5);Wn.push(new bu(Mi/Qn,Ln/Qn,Xi/Qn)),Jn.push(new bu(Ai/hr,Pi/hr,wr/hr))}Qt.push(Wn),dt.push(Jn)}return[Qt,dt]}(_e,ve,Re,ke,$e)),ae=s.queryGeometry;var fe,_e,ve,Re,ke,$e,rt,Ne,Ye,Xe;return function(fe,_e,ve){let Re=1/0;S1(ve,_e)&&(Re=g_(ve,_e[0]));for(let ke=0;ke<_e.length;ke++){const $e=_e[ke],rt=fe[ke];for(let Ne=0;Ne<$e.length-1;Ne++){const Ye=$e[Ne],Xe=[Ye,$e[Ne+1],rt[Ne+1],rt[Ne],Ye];D1(ve,Xe)&&(Re=Math.min(Re,g_(ve,Xe)))}}return Re!==1/0&&Re}(G,me,ae.isPointQuery()?ae.screenBounds:ae.screenGeometry)}},line:class extends bs{constructor(s){super(s,Sd),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(s){if("line-gradient"===s){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof af,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(s,r){super.recalculate(s,r),this.paint._values["line-floorwidth"]=Q1.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new ap(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(s){return new ic(this,s)}queryRadius(s){const r=s,a=v_(Ea("line-width",this,r),Ea("line-gap-width",this,r)),u=Ea("line-offset",this,r);return a/2+Math.abs(u)+Vf(this.paint.get("line-translate"))}queryIntersectsFeature(s,r,a,u,h,m){if(s.queryGeometry.isAboveHorizon)return!1;const v=Tx(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,s.pixelToTileUnitsFactor),b=s.pixelToTileUnitsFactor/2*v_(this.paint.get("line-width").evaluate(r,a),this.paint.get("line-gap-width").evaluate(r,a)),M=this.paint.get("line-offset").evaluate(r,a);return M&&(u=function(T,I){const O=[],R=new _t(0,0);for(let B=0;B<T.length;B++){const V=T[B],w=[];for(let K=0;K<V.length;K++){const G=V[K],me=V[K+1],ae=0===K?R:G.sub(V[K-1])._unit()._perp(),fe=K===V.length-1?R:me.sub(G)._unit()._perp(),_e=ae._add(fe)._unit();_e._mult(1/(_e.x*fe.x+_e.y*fe.y)),w.push(_e._mult(I)._add(G))}O.push(w)}return O}(u,M*s.pixelToTileUnitsFactor)),function(T,I,O){for(let R=0;R<I.length;R++){const B=I[R];if(T.length>=3)for(let V=0;V<B.length;V++)if(_u(T,B[V]))return!0;if(Bf(T,B,O))return!0}return!1}(v,u,b)}isTileClipped(){return!0}},symbol:Ig,background:class extends bs{constructor(s){super(s,ob)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends bs{constructor(s){super(s,o2)}getProgramIds(){return["raster"]}},sky:class extends bs{constructor(s){super(s,Ag),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){"sky-gradient"===s?this._updateColorRamp():"sky-atmosphere-sun"!==s&&"sky-atmosphere-halo-color"!==s&&"sky-atmosphere-color"!==s&&"sky-atmosphere-sun-intensity"!==s||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Kh({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}return!1}getCenter(s,r){if("atmosphere"===this.paint.get("sky-type")){const u=this.paint.get("sky-atmosphere-sun"),h=!u,m=s.style.light,v=m.properties.get("position");return h&&"viewport"===m.properties.get("anchor")&&oi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?vp(v.azimuthal,90-v.polar,r):vp(u[0],90-u[1],r)}const a=this.paint.get("sky-gradient-center");return vp(a[0],90-a[1],r)}is3D(){return!1}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return"atmosphere"===s?["skyboxCapture","skybox"]:"gradient"===s?["skyboxGradient"]:null}}};class Ud{constructor(r,a,u,h){this.context=r,this.format=u,this.texture=r.gl.createTexture(),this.update(a,h)}update(r,a,u){const{width:h,height:m}=r,{context:v}=this,{gl:b}=v,{HTMLImageElement:M,HTMLCanvasElement:T,HTMLVideoElement:I,ImageData:O,ImageBitmap:R}=Je;if(b.bindTexture(b.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA&&(!a||!1!==a.premultiply)),u||this.size&&this.size[0]===h&&this.size[1]===m){const{x:B,y:V}=u||{x:0,y:0};r instanceof M||r instanceof T||r instanceof I||r instanceof O||R&&r instanceof R?b.texSubImage2D(b.TEXTURE_2D,0,B,V,b.RGBA,b.UNSIGNED_BYTE,r):b.texSubImage2D(b.TEXTURE_2D,0,B,V,h,m,b.RGBA,b.UNSIGNED_BYTE,r.data)}else this.size=[h,m],r instanceof M||r instanceof T||r instanceof I||r instanceof O||R&&r instanceof R?b.texImage2D(b.TEXTURE_2D,0,this.format,this.format,b.UNSIGNED_BYTE,r):b.texImage2D(b.TEXTURE_2D,0,this.format,h,m,0,this.format,b.UNSIGNED_BYTE,r.data);this.useMipmap=!!(a&&a.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&b.generateMipmap(b.TEXTURE_2D)}bind(r,a){const{context:u}=this,{gl:h}=u;h.bindTexture(h.TEXTURE_2D,this.texture),r!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,r),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?r===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_NEAREST:r),this.filter=r),a!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,a),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class H_{constructor(r){this._callback=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Pg{constructor(){this.tasks={},this.taskQueue=[],ri(["process"],this),this.invoker=new H_(this.process),this.nextId=0}add(r,a){const u=this.nextId++,h=function({type:m,isSymbolTile:v,zoom:b}){return b=b||0,"message"===m?0:"maybePrepare"!==m||v?"parseTile"!==m||v?"parseTile"===m&&v?300-b:"maybePrepare"===m&&v?400-b:500:200-b:100-b}(a);if(0===h){zs();try{r()}finally{}return{cancel:()=>{}}}return this.tasks[u]={fn:r,metadata:a,priority:h,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){zs();try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const r=this.pick();if(null===r)return;const a=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let r=null,a=1/0;for(let h=0;h<this.taskQueue.length;h++){const m=this.tasks[this.taskQueue[h]];m.priority<a&&(a=m.priority,r=h)}if(null===r)return null;const u=this.taskQueue[r];return this.taskQueue.splice(r,1),u}remove(){this.invoker.remove()}}class T0{constructor(r){this._stringToNumber={},this._numberToString=[];for(let a=0;a<r.length;a++){const u=r[a];this._stringToNumber[u]=a,this._numberToString[a]=u}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}const D0=["tile","layer","source","sourceLayer","state"];class S0{constructor(r,a,u,h,m){this.type="Feature",this._vectorTileFeature=r,this._z=a,this._x=u,this._y=h,this.properties=r.properties,this.id=m}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(r.id=this.id);for(const a of D0)void 0!==this[a]&&(r[a]=this[a]);return r}}const mc=new Uint16Array(8184);for(let s=0;s<2046;s++){let r=s+2,a=0,u=0,h=0,m=0,v=0,b=0;for(1&r?h=m=v=32:a=u=b=32;(r>>=1)>1;){const T=a+h>>1,I=u+m>>1;1&r?(h=a,m=u,a=v,u=b):(a=h,u=m,h=v,m=b),v=T,b=I}const M=4*s;mc[M+0]=a,mc[M+1]=u,mc[M+2]=h,mc[M+3]=m}const rs=new Uint16Array(2178),_c=new Uint8Array(1089),_l=new Uint16Array(1089);function Bi(s){return 0===s?-.03125:32===s?.03125:0}var I0=Ee([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const G_={type:2,extent:Bt,loadGeometry:()=>[[new _t(0,0),new _t(Bt+1,0),new _t(Bt+1,Bt+1),new _t(0,Bt+1),new _t(0,0)]]};class Ss{constructor(r,a,u,h,m){this.tileID=r,this.uid=ar(),this.uses=0,this.tileSize=a,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=m,this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(r){const a=r+this.timeAdded;a<ms.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Eu(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,a,u){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(h,m){const v={};if(!m)return v;for(const b of h){const M=b.layerIds.map(T=>m.getLayer(T)).filter(Boolean);if(0!==M.length){b.layers=M,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(T=>M.filter(I=>I.id===T)[0]));for(const T of M)v[T.id]=b}}return v}(r.buckets,a.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const m=this.buckets[h];if(m instanceof gc){if(this.hasSymbolBuckets=!0,!u)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const m=this.buckets[h];if(m instanceof gc&&m.hasRTLText){this.hasRTLText=!0,S.isLoading()||S.isLoaded()||"deferred"!==C()||D();break}}this.queryPadding=0;for(const h in this.buckets){const m=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(h).queryRadius(m))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas)}else this.collisionBoxArray=new Un}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(r){return this.buckets[r.id]}upload(r){for(const u in this.buckets){const h=this.buckets[u];h.uploadPending()&&h.upload(r)}const a=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ud(r,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ud(r,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Ud(r,this.lineAtlas.image,a.ALPHA),this.lineAtlas.uploaded=!0)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,a,u,h,m,v,b,M){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:b,transform:v,params:m,tileTransform:this.tileTransform},r,a,u):{}}querySourceFeatures(r,a){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const h=u.loadVTLayers(),m=a?a.sourceLayer:"",v=h._geojsonTileLayer||h[m];if(!v)return;const b=Hs(a&&a.filter),{z:M,x:T,y:I}=this.tileID.canonical,O={z:M,x:T,y:I};for(let R=0;R<v.length;R++){const B=v.feature(R);if(b.needGeometry){const K=mu(B,!0);if(!b.filter(new k(this.tileID.overscaledZ),K,this.tileID.canonical))continue}else if(!b.filter(new k(this.tileID.overscaledZ),B))continue;const V=u.getId(B,m),w=new S0(B,M,T,I,V);w.tile=O,r.push(w)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const a=this.expirationTime;if(r.cacheControl){const u=yo(r.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const u=Date.now();let h=!1;if(this.expirationTime>u)h=!1;else if(a)if(this.expirationTime<a)h=!0;else{const m=this.expirationTime-a;m?this.expirationTime=u+Math.max(m,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(r,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(r).length||!a)return;const u=this.latestFeatureIndex.loadVTLayers(),h=a.style.listImages();for(const m in this.buckets){if(!a.style.hasLayer(m))continue;const v=this.buckets[m],b=v.layers[0].sourceLayer||"_geojsonTileLayer",M=u[b],T=r[b];if(!M||!T||0===Object.keys(T).length)continue;if(v.update(T,M,h,this.imageAtlas&&this.imageAtlas.patternPositions||{}),v instanceof ap||v instanceof eg){const O=a.style._getSourceCache(v.layers[0].source);a._terrain&&a._terrain.enabled&&O&&v.programConfigurations.needsUpload&&a._terrain._clearRenderCacheForTile(O.id,this.tileID)}const I=a&&a.style&&a.style.getLayer(m);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(v)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ms.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=ms.now()+r}setTexture(r,a){const u=a.context,h=u.gl;this.texture=this.texture||a.getTileTexture(r.width),this.texture?this.texture.update(r,{useMipmap:!0}):(this.texture=new Ud(u,r,h.RGBA,{useMipmap:!0}),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE))}setDependencies(r,a){const u={};for(const h of a)u[h]=!0;this.dependencies[r]=u}hasDependency(r,a){for(const u of r){const h=this.dependencies[u];if(h)for(const m of a)if(h[m])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,a){if(!a||"mercator"===a.name||this._tileDebugBuffer)return;const u=dl(G_,this.tileID.canonical,this.tileTransform)[0],h=new ot,m=new So;for(let v=0;v<u.length;v++){const{x:b,y:M}=u[v];h.emplaceBack(b,M),m.emplaceBack(v)}m.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(m),this._tileDebugBuffer=r.createVertexBuffer(h,ac.members),this._tileDebugSegments=Fi.simpleSegment(0,0,h.length,m.length)}_makeTileBoundsBuffers(r,a){if(this._tileBoundsBuffer||!a||"mercator"===a.name)return;const u=dl(G_,this.tileID.canonical,this.tileTransform)[0];let h,m;if(this.isRaster){const v=function(b,M){const T=Eu(b,M),I=Math.pow(2,b.z);for(let K=0;K<33;K++)for(let G=0;G<33;G++){const me=Hr((b.x+(G+Bi(G))/32)/I),ae=Or((b.y+(K+Bi(K))/32)/I),fe=M.project(me,ae),_e=33*K+G;rs[2*_e+0]=Math.round((fe.x*T.scale-T.x)*Bt),rs[2*_e+1]=Math.round((fe.y*T.scale-T.y)*Bt)}_c.fill(0),_l.fill(0);for(let K=2045;K>=0;K--){const G=4*K,me=mc[G+0],ae=mc[G+1],fe=mc[G+2],_e=mc[G+3],ve=me+fe>>1,Re=ae+_e>>1,ke=ve+Re-ae,$e=Re+me-ve,rt=33*ae+me,Ne=33*_e+fe,Ye=33*Re+ve,Xe=Math.hypot((rs[2*rt+0]+rs[2*Ne+0])/2-rs[2*Ye+0],(rs[2*rt+1]+rs[2*Ne+1])/2-rs[2*Ye+1])>=16;_c[Ye]=_c[Ye]||(Xe?1:0),K<1022&&(_c[Ye]=_c[Ye]||_c[33*(ae+$e>>1)+(me+ke>>1)]||_c[33*(_e+$e>>1)+(fe+ke>>1)])}const O=new Ze,R=new Pt;let B=0;function V(K,G){const me=33*G+K;return 0===_l[me]&&(O.emplaceBack(rs[2*me+0],rs[2*me+1],K*Bt/32,G*Bt/32),_l[me]=++B),_l[me]-1}function w(K,G,me,ae,fe,_e){const ve=K+me>>1,Re=G+ae>>1;if(Math.abs(K-fe)+Math.abs(G-_e)>1&&_c[33*Re+ve])w(fe,_e,K,G,ve,Re),w(me,ae,fe,_e,ve,Re);else{const ke=V(K,G),$e=V(me,ae),rt=V(fe,_e);R.emplaceBack(ke,$e,rt)}}return w(0,0,32,32,32,0),w(32,32,0,0,0,32),{vertices:O,indices:R}}(this.tileID.canonical,a);h=v.vertices,m=v.indices}else{h=new Ze,m=new Pt;for(const{x:b,y:M}of u)h.emplaceBack(b,M,0,0);const v=a_(h.int16,void 0,4);for(let b=0;b<v.length;b+=3)m.emplaceBack(v[b],v[b+1],v[b+2])}this._tileBoundsBuffer=r.createVertexBuffer(h,I0.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(m),this._tileBoundsSegments=Fi.simpleSegment(0,0,h.length,m.length)}_makeGlobeTileDebugBuffers(r,a){const u=a.projection;if(!u||"globe"!==u.name||a.freezeTileCoverage)return;const h=this.tileID.canonical,m=Ff(Km(h,a)),v=Zh(a.zoom);let b;v>0&&(b=$m(new Float64Array(16),a.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(r,h,a,m,b,v),this._makeGlobeTileDebugTextBuffer(r,h,a,m,b,v)}_globePoint(r,a,u,h,m,v,b){let M=Ma(r,a,u);if(v){const T=1<<u.z,I=ho(h.center.lng),O=Ws(h.center.lat),R=(u.x+.5)/T-I;let B=0;R>.5?B=-1:R<-.5&&(B=1);let V=(r/Bt+u.x)/T+B,w=(a/Bt+u.y)/T;V=(V-I)*h._pixelsPerMercatorPixel+I,w=(w-O)*h._pixelsPerMercatorPixel+O;const K=[V*h.worldSize,w*h.worldSize,0];Gi(K,K,v),M=du(M,K,b)}return Gi(M,M,m)}_makeGlobeTileDebugBorderBuffer(r,a,u,h,m,v){const b=new ot,M=new So,T=new Oe,I=(R,B,V,w,K)=>{const G=(V-R)/(K-1),me=(w-B)/(K-1),ae=b.length;for(let fe=0;fe<K;fe++){const _e=R+fe*G,ve=B+fe*me;b.emplaceBack(_e,ve);const Re=this._globePoint(_e,ve,a,u,h,m,v);T.emplaceBack(Re[0],Re[1],Re[2]),M.emplaceBack(ae+fe)}},O=Bt;I(0,0,O,0,16),I(O,0,O,O,16),I(O,O,0,O,16),I(0,O,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(M),this._tileDebugBuffer=r.createVertexBuffer(b,ac.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(T,Wm.members),this._tileDebugSegments=Fi.simpleSegment(0,0,b.length,M.length)}_makeGlobeTileDebugTextBuffer(r,a,u,h,m,v){const b=Bt/4,M=new ot,T=new Pt,I=new Oe,O=25;T.reserve(32),M.reserve(O),I.reserve(O);const R=(B,V)=>O*B+V;for(let B=0;B<O;B++){const V=B*b;for(let w=0;w<O;w++){const K=w*b;M.emplaceBack(K,V);const G=this._globePoint(K,V,a,u,h,m,v);I.emplaceBack(G[0],G[1],G[2])}}for(let B=0;B<4;B++)for(let V=0;V<4;V++){const w=R(B,V),K=R(B,V+1),G=R(B+1,V),me=R(B+1,V+1);T.emplaceBack(w,K,G),T.emplaceBack(G,K,me)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(T),this._tileDebugTextBuffer=r.createVertexBuffer(M,ac.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(I,Wm.members),this._tileDebugTextSegments=Fi.simpleSegment(0,0,O,32)}}class lb{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,a,u){const h=String(a);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][h]=this.stateChanges[r][h]||{},$i(this.stateChanges[r][h],u),null===this.deletedStates[r]){this.deletedStates[r]={};for(const m in this.state[r])m!==h&&(this.deletedStates[r][m]=null)}else if(this.deletedStates[r]&&null===this.deletedStates[r][h]){this.deletedStates[r][h]={};for(const m in this.state[r][h])u[m]||(this.deletedStates[r][h][m]=null)}else for(const m in u)this.deletedStates[r]&&this.deletedStates[r][h]&&null===this.deletedStates[r][h][m]&&delete this.deletedStates[r][h][m]}removeFeatureState(r,a,u){if(null===this.deletedStates[r])return;const h=String(a);if(this.deletedStates[r]=this.deletedStates[r]||{},u&&void 0!==a)null!==this.deletedStates[r][h]&&(this.deletedStates[r][h]=this.deletedStates[r][h]||{},this.deletedStates[r][h][u]=null);else if(void 0!==a)if(this.stateChanges[r]&&this.stateChanges[r][h])for(u in this.deletedStates[r][h]={},this.stateChanges[r][h])this.deletedStates[r][h][u]=null;else this.deletedStates[r][h]=null;else this.deletedStates[r]=null}getState(r,a){const u=String(a),h=$i({},(this.state[r]||{})[u],(this.stateChanges[r]||{})[u]);if(null===this.deletedStates[r])return{};if(this.deletedStates[r]){const m=this.deletedStates[r][a];if(null===m)return{};for(const v in m)delete h[v]}return h}initializeTileState(r,a){r.setFeatureState(this.state,a)}coalesceChanges(r,a){const u={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const m={};for(const v in this.stateChanges[h])this.state[h][v]||(this.state[h][v]={}),$i(this.state[h][v],this.stateChanges[h][v]),m[v]=this.state[h][v];u[h]=m}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const m={};if(null===this.deletedStates[h])for(const v in this.state[h])m[v]={},this.state[h][v]={};else for(const v in this.deletedStates[h]){if(null===this.deletedStates[h][v])this.state[h][v]={};else if(this.state[h][v])for(const b of Object.keys(this.deletedStates[h][v]))delete this.state[h][v][b];m[v]=this.state[h][v]}u[h]=u[h]||{},$i(u[h],m)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(u).length)for(const h in r)r[h].setFeatureState(u,a)}}class A0{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,a){const u=this.toIdx(r,a);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(r,a){return this.leaves[this.toIdx(r,a)]}toIdx(r,a){return a*this.size+r}}function jd(s,r,a,u){let h=0,m=Number.MAX_VALUE;for(let v=0;v<3;v++)if(Math.abs(u[v])<1e-15){if(a[v]<s[v]||a[v]>r[v])return null}else{const b=1/u[v];let M=(s[v]-a[v])*b,T=(r[v]-a[v])*b;if(M>T){const I=M;M=T,T=I}if(M>h&&(h=M),T<m&&(m=T),h>m)return null}return h}function P0(s,r,a,u,h,m,v,b,M,T,I){const O=u-s,R=h-r,B=m-a,V=v-s,w=b-r,K=M-a,G=I[1]*K-I[2]*w,me=I[2]*V-I[0]*K,ae=I[0]*w-I[1]*V,fe=O*G+R*me+B*ae;if(Math.abs(fe)<1e-15)return null;const _e=1/fe,ve=T[0]-s,Re=T[1]-r,ke=T[2]-a,$e=(ve*G+Re*me+ke*ae)*_e;if($e<0||$e>1)return null;const rt=Re*B-ke*R,Ne=ke*O-ve*B,Ye=ve*R-Re*O,Xe=(I[0]*rt+I[1]*Ne+I[2]*Ye)*_e;return Xe<0||$e+Xe>1?null:(V*rt+w*Ne+K*Ye)*_e}function kg(s,r,a){return(s-r)/(a-r)}function cb(s,r,a,u,h,m,v,b,M){const T=1<<a,I=m-u,O=v-h,R=(s+1)/T*I+u,B=(r+0)/T*O+h,V=(r+1)/T*O+h;b[0]=(s+0)/T*I+u,b[1]=B,M[0]=R,M[1]=V}class Og{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=function(m){const v=Math.ceil(Math.log2(m.dim/8)),b=[];let M=Math.ceil(Math.pow(2,v));const T=1/M,I=(B,V,w,K,G)=>{const me=K?1:0,ae=(B+1)*w-me,fe=V*w,_e=(V+1)*w-me;G[0]=B*w,G[1]=fe,G[2]=ae,G[3]=_e};let O=new A0(M);const R=[];for(let B=0;B<M*M;B++){I(B%M,Math.floor(B/M),T,!1,R);const V=vc(R[0],R[1],m),w=vc(R[2],R[1],m),K=vc(R[2],R[3],m),G=vc(R[0],R[3],m);O.minimums.push(Math.min(V,w,K,G)),O.maximums.push(Math.max(V,w,K,G)),O.leaves.push(1)}for(b.push(O),M/=2;M>=1;M/=2){const B=b[b.length-1];O=new A0(M);for(let V=0;V<M*M;V++){I(V%M,Math.floor(V/M),2,!0,R);const w=B.getElevation(R[0],R[1]),K=B.getElevation(R[2],R[1]),G=B.getElevation(R[2],R[3]),me=B.getElevation(R[0],R[3]),ae=B.isLeaf(R[0],R[1]),fe=B.isLeaf(R[2],R[1]),_e=B.isLeaf(R[2],R[3]),ve=B.isLeaf(R[0],R[3]),Re=Math.min(w.min,K.min,G.min,me.min),ke=Math.max(w.max,K.max,G.max,me.max),$e=ae&&fe&&_e&&ve;O.maximums.push(ke),O.minimums.push(Re),O.leaves.push(ke-Re<=5&&$e?1:0)}b.push(O)}return b}(this.dem),u=a.length-1,h=a[u];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(a,0,0,u,0)}raycastRoot(r,a,u,h,m,v,b=1){return jd([r,a,-100],[u,h,this.maximums[0]*b],m,v)}raycast(r,a,u,h,m,v,b=1){if(!this.nodeCount)return null;const M=this.raycastRoot(r,a,u,h,m,v,b);if(null==M)return null;const T=[],I=[],O=[],R=[],B=[{idx:0,t:M,nodex:0,nodey:0,depth:0}];for(;B.length>0;){const{idx:V,t:w,nodex:K,nodey:G,depth:me}=B.pop();if(this.leaves[V]){cb(K,G,me,r,a,u,h,O,R);const fe=1<<me,_e=(K+0)/fe,ve=(K+1)/fe,Re=(G+0)/fe,ke=(G+1)/fe,$e=vc(_e,Re,this.dem)*b,rt=vc(ve,Re,this.dem)*b,Ne=vc(ve,ke,this.dem)*b,Ye=vc(_e,ke,this.dem)*b,Xe=P0(O[0],O[1],$e,R[0],O[1],rt,R[0],R[1],Ne,m,v),nt=P0(R[0],R[1],Ne,O[0],R[1],Ye,O[0],O[1],$e,m,v),ct=Math.min(null!==Xe?Xe:Number.MAX_VALUE,null!==nt?nt:Number.MAX_VALUE);if(ct!==Number.MAX_VALUE)return ct;{const Ue=cu([],m,v,w);if(q_($e,rt,Ye,Ne,kg(Ue[0],O[0],R[0]),kg(Ue[1],O[1],R[1]))>=Ue[2])return w}continue}let ae=0;for(let fe=0;fe<this._siblingOffset.length;fe++){cb((K<<1)+this._siblingOffset[fe][0],(G<<1)+this._siblingOffset[fe][1],me+1,r,a,u,h,O,R),O[2]=-100,R[2]=this.maximums[this.childOffsets[V]+fe]*b;const _e=jd(O,R,m,v);if(null!=_e){const ve=_e;T[fe]=ve;let Re=!1;for(let ke=0;ke<ae&&!Re;ke++)ve>=T[I[ke]]&&(I.splice(ke,0,fe),Re=!0);Re||(I[ae]=fe),ae++}}for(let fe=0;fe<ae;fe++){const _e=I[fe];B.push({idx:this.childOffsets[V]+_e,t:T[_e],nodex:(K<<1)+this._siblingOffset[_e][0],nodey:(G<<1)+this._siblingOffset[_e][1],depth:me+1})}}return null}_addNode(r,a,u){return this.minimums.push(r),this.maximums.push(a),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(r,a,u,h,m){if(1===r[h].isLeaf(a,u))return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);const v=h-1,b=r[v];let M=0,T=0;for(let I=0;I<this._siblingOffset.length;I++){const O=2*a+this._siblingOffset[I][0],R=2*u+this._siblingOffset[I][1],B=b.getElevation(O,R),V=b.isLeaf(O,R),w=this._addNode(B.min,B.max,V);V&&(M|=1<<I),T||(T=w)}for(let I=0;I<this._siblingOffset.length;I++)M&1<<I||this._construct(r,2*a+this._siblingOffset[I][0],2*u+this._siblingOffset[I][1],v,T+I)}}function q_(s,r,a,u,h,m){return wn(wn(s,a,m),wn(r,u,m),h)}function vc(s,r,a){const u=a.dim,h=yn(s*u-.5,0,u-1),m=yn(r*u-.5,0,u-1),v=Math.floor(h),b=Math.floor(m),M=Math.min(v+1,u-1),T=Math.min(b+1,u-1);return q_(a.get(v,b),a.get(M,b),a.get(v,T),a.get(M,T),h-v,m-b)}const k0={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function O0(s,r,a){return(256*s*256+256*r+a)/10-1e4}function ub(s,r,a){return 256*s+r+a/256-32768}class yp{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,a,u,h=!1,m=!1){if(this.uid=r,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(u&&"mapbox"!==u&&"terrarium"!==u)return oi(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const v=this.dim=a.height-2,b=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.encoding=u||"mapbox",this.borderReady=h,!h){for(let M=0;M<v;M++)b[this._idx(-1,M)]=b[this._idx(0,M)],b[this._idx(v,M)]=b[this._idx(v-1,M)],b[this._idx(M,-1)]=b[this._idx(M,0)],b[this._idx(M,v)]=b[this._idx(M,v-1)];b[this._idx(-1,-1)]=b[this._idx(0,0)],b[this._idx(v,-1)]=b[this._idx(v-1,0)],b[this._idx(-1,v)]=b[this._idx(0,v-1)],b[this._idx(v,v)]=b[this._idx(v-1,v-1)],m&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Og(this)}get(r,a,u=!1){u&&(r=yn(r,-1,this.dim),a=yn(a,-1,this.dim));const h=4*this._idx(r,a);return("terrarium"===this.encoding?ub:O0)(this.pixels[h],this.pixels[h+1],this.pixels[h+2])}static getUnpackVector(r){return k0[r]}get unpackVector(){return k0[this.encoding]}_idx(r,a){if(r<-1||r>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(r+1)}static pack(r,a){const u=[0,0,0,0],h=yp.getUnpackVector(a);let m=Math.floor((r+h[3])/h[2]);return u[2]=m%256,m=Math.floor(m/256),u[1]=m%256,m=Math.floor(m/256),u[0]=m,u}getPixels(){return new ko({width:this.stride,height:this.stride},this.pixels)}backfillBorder(r,a,u){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let h=a*this.dim,m=a*this.dim+this.dim,v=u*this.dim,b=u*this.dim+this.dim;switch(a){case-1:h=m-1;break;case 1:m=h+1}switch(u){case-1:v=b-1;break;case 1:b=v+1}const M=-a*this.dim,T=-u*this.dim;for(let I=v;I<b;I++)for(let O=h;O<m;O++){const R=4*this._idx(O,I),B=4*this._idx(O+M,I+T);this.pixels[R+0]=r.pixels[B+0],this.pixels[R+1]=r.pixels[B+1],this.pixels[R+2]=r.pixels[B+2],this.pixels[R+3]=r.pixels[B+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Tt(yp,"DEMData"),Tt(Og,"DemMinMaxQuadTree",{omit:["dem"]});class db{constructor(r,a){this.max=r,this.onRemove=a,this.reset()}reset(){for(const r in this.data)for(const a of this.data[r])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(r,a,u){const h=r.wrapped().key;void 0===this.data[h]&&(this.data[h]=[]);const m={value:a,timeout:void 0};if(void 0!==u&&(m.timeout=setTimeout(()=>{this.remove(r,m)},u)),this.data[h].push(m),this.order.push(h),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const a=this.data[r].shift();return a.timeout&&clearTimeout(a.timeout),0===this.data[r].length&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),a.value}getByKey(r){const a=this.data[r];return a?a[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,a){if(!this.has(r))return this;const u=r.wrapped().key,h=void 0===a?0:this.data[u].indexOf(a),m=this.data[u][h];return this.data[u].splice(h,1),m.timeout&&clearTimeout(m.timeout),0===this.data[u].length&&delete this.data[u],this.onRemove(m.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(r){const a=[];for(const u in this.data)for(const h of this.data[u])r(h.value)||a.push(h);for(const u of a)this.remove(u.value.tileID,u)}}class $d{constructor(r,a,u){this.func=r,this.mask=a,this.range=u}}$d.ReadOnly=!1,$d.ReadWrite=!0,$d.disabled=new $d(519,$d.ReadOnly,[0,1]);class Lg{constructor(r,a,u,h,m,v){this.test=r,this.ref=a,this.mask=u,this.fail=h,this.depthFail=m,this.pass=v}}Lg.disabled=new Lg({func:519,mask:0},0,0,7680,7680,7680);class Qs{constructor(r,a,u){this.blendFunction=r,this.blendColor=a,this.mask=u}}Qs.Replace=[1,0],Qs.disabled=new Qs(Qs.Replace,Oi.transparent,[!1,!1,!1,!1]),Qs.unblended=new Qs(Qs.Replace,Oi.transparent,[!0,!0,!0,!0]),Qs.alphaBlended=new Qs([1,771],Oi.transparent,[!0,!0,!0,!0]);class ea{constructor(r,a,u){this.enable=r,this.mode=a,this.frontFace=u}}ea.disabled=new ea(!1,1029,2305),ea.backCCW=new ea(!0,1029,2305),ea.backCW=new ea(!0,1029,2304),ea.frontCW=new ea(!0,1028,2304),ea.frontCCW=new ea(!0,1028,2305);class Hd extends Ll{constructor(r,a,u){super(),this.id=r,this._onlySymbols=u,a.on("data",h=>{"source"===h.dataType&&"metadata"===h.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===h.dataType&&"content"===h.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new db(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new lb,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(r){this.map=r,this._minTileCacheSize=void 0===this._minTileCacheSize&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const a=this._tiles[r];if("loaded"!==a.state&&"errored"!==a.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,a){return r.isSymbolTile=this._onlySymbols,this._source.loadTile(r,a)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,()=>{})}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r,()=>{})}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const u=this._tiles[a];u.upload(r),u.prepare(this.map.style.imageManager)}}getIds(){return sa(this._tiles).map(r=>r.tileID).sort(Rg).map(r=>r.key)}getRenderableIds(r){const a=[];for(const u in this._tiles)this._isIdRenderable(+u,r)&&a.push(this._tiles[u]);return r?a.sort((u,h)=>{const m=u.tileID,v=h.tileID,b=new _t(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),M=new _t(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-v.overscaledZ||M.y-b.y||M.x-b.x}).map(u=>u.tileID.key):a.map(u=>u.tileID).sort(Rg).map(u=>u.key)}hasRenderableParent(r){const a=this.findLoadedParent(r,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(r,a){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(a||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)"errored"!==this._tiles[r].state&&this._reloadTile(+r,"reloading")}}_reloadTile(r,a){const u=this._tiles[r];u&&("loading"!==u.state&&(u.state=a),this._loadTile(u,this._tileLoaded.bind(this,u,r,a)))}_tileLoaded(r,a,u,h){if(h)if(r.state="errored",404!==h.status)this._source.fire(new Vs(h,{tile:r}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const m=this.map.painter.terrain;this.update(this.transform,m.getScaledDemTileSize(),!0),m.resetTileLookupCache(this.id)}else this.update(this.transform);else r.timeAdded=ms.now(),"expired"===u&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(a,r),"raster-dem"===this._source.type&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new jo("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const a=this.getRenderableIds();for(let h=0;h<a.length;h++){const m=a[h];if(r.neighboringTiles&&r.neighboringTiles[m]){const v=this.getTileByID(m);u(r,v),u(v,r)}}function u(h,m){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let v=m.tileID.canonical.x-h.tileID.canonical.x;const b=m.tileID.canonical.y-h.tileID.canonical.y,M=Math.pow(2,h.tileID.canonical.z),T=m.tileID.key;0===v&&0===b||Math.abs(b)>1||(Math.abs(v)>1&&(1===Math.abs(v+M)?v+=M:1===Math.abs(v-M)&&(v-=M)),m.dem&&h.dem&&(h.dem.backfillBorder(m.dem,v,b),h.neighboringTiles&&h.neighboringTiles[T]&&(h.neighboringTiles[T].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,a,u,h){for(const m in this._tiles){let v=this._tiles[m];if(h[m]||!v.hasData()||v.tileID.overscaledZ<=a||v.tileID.overscaledZ>u)continue;let b=v.tileID;for(;v&&v.tileID.overscaledZ>a+1;){const T=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[T.key],v&&v.hasData()&&(b=T)}let M=b;for(;M.overscaledZ>a;)if(M=M.scaledTo(M.overscaledZ-1),r[M.key]){h[b.key]=b;break}}}findLoadedParent(r,a){if(r.key in this._loadedParentTiles){const u=this._loadedParentTiles[r.key];return u&&u.tileID.overscaledZ>=a?u:null}for(let u=r.overscaledZ-1;u>=a;u--){const h=r.scaledTo(u),m=this._getLoadedTile(h);if(m)return m}}_getLoadedTile(r){const a=this._tiles[r.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,a){a=a||this._source.tileSize;const u=Math.ceil(r.width/a)+1,h=Math.ceil(r.height/a)+1,m=Math.floor(u*h*5),v="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,m):m,b="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(b)}handleWrapJump(r){const a=Math.round((r-(void 0===this._prevLng?r:this._prevLng))/360);if(this._prevLng=r,a){const u={};for(const h in this._tiles){const m=this._tiles[h];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+a),u[m.tileID.key]=m}this._tiles=u;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(r,a,u){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;let h;this.updateCacheSize(r,a),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(b=>new br(b.canonical.z,b.wrap,b.canonical.z,b.canonical.x,b.canonical.y)):(h=r.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(h=h.filter(b=>this._source.hasTile(b)))):h=[];const m=this._updateRetainedTiles(h);if(R0(this._source.type)&&0!==h.length){const b={},M={},T=Object.keys(m);for(const O of T){const R=m[O],B=this._tiles[O];if(!B||B.fadeEndTime&&B.fadeEndTime<=ms.now())continue;const V=this.findLoadedParent(R,Math.max(R.overscaledZ-Hd.maxOverzooming,this._source.minzoom));V&&(this._addTile(V.tileID),b[V.tileID.key]=V.tileID),M[O]=R}const I=h[h.length-1].overscaledZ;for(const O in this._tiles){const R=this._tiles[O];if(m[O]||!R.hasData())continue;let B=R.tileID;for(;B.overscaledZ>I;){B=B.scaledTo(B.overscaledZ-1);const V=this._tiles[B.key];if(V&&V.hasData()&&M[B.key]){m[O]=R.tileID;break}}}for(const O in b)m[O]||(this._coveredTiles[O]=!0,m[O]=b[O])}for(const b in m)this._tiles[b].clearFadeHold();const v=function(b,M){const T=[];for(const I in b)I in M||T.push(I);return T}(this._tiles,m);for(const b of v){const M=this._tiles[b];M.hasSymbolBuckets&&!M.holdingForFade()?M.setHoldDuration(this.map._fadeDuration):M.hasSymbolBuckets&&!M.symbolFadeFinished()||this._removeTile(+b)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const a={};if(0===r.length)return a;const u={},h=r.reduce((T,I)=>Math.min(T,I.overscaledZ),1/0),m=r[0].overscaledZ,v=Math.max(m-Hd.maxOverzooming,this._source.minzoom),b=Math.max(m+Hd.maxUnderzooming,this._source.minzoom),M={};for(const T of r){const I=this._addTile(T);a[T.key]=T,I.hasData()||h<this._source.maxzoom&&(M[T.key]=T)}this._retainLoadedChildren(M,h,b,a);for(const T of r){let I=this._tiles[T.key];if(I.hasData())continue;if(T.canonical.z>=this._source.maxzoom){const R=T.children(this._source.maxzoom)[0],B=this.getTile(R);if(B&&B.hasData()){a[R.key]=R;continue}}else{const R=T.children(this._source.maxzoom);if(a[R[0].key]&&a[R[1].key]&&a[R[2].key]&&a[R[3].key])continue}let O=I.wasRequested();for(let R=T.overscaledZ-1;R>=v;--R){const B=T.scaledTo(R);if(u[B.key]||(u[B.key]=!0,I=this.getTile(B),!I&&O&&(I=this._addTile(B)),I&&(a[B.key]=B,O=I.wasRequested(),I.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const a=[];let u,h=this._tiles[r].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){u=this._loadedParentTiles[h.key];break}a.push(h.key);const m=h.scaledTo(h.overscaledZ-1);if(u=this._getLoadedTile(m),u)break;h=m}for(const m of a)this._loadedParentTiles[m]=u}}_addTile(r){let a=this._tiles[r.key];if(a)return a;a=this._cache.getAndRemove(r),a&&(this._setTileReloadTimer(r.key,a),a.tileID=r,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,a)));const u=!!a;if(!u){const h=this.map?this.map.painter:null;a=new Ss(r,this._source.tileSize*r.overscaleFactor(),this.transform.tileZoom,h,this._isRaster),this._loadTile(a,this._tileLoaded.bind(this,a,r.key,a.state))}return a?(a.uses++,this._tiles[r.key]=a,u||this._source.fire(new jo("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a):null}_setTileReloadTimer(r,a){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const u=a.getExpiryTimeout();u&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},u))}_removeTile(r){const a=this._tiles[r];a&&(a.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),a.uses>0||(a.hasData()&&"reloading"!==a.state?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,a,u){const h=[],m=this.transform;if(!m)return h;const v="globe"===m.projection.name,b=ho(m.center.lng);for(const M in this._tiles){const T=this._tiles[M];if(u&&T.clearQueryDebugViz(),T.holdingForFade())continue;let I;if(v){const O=T.tileID.canonical;if(0===O.z){const R=[Math.abs(yn(b,...Gd(O,-1))-b),Math.abs(yn(b,...Gd(O,1))-b)];I=[0,2*R.indexOf(Math.min(...R))-1]}else{const R=[Math.abs(yn(b,...Gd(O,-1))-b),Math.abs(yn(b,...Gd(O,0))-b),Math.abs(yn(b,...Gd(O,1))-b)];I=[R.indexOf(Math.min(...R))-1]}}else I=[0];for(const O of I){const R=r.containsTile(T,m,a,O);R&&h.push(R)}}return h}getVisibleCoordinates(r){const a=this.getRenderableIds(r).map(u=>this._tiles[u].tileID);for(const u of a)u.projMatrix=this.transform.calculateProjMatrix(u.toUnwrapped());return a}hasTransition(){if(this._source.hasTransition())return!0;if(R0(this._source.type))for(const r in this._tiles){const a=this._tiles[r];if(void 0!==a.fadeEndTime&&a.fadeEndTime>=ms.now())return!0}return!1}setFeatureState(r,a,u){this._state.updateState(r=r||"_geojsonTileLayer",a,u)}removeFeatureState(r,a,u){this._state.removeFeatureState(r=r||"_geojsonTileLayer",a,u)}getFeatureState(r,a){return this._state.getState(r=r||"_geojsonTileLayer",a)}setDependencies(r,a,u){const h=this._tiles[r];h&&h.setDependencies(a,u)}reloadTilesForDependencies(r,a){for(const u in this._tiles)this._tiles[u].hasDependency(r,a)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(r,a))}_preloadTiles(r,a){if(!this._sourceLoaded){const b=()=>{this._sourceLoaded&&(this._source.off("data",b),this._preloadTiles(r,a))};return void this._source.on("data",b)}const u=new Map,h=Array.isArray(r)?r:[r],m=this.map.painter.terrain,v=this.usedForTerrain&&m?m.getScaledDemTileSize():this._source.tileSize;for(const b of h){const M=b.coveringTiles({tileSize:v,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const T of M)u.set(T.key,T);this.usedForTerrain&&b.updateElevation(!1)}sr(Array.from(u.values()),(b,M)=>{const T=new Ss(b,this._source.tileSize*b.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(T,I=>{"raster-dem"===this._source.type&&T.dem&&this._backfillDEM(T),M(I,T)})},a)}}function Rg(s,r){const a=Math.abs(2*s.wrap)-+(s.wrap<0),u=Math.abs(2*r.wrap)-+(r.wrap<0);return s.overscaledZ-r.overscaledZ||u-a||r.canonical.y-s.canonical.y||r.canonical.x-s.canonical.x}function R0(s){return"raster"===s||"image"===s||"video"===s||"custom"===s}function Gd(s,r){const a=1<<s.z;return[s.x/a+r,(s.x+1)/a+r]}Hd.maxOverzooming=10,Hd.maxUnderzooming=3;class vl{constructor(r,a,u){this._demTile=r,this._dem=this._demTile.dem,this._scale=a,this._offset=u}static create(r,a,u){const h=u||r.findDEMTileFor(a);if(!h||!h.dem)return;const m=h.dem,v=h.tileID,b=1<<a.canonical.z-v.canonical.z;return new vl(h,h.tileSize/Bt/b,[(a.canonical.x/b-v.canonical.x)*m.dim,(a.canonical.y/b-v.canonical.y)*m.dim])}tileCoordToPixel(r,a){const u=a*this._scale+this._offset[1],h=Math.floor(r*this._scale+this._offset[0]),m=Math.floor(u);return new _t(h,m)}getElevationAt(r,a,u,h){const m=r*this._scale+this._offset[0],v=a*this._scale+this._offset[1],b=Math.floor(m),M=Math.floor(v),T=this._dem;return h=!!h,u?wn(wn(T.get(b,M,h),T.get(b,M+1,h),v-M),wn(T.get(b+1,M,h),T.get(b+1,M+1,h),v-M),m-b):T.get(b,M,h)}getElevationAtPixel(r,a,u){return this._dem.get(r,a,!!u)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*Po(1,r)*this._dem.stride}}class Ia{constructor(r,a){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new Jl(Bt,16,0),this.featureIndexArray=new tc,this.promoteId=a}insert(r,a,u,h,m,v=0){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,h,m,v);const M=this.grid;for(let T=0;T<a.length;T++){const I=a[T],O=[1/0,1/0,-1/0,-1/0];for(let R=0;R<I.length;R++){const B=I[R];O[0]=Math.min(O[0],B.x),O[1]=Math.min(O[1],B.y),O[2]=Math.max(O[2],B.x),O[3]=Math.max(O[3],B.y)}O[0]<Bt&&O[1]<Bt&&O[2]>=0&&O[3]>=0&&M.insert(b,O[0],O[1],O[2],O[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new rg(new kd(this.rawTileData)).layers,this.sourceLayerCoder=new T0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,a,u,h){this.loadVTLayers();const m=r.params||{},v=Hs(m.filter),b=r.tileResult,M=r.transform,T=b.bufferedTilespaceBounds,I=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,(V,w,K,G)=>A1(b.bufferedTilespaceGeometry,V,w,K,G));I.sort(hb);let O=null;M.elevation&&I.length>0&&(O=vl.create(M.elevation,this.tileID));const R={};let B;for(let V=0;V<I.length;V++){const w=I[V];if(w===B)continue;B=w;const K=this.featureIndexArray.get(w);let G=null;this.loadMatchingFeature(R,K,v,m.layers,m.availableImages,a,u,h,(me,ae,fe,_e=0)=>(G||(G=dl(me,this.tileID.canonical,r.tileTransform)),ae.queryIntersectsFeature(b,me,fe,G,this.z,r.transform,r.pixelPosMatrix,O,_e)))}return R}loadMatchingFeature(r,a,u,h,m,v,b,M,T){const{featureIndex:I,bucketIndex:O,sourceLayerIndex:R,layoutVertexArrayOffset:B}=a,V=this.bucketLayerIDs[O];if(h&&!function(me,ae){for(let fe=0;fe<me.length;fe++)if(ae.indexOf(me[fe])>=0)return!0;return!1}(h,V))return;const w=this.sourceLayerCoder.decode(R),K=this.vtLayers[w].feature(I);if(u.needGeometry){const me=mu(K,!0);if(!u.filter(new k(this.tileID.overscaledZ),me,this.tileID.canonical))return}else if(!u.filter(new k(this.tileID.overscaledZ),K))return;const G=this.getId(K,w);for(let me=0;me<V.length;me++){const ae=V[me];if(h&&h.indexOf(ae)<0)continue;const fe=v[ae];if(!fe)continue;let _e={};void 0!==G&&M&&(_e=M.getState(fe.sourceLayer||"_geojsonTileLayer",G));const ve=$i({},b[ae]);ve.paint=Su(ve.paint,fe.paint,K,_e,m),ve.layout=Su(ve.layout,fe.layout,K,_e,m);const Re=!T||T(K,fe,_e,B);if(!Re)continue;const ke=new S0(K,this.z,this.x,this.y,G);ke.layer=ve;let $e=r[ae];void 0===$e&&($e=r[ae]=[]),$e.push({featureIndex:I,feature:ke,intersectionZ:Re})}}lookupSymbolFeatures(r,a,u,h,m,v,b,M){const T={};this.loadVTLayers();const I=Hs(m);for(const O of r)this.loadMatchingFeature(T,{bucketIndex:u,sourceLayerIndex:h,featureIndex:O,layoutVertexArrayOffset:0},I,v,b,M,a);return T}loadFeature(r){const{featureIndex:a,sourceLayerIndex:u}=r;this.loadVTLayers();const h=this.sourceLayerCoder.decode(u),m=this.vtFeatures[h];if(m[a])return m[a];const v=this.vtLayers[h].feature(a);return m[a]=v,v}hasLayer(r){for(const a of this.bucketLayerIDs)for(const u of a)if(r===u)return!0;return!1}getId(r,a){let u=r.id;if(this.promoteId){const h="string"==typeof this.promoteId?this.promoteId:this.promoteId[a];null!=h&&(u=r.properties[h]),"boolean"==typeof u&&(u=Number(u))}return u}}function Su(s,r,a,u,h){return Cn(s,(m,v)=>{const b=r instanceof se?r.get(v):null;return b&&b.evaluate?b.evaluate(a,u,h):b})}function hb(s,r){return r-s}Tt(Ia,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class F0{constructor(r,a){this.width=r,this.height=a,this.nextRow=0,this.image=new uc({width:r,height:a}),this.positions={},this.uploaded=!1}getDash(r,a){const u=this.getKey(r,a);return this.positions[u]}trim(){const r=this.width,a=this.height=Ei(this.nextRow);this.image.resize({width:r,height:a})}getKey(r,a){return r.join(",")+a}getDashRanges(r,a,u){const h=[];let m=r.length%2==1?-r[r.length-1]*u:0,v=r[0]*u,b=!0;h.push({left:m,right:v,isDash:b,zeroLength:0===r[0]});let M=r[0];for(let T=1;T<r.length;T++){b=!b;const I=r[T];m=M*u,M+=I,v=M*u,h.push({left:m,right:v,isDash:b,zeroLength:0===I})}return h}addRoundDash(r,a,u){const h=a/2;for(let m=-u;m<=u;m++){const v=this.width*(this.nextRow+u+m);let b=0,M=r[b];for(let T=0;T<this.width;T++){T/M.right>1&&(M=r[++b]);const I=Math.abs(T-M.left),O=Math.abs(T-M.right),R=Math.min(I,O);let B;const V=m/u*(h+1);if(M.isDash){const w=h-Math.abs(V);B=Math.sqrt(R*R+w*w)}else B=h-Math.sqrt(R*R+V*V);this.image.data[v+T]=Math.max(0,Math.min(255,B+128))}}}addRegularDash(r,a){for(let M=r.length-1;M>=0;--M){const T=r[M],I=r[M+1];T.zeroLength?r.splice(M,1):I&&I.isDash===T.isDash&&(I.left=T.left,r.splice(M,1))}const u=r[0],h=r[r.length-1];u.isDash===h.isDash&&(u.left=h.left-this.width,h.right=u.right+this.width);const m=this.width*this.nextRow;let v=0,b=r[v];for(let M=0;M<this.width;M++){M/b.right>1&&(b=r[++v]);const T=Math.abs(M-b.left),I=Math.abs(M-b.right),O=Math.min(T,I);this.image.data[m+M]=Math.max(0,Math.min(255,(b.isDash?O:-O)+a+128))}}addDash(r,a){const u=this.getKey(r,a);if(this.positions[u])return this.positions[u];const h="round"===a,m=h?7:0,v=2*m+1;if(this.nextRow+v>this.height)return oi("LineAtlas out of space"),null;0===r.length&&r.push(1);let b=0;for(let I=0;I<r.length;I++)r[I]<0&&(oi("Negative value is found in line dasharray, replacing values with 0"),r[I]=0),b+=r[I];if(0!==b){const I=this.width/b,O=this.getDashRanges(r,this.width,I);h?this.addRoundDash(O,I,m):this.addRegularDash(O,"square"===a?.5*I:0)}const M=this.nextRow+m;this.nextRow+=v;const T={tl:[M,m],br:[b,0]};return this.positions[u]=T,T}}Tt(F0,"LineAtlas");const Z_=1*Ts;class Fg{constructor(r){const a={},u=[];for(const b in r){const M=r[b],T=a[b]={};for(const I in M.glyphs){const O=M.glyphs[+I];if(!O||0===O.bitmap.width||0===O.bitmap.height)continue;const R=O.metrics.localGlyph?Z_:1,B={x:0,y:0,w:O.bitmap.width+2*R,h:O.bitmap.height+2*R};u.push(B),T[I]=B}}const{w:h,h:m}=c0(u),v=new uc({width:h||1,height:m||1});for(const b in r){const M=r[b];for(const T in M.glyphs){const I=M.glyphs[+T];if(!I||0===I.bitmap.width||0===I.bitmap.height)continue;const O=a[b][T],R=I.metrics.localGlyph?Z_:1;uc.copy(I.bitmap,v,{x:0,y:0},{x:O.x+R,y:O.y+R},I.bitmap)}}this.image=v,this.positions=a}}Tt(Fg,"GlyphAtlas");class bp{constructor(r){this.tileID=new br(r.tileID.overscaledZ,r.tileID.wrap,r.tileID.canonical.z,r.tileID.canonical.x,r.tileID.canonical.y),this.tileZoom=r.tileZoom,this.uid=r.uid,this.zoom=r.zoom,this.canonical=r.tileID.canonical,this.pixelRatio=r.pixelRatio,this.tileSize=r.tileSize,this.source=r.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=r.showCollisionBoxes,this.collectResourceTiming=!!r.collectResourceTiming,this.returnDependencies=!!r.returnDependencies,this.promoteId=r.promoteId,this.enableTerrain=!!r.enableTerrain,this.isSymbolTile=r.isSymbolTile,this.tileTransform=Eu(r.tileID.canonical,r.projection),this.projection=r.projection}parse(r,a,u,h,m){this.status="parsing",this.data=r,this.collisionBoxArray=new Un;const v=new T0(Object.keys(r.layers).sort()),b=new Ia(this.tileID,this.promoteId);b.bucketLayerIDs=[];const M={},T=new F0(256,256),I={featureIndex:b,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:T,availableImages:u},O=a.familiesBySource[this.source];for(const _e in O){const ve=r.layers[_e];if(!ve)continue;let Re=!1,ke=!1;for(const Ne of O[_e])"symbol"===Ne[0].type?Re=!0:ke=!0;if(!0===this.isSymbolTile&&!Re||!1===this.isSymbolTile&&!ke)continue;1===ve.version&&oi(`Vector tile source "${this.source}" layer "${_e}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const $e=v.encode(_e),rt=[];for(let Ne=0;Ne<ve.length;Ne++){const Ye=ve.feature(Ne),Xe=b.getId(Ye,_e);rt.push({feature:Ye,id:Xe,index:Ne,sourceLayerIndex:$e})}for(const Ne of O[_e]){const Ye=Ne[0];void 0!==this.isSymbolTile&&"symbol"===Ye.type!==this.isSymbolTile||Ye.minzoom&&this.zoom<Math.floor(Ye.minzoom)||Ye.maxzoom&&this.zoom>=Ye.maxzoom||"none"!==Ye.visibility&&(Ng(Ne,this.zoom,u),(M[Ye.id]=Ye.createBucket({index:b.bucketLayerIDs.length,layers:Ne,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:$e,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:u})).populate(rt,I,this.tileID.canonical,this.tileTransform),b.bucketLayerIDs.push(Ne.map(Xe=>Xe.id)))}}let R,B,V,w;T.trim();const K={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},G=()=>{if(R)return m(R);if(B&&V&&w){const _e=new Fg(B),ve=new gg(V,w);for(const Re in M){const ke=M[Re];ke instanceof gc?(Ng(ke.layers,this.zoom,u),N_(ke,B,_e.positions,V,ve.iconPositions,this.showCollisionBoxes,u,this.tileID.canonical,this.tileZoom,this.projection)):ke.hasPattern&&(ke instanceof ap||ke instanceof eg||ke instanceof rp)&&(Ng(ke.layers,this.zoom,u),ke.addFeatures(I,this.tileID.canonical,ve.patternPositions,u,this.tileTransform))}this.status="done",m(null,{buckets:sa(M).filter(Re=>!Re.isEmpty()),featureIndex:b,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:_e.image,lineAtlas:T,imageAtlas:ve,glyphMap:this.returnDependencies?B:null,iconMap:this.returnDependencies?V:null,glyphPositions:this.returnDependencies?_e.positions:null})}},me=Cn(I.glyphDependencies,_e=>Object.keys(_e).map(Number));Object.keys(me).length?h.send("getGlyphs",{uid:this.uid,stacks:me},(_e,ve)=>{R||(R=_e,B=ve,G())},void 0,!1,K):B={};const ae=Object.keys(I.iconDependencies);ae.length?h.send("getImages",{icons:ae,source:this.source,tileID:this.tileID,type:"icons"},(_e,ve)=>{R||(R=_e,V=ve,G())},void 0,!1,K):V={};const fe=Object.keys(I.patternDependencies);fe.length?h.send("getImages",{icons:fe,source:this.source,tileID:this.tileID,type:"patterns"},(_e,ve)=>{R||(R=_e,w=ve,G())},void 0,!1,K):w={},G()}}function Ng(s,r,a){const u=new k(r);for(const h of s)h.recalculate(u,a)}class pb{constructor(r){this.entries={},this.scheduler=r}request(r,a,u,h){const m=this.entries[r]=this.entries[r]||{callbacks:[]};if(m.result){const[v,b]=m.result;return this.scheduler?this.scheduler.add(()=>{h(v,b)},a):h(v,b),()=>{}}return m.callbacks.push(h),m.cancel||(m.cancel=u((v,b)=>{m.result=[v,b];for(const M of m.callbacks)this.scheduler?this.scheduler.add(()=>{M(v,b)},a):M(v,b);setTimeout(()=>delete this.entries[r],3e3)})),()=>{m.result||(m.callbacks=m.callbacks.filter(v=>v!==h),m.callbacks.length||(m.cancel(),delete this.entries[r]))}}}function zg(s,r,a){const u=JSON.stringify(s.request);return s.data&&(this.deduped.entries[u]={result:[null,s.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},h=>{const m=kl(s.request,(v,b,M,T)=>{v?h(v):b&&h(null,{vectorTile:a?void 0:new rg(new kd(b)),rawData:b,cacheControl:M,expires:T})});return()=>{m.cancel(),h()}},r)}const yc=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class qd{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,u]=new Uint8Array(r,0,2);if(219!==a)throw new Error("Data does not appear to be in a KDBush format.");const h=u>>4;if(1!==h)throw new Error(`Got v${h} data when expected v1.`);const m=yc[15&u];if(!m)throw new Error("Unrecognized array type.");const[v]=new Uint16Array(r,2,1),[b]=new Uint32Array(r,4,1);return new qd(b,v,m,r)}constructor(r,a=64,u=Float64Array,h){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=u,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const m=yc.indexOf(this.ArrayType),v=2*r*this.ArrayType.BYTES_PER_ELEMENT,b=r*this.IndexArrayType.BYTES_PER_ELEMENT,M=(8-b%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${u}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+b+M,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+v+b+M),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+b+M,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=r)}add(r,a){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=r,this.coords[this._pos++]=a,u}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return Bg(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,a,u,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:v,nodeSize:b}=this,M=[0,m.length-1,0],T=[];for(;M.length;){const I=M.pop()||0,O=M.pop()||0,R=M.pop()||0;if(O-R<=b){for(let K=R;K<=O;K++){const G=v[2*K],me=v[2*K+1];G>=r&&G<=u&&me>=a&&me<=h&&T.push(m[K])}continue}const B=R+O>>1,V=v[2*B],w=v[2*B+1];V>=r&&V<=u&&w>=a&&w<=h&&T.push(m[B]),(0===I?r<=V:a<=w)&&(M.push(R),M.push(B-1),M.push(1-I)),(0===I?u>=V:h>=w)&&(M.push(B+1),M.push(O),M.push(1-I))}return T}within(r,a,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:m,nodeSize:v}=this,b=[0,h.length-1,0],M=[],T=u*u;for(;b.length;){const I=b.pop()||0,O=b.pop()||0,R=b.pop()||0;if(O-R<=v){for(let K=R;K<=O;K++)N0(m[2*K],m[2*K+1],r,a)<=T&&M.push(h[K]);continue}const B=R+O>>1,V=m[2*B],w=m[2*B+1];N0(V,w,r,a)<=T&&M.push(h[B]),(0===I?r-u<=V:a-u<=w)&&(b.push(R),b.push(B-1),b.push(1-I)),(0===I?r+u>=V:a+u>=w)&&(b.push(B+1),b.push(O),b.push(1-I))}return M}}function Bg(s,r,a,u,h,m){if(h-u<=a)return;const v=u+h>>1;W_(s,r,v,u,h,m),Bg(s,r,a,u,v-1,1-m),Bg(s,r,a,v+1,h,1-m)}function W_(s,r,a,u,h,m){for(;h>u;){if(h-u>600){const T=h-u+1,I=a-u+1,O=Math.log(T),R=.5*Math.exp(2*O/3),B=.5*Math.sqrt(O*R*(T-R)/T)*(I-T/2<0?-1:1);W_(s,r,a,Math.max(u,Math.floor(a-I*R/T+B)),Math.min(h,Math.floor(a+(T-I)*R/T+B)),m)}const v=r[2*a+m];let b=u,M=h;for(wp(s,r,u,a),r[2*h+m]>v&&wp(s,r,u,h);b<M;){for(wp(s,r,b,M),b++,M--;r[2*b+m]<v;)b++;for(;r[2*M+m]>v;)M--}r[2*u+m]===v?wp(s,r,u,M):(M++,wp(s,r,M,h)),M<=a&&(u=M+1),a<=M&&(h=M-1)}}function wp(s,r,a,u){X_(s,a,u),X_(r,2*a,2*u),X_(r,2*a+1,2*u+1)}function X_(s,r,a){const u=s[r];s[r]=s[a],s[a]=u}function N0(s,r,a,u){const h=s-a,m=r-u;return h*h+m*m}p.ARRAY_TYPE=gi,p.AUTH_ERR_MSG=xe,p.Aabb=$r,p.Actor=class{constructor(s,r,a){this.target=s,this.parent=r,this.mapId=a,this.callbacks={},this.cancelCallbacks={},ri(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=zs()?s:Je,this.scheduler=new Pg}send(s,r,a,u,h=!1,m){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=m,this.callbacks[v]=a);const b=Lc(this.globalScope)?void 0:[];return this.target.postMessage({id:v,type:s,hasCallback:!!a,targetMapId:u,mustQueue:h,sourceMapId:this.mapId,data:tu(r,b)},b),{cancel:()=>{a&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(s){const r=s.data,a=r.id;if(a&&(!r.targetMapId||this.mapId===r.targetMapId))if("<cancel>"===r.type){const u=this.cancelCallbacks[a];delete this.cancelCallbacks[a],u&&u.cancel()}else if(r.mustQueue||zs()){const u=this.callbacks[a];this.cancelCallbacks[a]=this.scheduler.add(()=>this.processTask(a,r),u&&u.metadata||{type:"message"})}else this.processTask(a,r)}processTask(s,r){if("<response>"===r.type){const a=this.callbacks[s];delete this.callbacks[s],a&&(r.error?a(Ql(r.error)):a(null,Ql(r.data)))}else{const a=Lc(this.globalScope)?void 0:[],u=r.hasCallback?(m,v)=>{delete this.cancelCallbacks[s],this.target.postMessage({id:s,type:"<response>",sourceMapId:this.mapId,error:m?tu(m):null,data:tu(v,a)},a)}:m=>{},h=Ql(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,h,u);else if(this.parent.getWorkerSource){const m=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,m[0],h.source)[m[1]](h,u)}else u(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},p.CanonicalTileID=cg,p.Color=Oi,p.ColorMode=Qs,p.CullFaceMode=ea,p.DEMData=yp,p.DataConstantProperty=$,p.DedupedRequest=pb,p.DepthMode=$d,p.EXTENT=Bt,p.Elevation=class{isDataAvailableAtPoint(s){const r=this._source();if(this.isUsingMockSource()||!r||s.y<0||s.y>1)return!1;const a=r.getSource().maxzoom,u=1<<a,h=Math.floor(s.x),m=Math.floor((s.x-h)*u),v=Math.floor(s.y*u),b=this.findDEMTileFor(new br(a,h,a,m,v));return!(!b||!b.dem)}getAtPointOrZero(s,r=0){return this.getAtPoint(s,r)||0}getAtPoint(s,r,a=!0){if(this.isUsingMockSource())return null;null==r&&(r=null);const u=this._source();if(!u||s.y<0||s.y>1)return r;const h=u.getSource().maxzoom,m=1<<h,v=Math.floor(s.x),b=s.x-v,M=new br(h,v,h,Math.floor(b*m),Math.floor(s.y*m)),T=this.findDEMTileFor(M);if(!T||!T.dem)return r;const I=T.dem,O=1<<T.tileID.canonical.z,R=(b*O-T.tileID.canonical.x)*I.dim,B=(s.y*O-T.tileID.canonical.y)*I.dim,V=Math.floor(R),w=Math.floor(B);return(a?this.exaggeration():1)*wn(wn(I.get(V,w),I.get(V,w+1),B-w),wn(I.get(V+1,w),I.get(V+1,w+1),B-w),R-V)}getAtTileOffset(s,r,a){const u=1<<s.canonical.z;return this.getAtPointOrZero(new Rr(s.wrap+(s.canonical.x+r/Bt)/u,(s.canonical.y+a/Bt)/u))}getAtTileOffsetFunc(s,r,a,u){return h=>{const m=this.getAtTileOffset(s,h.x,h.y),v=u.upVector(s.canonical,h.x,h.y);return ws(v,v,m*u.upVectorScale(s.canonical,r,a).metersToTile),v}}getForTilePoints(s,r,a,u){if(this.isUsingMockSource())return!1;const h=vl.create(this,s,u);return!!h&&(r.forEach(m=>{m[2]=this.exaggeration()*h.getElevationAt(m[0],m[1],a)}),!0)}getMinMaxForTile(s){if(this.isUsingMockSource())return null;const r=this.findDEMTileFor(s);if(!r||!r.dem)return null;const a=r.dem.tree,u=r.tileID,h=1<<s.canonical.z-u.canonical.z;let m=s.canonical.x/h-u.canonical.x,v=s.canonical.y/h-u.canonical.y,b=0;for(let M=0;M<s.canonical.z-u.canonical.z&&!a.leaves[b];M++){m*=2,v*=2;const T=2*Math.floor(v)+Math.floor(m);b=a.childOffsets[b]+T,m%=1,v%=1}return{min:this.exaggeration()*a.minimums[b],max:this.exaggeration()*a.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,r,a){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},p.ErrorEvent=Vs,p.EvaluationParameters=k,p.Event=jo,p.Evented=Ll,p.FillExtrusionBucket=rp,p.Frustum=kf,p.FrustumCorners=Xm,p.GLOBE_RADIUS=Ca,p.GLOBE_SCALE_MATCH_LATITUDE=45,p.GLOBE_ZOOM_THRESHOLD_MAX=Ym,p.GLOBE_ZOOM_THRESHOLD_MIN=Of,p.GlobeSharedBuffers=class{constructor(s){this._createGrid(s),this._createPoles(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();for(const s of this._gridSegments)s.withSkirts.destroy(),s.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const s of this._wireframeSegments)s.destroy()}}_fillGridMeshWithLods(s,r){const a=new ot,u=new Pt,h=[],m=s+1+2,v=r[0]+1,b=r[0]+1+(1+r.length),M=(T,I,O)=>{let R=T===m-1?T-2:0===T?T:T-1;return R+=O?24575:0,[R,I]};for(let T=0;T<m;++T)a.emplaceBack(...M(T,0,!0));for(let T=0;T<v;++T)for(let I=0;I<m;++I)a.emplaceBack(...M(I,T,(0===I||I===m-1)&&!0));for(let T=0;T<r.length;++T){const I=r[T];for(let O=0;O<m;++O)a.emplaceBack(...M(O,I,!0))}for(let T=0;T<r.length;++T){const I=u.length,O=r[T]+1+2,R=new Pt;for(let w=0;w<O-1;w++){const K=w===O-2,G=K?m*(b-r.length+T-w):m;for(let me=0;me<m-1;me++){const ae=w*m+me;0===w||K||0===me||me===m-2?(R.emplaceBack(ae+1,ae,ae+G),R.emplaceBack(ae+G,ae+G+1,ae+1)):(u.emplaceBack(ae+1,ae,ae+G),u.emplaceBack(ae+G,ae+G+1,ae+1))}}const B=Fi.simpleSegment(0,I,a.length,u.length-I);for(let w=0;w<R.uint16.length;w+=3)u.emplaceBack(R.uint16[w],R.uint16[w+1],R.uint16[w+2]);const V=Fi.simpleSegment(0,I,a.length,u.length-I);h.push({withoutSkirts:B,withSkirts:V})}return{vertices:a,indices:u,segments:h}}_createGrid(s){const r=this._fillGridMeshWithLods(64,Gh);this._gridSegments=r.segments,this._gridBuffer=s.createVertexBuffer(r.vertices,ac.members),this._gridIndexBuffer=s.createIndexBuffer(r.indices,!0)}_createPoles(s){const r=new Pt;for(let h=0;h<=64;h++)r.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=s.createIndexBuffer(r,!0);const a=new Gn,u=new Gn;this._poleSegments=[];for(let h=0,m=0;h<Of;h++){const v=360/(1<<h);a.emplaceBack(0,-Ca,0,.5,0),u.emplaceBack(0,-Ca,0,.5,1);for(let b=0;b<=64;b++){const M=b/64,T=wn(0,v,M),[I,O,R]=pu(bx,wx,T,Ca);a.emplaceBack(I,O,R,M,0),u.emplaceBack(I,O,R,M,1)}this._poleSegments.push(Fi.simpleSegment(m,0,66,64)),m+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(a,Pf,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(u,Pf,!1)}getGridBuffers(s,r){return[this._gridBuffer,this._gridIndexBuffer,r?this._gridSegments[s].withSkirts:this._gridSegments[s].withoutSkirts]}getPoleBuffers(s){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}getWirefameBuffers(s,r){if(!this._wireframeSegments){const a=new dr,u=64,h=u+1+2,m=1;this._wireframeSegments=[];for(let v=0,b=0;v<Gh.length;v++){const M=Gh[v];for(let I=m;I<M+m;I++)for(let O=m;O<u+m;O++){const R=I*h+O;a.emplaceBack(R,R+1),a.emplaceBack(R,R+h),a.emplaceBack(R,R+h+1)}const T=M*u*3;this._wireframeSegments.push(Fi.simpleSegment(0,b,(M+1)*h,T)),b+=T}this._wireframeIndexBuffer=s.createIndexBuffer(a)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[r]]}},p.GlyphManager=dc,p.ImagePosition=u0,p.KDBush=qd,p.LivePerformanceUtils=Dm,p.LngLat=qn,p.LngLatBounds=rc,p.LocalGlyphMode=xg,p.MAX_MERCATOR_LATITUDE=Lr,p.MercatorCoordinate=Rr,p.ONE_EM=zi,p.OverscaledTileID=br,p.PerformanceMarkers=Ol,p.Point=_t,p.Properties=de,p.RGBAImage=ko,p.Ray=Hh,p.RequestManager=class{constructor(s,r,a){this._transformRequestFn=s,this._customAccessToken=r,this._silenceAuthErrors=!!a,this._createSkuToken()}_createSkuToken(){const s=function(){let r="";for(let a=0;a<10;a++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Sl,r].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,r){return this._transformRequestFn&&this._transformRequestFn(s,r)||{url:s}}normalizeStyleURL(s,r){if(!Te(s))return s;const a=gt(s);return a.path=`/styles/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||r)}normalizeGlyphsURL(s,r){if(!Te(s))return s;const a=gt(s);return a.path=`/fonts/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||r)}normalizeSourceURL(s,r,a,u){if(!Te(s))return s;const h=gt(s);return h.path=`/v4/${h.authority}.json`,h.params.push("secure"),a&&h.params.push(`language=${a}`),u&&h.params.push(`worldview=${u}`),this._makeAPIURL(h,this._customAccessToken||r)}normalizeSpriteURL(s,r,a,u){const h=gt(s);return Te(s)?(h.path=`/styles/v1${h.path}/sprite${r}${a}`,this._makeAPIURL(h,this._customAccessToken||u)):(h.path+=`${r}${a}`,at(h))}normalizeTileURL(s,r,a){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!Te(s))return s;const u=gt(s);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||a&&"raster"!==u.authority&&512===a?"@2x":""}${on.supported?".webp":"$1"}`),"raster"===u.authority?u.path=`/${an.RASTER_URL_PREFIX}${u.path}`:(u.path=u.path.replace(/^.+\/v4\//,"/"),u.path=`/${an.TILE_URL_VERSION}${u.path}`);const h=this._customAccessToken||function(m){for(const v of m){const b=v.match(/^access_token=(.*)$/);if(b)return b[1]}return null}(u.params)||an.ACCESS_TOKEN;return an.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&u.params.push(`sku=${this._skuToken}`),this._makeAPIURL(u,h)}canonicalizeTileURL(s,r){const a=gt(s);if(!a.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!a.path.match(/\.[\w]+$/))return s;let u="mapbox://";a.path.match(/^\/raster\/v1\//)?u+=`raster/${a.path.replace(`/${an.RASTER_URL_PREFIX}/`,"")}`:u+=`tiles/${a.path.replace(`/${an.TILE_URL_VERSION}/`,"")}`;let h=a.params;return r&&(h=h.filter(m=>!m.match(/^access_token=/))),h.length&&(u+=`?${h.join("&")}`),u}canonicalizeTileset(s,r){const a=!!r&&Te(r),u=[];for(const h of s.tiles||[])Pe(h)?u.push(this.canonicalizeTileURL(h,a)):u.push(h);return u}_makeAPIURL(s,r){const a="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",u=gt(an.API_URL);if(s.protocol=u.protocol,s.authority=u.authority,"http"===s.protocol){const h=s.params.indexOf("secure");h>=0&&s.params.splice(h,1)}if("/"!==u.path&&(s.path=`${u.path}${s.path}`),!an.REQUIRE_ACCESS_TOKEN)return at(s);if(r=r||an.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${a}`);if("s"===r[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${a}`)}return s.params=s.params.filter(h=>-1===h.indexOf("access_token")),s.params.push(`access_token=${r||""}`),at(s)}},p.ResourceType=Xr,p.SegmentVector=Fi,p.SourceCache=Hd,p.StencilMode=Lg,p.StructArrayLayout1ui2=So,p.StructArrayLayout2f1f2i16=At,p.StructArrayLayout2i4=ot,p.StructArrayLayout2ui4=dr,p.StructArrayLayout3f12=un,p.StructArrayLayout3ui6=Pt,p.StructArrayLayout4i8=Ze,p.StructArrayLayout5f20=Gn,p.Texture=Ud,p.Tile=Ss,p.Transitionable=j,p.Uniform1f=fd,p.Uniform1i=class extends qs{constructor(s){super(s),this.current=0}set(s,r,a){this.fetchUniformLocation(s,r)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},p.Uniform2f=class extends qs{constructor(s){super(s),this.current=[0,0]}set(s,r,a){this.fetchUniformLocation(s,r)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}},p.Uniform3f=class extends qs{constructor(s){super(s),this.current=[0,0,0]}set(s,r,a){this.fetchUniformLocation(s,r)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}},p.Uniform4f=p1,p.UniformColor=px,p.UniformMatrix2f=class extends qs{constructor(s){super(s),this.current=ol}set(s,r,a){if(this.fetchUniformLocation(s,r))for(let u=0;u<4;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}},p.UniformMatrix3f=class extends qs{constructor(s){super(s),this.current=lo}set(s,r,a){if(this.fetchUniformLocation(s,r))for(let u=0;u<9;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}},p.UniformMatrix4f=class extends qs{constructor(s){super(s),this.current=f1}set(s,r,a){if(this.fetchUniformLocation(s,r)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let u=1;u<16;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}},p.UnwrappedTileID=Vx,p.ValidationError=wt,p.VectorTileFeature=Td,p.VectorTileWorkerSource=class extends Ll{constructor(s,r,a,u,h){super(),this.actor=s,this.layerIndex=r,this.availableImages=a,this.loadVectorData=h||zg,this.loading={},this.loaded={},this.deduped=new pb(s.scheduler),this.isSpriteLoaded=u,this.scheduler=s.scheduler}loadTile(s,r){const a=s.uid,u=s&&s.request,h=u&&u.collectResourceTiming,m=this.loading[a]=new bp(s);m.abort=this.loadVectorData(s,(v,b)=>{const M=!this.loading[a];if(delete this.loading[a],M||v||!b)return m.status="done",M||(this.loaded[a]=m),r(v);const T=b.rawData,I={};b.expires&&(I.expires=b.expires),b.cacheControl&&(I.cacheControl=b.cacheControl),m.vectorTile=b.vectorTile||new rg(new kd(T));const O=()=>{m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,(R,B)=>{if(R||!B)return r(R);const V={};if(h){const w=Ji(u);w.length>0&&(V.resourceTiming=JSON.parse(JSON.stringify(w)))}r(null,$i({rawTileData:T.slice(0)},B,I,V))})};this.isSpriteLoaded?O():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(O,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom}):O()}),this.loaded=this.loaded||{},this.loaded[a]=m})}reloadTile(s,r){const a=this.loaded,u=s.uid,h=this;if(a&&a[u]){const m=a[u];m.showCollisionBoxes=s.showCollisionBoxes,m.enableTerrain=!!s.enableTerrain,m.projection=s.projection,m.tileTransform=Eu(s.tileID.canonical,s.projection);const v=(b,M)=>{const T=m.reloadCallback;T&&(delete m.reloadCallback,m.parse(m.vectorTile,h.layerIndex,this.availableImages,h.actor,T)),r(b,M)};"parsing"===m.status?m.reloadCallback=v:"done"===m.status&&(m.vectorTile?m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,v):v())}}abortTile(s,r){const a=s.uid,u=this.loading[a];u&&(u.abort&&u.abort(),delete this.loading[a]),r()}removeTile(s,r){const a=this.loaded,u=s.uid;a&&a[u]&&delete a[u],r()}},p.WritingMode=po,p.ZoomDependentExpression=Dt,p.add=wa,p.addDynamicAttributes=Vd,p.adjoint=function(s,r){var a=r[0],u=r[1],h=r[2],m=r[3],v=r[4],b=r[5],M=r[6],T=r[7],I=r[8];return s[0]=v*I-b*T,s[1]=h*T-u*I,s[2]=u*b-h*v,s[3]=b*M-m*I,s[4]=a*I-h*M,s[5]=h*m-a*b,s[6]=m*T-v*M,s[7]=u*M-a*T,s[8]=a*v-u*m,s},p.asyncAll=sr,p.bezier=Na,p.bindAll=ri,p.boundsAttributes=I0,p.bufferConvexPolygon=function(s,r){const a=[];for(let u=0;u<s.length;u++){const h=xn(u-1,-1,s.length-1),m=xn(u+1,-1,s.length-1),v=s[u],b=s[m],M=s[h].sub(v).unit(),T=b.sub(v).unit(),I=T.angleWithSep(M.x,M.y),O=M.add(T).unit().mult(-1*r/Math.sin(I/2));a.push(v.add(O))}return a},p.cacheEntryPossiblyAdded=function(s){Rc++,Rc>Il&&(s.getActor().send("enforceCacheSizeLimit",qu),Rc=0)},p.calculateGlobeLabelMatrix=function(s,r){const{x:a,y:u}=s.point,h=yx(a,u,s.worldSize/s._pixelsPerMercatorPixel,0,0);return eo(h,h,b1(Ms(r)))},p.calculateGlobeMatrix=function(s){const{x:r,y:a}=s.point,{lng:u,lat:h}=s._center;return yx(r,a,s.worldSize,u,h)},p.calculateGlobeMercatorMatrix=function(s){const r=s.pixelsPerMeter,a=r/Po(1,s.center.lat),u=xt(new Float64Array(16));return Bh(u,u,[s.point.x,s.point.y,0]),sc(u,u,[a,a,r]),Float32Array.from(u)},p.circumferenceAtLatitude=Ao,p.clamp=yn,p.clearTileCache=function(s){if(!Al())return;const r=Je.caches.delete(Ba);s&&r.catch(s).then(()=>s())},p.clipLine=Jx,p.clone=function(s){var r=new gi(16);return r[0]=s[0],r[1]=s[1],r[2]=s[2],r[3]=s[3],r[4]=s[4],r[5]=s[5],r[6]=s[6],r[7]=s[7],r[8]=s[8],r[9]=s[9],r[10]=s[10],r[11]=s[11],r[12]=s[12],r[13]=s[13],r[14]=s[14],r[15]=s[15],r},p.clone$1=Br,p.collisionCircleLayout=y_,p.config=an,p.conjugate=function(s,r){return s[0]=-r[0],s[1]=-r[1],s[2]=-r[2],s[3]=r[3],s},p.create=function(){var s=new gi(16);return gi!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},p.create$1=oc,p.createExpression=Wl,p.createLayout=Ee,p.createStyleLayer=function(s){return"custom"===s.type?new sb(s):new ab[s.type](s)},p.cross=Gm,p.degToRad=fn,p.distance=function(s,r){return Math.hypot(r[0]-s[0],r[1]-s[1],r[2]-s[2])},p.div=function(s,r,a){return s[0]=r[0]/a[0],s[1]=r[1]/a[1],s[2]=r[2]/a[2],s},p.dot=Cs,p.earthRadius=qi,p.ease=Uo,p.easeCubicInOut=ju,p.ecefToLatLng=function([s,r,a]){const u=Math.hypot(s,r,a),h=Math.atan2(s,a),m=.5*Math.PI-Math.acos(-r/u);return new qn(gr(h),gr(m))},p.emitValidationErrors=mf,p.endsWith=ei,p.enforceCacheSizeLimit=function(s){Va(),xo&&xo.then(r=>{r.keys().then(a=>{for(let u=0;u<a.length-s;u++)r.delete(a[u])})})},p.evaluateSizeForFeature=b_,p.evaluateSizeForZoom=Id,p.evaluateVariableOffset=b0,p.evented=x,p.exactEquals=function(s,r){return s[0]===r[0]&&s[1]===r[1]&&s[2]===r[2]&&s[3]===r[3]},p.exactEquals$1=function(s,r){return s[0]===r[0]&&s[1]===r[1]&&s[2]===r[2]},p.exported=ms,p.exported$1=on,p.extend=$i,p.extend$1=Us,p.fillExtrusionHeightLift=lg,p.filterObject=En,p.fromMat4=function(s,r){return s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[4],s[4]=r[5],s[5]=r[6],s[6]=r[8],s[7]=r[9],s[8]=r[10],s},p.fromQuat=function(s,r){var a=r[0],u=r[1],h=r[2],m=r[3],v=a+a,b=u+u,M=h+h,T=a*v,I=u*v,O=u*b,R=h*v,B=h*b,V=h*M,w=m*v,K=m*b,G=m*M;return s[0]=1-O-V,s[1]=I+G,s[2]=R-K,s[3]=0,s[4]=I-G,s[5]=1-T-V,s[6]=B+w,s[7]=0,s[8]=R+K,s[9]=B-w,s[10]=1-T-O,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},p.fromRotation=function(s,r){var a=Math.sin(r),u=Math.cos(r);return s[0]=u,s[1]=a,s[2]=0,s[3]=-a,s[4]=u,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},p.fromScaling=ll,p.furthestTileCorner=function(s){const r=Math.round((s+45+360)%360/90)%4;return Pc[r]},p.getAABBPointSquareDist=function(s,r,a){let u=0;for(let h=0;h<2;++h){const m=a?a[h]:0;s[h]>m&&(u+=(s[h]-m)*(s[h]-m)),r[h]<m&&(u+=(m-r[h])*(m-r[h]))}return u},p.getAnchorAlignment=P_,p.getAnchorJustification=Rd,p.getBounds=function(s){let r=1/0,a=1/0,u=-1/0,h=-1/0;for(const m of s)r=Math.min(r,m.x),a=Math.min(a,m.y),u=Math.max(u,m.x),h=Math.max(h,m.y);return{min:new _t(r,a),max:new _t(u,h)}},p.getColumn=la,p.getDefaultExportFromCjs=io,p.getGridMatrix=function(s,r,a,u){const h=r.getNorth(),m=r.getSouth(),v=r.getWest(),b=r.getEast(),M=1<<s.z,T=b-v,I=h-m,O=T/64,R=-I/Gh[a],B=[0,O,0,R,0,0,h,v,0];if(s.z>0){const V=180/u;Ni(B,B,[V/T+1,0,0,0,V/I+1,0,-.5*V/O,.5*V/R,1])}return B[2]=M,B[5]=s.x,B[8]=s.y,B},p.getImage=he,p.getJSON=function(s,r){return ca($i(s,{type:"json"}),r)},p.getLatitudinalLod=function(s){const r=Lr-5;s=yn(s,-r,r)/r*90;const a=Math.pow(Math.abs(Math.sin(fn(s))),3);return Math.round(a*(Gh.length-1))},p.getMapSessionAPI=mr,p.getPerformanceMeasurement=Ji,p.getProjection=Bd,p.getRTLTextPluginStatus=C,p.getReferrer=Ua,p.getTilePoint=function(s,{x:r,y:a},u=0){return new _t(((r-u)*s.scale-s.x)*Bt,(a*s.scale-s.y)*Bt)},p.getTileVec3=function(s,r,a=0){return au(((r.x-a)*s.scale-s.x)*Bt,(r.y*s.scale-s.y)*Bt,Cx(r.z,r.y))},p.getVideo=function(s,r){const a=Je.document.createElement("video");a.muted=!0,a.onloadstart=function(){r(null,a)};for(let u=0;u<s.length;u++){const h=Je.document.createElement("source");Zu(s[u])||(a.crossOrigin="Anonymous"),h.src=s[u],a.appendChild(h)}return{cancel:()=>{}}},p.globeCenterToScreenPoint=function(s){const r=[0,0,0],a=xt(new Float64Array(16));return eo(a,s.pixelMatrix,s.globeMatrix),Gi(r,r,a),new _t(r[0],r[1])},p.globeDenormalizeECEF=b1,p.globeECEFOrigin=function(s,r){const a=[0,0,0];return Gi(a,a,Ff(Ms(r.canonical))),Gi(a,a,s),a},p.globeMetersToEcef=Rf,p.globeNormalizeECEF=Ff,p.globePixelsToTileUnits=function(s,r){return Bt/(512*Math.pow(2,s))*Jm(Ms(r))},p.globePoleMatrixForTile=function(s,r,a){const u=xt(new Float64Array(16)),h=(r/(1<<s)-.5)*Math.PI*2;return ou(u,a.globeMatrix,h),Float32Array.from(u)},p.globeTileBounds=Ms,p.globeTiltAtLngLat=xx,p.globeToMercatorTransition=Zh,p.globeUseCustomAntiAliasing=function(s,r,a){const u=Zh(a.zoom),h=s.style.map._antialias,m=!!r.extStandardDerivatives,v=r.extStandardDerivativesForceOff||s.terrain&&s.terrain.exaggeration()>0;return 0===u&&!h&&!v&&m},p.identity=xt,p.identity$1=Zm,p.invert=$m,p.isFullscreen=function(){return!!Je.document.fullscreenElement||!!Je.document.webkitFullscreenElement},p.isLngLatBehindGlobe=w1,p.isMapAuthenticated=function(s){return Sr.has(s)},p.isMapboxURL=Te,p.isSafariWithAntialiasingBug=function(s){const r=s.navigator?s.navigator.userAgent:null;return!!Lc(s)&&r&&(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},p.latFromMercatorY=Or,p.latLngToECEF=cc,p.len=jh,p.length=su,p.length$1=function(s){return Math.hypot(s[0],s[1],s[2],s[3])},p.lngFromMercatorX=Hr,p.loadVectorTile=zg,p.makeRequest=ca,p.mapValue=function(s,r,a,u,h){return yn((s-r)/(a-r)*(h-u)+u,u,h)},p.mercatorScale=Mx,p.mercatorXfromLng=ho,p.mercatorYfromLat=Ws,p.mercatorZfromAltitude=Po,p.mul=Sf,p.mul$1=mx,p.multiply=eo,p.multiply$1=Ni,p.multiply$2=lu,p.nextPowerOfTwo=Ei,p.normalize=co,p.normalize$1=_x,p.normalize$2=$h,p.number=wn,p.ortho=function(s,r,a,u,h,m,v){var b=1/(r-a),M=1/(u-h),T=1/(m-v);return s[0]=-2*b,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*M,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*T,s[11]=0,s[12]=(r+a)*b,s[13]=(h+u)*M,s[14]=(v+m)*T,s[15]=1,s},p.pbf=M_,p.perspective=function(s,r,a,u,h){var m,v=1/Math.tan(r/2);return s[0]=v/a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=v,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,null!=h&&h!==1/0?(s[10]=(h+u)*(m=1/(u-h)),s[14]=2*h*u*m):(s[10]=-1,s[14]=-2*u),s},p.pick=function(s,r){const a={};for(let u=0;u<r.length;u++){const h=r[u];h in s&&(a[h]=s[h])}return a},p.plugin=S,p.pointGeometry=Fs,p.polesInViewport=function(s){const r=xt(new Float64Array(16));eo(r,s.pixelMatrix,s.globeMatrix);const a=[0,es,0],u=[0,ts,0];return Gi(a,a,r),Gi(u,u,r),[a[0]>0&&a[0]<=s.width&&a[1]>0&&a[1]<=s.height&&!w1(s,new qn(s.center.lat,90)),u[0]>0&&u[0]<=s.width&&u[1]>0&&u[1]<=s.height&&!w1(s,new qn(s.center.lat,-90))]},p.polygonContainsPoint=_u,p.polygonIntersectsBox=A1,p.polygonIntersectsPolygon=D1,p.polygonizeBounds=function(s,r,a=0,u=!0){const h=new _t(a,a),m=s.sub(h),v=r.add(h),b=[m,new _t(v.x,m.y),v,new _t(m.x,v.y)];return u&&b.push(m.clone()),b},p.posAttributes=ac,p.postMapLoadEvent=An,p.postPerformanceEvent=Ki,p.postTurnstileEvent=bn,p.potpack=c0,p.prevPowerOfTwo=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log(s)/Math.LN2))},p.radToDeg=gr,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.registerForPluginStateChange=function(s){return s({pluginStatus:g,pluginURL:l}),x.on("pluginStateChange",s),s},p.removeAuthState=function(s){Sr.delete(s)},p.renderColorRamp=Kh,p.resample=gu,p.rotateX=Df,p.rotateX$1=y1,p.rotateY=ou,p.rotateY$1=Zs,p.rotateZ=function(s,r,a){var u=Math.sin(a),h=Math.cos(a),m=r[0],v=r[1],b=r[2],M=r[3],T=r[4],I=r[5],O=r[6],R=r[7];return r!==s&&(s[8]=r[8],s[9]=r[9],s[10]=r[10],s[11]=r[11],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[0]=m*h+T*u,s[1]=v*h+I*u,s[2]=b*h+O*u,s[3]=M*h+R*u,s[4]=T*h-m*u,s[5]=I*h-v*u,s[6]=O*h-b*u,s[7]=R*h-M*u,s},p.rotateZ$1=function(s,r,a){a*=.5;var u=r[0],h=r[1],m=r[2],v=r[3],b=Math.sin(a),M=Math.cos(a);return s[0]=u*M+h*b,s[1]=h*M-u*b,s[2]=m*M+v*b,s[3]=v*M-m*b,s},p.scale=sc,p.scale$1=If,p.scale$2=ws,p.scaleAndAdd=cu,p.set=function(s,r,a,u){return s[0]=r,s[1]=a,s[2]=u,s},p.setCacheLimits=function(s,r){qu=s,Il=r},p.setColumn=function(s,r,a){s[4*r+0]=a[0],s[4*r+1]=a[1],s[4*r+2]=a[2],s[4*r+3]=a[3]},p.setRTLTextPlugin=function(s,r,a=!1){if(g===Cf||g===nu||g===dd)throw new Error("setRTLTextPlugin cannot be called multiple times.");l=ms.resolveURL(s),g=Cf,ec=r,_(),a||D()},p.smoothstep=za,p.spec=je,p.squaredLength=function(s){var r=s[0],a=s[1],u=s[2];return r*r+a*a+u*u},p.storeAuthState=function(s,r){r?Sr.add(s):Sr.delete(s)},p.sub=uo,p.subtract=Hm,p.symbolSize=w_,p.tileAABB=function(s,r,a,u,h,m,v,b,M){if("globe"===M.name)return function _d(s,r,a){const u=r/s.worldSize,h=s.globeMatrix;if(a.z<=1){const ke=Ms(a).getCorners();return hu(ke,h,u),$r.fromPoints(ke)}const m=ul(a),v=lc(m);hu(v,h,u);const b=Number.MAX_VALUE,M=[-b,-b,-b],T=[b,b,b];if(m.contains(s.center)){for(const rt of v)cl(T,T,rt),Uh(M,M,rt);M[2]=0;const ke=s.point,$e=[ke.x*u,ke.y*u,0];return cl(T,T,$e),Uh(M,M,$e),new $r(T,M)}const I=[h[12]*u,h[13]*u,h[14]*u],O=m.getCenter(),R=yn(s.center.lat,-Lr,Lr),B=yn(O.lat,-Lr,Lr),V=ho(s.center.lng),w=Ws(R);let K=V-ho(O.lng);const G=w-Ws(B);K>.5?K-=1:K<-.5&&(K+=1);let me=0;Math.abs(K)>Math.abs(G)?me=K>=0?1:3:(me=G>=0?0:2,cu(I,I,[h[4]*u,h[5]*u,h[6]*u],-Math.sin(fn(G>=0?m.getSouth():m.getNorth()))*Ca));const ae=v[me],fe=v[(me+1)%4],_e=new vx(ae,fe,I),ve=[nr(_e,0)||ae[0],nr(_e,1)||ae[1],nr(_e,2)||ae[2]],Re=Zh(s.zoom);if(Re>0){const ke=function({x:rt,y:Ne,z:Ye},Xe,nt,ct,Ue){const yt=1/(1<<Ye);let St=rt*yt,Ct=St+yt,Qt=Ne*yt,dt=Qt+yt,zt=0;const Xt=(St+Ct)/2-ct;return Xt>.5?zt=-1:Xt<-.5&&(zt=1),St=((St+zt)*Xe-(ct*=Xe))*nt+ct,Ct=((Ct+zt)*Xe-ct)*nt+ct,Qt=(Qt*Xe-(Ue*=Xe))*nt+Ue,dt=(dt*Xe-Ue)*nt+Ue,[[St,dt,0],[Ct,dt,0],[Ct,Qt,0],[St,Qt,0]]}(a,r,s._pixelsPerMercatorPixel,V,w);for(let rt=0;rt<v.length;rt++)du(v[rt],ke[rt],Re);const $e=wa([],ke[me],ke[(me+1)%4]);ws($e,$e,.5),du(ve,$e,Re)}for(const ke of v)cl(T,T,ke),Uh(M,M,ke);return T[2]=Math.min(ae[2],fe[2]),cl(T,T,ve),Uh(M,M,ve),new $r(T,M)}(s,r,new cg(a,u,h));const T=Eu({z:a,x:u,y:h},M);return new $r([(m+T.x/T.scale)*r,r*(T.y/T.scale),v],[(m+T.x2/T.scale)*r,r*(T.y2/T.scale),b])},p.tileCornersToBounds=ul,p.tileTransform=Eu,p.transformMat3=function(s,r,a){var u=r[0],h=r[1],m=r[2];return s[0]=u*a[0]+h*a[3]+m*a[6],s[1]=u*a[1]+h*a[4]+m*a[7],s[2]=u*a[2]+h*a[5]+m*a[8],s},p.transformMat4=Gi,p.transformMat4$1=md,p.transformQuat=gx,p.transitionTileAABBinECEF=Km,p.translate=Bh,p.transpose=function(s,r){if(s===r){var a=r[1],u=r[2],h=r[5];s[1]=r[3],s[2]=r[6],s[3]=a,s[5]=r[7],s[6]=u,s[7]=h}else s[0]=r[0],s[1]=r[3],s[2]=r[6],s[3]=r[1],s[4]=r[4],s[5]=r[7],s[6]=r[2],s[7]=r[5],s[8]=r[8];return s},p.triggerPluginCompletionEvent=d,p.uniqueId=ar,p.updateGlobeVertexNormal=function(s,r,a,u,h){const m=5*r+2;s.float32[m+0]=a,s.float32[m+1]=u,s.float32[m+2]=h},p.validateCustomStyleLayer=function(s){const r=[],a=s.id;return void 0===a&&r.push({message:`layers.${a}: missing required property "id"`}),void 0===s.render&&r.push({message:`layers.${a}: missing required method "render"`}),s.renderingMode&&"2d"!==s.renderingMode&&"3d"!==s.renderingMode&&r.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),r},p.validateFilter=s=>Do(cd(s)),p.validateFog=s=>Do(ya(s)),p.validateLayer=s=>Do(tl(s)),p.validateLight=s=>Do(jr(s)),p.validateSource=s=>Do(Rm(s)),p.validateStyle=gf,p.validateTerrain=s=>Do(Qc(s)),p.values=sa,p.vectorTile=tg,p.version=us,p.warnOnce=oi,p.window=Je,p.wrap=xn}),gh(0,function(p){function Je(ge){if("number"==typeof ge||"boolean"==typeof ge||"string"==typeof ge||null==ge)return JSON.stringify(ge);if(Array.isArray(ge)){let X="[";for(const he of ge)X+=`${Je(he)},`;return`${X}]`}let Z="{";for(const X of Object.keys(ge).sort())Z+=`${X}:${Je(ge[X])},`;return`${Z}}`}function us(ge){let Z="";for(const X of p.refProperties)Z+=`/${Je(ge[X])}`;return Z}class mo{constructor(Z){this.keyCache={},Z&&this.replace(Z)}replace(Z){this._layerConfigs={},this._layers={},this.update(Z,[])}update(Z,X){for(const xe of Z)this._layerConfigs[xe.id]=xe,(this._layers[xe.id]=p.createStyleLayer(xe)).compileFilter(),this.keyCache[xe.id]&&delete this.keyCache[xe.id];for(const xe of X)delete this.keyCache[xe],delete this._layerConfigs[xe],delete this._layers[xe];this.familiesBySource={};const he=function(xe,Te){const Pe={};for(let De=0;De<xe.length;De++){const ze=Te&&Te[xe[De].id]||us(xe[De]);Te&&(Te[xe[De].id]=ze);let ht=Pe[ze];ht||(ht=Pe[ze]=[]),ht.push(xe[De])}const Ae=[];for(const De in Pe)Ae.push(Pe[De]);return Ae}(p.values(this._layerConfigs),this.keyCache);for(const xe of he){const Te=xe.map(gt=>this._layers[gt.id]),Pe=Te[0];if("none"===Pe.visibility)continue;const Ae=Pe.source||"";let De=this.familiesBySource[Ae];De||(De=this.familiesBySource[Ae]={});const ze=Pe.sourceLayer||"_geojsonTileLayer";let ht=De[ze];ht||(ht=De[ze]=[]),ht.push(Te)}}}class an{loadTile(Z,X){const{uid:he,encoding:xe,rawImageData:Te,padding:Pe,buildQuadTree:Ae}=Z,De=p.window.ImageBitmap&&Te instanceof p.window.ImageBitmap?this.getImageData(Te,Pe):Te;X(null,new p.DEMData(he,De,xe,Pe<1,Ae))}getImageData(Z,X){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Z.width,Z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Z.width,this.offscreenCanvas.height=Z.height,this.offscreenCanvasContext.drawImage(Z,0,0,Z.width,Z.height);const he=this.offscreenCanvasContext.getImageData(-X,-X,Z.width+2*X,Z.height+2*X);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),he}}function on(ge,Z){if(0!==ge.length){or(ge[0],Z);for(var X=1;X<ge.length;X++)or(ge[X],!Z)}}function or(ge,Z){for(var X=0,he=0,xe=0,Te=ge.length,Pe=Te-1;xe<Te;Pe=xe++){var Ae=(ge[xe][0]-ge[Pe][0])*(ge[Pe][1]+ge[xe][1]),De=X+Ae;he+=Math.abs(X)>=Math.abs(Ae)?X-De+Ae:Ae-De+X,X=De}X+he>=0!=!!Z&&ge.reverse()}var zr=p.getDefaultExportFromCjs(function ge(Z,X){var he,xe=Z&&Z.type;if("FeatureCollection"===xe)for(he=0;he<Z.features.length;he++)ge(Z.features[he],X);else if("GeometryCollection"===xe)for(he=0;he<Z.geometries.length;he++)ge(Z.geometries[he],X);else if("Feature"===xe)ge(Z.geometry,X);else if("Polygon"===xe)on(Z.coordinates,X);else if("MultiPolygon"===xe)for(he=0;he<Z.coordinates.length;he++)on(Z.coordinates[he],X);return Z});const Bo=p.VectorTileFeature.prototype.toGeoJSON;var Rs={exports:{}},Ac=p.pointGeometry,Sl=p.vectorTile.VectorTileFeature,io=_o;function _o(ge,Z){this.options=Z||{},this.features=ge,this.length=ge.length}function Wr(ge,Z){this.id="number"==typeof ge.id?ge.id:void 0,this.type=ge.type,this.rawGeometry=1===ge.type?[ge.geometry]:ge.geometry,this.properties=ge.tags,this.extent=Z||4096}_o.prototype.feature=function(ge){return new Wr(this.features[ge],this.options.extent)},Wr.prototype.loadGeometry=function(){var ge=this.rawGeometry;this.geometry=[];for(var Z=0;Z<ge.length;Z++){for(var X=ge[Z],he=[],xe=0;xe<X.length;xe++)he.push(new Ac(X[xe][0],X[xe][1]));this.geometry.push(he)}return this.geometry},Wr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ge=this.geometry,Z=1/0,X=-1/0,he=1/0,xe=-1/0,Te=0;Te<ge.length;Te++)for(var Pe=ge[Te],Ae=0;Ae<Pe.length;Ae++){var De=Pe[Ae];Z=Math.min(Z,De.x),X=Math.max(X,De.x),he=Math.min(he,De.y),xe=Math.max(xe,De.y)}return[Z,he,X,xe]},Wr.prototype.toGeoJSON=Sl.prototype.toGeoJSON;var Ra=p.pbf,Fs=io;function Vo(ge){var Z=new Ra;return function(X,he){for(var xe in X.layers)he.writeMessage(3,_t,X.layers[xe])}(ge,Z),Z.finish()}function _t(ge,Z){var X;Z.writeVarintField(15,ge.version||1),Z.writeStringField(1,ge.name||""),Z.writeVarintField(5,ge.extent||4096);var he={keys:[],values:[],keycache:{},valuecache:{}};for(X=0;X<ge.length;X++)he.feature=ge.feature(X),Z.writeMessage(2,mh,he);var xe=he.keys;for(X=0;X<xe.length;X++)Z.writeStringField(3,xe[X]);var Te=he.values;for(X=0;X<Te.length;X++)Z.writeMessage(4,ju,Te[X])}function mh(ge,Z){var X=ge.feature;void 0!==X.id&&Z.writeVarintField(1,X.id),Z.writeMessage(2,Fa,ge),Z.writeVarintField(3,X.type),Z.writeMessage(4,Pc,X)}function Fa(ge,Z){var X=ge.feature,he=ge.keys,xe=ge.values,Te=ge.keycache,Pe=ge.valuecache;for(var Ae in X.properties){var De=X.properties[Ae],ze=Te[Ae];if(null!==De){void 0===ze&&(he.push(Ae),Te[Ae]=ze=he.length-1),Z.writeVarint(ze);var ht=typeof De;"string"!==ht&&"boolean"!==ht&&"number"!==ht&&(De=JSON.stringify(De));var gt=ht+":"+De,at=Pe[gt];void 0===at&&(xe.push(De),Pe[gt]=at=xe.length-1),Z.writeVarint(at)}}}function fn(ge,Z){return(Z<<3)+(7&ge)}function gr(ge){return ge<<1^ge>>31}function Pc(ge,Z){for(var X=ge.loadGeometry(),he=ge.type,xe=0,Te=0,Pe=X.length,Ae=0;Ae<Pe;Ae++){var De=X[Ae],ze=1;1===he&&(ze=De.length),Z.writeVarint(fn(1,ze));for(var ht=3===he?De.length-1:De.length,gt=0;gt<ht;gt++){1===gt&&1!==he&&Z.writeVarint(fn(2,ht-1));var at=De[gt].x-xe,Yt=De[gt].y-Te;Z.writeVarint(gr(at)),Z.writeVarint(gr(Yt)),xe+=at,Te+=Yt}3===he&&Z.writeVarint(fn(7,1))}}function ju(ge,Z){var X=typeof ge;"string"===X?Z.writeStringField(1,ge):"boolean"===X?Z.writeBooleanField(7,ge):"number"===X&&(ge%1!=0?Z.writeDoubleField(3,ge):ge<0?Z.writeSVarintField(6,ge):Z.writeVarintField(5,ge))}Rs.exports=Vo,Rs.exports.fromVectorTileJs=Vo,Rs.exports.fromGeojsonVt=function(ge,Z){Z=Z||{};var X={};for(var he in ge)X[he]=new Fs(ge[he].features,Z),X[he].name=he,X[he].version=Z.version,X[he].extent=Z.extent;return Vo({layers:X})},Rs.exports.GeoJSONWrapper=Fs;var Na=p.getDefaultExportFromCjs(Rs.exports);const Uo={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ge=>ge},yn=Math.fround||(za=new Float32Array(1),ge=>(za[0]=+ge,za[0]));var za;const xn=3,sr=5,sa=6;class $i{constructor(Z){this.options=Object.assign(Object.create(Uo),Z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Z){const{log:X,minZoom:he,maxZoom:xe}=this.options;X&&console.time("total time");const Te=`prepare ${Z.length} points`;X&&console.time(Te),this.points=Z;const Pe=[];for(let De=0;De<Z.length;De++){const ze=Z[De];if(!ze.geometry)continue;const[ht,gt]=ze.geometry.coordinates,at=yn(Ns(ht)),Yt=yn(Ei(gt));Pe.push(at,Yt,1/0,De,-1,1),this.options.reduce&&Pe.push(0)}let Ae=this.trees[xe+1]=this._createTree(Pe);X&&console.timeEnd(Te);for(let De=xe;De>=he;De--){const ze=+Date.now();Ae=this.trees[De]=this._createTree(this._cluster(Ae,De)),X&&console.log("z%d: %d clusters in %dms",De,Ae.numItems,+Date.now()-ze)}return X&&console.timeEnd("total time"),this}getClusters(Z,X){let he=((Z[0]+180)%360+360)%360-180;const xe=Math.max(-90,Math.min(90,Z[1]));let Te=180===Z[2]?180:((Z[2]+180)%360+360)%360-180;const Pe=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)he=-180,Te=180;else if(he>Te){const gt=this.getClusters([he,xe,180,Pe],X),at=this.getClusters([-180,xe,Te,Pe],X);return gt.concat(at)}const Ae=this.trees[this._limitZoom(X)],De=Ae.range(Ns(he),Ei(Pe),Ns(Te),Ei(xe)),ze=Ae.data,ht=[];for(const gt of De){const at=this.stride*gt;ht.push(ze[at+sr]>1?aa(ze,at,this.clusterProps):this.points[ze[at+xn]])}return ht}getChildren(Z){const X=this._getOriginId(Z),he=this._getOriginZoom(Z),xe="No cluster with the specified id.",Te=this.trees[he];if(!Te)throw new Error(xe);const Pe=Te.data;if(X*this.stride>=Pe.length)throw new Error(xe);const Ae=this.options.radius/(this.options.extent*Math.pow(2,he-1)),De=Te.within(Pe[X*this.stride],Pe[X*this.stride+1],Ae),ze=[];for(const ht of De){const gt=ht*this.stride;Pe[gt+4]===Z&&ze.push(Pe[gt+sr]>1?aa(Pe,gt,this.clusterProps):this.points[Pe[gt+xn]])}if(0===ze.length)throw new Error(xe);return ze}getLeaves(Z,X,he){const xe=[];return this._appendLeaves(xe,Z,X=X||10,he=he||0,0),xe}getTile(Z,X,he){const xe=this.trees[this._limitZoom(Z)],Te=Math.pow(2,Z),{extent:Pe,radius:Ae}=this.options,De=Ae/Pe,ze=(he-De)/Te,ht=(he+1+De)/Te,gt={features:[]};return this._addTileFeatures(xe.range((X-De)/Te,ze,(X+1+De)/Te,ht),xe.data,X,he,Te,gt),0===X&&this._addTileFeatures(xe.range(1-De/Te,ze,1,ht),xe.data,Te,he,Te,gt),X===Te-1&&this._addTileFeatures(xe.range(0,ze,De/Te,ht),xe.data,-1,he,Te,gt),gt.features.length?gt:null}getClusterExpansionZoom(Z){let X=this._getOriginZoom(Z)-1;for(;X<=this.options.maxZoom;){const he=this.getChildren(Z);if(X++,1!==he.length)break;Z=he[0].properties.cluster_id}return X}_appendLeaves(Z,X,he,xe,Te){const Pe=this.getChildren(X);for(const Ae of Pe){const De=Ae.properties;if(De&&De.cluster?Te+De.point_count<=xe?Te+=De.point_count:Te=this._appendLeaves(Z,De.cluster_id,he,xe,Te):Te<xe?Te++:Z.push(Ae),Z.length===he)break}return Te}_createTree(Z){const X=new p.KDBush(Z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let he=0;he<Z.length;he+=this.stride)X.add(Z[he],Z[he+1]);return X.finish(),X.data=Z,X}_addTileFeatures(Z,X,he,xe,Te,Pe){for(const Ae of Z){const De=Ae*this.stride,ze=X[De+sr]>1;let ht,gt,at;if(ze)ht=ar(X,De,this.clusterProps),gt=X[De],at=X[De+1];else{const Kt=this.points[X[De+xn]];ht=Kt.properties;const[ln,bn]=Kt.geometry.coordinates;gt=Ns(ln),at=Ei(bn)}const Yt={type:1,geometry:[[Math.round(this.options.extent*(gt*Te-he)),Math.round(this.options.extent*(at*Te-xe))]],tags:ht};let hn;hn=ze||this.options.generateId?X[De+xn]:this.points[X[De+xn]].id,void 0!==hn&&(Yt.id=hn),Pe.features.push(Yt)}}_limitZoom(Z){return Math.max(this.options.minZoom,Math.min(Math.floor(+Z),this.options.maxZoom+1))}_cluster(Z,X){const{radius:he,extent:xe,reduce:Te,minPoints:Pe}=this.options,Ae=he/(xe*Math.pow(2,X)),De=Z.data,ze=[],ht=this.stride;for(let gt=0;gt<De.length;gt+=ht){if(De[gt+2]<=X)continue;De[gt+2]=X;const at=De[gt],Yt=De[gt+1],hn=Z.within(De[gt],De[gt+1],Ae),Kt=De[gt+sr];let ln=Kt;for(const bn of hn){const di=bn*ht;De[di+2]>X&&(ln+=De[di+sr])}if(ln>Kt&&ln>=Pe){let bn,di=at*Kt,An=Yt*Kt,Dr=-1;const Ki=((gt/ht|0)<<5)+(X+1)+this.points.length;for(const hs of hn){const mr=hs*ht;if(De[mr+2]<=X)continue;De[mr+2]=X;const Sr=De[mr+sr];di+=De[mr]*Sr,An+=De[mr+1]*Sr,De[mr+4]=Ki,Te&&(bn||(bn=this._map(De,gt,!0),Dr=this.clusterProps.length,this.clusterProps.push(bn)),Te(bn,this._map(De,mr)))}De[gt+4]=Ki,ze.push(di/ln,An/ln,1/0,Ki,-1,ln),Te&&ze.push(Dr)}else{for(let bn=0;bn<ht;bn++)ze.push(De[gt+bn]);if(ln>1)for(const bn of hn){const di=bn*ht;if(!(De[di+2]<=X)){De[di+2]=X;for(let An=0;An<ht;An++)ze.push(De[di+An])}}}}return ze}_getOriginId(Z){return Z-this.points.length>>5}_getOriginZoom(Z){return(Z-this.points.length)%32}_map(Z,X,he){if(Z[X+sr]>1){const Pe=this.clusterProps[Z[X+sa]];return he?Object.assign({},Pe):Pe}const xe=this.points[Z[X+xn]].properties,Te=this.options.map(xe);return he&&Te===xe?Object.assign({},Te):Te}}function aa(ge,Z,X){return{type:"Feature",id:ge[Z+xn],properties:ar(ge,Z,X),geometry:{type:"Point",coordinates:[(he=ge[Z],360*(he-.5)),kc(ge[Z+1])]}};var he}function ar(ge,Z,X){const he=ge[Z+sr],xe=he>=1e4?`${Math.round(he/1e3)}k`:he>=1e3?Math.round(he/100)/10+"k":he,Te=ge[Z+sa],Pe=-1===Te?{}:Object.assign({},X[Te]);return Object.assign(Pe,{cluster:!0,cluster_id:ge[Z+xn],point_count:he,point_count_abbreviated:xe})}function Ns(ge){return ge/360+.5}function Ei(ge){const Z=Math.sin(ge*Math.PI/180),X=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return X<0?0:X>1?1:X}function kc(ge){const Z=(180-360*ge)*Math.PI/180;return 360*Math.atan(Math.exp(Z))/Math.PI-90}function ri(ge,Z,X,he){for(var xe,Te=he,Pe=X-Z>>1,Ae=X-Z,De=ge[Z],ze=ge[Z+1],ht=ge[X],gt=ge[X+1],at=Z+3;at<X;at+=3){var Yt=ei(ge[at],ge[at+1],De,ze,ht,gt);if(Yt>Te)xe=at,Te=Yt;else if(Yt===Te){var hn=Math.abs(at-Pe);hn<Ae&&(xe=at,Ae=hn)}}Te>he&&(xe-Z>3&&ri(ge,Z,xe,he),ge[xe+2]=Te,X-xe>3&&ri(ge,xe,X,he))}function ei(ge,Z,X,he,xe,Te){var Pe=xe-X,Ae=Te-he;if(0!==Pe||0!==Ae){var De=((ge-X)*Pe+(Z-he)*Ae)/(Pe*Pe+Ae*Ae);De>1?(X=xe,he=Te):De>0&&(X+=Pe*De,he+=Ae*De)}return(Pe=ge-X)*Pe+(Ae=Z-he)*Ae}function Cn(ge,Z,X,he){var xe={id:void 0===ge?null:ge,type:Z,geometry:X,tags:he,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Te){var Pe=Te.geometry,Ae=Te.type;if("Point"===Ae||"MultiPoint"===Ae||"LineString"===Ae)En(Te,Pe);else if("Polygon"===Ae||"MultiLineString"===Ae)for(var De=0;De<Pe.length;De++)En(Te,Pe[De]);else if("MultiPolygon"===Ae)for(De=0;De<Pe.length;De++)for(var ze=0;ze<Pe[De].length;ze++)En(Te,Pe[De][ze])}(xe),xe}function En(ge,Z){for(var X=0;X<Z.length;X+=3)ge.minX=Math.min(ge.minX,Z[X]),ge.minY=Math.min(ge.minY,Z[X+1]),ge.maxX=Math.max(ge.maxX,Z[X]),ge.maxY=Math.max(ge.maxY,Z[X+1])}function Br(ge,Z,X,he){if(Z.geometry){var xe=Z.geometry.coordinates,Te=Z.geometry.type,Pe=Math.pow(X.tolerance/((1<<X.maxZoom)*X.extent),2),Ae=[],De=Z.id;if(X.promoteId?De=Z.properties[X.promoteId]:X.generateId&&(De=he||0),"Point"===Te)Oc(xe,Ae);else if("MultiPoint"===Te)for(var ze=0;ze<xe.length;ze++)Oc(xe[ze],Ae);else if("LineString"===Te)oi(xe,Ae,Pe,!1);else if("MultiLineString"===Te){if(X.lineMetrics){for(ze=0;ze<xe.length;ze++)oi(xe[ze],Ae=[],Pe,!1),ge.push(Cn(De,"LineString",Ae,Z.properties));return}vo(xe,Ae,Pe,!1)}else if("Polygon"===Te)vo(xe,Ae,Pe,!0);else{if("MultiPolygon"!==Te){if("GeometryCollection"===Te){for(ze=0;ze<Z.geometry.geometries.length;ze++)Br(ge,{id:De,geometry:Z.geometry.geometries[ze],properties:Z.properties},X,he);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ze=0;ze<xe.length;ze++){var ht=[];vo(xe[ze],ht,Pe,!0),Ae.push(ht)}}ge.push(Cn(De,Te,Ae,Z.properties))}}function Oc(ge,Z){Z.push($u(ge[0])),Z.push(zs(ge[1])),Z.push(0)}function oi(ge,Z,X,he){for(var xe,Te,Pe=0,Ae=0;Ae<ge.length;Ae++){var De=$u(ge[Ae][0]),ze=zs(ge[Ae][1]);Z.push(De),Z.push(ze),Z.push(0),Ae>0&&(Pe+=he?(xe*ze-De*Te)/2:Math.sqrt(Math.pow(De-xe,2)+Math.pow(ze-Te,2))),xe=De,Te=ze}var ht=Z.length-3;Z[2]=1,ri(Z,0,ht,X),Z[ht+2]=1,Z.size=Math.abs(Pe),Z.start=0,Z.end=Z.size}function vo(ge,Z,X,he){for(var xe=0;xe<ge.length;xe++){var Te=[];oi(ge[xe],Te,X,he),Z.push(Te)}}function $u(ge){return ge/360+.5}function zs(ge){var Z=Math.sin(ge*Math.PI/180),X=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return X<0?0:X>1?1:X}function yo(ge,Z,X,he,xe,Te,Pe,Ae){if(he/=Z,Te>=(X/=Z)&&Pe<he)return ge;if(Pe<X||Te>=he)return null;for(var De=[],ze=0;ze<ge.length;ze++){var ht=ge[ze],gt=ht.geometry,at=ht.type,Yt=0===xe?ht.minX:ht.minY,hn=0===xe?ht.maxX:ht.maxY;if(Yt>=X&&hn<he)De.push(ht);else if(!(hn<X||Yt>=he)){var Kt=[];if("Point"===at||"MultiPoint"===at)Hu(gt,Kt,X,he,xe);else if("LineString"===at)Lc(gt,Kt,X,he,xe,!1,Ae.lineMetrics);else if("MultiLineString"===at)la(gt,Kt,X,he,xe,!1);else if("Polygon"===at)la(gt,Kt,X,he,xe,!0);else if("MultiPolygon"===at)for(var ln=0;ln<gt.length;ln++){var bn=[];la(gt[ln],bn,X,he,xe,!0),bn.length&&Kt.push(bn)}if(Kt.length){if(Ae.lineMetrics&&"LineString"===at){for(ln=0;ln<Kt.length;ln++)De.push(Cn(ht.id,at,Kt[ln],ht.tags));continue}"LineString"!==at&&"MultiLineString"!==at||(1===Kt.length?(at="LineString",Kt=Kt[0]):at="MultiLineString"),"Point"!==at&&"MultiPoint"!==at||(at=3===Kt.length?"Point":"MultiPoint"),De.push(Cn(ht.id,at,Kt,ht.tags))}}}return De.length?De:null}function Hu(ge,Z,X,he,xe){for(var Te=0;Te<ge.length;Te+=3){var Pe=ge[Te+xe];Pe>=X&&Pe<=he&&(Z.push(ge[Te]),Z.push(ge[Te+1]),Z.push(ge[Te+2]))}}function Lc(ge,Z,X,he,xe,Te,Pe){for(var Ae,De,ze=Gu(ge),ht=0===xe?qu:Il,gt=ge.start,at=0;at<ge.length-3;at+=3){var Yt=ge[at],hn=ge[at+1],Kt=ge[at+2],ln=ge[at+3],bn=ge[at+4],di=0===xe?Yt:hn,An=0===xe?ln:bn,Dr=!1;Pe&&(Ae=Math.sqrt(Math.pow(Yt-ln,2)+Math.pow(hn-bn,2))),di<X?An>X&&(De=ht(ze,Yt,hn,ln,bn,X),Pe&&(ze.start=gt+Ae*De)):di>he?An<he&&(De=ht(ze,Yt,hn,ln,bn,he),Pe&&(ze.start=gt+Ae*De)):Ba(ze,Yt,hn,Kt),An<X&&di>=X&&(De=ht(ze,Yt,hn,ln,bn,X),Dr=!0),An>he&&di<=he&&(De=ht(ze,Yt,hn,ln,bn,he),Dr=!0),!Te&&Dr&&(Pe&&(ze.end=gt+Ae*De),Z.push(ze),ze=Gu(ge)),Pe&&(gt+=Ae)}var Ki=ge.length-3;Yt=ge[Ki],hn=ge[Ki+1],Kt=ge[Ki+2],(di=0===xe?Yt:hn)>=X&&di<=he&&Ba(ze,Yt,hn,Kt),Ki=ze.length-3,Te&&Ki>=3&&(ze[Ki]!==ze[0]||ze[Ki+1]!==ze[1])&&Ba(ze,ze[0],ze[1],ze[2]),ze.length&&Z.push(ze)}function Gu(ge){var Z=[];return Z.size=ge.size,Z.start=ge.start,Z.end=ge.end,Z}function la(ge,Z,X,he,xe,Te){for(var Pe=0;Pe<ge.length;Pe++)Lc(ge[Pe],Z,X,he,xe,Te,!1)}function Ba(ge,Z,X,he){ge.push(Z),ge.push(X),ge.push(he)}function qu(ge,Z,X,he,xe,Te){var Pe=(Te-Z)/(he-Z);return ge.push(Te),ge.push(X+(xe-X)*Pe),ge.push(1),Pe}function Il(ge,Z,X,he,xe,Te){var Pe=(Te-X)/(xe-X);return ge.push(Z+(he-Z)*Pe),ge.push(Te),ge.push(1),Pe}function xo(ge,Z){for(var X=[],he=0;he<ge.length;he++){var xe,Te=ge[he],Pe=Te.type;if("Point"===Pe||"MultiPoint"===Pe||"LineString"===Pe)xe=ds(Te.geometry,Z);else if("MultiLineString"===Pe||"Polygon"===Pe){xe=[];for(var Ae=0;Ae<Te.geometry.length;Ae++)xe.push(ds(Te.geometry[Ae],Z))}else if("MultiPolygon"===Pe)for(xe=[],Ae=0;Ae<Te.geometry.length;Ae++){for(var De=[],ze=0;ze<Te.geometry[Ae].length;ze++)De.push(ds(Te.geometry[Ae][ze],Z));xe.push(De)}X.push(Cn(Te.id,Pe,xe,Te.tags))}return X}function ds(ge,Z){var X=[];X.size=ge.size,void 0!==ge.start&&(X.start=ge.start,X.end=ge.end);for(var he=0;he<ge.length;he+=3)X.push(ge[he]+Z,ge[he+1],ge[he+2]);return X}function Al(ge,Z){if(ge.transformed)return ge;var X,he,xe,Te=1<<ge.z,Pe=ge.x,Ae=ge.y;for(X=0;X<ge.features.length;X++){var De=ge.features[X],ze=De.geometry,ht=De.type;if(De.geometry=[],1===ht)for(he=0;he<ze.length;he+=2)De.geometry.push(Va(ze[he],ze[he+1],Z,Te,Pe,Ae));else for(he=0;he<ze.length;he++){var gt=[];for(xe=0;xe<ze[he].length;xe+=2)gt.push(Va(ze[he][xe],ze[he][xe+1],Z,Te,Pe,Ae));De.geometry.push(gt)}}return ge.transformed=!0,ge}function Va(ge,Z,X,he,xe,Te){return[Math.round(X*(ge*he-xe)),Math.round(X*(Z*he-Te))]}function Pl(ge,Z,X,he,xe){for(var Te=Z===xe.maxZoom?0:xe.tolerance/((1<<Z)*xe.extent),Pe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:X,y:he,z:Z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ae=0;Ae<ge.length;Ae++){Pe.numFeatures++,Rc(Pe,ge[Ae],Te,xe);var De=ge[Ae].minX,ze=ge[Ae].minY,ht=ge[Ae].maxX,gt=ge[Ae].maxY;De<Pe.minX&&(Pe.minX=De),ze<Pe.minY&&(Pe.minY=ze),ht>Pe.maxX&&(Pe.maxX=ht),gt>Pe.maxY&&(Pe.maxY=gt)}return Pe}function Rc(ge,Z,X,he){var xe=Z.geometry,Te=Z.type,Pe=[];if("Point"===Te||"MultiPoint"===Te)for(var Ae=0;Ae<xe.length;Ae+=3)Pe.push(xe[Ae]),Pe.push(xe[Ae+1]),ge.numPoints++,ge.numSimplified++;else if("LineString"===Te)Xr(Pe,xe,ge,X,!1,!1);else if("MultiLineString"===Te||"Polygon"===Te)for(Ae=0;Ae<xe.length;Ae++)Xr(Pe,xe[Ae],ge,X,"Polygon"===Te,0===Ae);else if("MultiPolygon"===Te)for(var De=0;De<xe.length;De++){var ze=xe[De];for(Ae=0;Ae<ze.length;Ae++)Xr(Pe,ze[Ae],ge,X,!0,0===Ae)}if(Pe.length){var ht=Z.tags||null;if("LineString"===Te&&he.lineMetrics){for(var gt in ht={},Z.tags)ht[gt]=Z.tags[gt];ht.mapbox_clip_start=xe.start/xe.size,ht.mapbox_clip_end=xe.end/xe.size}var at={geometry:Pe,type:"Polygon"===Te||"MultiPolygon"===Te?3:"LineString"===Te||"MultiLineString"===Te?2:1,tags:ht};null!==Z.id&&(at.id=Z.id),ge.features.push(at)}}function Xr(ge,Z,X,he,xe,Te){var Pe=he*he;if(he>0&&Z.size<(xe?Pe:he))X.numPoints+=Z.length/3;else{for(var Ae=[],De=0;De<Z.length;De+=3)(0===he||Z[De+2]>Pe)&&(X.numSimplified++,Ae.push(Z[De]),Ae.push(Z[De+1])),X.numPoints++;xe&&function(ze,ht){for(var gt=0,at=0,Yt=ze.length,hn=Yt-2;at<Yt;hn=at,at+=2)gt+=(ze[at]-ze[hn])*(ze[at+1]+ze[hn+1]);if(gt>0===ht)for(at=0,Yt=ze.length;at<Yt/2;at+=2){var Kt=ze[at],ln=ze[at+1];ze[at]=ze[Yt-2-at],ze[at+1]=ze[Yt-1-at],ze[Yt-2-at]=Kt,ze[Yt-1-at]=ln}}(Ae,Te),ge.push(Ae)}}function Bs(ge,Z){var X=(Z=this.options=function(xe,Te){for(var Pe in Te)xe[Pe]=Te[Pe];return xe}(Object.create(this.options),Z)).debug;if(X&&console.time("preprocess data"),Z.maxZoom<0||Z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Z.promoteId&&Z.generateId)throw new Error("promoteId and generateId cannot be used together.");var xe,Te,Pe,Ae,De,ze,he=function(xe,Te){var Pe=[];if("FeatureCollection"===xe.type)for(var Ae=0;Ae<xe.features.length;Ae++)Br(Pe,xe.features[Ae],Te,Ae);else Br(Pe,"Feature"===xe.type?xe:{geometry:xe},Te);return Pe}(ge,Z);this.tiles={},this.tileCoords=[],X&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Z.indexMaxZoom,Z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ae=xe=he,De=yo(xe,1,-1-(Pe=(Te=Z).buffer/Te.extent),Pe,0,-1,2,Te),ze=yo(xe,1,1-Pe,2+Pe,0,-1,2,Te),(De||ze)&&(Ae=yo(xe,1,-Pe,1+Pe,0,-1,2,Te)||[],De&&(Ae=xo(De,1).concat(Ae)),ze&&(Ae=Ae.concat(xo(ze,-1)))),(he=Ae).length&&this.splitTile(he,0,0,0),X&&(he.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ua(ge,Z,X){return 32*((1<<ge)*X+Z)+ge}function ca(ge,Z){const X=ge.tileID.canonical;if(!this._geoJSONIndex)return Z(null,null);const he=this._geoJSONIndex.getTile(X.z,X.x,X.y);if(!he)return Z(null,null);const xe=new class{constructor(Pe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=Pe.length,this._features=Pe}feature(Pe){return new class{constructor(Ae){this._feature=Ae,this.extent=p.EXTENT,this.type=Ae.type,this.properties=Ae.tags,"id"in Ae&&!isNaN(Ae.id)&&(this.id=parseInt(Ae.id,10))}loadGeometry(){if(1===this._feature.type){const Ae=[];for(const De of this._feature.geometry)Ae.push([new p.Point(De[0],De[1])]);return Ae}{const Ae=[];for(const De of this._feature.geometry){const ze=[];for(const ht of De)ze.push(new p.Point(ht[0],ht[1]));Ae.push(ze)}return Ae}}toGeoJSON(Ae,De,ze){return Bo.call(this,Ae,De,ze)}}(this._features[Pe])}}(he.features);let Te=Na(xe);0===Te.byteOffset&&Te.byteLength===Te.buffer.byteLength||(Te=new Uint8Array(Te)),Z(null,{vectorTile:xe,rawData:Te.buffer})}Bs.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Bs.prototype.splitTile=function(ge,Z,X,he,xe,Te,Pe){for(var Ae=[ge,Z,X,he],De=this.options,ze=De.debug;Ae.length;){he=Ae.pop(),X=Ae.pop(),Z=Ae.pop(),ge=Ae.pop();var ht=1<<Z,gt=Ua(Z,X,he),at=this.tiles[gt];if(!at&&(ze>1&&console.time("creation"),at=this.tiles[gt]=Pl(ge,Z,X,he,De),this.tileCoords.push({z:Z,x:X,y:he}),ze)){ze>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Z,X,he,at.numFeatures,at.numPoints,at.numSimplified),console.timeEnd("creation"));var Yt="z"+Z;this.stats[Yt]=(this.stats[Yt]||0)+1,this.total++}if(at.source=ge,xe){if(Z===De.maxZoom||Z===xe)continue;var hn=1<<xe-Z;if(X!==Math.floor(Te/hn)||he!==Math.floor(Pe/hn))continue}else if(Z===De.indexMaxZoom||at.numPoints<=De.indexMaxPoints)continue;if(at.source=null,0!==ge.length){ze>1&&console.time("clipping");var Kt,ln,bn,di,An,Dr,Ki=.5*De.buffer/De.extent,hs=.5-Ki,mr=.5+Ki,Sr=1+Ki;Kt=ln=bn=di=null,An=yo(ge,ht,X-Ki,X+mr,0,at.minX,at.maxX,De),Dr=yo(ge,ht,X+hs,X+Sr,0,at.minX,at.maxX,De),ge=null,An&&(Kt=yo(An,ht,he-Ki,he+mr,1,at.minY,at.maxY,De),ln=yo(An,ht,he+hs,he+Sr,1,at.minY,at.maxY,De),An=null),Dr&&(bn=yo(Dr,ht,he-Ki,he+mr,1,at.minY,at.maxY,De),di=yo(Dr,ht,he+hs,he+Sr,1,at.minY,at.maxY,De),Dr=null),ze>1&&console.timeEnd("clipping"),Ae.push(Kt||[],Z+1,2*X,2*he),Ae.push(ln||[],Z+1,2*X,2*he+1),Ae.push(bn||[],Z+1,2*X+1,2*he),Ae.push(di||[],Z+1,2*X+1,2*he+1)}}},Bs.prototype.getTile=function(ge,Z,X){var he=this.options,xe=he.extent,Te=he.debug;if(ge<0||ge>24)return null;var Pe=1<<ge,Ae=Ua(ge,Z=(Z%Pe+Pe)%Pe,X);if(this.tiles[Ae])return Al(this.tiles[Ae],xe);Te>1&&console.log("drilling down to z%d-%d-%d",ge,Z,X);for(var De,ze=ge,ht=Z,gt=X;!De&&ze>0;)ze--,ht=Math.floor(ht/2),gt=Math.floor(gt/2),De=this.tiles[Ua(ze,ht,gt)];return De&&De.source?(Te>1&&console.log("found parent tile z%d-%d-%d",ze,ht,gt),Te>1&&console.time("drilling down"),this.splitTile(De.source,ze,ht,gt,ge,Z,X),Te>1&&console.timeEnd("drilling down"),this.tiles[Ae]?Al(this.tiles[Ae],xe):null):null};class kl extends p.VectorTileWorkerSource{constructor(Z,X,he,xe,Te){super(Z,X,he,xe,ca),Te&&(this.loadGeoJSON=Te)}loadData(Z,X){const he=Z&&Z.request,xe=he&&he.collectResourceTiming;this.loadGeoJSON(Z,(Te,Pe)=>{if(Te||!Pe)return X(Te);if("object"!=typeof Pe)return X(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));{zr(Pe,!0);try{if(Z.filter){const De=p.createExpression(Z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===De.result)throw new Error(De.value.map(ht=>`${ht.key}: ${ht.message}`).join(", "));Pe={type:"FeatureCollection",features:Pe.features.filter(ht=>De.value.evaluate({zoom:0},ht))}}this._geoJSONIndex=Z.cluster?new $i(function({superclusterOptions:De,clusterProperties:ze}){if(!ze||!De)return De;const ht={},gt={},at={accumulated:null,zoom:0},Yt={properties:null},hn=Object.keys(ze);for(const Kt of hn){const[ln,bn]=ze[Kt],di=p.createExpression(bn),An=p.createExpression("string"==typeof ln?[ln,["accumulated"],["get",Kt]]:ln);ht[Kt]=di.value,gt[Kt]=An.value}return De.map=Kt=>{Yt.properties=Kt;const ln={};for(const bn of hn)ln[bn]=ht[bn].evaluate(at,Yt);return ln},De.reduce=(Kt,ln)=>{Yt.properties=ln;for(const bn of hn)at.accumulated=Kt[bn],Kt[bn]=gt[bn].evaluate(at,Yt)},De}(Z)).load(Pe.features):new Bs(De=Pe,Z.geojsonVtOptions)}catch(De){return X(De)}this.loaded={};const Ae={};if(xe){const De=p.getPerformanceMeasurement(he);De&&(Ae.resourceTiming={},Ae.resourceTiming[Z.source]=JSON.parse(JSON.stringify(De)))}X(null,Ae)}var De})}reloadTile(Z,X){const he=this.loaded;return he&&he[Z.uid]?super.reloadTile(Z,X):this.loadTile(Z,X)}loadGeoJSON(Z,X){if(Z.request)p.getJSON(Z.request,X);else{if("string"!=typeof Z.data)return X(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));try{return X(null,JSON.parse(Z.data))}catch{return X(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Z,X){try{X(null,this._geoJSONIndex.getClusterExpansionZoom(Z.clusterId))}catch(he){X(he)}}getClusterChildren(Z,X){try{X(null,this._geoJSONIndex.getChildren(Z.clusterId))}catch(he){X(he)}}getClusterLeaves(Z,X){try{X(null,this._geoJSONIndex.getLeaves(Z.clusterId,Z.limit,Z.offset))}catch(he){X(he)}}}class Zu{constructor(Z){this.self=Z,this.actor=new p.Actor(Z,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=p.getProjection({name:"mercator"}),this.workerSourceTypes={vector:p.VectorTileWorkerSource,geojson:kl},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(X,he)=>{if(this.workerSourceTypes[X])throw new Error(`Worker source with name "${X}" already registered.`);this.workerSourceTypes[X]=he},this.self.registerRTLTextPlugin=X=>{if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=X.applyArabicShaping,p.plugin.processBidirectionalText=X.processBidirectionalText,p.plugin.processStyledBidirectionalText=X.processStyledBidirectionalText}}clearCaches(Z,X,he){delete this.layerIndexes[Z],delete this.availableImages[Z],delete this.workerSources[Z],delete this.demWorkerSources[Z],he()}checkIfReady(Z,X,he){he()}setReferrer(Z,X){this.referrer=X}spriteLoaded(Z,X){this.isSpriteLoaded[Z]=X;for(const he in this.workerSources[Z]){const xe=this.workerSources[Z][he];for(const Te in xe)xe[Te]instanceof p.VectorTileWorkerSource&&(xe[Te].isSpriteLoaded=X,xe[Te].fire(new p.Event("isSpriteLoaded")))}}setImages(Z,X,he){this.availableImages[Z]=X;for(const xe in this.workerSources[Z]){const Te=this.workerSources[Z][xe];for(const Pe in Te)Te[Pe].availableImages=X}he()}enableTerrain(Z,X,he){this.terrain=X,he()}setProjection(Z,X){this.projections[Z]=p.getProjection(X)}setLayers(Z,X,he){this.getLayerIndex(Z).replace(X),he()}updateLayers(Z,X,he){this.getLayerIndex(Z).update(X.layers,X.removedIds),he()}loadTile(Z,X,he){const xe=this.enableTerrain?p.extend({enableTerrain:this.terrain},X):X;xe.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,X.type,X.source).loadTile(xe,he)}loadDEMTile(Z,X,he){const xe=this.enableTerrain?p.extend({buildQuadTree:this.terrain},X):X;this.getDEMWorkerSource(Z,X.source).loadTile(xe,he)}reloadTile(Z,X,he){const xe=this.enableTerrain?p.extend({enableTerrain:this.terrain},X):X;xe.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,X.type,X.source).reloadTile(xe,he)}abortTile(Z,X,he){this.getWorkerSource(Z,X.type,X.source).abortTile(X,he)}removeTile(Z,X,he){this.getWorkerSource(Z,X.type,X.source).removeTile(X,he)}removeSource(Z,X,he){if(!this.workerSources[Z]||!this.workerSources[Z][X.type]||!this.workerSources[Z][X.type][X.source])return;const xe=this.workerSources[Z][X.type][X.source];delete this.workerSources[Z][X.type][X.source],void 0!==xe.removeSource?xe.removeSource(X,he):he()}loadWorkerSource(Z,X,he){try{this.self.importScripts(X.url),he()}catch(xe){he(xe.toString())}}syncRTLPluginState(Z,X,he){try{p.plugin.setState(X);const xe=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&null!=xe){this.self.importScripts(xe);const Te=p.plugin.isParsed();he(Te?void 0:new Error(`RTL Text Plugin failed to import scripts from ${xe}`),Te)}}catch(xe){he(xe.toString())}}getAvailableImages(Z){let X=this.availableImages[Z];return X||(X=[]),X}getLayerIndex(Z){let X=this.layerIndexes[Z];return X||(X=this.layerIndexes[Z]=new mo),X}getWorkerSource(Z,X,he){return this.workerSources[Z]||(this.workerSources[Z]={}),this.workerSources[Z][X]||(this.workerSources[Z][X]={}),this.workerSources[Z][X][he]||(this.workerSources[Z][X][he]=new this.workerSourceTypes[X]({send:(Te,Pe,Ae,De,ze,ht)=>{this.actor.send(Te,Pe,Ae,Z,ze,ht)},scheduler:this.actor.scheduler},this.getLayerIndex(Z),this.getAvailableImages(Z),this.isSpriteLoaded[Z])),this.workerSources[Z][X][he]}getDEMWorkerSource(Z,X){return this.demWorkerSources[Z]||(this.demWorkerSources[Z]={}),this.demWorkerSources[Z][X]||(this.demWorkerSources[Z][X]=new an),this.demWorkerSources[Z][X]}enforceCacheSizeLimit(Z,X){p.enforceCacheSizeLimit(X)}getWorkerPerformanceMetrics(Z,X,he){he(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Zu(self)),Zu}),gh(0,function(p){function Je(g,l){if(Array.isArray(g)){if(!Array.isArray(l)||g.length!==l.length)return!1;for(let d=0;d<g.length;d++)if(!Je(g[d],l[d]))return!1;return!0}if("object"==typeof g&&null!==g&&null!==l){if("object"!=typeof l||Object.keys(g).length!==Object.keys(l).length)return!1;for(const d in g)if(!Je(g[d],l[d]))return!1;return!0}return g===l}var us=mo;function mo(g){return l=g,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,x,C=new Blob([""],{type:"text/javascript"}),D=URL.createObjectURL(C);try{x=new Worker(D),_=!0}catch{_=!1}return x&&x.terminate(),URL.revokeObjectURL(D),_}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var _=document.createElement("canvas");_.width=_.height=1;var x=_.getContext("2d");if(!x)return!1;var C=x.getImageData(0,0,1,1);return C&&C.width===_.width}()||(void 0===an[d=l&&l.failIfMajorPerformanceCaveat]&&(an[d]=function(_){var x,D,S,k,C=(D=_,S=document.createElement("canvas"),(k=Object.create(mo.webGLContextAttributes)).failIfMajorPerformanceCaveat=D,S.getContext("webgl",k)||S.getContext("experimental-webgl",k));if(!C)return!1;try{x=C.createShader(C.VERTEX_SHADER)}catch{return!1}return!(!x||C.isContextLost())&&(C.shaderSource(x,"void main() {}"),C.compileShader(x),!0===C.getShaderParameter(x,C.COMPILE_STATUS))}(d)),!an[d]||document.documentMode));var l,d}var an={};function on(g,l,d){const _=p.window.document.createElement(g);return void 0!==l&&(_.className=l),d&&d.appendChild(_),_}function or(g,l,d){const _=p.window.document.createElementNS("http://www.w3.org/2000/svg",g);for(const x of Object.keys(l))_.setAttributeNS(null,x,l[x]);return d&&d.appendChild(_),_}mo.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const zr=p.window.document&&p.window.document.documentElement.style,Bo=zr&&void 0!==zr.userSelect?"userSelect":"WebkitUserSelect";let Rs;function Ac(){zr&&Bo&&(Rs=zr[Bo],zr[Bo]="none")}function Sl(){zr&&Bo&&(zr[Bo]=Rs)}function io(g){g.preventDefault(),g.stopPropagation(),p.window.removeEventListener("click",io,!0)}function _o(){p.window.addEventListener("click",io,!0),p.window.setTimeout(()=>{p.window.removeEventListener("click",io,!0)},0)}function Wr(g,l){const d=g.getBoundingClientRect();return Vo(g,d,l)}function Ra(g,l){const d=g.getBoundingClientRect(),_=[];for(let x=0;x<l.length;x++)_.push(Vo(g,d,l[x]));return _}function Fs(g){return void 0!==p.window.InstallTrigger&&2===g.button&&g.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:g.button}function Vo(g,l,d){const _=g.offsetWidth===l.width?1:g.offsetWidth/l.width;return new p.Point((d.clientX-l.left)*_,(d.clientY-l.top)*_)}function _t(g,l){var d=l[0],_=l[1],x=l[2],C=l[3],D=d*C-x*_;return D?(g[0]=C*(D=1/D),g[1]=-_*D,g[2]=-x*D,g[3]=d*D,g):null}function mh(g){const{userImage:l}=g;return!!(l&&l.render&&l.render())&&(g.data.replace(new Uint8Array(l.data.buffer)),!0)}class Fa extends p.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(l){if(this.loaded!==l&&(this.loaded=l,l)){for(const{ids:d,callback:_}of this.requestors)this._notify(d,_);this.requestors=[]}}hasImage(l){return!!this.getImage(l)}getImage(l){return this.images[l]}addImage(l,d){this._validate(l,d)&&(this.images[l]=d)}_validate(l,d){let _=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new p.ErrorEvent(new Error(`Image "${l}" has invalid "stretchX" value`))),_=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new p.ErrorEvent(new Error(`Image "${l}" has invalid "stretchY" value`))),_=!1),this._validateContent(d.content,d)||(this.fire(new p.ErrorEvent(new Error(`Image "${l}" has invalid "content" value`))),_=!1),_}_validateStretch(l,d){if(!l)return!0;let _=0;for(const x of l){if(x[0]<_||x[1]<x[0]||d<x[1])return!1;_=x[1]}return!0}_validateContent(l,d){return!(l&&(4!==l.length||l[0]<0||d.data.width<l[0]||l[1]<0||d.data.height<l[1]||l[2]<0||d.data.width<l[2]||l[3]<0||d.data.height<l[3]||l[2]<l[0]||l[3]<l[1]))}updateImage(l,d){d.version=this.images[l].version+1,this.images[l]=d,this.updatedImages[l]=!0}removeImage(l){const d=this.images[l];delete this.images[l],delete this.patterns[l],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(l,d){let _=!0;if(!this.isLoaded())for(const x of l)this.images[x]||(_=!1);this.isLoaded()||_?this._notify(l,d):this.requestors.push({ids:l,callback:d})}_notify(l,d){const _={};for(const x of l){this.images[x]||this.fire(new p.Event("styleimagemissing",{id:x}));const C=this.images[x];C?_[x]={data:C.data.clone(),pixelRatio:C.pixelRatio,sdf:C.sdf,version:C.version,stretchX:C.stretchX,stretchY:C.stretchY,content:C.content,hasRenderCallback:!(!C.userImage||!C.userImage.render)}:p.warnOnce(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,_)}getPixelSize(){const{width:l,height:d}=this.atlasImage;return{width:l,height:d}}getPattern(l){const d=this.patterns[l],_=this.getImage(l);if(!_)return null;if(d&&d.position.version===_.version)return d.position;if(d)d.position.version=_.version;else{const x={w:_.data.width+2,h:_.data.height+2,x:0,y:0},C=new p.ImagePosition(x,_);this.patterns[l]={bin:x,position:C}}return this._updatePatternAtlas(),this.patterns[l].position}bind(l){const d=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(l,this.atlasImage,d.RGBA),this.atlasTexture&&this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const l=[];for(const C in this.patterns)l.push(this.patterns[C].bin);const{w:d,h:_}=p.potpack(l),x=this.atlasImage;x.resize({width:d||1,height:_||1});for(const C in this.patterns){const{bin:D}=this.patterns[C],S=D.x+1,k=D.y+1,N=this.images[C].data,F=N.width,j=N.height;p.RGBAImage.copy(N,x,{x:0,y:0},{x:S,y:k},{width:F,height:j}),p.RGBAImage.copy(N,x,{x:0,y:j-1},{x:S,y:k-1},{width:F,height:1}),p.RGBAImage.copy(N,x,{x:0,y:0},{x:S,y:k+j},{width:F,height:1}),p.RGBAImage.copy(N,x,{x:F-1,y:0},{x:S-1,y:k},{width:1,height:j}),p.RGBAImage.copy(N,x,{x:0,y:0},{x:S+F,y:k},{width:1,height:j})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(l){for(const d of l){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const _=this.images[d];mh(_)&&this.updateImage(d,_)}}}const fn=new p.Properties({anchor:new p.DataConstantProperty(p.spec.light.anchor),position:new class{constructor(){this.specification=p.spec.light.position}possiblyEvaluate(g,l){return function([d,_,x]){const C=p.degToRad(_+90),D=p.degToRad(x);return{x:d*Math.cos(C)*Math.sin(D),y:d*Math.sin(C)*Math.sin(D),z:d*Math.cos(D),azimuthal:_,polar:x}}(g.expression.evaluate(l))}interpolate(g,l,d){return{x:p.number(g.x,l.x,d),y:p.number(g.y,l.y,d),z:p.number(g.z,l.z,d),azimuthal:p.number(g.azimuthal,l.azimuthal,d),polar:p.number(g.polar,l.polar,d)}}},color:new p.DataConstantProperty(p.spec.light.color),intensity:new p.DataConstantProperty(p.spec.light.intensity)});class gr extends p.Evented{constructor(l){super(),this._transitionable=new p.Transitionable(fn),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,d={}){if(!this._validate(p.validateLight,l,d))for(const _ in l){const x=l[_];p.endsWith(_,"-transition")?this._transitionable.setTransition(_.slice(0,-11),x):this._transitionable.setValue(_,x)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,d,_){return(!_||!1!==_.validate)&&p.emitValidationErrors(this,l.call(p.validateStyle,p.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}const Pc=new p.Properties({source:new p.DataConstantProperty(p.spec.terrain.source),exaggeration:new p.DataConstantProperty(p.spec.terrain.exaggeration)});let ju=class extends p.Evented{constructor(g,l){super(),this._transitionable=new p.Transitionable(Pc),this.set(g),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(g){for(const l in g){const d=g[l];p.endsWith(l,"-transition")?this._transitionable.setTransition(l.slice(0,-11),d):this._transitionable.setValue(l,d)}}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}};function Na(g,l,d,_){const x=p.smoothstep(45,65,d),[C,D]=Uo(g,_),S=p.length(l);let k=1-Math.min(1,Math.exp((S-C)/(D-C)*-6));return k*=k*k,k=Math.min(1,1.00747*k),k*x*g.alpha}function Uo(g,l){const d=.5/Math.tan(.5*l);return[g.range[0]+d,g.range[1]+d]}const yn=new p.Properties({range:new p.DataConstantProperty(p.spec.fog.range),color:new p.DataConstantProperty(p.spec.fog.color),"high-color":new p.DataConstantProperty(p.spec.fog["high-color"]),"space-color":new p.DataConstantProperty(p.spec.fog["space-color"]),"horizon-blend":new p.DataConstantProperty(p.spec.fog["horizon-blend"]),"star-intensity":new p.DataConstantProperty(p.spec.fog["star-intensity"])});class za extends p.Evented{constructor(l,d){super(),this._transitionable=new p.Transitionable(yn),this.set(l),this._transitioning=this._transitionable.untransitioned(),this._transform=d}get state(){const l=this._transform,d="globe"===l.projection.name,_=p.globeToMercatorTransition(l.zoom),x=this.properties.get("range"),C=[.5,3];return{range:d?[p.number(C[0],x[0],_),p.number(C[1],x[1],_)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(l,d={}){if(!this._validate(p.validateFog,l,d)){for(const _ of Object.keys(p.spec.fog))l&&void 0===l[_]&&(l[_]=p.spec.fog[_].default);for(const _ in l){const x=l[_];p.endsWith(_,"-transition")?this._transitionable.setTransition(_.slice(0,-11),x):this._transitionable.setValue(_,x)}}}getOpacity(l){if(!this._transform.projection.supportsFog)return 0;const d=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:p.smoothstep(45,65,l))*d.a}getOpacityAtLatLng(l,d){return this._transform.projection.supportsFog?function(_,x,C){const D=p.MercatorCoordinate.fromLngLat(x),S=C.elevation?C.elevation.getAtPointOrZero(D):0,k=[D.x,D.y,S];return p.transformMat4(k,k,C.mercatorFogMatrix),Na(_,k,C.pitch,C._fov)}(this.state,l,d):0}getFovAdjustedRange(l){return this._transform.projection.supportsFog?Uo(this.state,l):[0,1]}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,d,_){return(!_||!1!==_.validate)&&p.emitValidationErrors(this,l.call(p.validateStyle,p.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}class xn{constructor(l,d){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=p.uniqueId();const _=this.workerPool.acquire(this.id);for(let x=0;x<_.length;x++){const C=new xn.Actor(_[x],d,this.id);C.name=`Worker ${x}`,this.actors.push(C)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(l,d,_){p.asyncAll(this.actors,(x,C)=>{x.send(l,d,C)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(l=>{l.remove()}),this.actors=[],this.workerPool.release(this.id)}}function sr(g,l,d){return l*(p.EXTENT/(g.tileSize*Math.pow(2,d-g.tileID.overscaledZ)))}xn.Actor=p.Actor;class sa{constructor(l,d,_,x){this.screenBounds=l,this.cameraPoint=d,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(l,d){let _,x;if(l instanceof p.Point||"number"==typeof l[0]){const C=p.Point.convert(l);_=[C],x=d.isPointAboveHorizon(C)}else{const C=p.Point.convert(l[0]),D=p.Point.convert(l[1]);_=[C,D],x=p.polygonizeBounds(C,D).every(S=>d.isPointAboveHorizon(S))}return new sa(_,d.getCameraPoint(),x,d)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(l){return p.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],l)}bufferedCameraGeometry(l){const d=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new p.Point(1,1)):this.screenBounds[1],x=p.polygonizeBounds(d,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>d.x&&this.cameraPoint.x<_.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?x[2]=this.cameraPoint:this.cameraPoint.x<=d.x&&(x[3]=this.cameraPoint)),p.bufferConvexPolygon(x,l)}bufferedCameraGeometryGlobe(l){const d=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new p.Point(1,1)):this.screenBounds[1],x=p.polygonizeBounds(d,_,l),C=this.cameraPoint.clone();switch(3*((C.y>d.y)+(C.y>_.y))+((C.x>d.x)+(C.x>_.x))){case 0:x[0]=C,x[4]=C.clone();break;case 1:x.splice(1,0,C);break;case 2:x[1]=C;break;case 3:x.splice(4,0,C);break;case 5:x.splice(2,0,C);break;case 6:x[3]=C;break;case 7:x.splice(3,0,C);break;case 8:x[2]=C}return x}containsTile(l,d,_,x=0){const C=l.queryPadding/d._pixelsPerMercatorPixel+1,D=_?this._bufferedCameraMercator(C,d):this._bufferedScreenMercator(C,d);let S=l.tileID.wrap+(D.unwrapped?x:0);const k=D.polygon.map(se=>p.getTilePoint(l.tileTransform,se,S));if(!p.polygonIntersectsBox(k,0,0,p.EXTENT,p.EXTENT))return;S=l.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const N=this.screenGeometryMercator.polygon.map(se=>p.getTileVec3(l.tileTransform,se,S)),F=N.map(se=>new p.Point(se[0],se[1])),j=d.getFreeCameraOptions().position||new p.MercatorCoordinate(0,0,0),Y=p.getTileVec3(l.tileTransform,j,S),ee=N.map(se=>{const $=p.sub(se,se,Y);return p.normalize($,$),new p.Ray(Y,$)}),re=sr(l,1,d.zoom)*d._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:F,tilespaceRays:ee,bufferedTilespaceGeometry:k,bufferedTilespaceBounds:(ie=p.getBounds(k),ie.min.x=p.clamp(ie.min.x,0,p.EXTENT),ie.min.y=p.clamp(ie.min.y,0,p.EXTENT),ie.max.x=p.clamp(ie.max.x,0,p.EXTENT),ie.max.y=p.clamp(ie.max.y,0,p.EXTENT),ie),tile:l,tileID:l.tileID,pixelToTileUnitsFactor:re};var ie}_bufferedScreenMercator(l,d){const _=ar(l);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let x;return x="globe"===d.projection.name?this._projectAndResample(this.bufferedScreenGeometry(l),d):{polygon:this.bufferedScreenGeometry(l).map(C=>d.pointCoordinate3D(C)),unwrapped:!0},this._screenRaycastCache[_]=x,x}}_bufferedCameraMercator(l,d){const _=ar(l);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let x;return x="globe"===d.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(l),d):{polygon:this.bufferedCameraGeometry(l).map(C=>d.pointCoordinate3D(C)),unwrapped:!0},this._cameraRaycastCache[_]=x,x}}_projectAndResample(l,d){const _=function(C,D){const S=p.multiply([],D.pixelMatrix,D.globeMatrix),k=[0,-p.GLOBE_RADIUS,0,1],N=[0,p.GLOBE_RADIUS,0,1],F=[0,0,0,1];p.transformMat4$1(k,k,S),p.transformMat4$1(N,N,S),p.transformMat4$1(F,F,S);const j=new p.Point(k[0]/k[3],k[1]/k[3]),Y=new p.Point(N[0]/N[3],N[1]/N[3]),ee=p.polygonContainsPoint(C,j)&&k[3]<F[3],re=p.polygonContainsPoint(C,Y)&&N[3]<F[3];if(!ee&&!re)return null;const ie=function(we,Se,Ee){for(let Fe=1;Fe<we.length;Fe++){const ot=aa(Se.pointCoordinate3D(we[Fe-1]).x),Oe=aa(Se.pointCoordinate3D(we[Fe]).x);if(Ee<0){if(ot<Oe)return{idx:Fe,t:-ot/(Oe-1-ot)}}else if(Oe<ot)return{idx:Fe,t:(1-ot)/(Oe+1-ot)}}return null}(C,D,ee?-1:1);if(!ie)return null;const{idx:se,t:$}=ie;let Q=se>1?$i(C.slice(0,se),D):[],ue=se<C.length?$i(C.slice(se),D):[];Q=Q.map(we=>new p.Point(aa(we.x),we.y)),ue=ue.map(we=>new p.Point(aa(we.x),we.y));const de=[...Q];0===de.length&&de.push(ue[ue.length-1]);const be=p.number(de[de.length-1].y,(0===ue.length?Q[0]:ue[0]).y,$);let Me;return Me=ee?[new p.Point(0,be),new p.Point(0,0),new p.Point(1,0),new p.Point(1,be)]:[new p.Point(1,be),new p.Point(1,1),new p.Point(0,1),new p.Point(0,be)],de.push(...Me),0===ue.length?de.push(Q[0]):de.push(...ue),{polygon:de.map(we=>new p.MercatorCoordinate(we.x,we.y)),unwrapped:!1}}(l,d);if(_)return _;const x=function(C,D){let S=!1,k=-1/0,N=0;for(let j=0;j<C.length-1;j++)C[j].x>k&&(k=C[j].x,N=j);for(let j=0;j<C.length-1;j++){const Y=(N+j)%(C.length-1),ee=C[Y],re=C[Y+1];Math.abs(ee.x-re.x)>.5&&(ee.x<re.x?(ee.x+=1,0===Y&&(C[C.length-1].x+=1)):(re.x+=1,Y+1===C.length-1&&(C[0].x+=1)),S=!0)}const F=p.mercatorXfromLng(D.center.lng);return S&&F<Math.abs(F-1)&&C.forEach(j=>{j.x-=1}),{polygon:C,unwrapped:S}}($i(l,d).map(C=>new p.Point(aa(C.x),C.y)),d);return{polygon:x.polygon.map(C=>new p.MercatorCoordinate(C.x,C.y)),unwrapped:x.unwrapped}}}function $i(g,l){return p.resample(g,d=>{const _=l.pointCoordinate3D(d);d.x=_.x,d.y=_.y},1/256)}function aa(g){return g<0?1+g%1:g%1}function ar(g){return 100*g|0}function Ns(g,l,d,_,x){const C=function(D,S){if(D)return x(D);if(S){g.url&&S.tiles&&g.tiles&&delete g.tiles;const k=p.pick(p.extend(S,g),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);S.vector_layers&&(k.vectorLayers=S.vector_layers,k.vectorLayerIds=k.vectorLayers.map(N=>N.id)),k.tiles=l.canonicalizeTileset(k,g.url),x(null,k)}};return g.url?p.getJSON(l.transformRequest(l.normalizeSourceURL(g.url,null,d,_),p.ResourceType.Source),C):p.exported.frame(()=>C(null,g))}class Ei{constructor(l,d,_){this.bounds=p.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=d||0,this.maxzoom=_||24}validateBounds(l){return Array.isArray(l)&&4===l.length?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const d=Math.pow(2,l.z),_=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*d),x=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*d),C=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*d),D=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*d);return l.x>=_&&l.x<C&&l.y>=x&&l.y<D}}class kc{constructor(l,d,_){this.context=l;const x=l.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||d.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){const d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ri={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ei{constructor(l,d,_,x){this.length=d.length,this.attributes=_,this.itemSize=d.bytesPerElement,this.dynamicDraw=x,this.context=l;const C=l.gl;this.buffer=C.createBuffer(),l.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||d.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,d){for(let _=0;_<this.attributes.length;_++){const x=d.attributes[this.attributes[_].name];void 0!==x&&l.enableVertexAttribArray(x)}}setVertexAttribPointers(l,d,_){for(let x=0;x<this.attributes.length;x++){const C=this.attributes[x],D=d.attributes[C.name];void 0!==D&&l.vertexAttribPointer(D,C.components,l[ri[C.type]],!1,this.itemSize,C.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Cn{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class En extends Cn{getDefault(){return p.Color.transparent}set(l){const d=this.current;(l.r!==d.r||l.g!==d.g||l.b!==d.b||l.a!==d.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Br extends Cn{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class Oc extends Cn{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class oi extends Cn{getDefault(){return[!0,!0,!0,!0]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||l[3]!==d[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class vo extends Cn{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class $u extends Cn{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class zs extends Cn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const d=this.current;(l.func!==d.func||l.ref!==d.ref||l.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class yo extends Cn{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class Hu extends Cn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=l,this.dirty=!1}}class Lc extends Cn{getDefault(){return[0,1]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class Gu extends Cn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=l,this.dirty=!1}}class la extends Cn{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class Ba extends Cn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.BLEND):d.disable(d.BLEND),this.current=l,this.dirty=!1}}class qu extends Cn{getDefault(){const l=this.gl;return[l.ONE,l.ZERO]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)}}class Il extends Cn{getDefault(){return p.Color.transparent}set(l){const d=this.current;(l.r!==d.r||l.g!==d.g||l.b!==d.b||l.a!==d.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class xo extends Cn{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)}}class ds extends Cn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;l?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=l,this.dirty=!1}}class Al extends Cn{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class Va extends Cn{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}let Pl,Rc=class extends Cn{getDefault(){return null}set(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)}};class Xr extends Cn{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class Bs extends Cn{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const d=this.current;(l[0]!==d[0]||l[1]!==d[1]||l[2]!==d[2]||l[3]!==d[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Ua extends Cn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class ca extends Cn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class kl extends Cn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class Zu extends Cn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class ge extends Cn{getDefault(){return null}set(l){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Z extends Cn{constructor(l){super(l),this.vao=l.extVertexArrayObject}getDefault(){return null}set(l){this.vao&&(l!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(l),this.current=l,this.dirty=!1)}}class X extends Cn{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class he extends Cn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class xe extends Cn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class Te extends Cn{constructor(l,d){super(l),this.context=l,this.parent=d}getDefault(){return null}}class Pe extends Te{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Ae extends Te{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,this.attachment(),d.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class De extends Ae{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class ze{constructor(l,d,_,x){this.context=l,this.width=d,this.height=_;const C=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new Pe(l,C),x&&(this.depthAttachment=new Ae(l,C))}destroy(){const l=this.context.gl,d=this.colorAttachment.get();if(d&&l.deleteTexture(d),this.depthAttachment){const _=this.depthAttachment.get();_&&l.deleteRenderbuffer(_)}l.deleteFramebuffer(this.framebuffer)}}class ht{constructor(l,d=!1){if(this.gl=l,this.isWebGL2=d,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),d){const _=l;this.extVertexArrayObject={createVertexArrayOES:_.createVertexArray.bind(l),deleteVertexArrayOES:_.deleteVertexArray.bind(l),bindVertexArrayOES:_.bindVertexArray.bind(l)}}this.clearColor=new En(this),this.clearDepth=new Br(this),this.clearStencil=new Oc(this),this.colorMask=new oi(this),this.depthMask=new vo(this),this.stencilMask=new $u(this),this.stencilFunc=new zs(this),this.stencilOp=new yo(this),this.stencilTest=new Hu(this),this.depthRange=new Lc(this),this.depthTest=new Gu(this),this.depthFunc=new la(this),this.blend=new Ba(this),this.blendFunc=new qu(this),this.blendColor=new Il(this),this.blendEquation=new xo(this),this.cullFace=new ds(this),this.cullFaceSide=new Al(this),this.frontFace=new Va(this),this.program=new Rc(this),this.activeTexture=new Xr(this),this.viewport=new Bs(this),this.bindFramebuffer=new Ua(this),this.bindRenderbuffer=new ca(this),this.bindTexture=new kl(this),this.bindVertexBuffer=new Zu(this),this.bindElementBuffer=new ge(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Z(this),this.pixelStoreUnpack=new X(this),this.pixelStoreUnpackPremultiplyAlpha=new he(this),this.pixelStoreUnpackFlipY=new xe(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=l.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=l.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=l.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),d||(this.extTextureHalfFloat=l.getExtension("OES_texture_half_float")),(d||this.extTextureHalfFloat&&l.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=d||l.getExtension("OES_standard_derivatives"),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,d){return new kc(this,l,d)}createVertexBuffer(l,d,_){return new ei(this,l,d,_)}createRenderbuffer(l,d,_){const x=this.gl,C=x.createRenderbuffer();return this.bindRenderbuffer.set(C),x.renderbufferStorage(x.RENDERBUFFER,l,d,_),this.bindRenderbuffer.set(null),C}createFramebuffer(l,d,_){return new ze(this,l,d,_)}clear({color:l,depth:d,stencil:_}){const x=this.gl;let C=0;l&&(C|=x.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set([!0,!0,!0,!0])),void 0!==d&&(C|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),void 0!==_&&(C|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),x.clear(C)}setCullFace(l){!1===l.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){Je(l.blendFunction,p.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class gt extends p.Evented{constructor(l,d,_,x){if(super(),this.id=l,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(d,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new p.DedupedRequest}load(l){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"}));const d=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_=this.map._worldview;this._tileJSONRequest=Ns(this._options,this.map._requestManager,d,_,(x,C)=>{this._tileJSONRequest=null,this._loaded=!0,x?(d&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${d}`),_&&2!==_.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_}`),this.fire(new p.ErrorEvent(x))):C&&(p.extend(this,C),C.bounds&&(this.tileBounds=new Ei(C.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(C.tiles,this.map._requestManager._customAccessToken),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))),l&&l(x)})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return p.extend({},this._options)}loadTile(l,d){const _=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),x={request:this.map._requestManager.transformRequest(_,p.ResourceType.Tile),data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:l.isSymbolTile};if(x.request.collectResourceTiming=this._collectResourceTiming,l.actor&&"expired"!==l.state)"loading"===l.state?l.reloadCallback=d:l.request=l.actor.send("reloadTile",x,C.bind(this));else if(l.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)l.request=l.actor.send("loadTile",x,C.bind(this),void 0,!0);else{const D=p.loadVectorTile.call({deduped:this._deduped},x,(S,k)=>{S||!k?C.call(this,S):(x.data={cacheControl:k.cacheControl,expires:k.expires,rawData:k.rawData.slice(0)},l.actor&&l.actor.send("loadTile",x,C.bind(this),void 0,!0))},!0);l.request={cancel:D}}function C(D,S){return delete l.request,l.aborted?d(null):D&&404!==D.status?d(D):(S&&S.resourceTiming&&(l.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&S&&l.setExpiryData(S),l.loadVectorData(S,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id})}unloadTile(l){l.unloadVectorData(),l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class at extends p.Evented{constructor(l,d,_,x){super(),this.id=l,this.dispatcher=_,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},d),p.extend(this,p.pick(d,["url","scheme","tileSize"]))}load(l){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ns(this._options,this.map._requestManager,null,null,(d,_)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new p.ErrorEvent(d)):_&&(p.extend(this,_),_.bounds&&(this.tileBounds=new Ei(_.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(_.tiles),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))),l&&l(d)})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(l){return this._options.tiles=l,this.reload(),this}setUrl(l){return this.url=l,this._options.url=l,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return p.extend({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,d){const _=p.exported.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);l.request=p.getImage(this.map._requestManager.transformRequest(x,p.ResourceType.Tile),(C,D,S,k)=>(delete l.request,l.aborted?(l.state="unloaded",d(null)):C?(l.state="errored",d(C)):D?(this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:S,expires:k}),l.setTexture(D,this.map.painter),l.state="loaded",p.cacheEntryPossiblyAdded(this.dispatcher),void d(null)):d(null)))}static loadTileData(l,d,_){l.setTexture(d,_)}static unloadTileData(l,d){l.texture&&d.saveTileTexture(l.texture)}abortTile(l,d){l.request&&(l.request.cancel(),delete l.request),d()}unloadTile(l,d){l.texture&&this.map.painter.saveTileTexture(l.texture),d()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Yt(g,l,d,_,x,C,D,S){const k=[g,d,x,l,_,C,1,1,1],N=[D,S,1],F=p.adjoint([],k),[j,Y,ee]=p.transformMat3(N,N,p.transpose(F,F));return p.multiply$1(k,[j,0,0,0,Y,0,0,0,ee],k)}class hn extends p.Evented{constructor(l,d,_,x){super(),this.id=l,this.dispatcher=_,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=d,this._dirty=!1}load(l,d){this._loaded=d||!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),(_,x)=>{if(this._imageRequest=null,this._loaded=!0,_)this.fire(new p.ErrorEvent(_));else if(x){const{HTMLImageElement:C}=p.window;this.image=x instanceof C?p.exported.getImageData(x):x,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,l&&(this.coordinates=l),this._finishLoading()}})}loaded(){return this._loaded}updateImage(l){return this.image&&l.url?(this._imageRequest&&l.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=l.url,this.load(l.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(l){this.coordinates=l,this._boundsArray=void 0;const d=l.map(p.MercatorCoordinate.fromLngLat);return this.tileID=function(_){let x=1/0,C=1/0,D=-1/0,S=-1/0;for(const j of _)x=Math.min(x,j.x),C=Math.min(C,j.y),D=Math.max(D,j.x),S=Math.max(S,j.y);const k=Math.max(D-x,S-C),N=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),F=Math.pow(2,N);return new p.CanonicalTileID(N,Math.floor((x+D)/2*F),Math.floor((C+S)/2*F))}(d),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(l){for(const k in this.tiles){const N=this.tiles[k];"loaded"!==N.state&&(N.state="loaded",N.texture=this.texture)}if(this._boundsArray)return;const d=p.tileTransform(this.tileID,this.map.transform.projection),[_,x,C,D]=this.coordinates.map(k=>{const N=d.projection.project(k[0],k[1]);return p.getTilePoint(d,N)._round()});this.perspectiveTransform=function(k,N,F,j,Y,ee,re,ie,se,$){const Q=Yt(0,0,k,0,0,N,k,N),ue=Yt(F,j,Y,ee,re,ie,se,$);return p.multiply$1(ue,p.adjoint(Q,Q),ue),[ue[6]/ue[8]*k/p.EXTENT,ue[7]/ue[8]*N/p.EXTENT]}(this.width,this.height,_.x,_.y,x.x,x.y,D.x,D.y,C.x,C.y);const S=this._boundsArray=new p.StructArrayLayout4i8;S.emplaceBack(_.x,_.y,0,0),S.emplaceBack(x.x,x.y,p.EXTENT,0),S.emplaceBack(D.x,D.y,0,p.EXTENT),S.emplaceBack(C.x,C.y,p.EXTENT,p.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=l.createVertexBuffer(S,p.boundsAttributes.members),this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const l=this.map.painter.context,d=l.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new p.Texture(l,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(l)}loadTile(l,d){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={},d(null)):(l.state="errored",d(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Kt={vector:gt,raster:at,"raster-dem":class extends at{constructor(g,l,d,_){super(g,l,d,_),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox"}loadTile(g,l){const d=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(x,C){x&&(g.state="errored",l(x)),C&&(g.dem=C,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",l(null))}g.request=p.getImage(this.map._requestManager.transformRequest(d,p.ResourceType.Tile),function(x,C,D,S){if(delete g.request,g.aborted)g.state="unloaded",l(null);else if(x)g.state="errored",l(x);else if(C){this.map._refreshExpiredTiles&&g.setExpiryData({cacheControl:D,expires:S});const k=p.window.ImageBitmap&&C instanceof p.window.ImageBitmap&&(null==Pl&&(Pl=p.window.OffscreenCanvas&&new p.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof p.window.createImageBitmap),Pl),N=1-(C.width-p.prevPowerOfTwo(C.width))/2;N<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const F=k?C:p.exported.getImageData(C,N),j={uid:g.uid,coord:g.tileID,source:this.id,rawImageData:F,encoding:this.encoding,padding:N};g.actor&&"expired"!==g.state||(g.actor=this.dispatcher.getActor(),g.actor.send("loadDEMTile",j,_.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(g){const l=g.canonical,d=Math.pow(2,l.z),_=(l.x-1+d)%d,x=0===l.x?g.wrap-1:g.wrap,C=(l.x+1+d)%d,D=l.x+1===d?g.wrap+1:g.wrap,S={};return S[new p.OverscaledTileID(g.overscaledZ,x,l.z,_,l.y).key]={backfilled:!1},S[new p.OverscaledTileID(g.overscaledZ,D,l.z,C,l.y).key]={backfilled:!1},l.y>0&&(S[new p.OverscaledTileID(g.overscaledZ,x,l.z,_,l.y-1).key]={backfilled:!1},S[new p.OverscaledTileID(g.overscaledZ,g.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},S[new p.OverscaledTileID(g.overscaledZ,D,l.z,C,l.y-1).key]={backfilled:!1}),l.y+1<d&&(S[new p.OverscaledTileID(g.overscaledZ,x,l.z,_,l.y+1).key]={backfilled:!1},S[new p.OverscaledTileID(g.overscaledZ,g.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},S[new p.OverscaledTileID(g.overscaledZ,D,l.z,C,l.y+1).key]={backfilled:!1}),S}unloadTile(g){g.demTexture&&this.map.painter.saveTileTexture(g.demTexture),g.fbo&&(g.fbo.destroy(),delete g.fbo),g.dem&&delete g.dem,delete g.neighboringTiles,g.state="unloaded"}},geojson:class extends p.Evented{constructor(g,l,d,_){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=d.getActor(),this.setEventedParent(_),this._data=l.data,this._options=p.extend({},l),this._collectResourceTiming=l.collectResourceTiming,void 0!==l.maxzoom&&(this.maxzoom=l.maxzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId;const x=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:l.cluster||!1,geojsonVtOptions:{buffer:(void 0!==l.buffer?l.buffer:128)*x,tolerance:(void 0!==l.tolerance?l.tolerance:.375)*x,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:void 0!==l.clusterMaxZoom?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:p.EXTENT,radius:(void 0!==l.clusterRadius?l.clusterRadius:50)*x,log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter},l.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}getClusterExpansionZoom(g,l){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id},l),this}getClusterChildren(g,l){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id},l),this}getClusterLeaves(g,l,d,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:g,limit:l,offset:d},_),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new p.Event("dataloading",{dataType:"source"})),this._loaded=!1;const g=p.extend({},this.workerOptions),l=this._data;"string"==typeof l?(g.request=this.map._requestManager.transformRequest(p.exported.resolveURL(l),p.ResourceType.Source),g.request.collectResourceTiming=this._collectResourceTiming):g.data=JSON.stringify(l),this._pendingLoad=this.actor.send(`${this.type}.loadData`,g,(d,_)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new p.ErrorEvent(d));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(x.resourceTiming=_.resourceTiming[this.id]),this.fire(new p.Event("data",x)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(g,l){const d=g.actor?"reloadTile":"loadTile";g.actor=this.actor,g.request=this.actor.send(d,{type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(_,x)=>(delete g.request,g.unloadVectorData(),g.aborted?l(null):_?l(_):(g.loadVectorData(x,this.map.painter,"reloadTile"===d),l(null))),void 0,"loadTile"===d)}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g){g.unloadVectorData(),this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return p.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends hn{constructor(g,l,d,_){super(g,l,d,_),this.roundZoom=!0,this.type="video",this.options=l}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const l of g.urls)this.urls.push(this.map._requestManager.transformRequest(l,p.ResourceType.Source).url);p.getVideo(this.urls,(l,d)=>{this._loaded=!0,l?this.fire(new p.ErrorEvent(l)):d&&(this.video=d,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const l=this.video.seekable;g<l.start(0)||g>l.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const g=this.map.painter.context,l=g.gl;this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(g,this.video,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(g)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:hn,canvas:class extends hn{constructor(g,l,d,_){super(g,l,d,_),l.coordinates?Array.isArray(l.coordinates)&&4===l.coordinates.length&&!l.coordinates.some(x=>!Array.isArray(x)||2!==x.length||x.some(C=>"number"!=typeof C))||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'missing required property "coordinates"'))),l.animate&&"boolean"!=typeof l.animate&&this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),l.canvas?"string"==typeof l.canvas||l.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${g}`,null,'missing required property "canvas"'))),this.options=l,this.animate=void 0===l.animate||l.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const l=this.map.painter.context;this.texture?(g||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(l,this.canvas,l.gl.RGBA,{premultiply:!0}),this._prepareData(l)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}},custom:class extends p.Evented{constructor(g,l,d,_){super(),this.id=g,this.type="custom",this._dataType="raster",this._dispatcher=d,this._implementation=l,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new p.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new p.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ei(this._implementation.bounds,this.minzoom,this.maxzoom)),l.update=this._update.bind(this),l.clearTiles=this._clearTiles.bind(this),l.coveringTiles=this._coveringTiles.bind(this),p.extend(this,p.pick(l,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return p.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(g){this._map=g,this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(g),this.load()}onRemove(g){this._implementation.onRemove&&this._implementation.onRemove(g)}hasTile(g){if(this._implementation.hasTile){const{x:l,y:d,z:_}=g.canonical;return this._implementation.hasTile({x:l,y:d,z:_})}return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,l){const{x:d,y:_,z:x}=g.tileID.canonical,C=new p.window.AbortController;g.request=Promise.resolve(this._implementation.loadTile({x:d,y:_,z:x},{signal:C.signal})).then(function(D){return delete g.request,g.aborted?(g.state="unloaded",l(null)):void 0===D?(g.state="errored",l(null)):null===D?(this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",l(null)):(S=D)instanceof p.window.ImageData||S instanceof p.window.HTMLCanvasElement||S instanceof p.window.ImageBitmap||S instanceof p.window.HTMLImageElement?(this.loadTileData(g,D),g.state="loaded",void l(null)):(g.state="errored",l(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var S}.bind(this)).catch(D=>{20!==D.code&&(g.state="errored",l(D))}),g.request.cancel=()=>C.abort()}loadTileData(g,l){at.loadTileData(g,l,this._map.painter)}unloadTileData(g){at.unloadTileData(g,this._map.painter)}unloadTile(g,l){if(this.unloadTileData(g),this._implementation.unloadTile){const{x:d,y:_,z:x}=g.tileID.canonical;this._implementation.unloadTile({x:d,y:_,z:x})}l()}abortTile(g,l){g.request&&g.request.cancel&&(g.request.cancel(),delete g.request),l()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(g=>({x:g.canonical.x,y:g.canonical.y,z:g.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}}},ln=function(g,l,d,_){const x=new Kt[l.type](g,l,d,_);if(x.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${x.id}`);return p.bindAll(["load","abort","unload","serialize","prepare"],x),x};function bn(g,l){const d=p.identity([]);return p.scale(d,d,[.5*g.width,.5*-g.height,1]),p.translate(d,d,[1,-1,0]),p.multiply(d,d,g.calculateProjMatrix(l.toUnwrapped())),Float32Array.from(d)}function di(g,l,d,_,x,C,D,S=!1){const k=g.tilesIn(_,D,S);k.sort(Dr);const N=[];for(const j of k)N.push({wrappedTileID:j.tile.tileID.wrapped().key,queryResults:j.tile.queryRenderedFeatures(l,d,g._state,j,x,C,bn(g.transform,j.tile.tileID),S)});const F=function(j){const Y={},ee={};for(const re of j){const ie=re.queryResults,se=re.wrappedTileID,$=ee[se]=ee[se]||{};for(const Q in ie){const ue=ie[Q],de=$[Q]=$[Q]||{},be=Y[Q]=Y[Q]||[];for(const Me of ue)de[Me.featureIndex]||(de[Me.featureIndex]=!0,be.push(Me))}}return Y}(N);for(const j in F)F[j].forEach(Y=>{const ee=Y.feature,re=ee.layer;re&&"background"!==re.type&&"sky"!==re.type&&(ee.source=re.source,re["source-layer"]&&(ee.sourceLayer=re["source-layer"]),ee.state=void 0!==ee.id?g.getFeatureState(re["source-layer"],ee.id):{})});return F}function An(g,l){const d=g.getRenderableIds().map(C=>g.getTileByID(C)),_=[],x={};for(let C=0;C<d.length;C++){const D=d[C],S=D.tileID.canonical.key;x[S]||(x[S]=!0,D.querySourceFeatures(_,l))}return _}function Dr(g,l){const d=g.tileID,_=l.tileID;return d.overscaledZ-_.overscaledZ||d.canonical.y-_.canonical.y||d.wrap-_.wrap||d.canonical.x-_.canonical.x}function Ki(){return null!=ec.workerClass?new ec.workerClass:new p.window.Worker(ec.workerUrl)}const hs="mapboxgl_preloaded_worker_pool";class mr{constructor(){this.active={}}acquire(l){if(!this.workers)for(this.workers=[];this.workers.length<mr.workerCount;)this.workers.push(new Ki);return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],0===this.numActive()&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[hs]}numActive(){return Object.keys(this.active).length}}let Sr;function Ol(){return Sr||(Sr=new mr),Sr}function Dm(g,l){const d={};for(const _ in g)"ref"!==_&&(d[_]=g[_]);return p.refProperties.forEach(_=>{_ in l&&(d[_]=l[_])}),d}function ps(g){g=g.slice();const l=Object.create(null);for(let d=0;d<g.length;d++)l[g[d].id]=g[d];for(let d=0;d<g.length;d++)"ref"in g[d]&&(g[d]=Dm(g[d],l[g[d].ref]));return g}mr.workerCount=2;const Fn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Ji(g,l,d){d.push({command:Fn.addSource,args:[g,l[g]]})}function fs(g,l,d){l.push({command:Fn.removeSource,args:[g]}),d[g]=!0}function bo(g,l,d,_){fs(g,d,_),Ji(g,l,d)}function _h(g,l,d){let _;for(_ in g[d])if(g[d].hasOwnProperty(_)&&"data"!==_&&!Je(g[d][_],l[d][_]))return!1;for(_ in l[d])if(l[d].hasOwnProperty(_)&&"data"!==_&&!Je(g[d][_],l[d][_]))return!1;return!0}function gs(g,l,d,_,x,C){let D;for(D in l=l||{},g=g||{})g.hasOwnProperty(D)&&(Je(g[D],l[D])||d.push({command:C,args:[_,D,l[D],x]}));for(D in l)l.hasOwnProperty(D)&&!g.hasOwnProperty(D)&&(Je(g[D],l[D])||d.push({command:C,args:[_,D,l[D],x]}))}function ms(g){return g.id}function Fc(g,l){return g[l.id]=l,g}class Wu{constructor(l,d){this.reset(l,d)}reset(l,d){this.points=l||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(1===this.points.length)return this.points[0];l=p.clamp(l,0,1);let d=1,_=this._distances[d];const x=l*this.paddedLength+this.padding;for(;_<x&&d<this._distances.length;)_=this._distances[++d];const C=d-1,D=this._distances[C],S=_-D,k=S>0?(x-D)/S:0;return this.points[C].mult(1-k).add(this.points[d].mult(k))}}class jo{constructor(l,d,_){const x=this.boxCells=[],C=this.circleCells=[];this.xCellCount=Math.ceil(l/_),this.yCellCount=Math.ceil(d/_);for(let D=0;D<this.xCellCount*this.yCellCount;D++)x.push([]),C.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=d,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,d,_,x,C){this._forEachCell(d,_,x,C,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(x),this.bboxes.push(C)}insertCircle(l,d,_,x){this._forEachCell(d-x,_-x,d+x,_+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(d),this.circles.push(_),this.circles.push(x)}_insertBoxCell(l,d,_,x,C,D){this.boxCells[C].push(D)}_insertCircleCell(l,d,_,x,C,D){this.circleCells[C].push(D)}_query(l,d,_,x,C,D){if(_<0||l>this.width||x<0||d>this.height)return!C&&[];const S=[];if(l<=0&&d<=0&&this.width<=_&&this.height<=x){if(C)return!0;for(let k=0;k<this.boxKeys.length;k++)S.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const N=this.circles[3*k],F=this.circles[3*k+1],j=this.circles[3*k+2];S.push({key:this.circleKeys[k],x1:N-j,y1:F-j,x2:N+j,y2:F+j})}return D?S.filter(D):S}return this._forEachCell(l,d,_,x,this._queryCell,S,{hitTest:C,seenUids:{box:{},circle:{}}},D),C?S.length>0:S}_queryCircle(l,d,_,x,C){const D=l-_,S=l+_,k=d-_,N=d+_;if(S<0||D>this.width||N<0||k>this.height)return!x&&[];const F=[];return this._forEachCell(D,k,S,N,this._queryCellCircle,F,{hitTest:x,circle:{x:l,y:d,radius:_},seenUids:{box:{},circle:{}}},C),x?F.length>0:F}query(l,d,_,x,C){return this._query(l,d,_,x,!1,C)}hitTest(l,d,_,x,C){return this._query(l,d,_,x,!0,C)}hitTestCircle(l,d,_,x){return this._queryCircle(l,d,_,!0,x)}_queryCell(l,d,_,x,C,D,S,k){const N=S.seenUids,F=this.boxCells[C];if(null!==F){const Y=this.bboxes;for(const ee of F)if(!N.box[ee]){N.box[ee]=!0;const re=4*ee;if(l<=Y[re+2]&&d<=Y[re+3]&&_>=Y[re+0]&&x>=Y[re+1]&&(!k||k(this.boxKeys[ee]))){if(S.hitTest)return D.push(!0),!0;D.push({key:this.boxKeys[ee],x1:Y[re],y1:Y[re+1],x2:Y[re+2],y2:Y[re+3]})}}}const j=this.circleCells[C];if(null!==j){const Y=this.circles;for(const ee of j)if(!N.circle[ee]){N.circle[ee]=!0;const re=3*ee;if(this._circleAndRectCollide(Y[re],Y[re+1],Y[re+2],l,d,_,x)&&(!k||k(this.circleKeys[ee]))){if(S.hitTest)return D.push(!0),!0;{const ie=Y[re],se=Y[re+1],$=Y[re+2];D.push({key:this.circleKeys[ee],x1:ie-$,y1:se-$,x2:ie+$,y2:se+$})}}}}}_queryCellCircle(l,d,_,x,C,D,S,k){const N=S.circle,F=S.seenUids,j=this.boxCells[C];if(null!==j){const ee=this.bboxes;for(const re of j)if(!F.box[re]){F.box[re]=!0;const ie=4*re;if(this._circleAndRectCollide(N.x,N.y,N.radius,ee[ie+0],ee[ie+1],ee[ie+2],ee[ie+3])&&(!k||k(this.boxKeys[re])))return D.push(!0),!0}}const Y=this.circleCells[C];if(null!==Y){const ee=this.circles;for(const re of Y)if(!F.circle[re]){F.circle[re]=!0;const ie=3*re;if(this._circlesCollide(ee[ie],ee[ie+1],ee[ie+2],N.x,N.y,N.radius)&&(!k||k(this.circleKeys[re])))return D.push(!0),!0}}}_forEachCell(l,d,_,x,C,D,S,k){const N=this._convertToXCellCoord(l),F=this._convertToYCellCoord(d),j=this._convertToXCellCoord(_),Y=this._convertToYCellCoord(x);for(let ee=N;ee<=j;ee++)for(let re=F;re<=Y;re++)if(C.call(this,l,d,_,x,this.xCellCount*re+ee,D,S,k))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,d,_,x,C,D){const S=x-l,k=C-d,N=_+D;return N*N>S*S+k*k}_circleAndRectCollide(l,d,_,x,C,D,S){const k=(D-x)/2,N=Math.abs(l-(x+k));if(N>k+_)return!1;const F=(S-C)/2,j=Math.abs(d-(C+F));if(j>F+_)return!1;if(N<=k||j<=F)return!0;const Y=N-k,ee=j-F;return Y*Y+ee*ee<=_*_}}const Vs={unknown:0,flipRequired:1,flipNotRequired:2},Ll=Math.tan(85*Math.PI/180);function je(g,l,d,_,x,C,D){const S=p.create();if(d)if("globe"===C.name){const k=p.calculateGlobeLabelMatrix(x,l);p.multiply(S,S,k)}else{const k=_t([],D);S[0]=k[0],S[1]=k[1],S[4]=k[2],S[5]=k[3],_||p.rotateZ(S,S,x.angle)}else p.multiply(S,x.labelPlaneMatrix,g);return S}function Us(g,l,d,_,x,C,D){const S=je(g,l,d,_,x,C,D);return"globe"===C.name&&d||(S[2]=S[6]=S[10]=S[14]=0),S}function Hi(g,l,d,_,x,C,D){if(d){if("globe"===C.name){const S=je(g,l,d,_,x,C,D);return p.invert(S,S),p.multiply(S,g,S),S}{const S=p.clone(g),k=p.identity([]);return k[0]=D[0],k[1]=D[1],k[4]=D[2],k[5]=D[3],p.multiply(S,S,k),_||p.rotateZ(S,S,-x.angle),S}}return x.glCoordMatrix}function _r(g,l,d,_){const x=[g,l,d,1];d?p.transformMat4$1(x,x,_):gn(x,x,_);const C=x[3];return x[0]/=C,x[1]/=C,x[2]/=C,x}function Xp(g,l){return Math.min(.5+g/l*.5,1.5)}function $o(g,l){const d=g[0]/g[3],_=g[1]/g[3];return d>=-l[0]&&d<=l[0]&&_>=-l[1]&&_<=l[1]}function vh(g,l,d,_,x,C,D,S,k,N){const F=d.transform,j=_?g.textSizeData:g.iconSizeData,Y=p.evaluateSizeForZoom(j,d.transform.zoom),ee="globe"===F.projection.name,re=[256/d.width*2+1,256/d.height*2+1],ie=_?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;ie.clear();let se=null;ee&&(se=_?g.text.globeExtVertexArray:g.icon.globeExtVertexArray);const $=g.lineVertexArray,Q=_?g.text.placedSymbolArray:g.icon.placedSymbolArray,ue=d.transform.width/d.transform.height;let de,be=!1;for(let Me=0;Me<Q.length;Me++){const we=Q.get(Me),{numGlyphs:Se,writingMode:Ee}=we;if(Ee!==p.WritingMode.vertical||be||de===p.WritingMode.horizontal||(be=!0),de=Ee,(we.hidden||Ee===p.WritingMode.vertical)&&!be){Ti(Se,ie);continue}be=!1;const Fe=new p.Point(we.tileAnchorX,we.tileAnchorY);let{x:ot,y:Oe,z:Ze}=F.projection.projectTilePoint(Fe.x,Fe.y,N.canonical);if(k){const[Ht,Et,At]=k(Fe);ot+=Ht,Oe+=Et,Ze+=At}const Be=[ot,Oe,Ze,1];if(p.transformMat4$1(Be,Be,l),!$o(Be,re)){Ti(Se,ie);continue}const it=Xp(d.transform.cameraToCenterDistance,Be[3]),Le=p.evaluateSizeForFeature(j,Y,we),Ge=D?Le/it:Le*it,tt=_r(ot,Oe,Ze,x);if(tt[3]<=0){Ti(Se,ie);continue}let Qe={};const st=D?null:k,vt=bt(we,Ge,!1,S,l,x,C,g.glyphOffsetArray,$,ie,se,tt,Fe,Qe,ue,st,F.projection,N,D);be=vt.useVertical,st&&vt.needsFlipping&&(Qe={}),(vt.notEnoughRoom||be||vt.needsFlipping&&bt(we,Ge,!0,S,l,x,C,g.glyphOffsetArray,$,ie,se,tt,Fe,Qe,ue,st,F.projection,N,D).notEnoughRoom)&&Ti(Se,ie)}_?(g.text.dynamicLayoutVertexBuffer.updateData(ie),se&&g.text.globeExtVertexBuffer.updateData(se)):(g.icon.dynamicLayoutVertexBuffer.updateData(ie),se&&g.icon.globeExtVertexBuffer.updateData(se))}function Yp(g,l,d,_,x,C,D,S,k,N,F,j,Y,ee,re,ie){const{lineStartIndex:se,glyphStartIndex:$,segment:Q}=S,ue=$+S.numGlyphs,de=se+S.lineLength,be=l.getoffsetX($),Me=l.getoffsetX(ue-1),we=Vr(g*be,d,_,x,C,D,Q,se,de,k,N,F,j,Y,!0,ee,re,ie);if(!we)return null;const Se=Vr(g*Me,d,_,x,C,D,Q,se,de,k,N,F,j,Y,!0,ee,re,ie);return Se?{first:we,last:Se}:null}function bi(g,l,d,_){return g===p.WritingMode.horizontal&&Math.abs(_)>Math.abs(d)?{useVertical:!0}:g===p.WritingMode.vertical?_>0?{needsFlipping:!0}:null:l!==Vs.unknown&&(0===(x=d)||Math.abs(_/x)>Ll)?l===Vs.flipRequired?{needsFlipping:!0}:null:d<0?{needsFlipping:!0}:null;var x}function bt(g,l,d,_,x,C,D,S,k,N,F,j,Y,ee,re,ie,se,$,Q){const ue=l/24,de=g.lineOffsetX*ue,be=g.lineOffsetY*ue,{lineStartIndex:Me,glyphStartIndex:we,numGlyphs:Se,segment:Ee,writingMode:Fe,flipState:ot}=g,Oe=Me+g.lineLength,Ze=Be=>{if(F){const[tt,Qe,st]=Be.up,vt=N.length;p.updateGlobeVertexNormal(F,vt+0,tt,Qe,st),p.updateGlobeVertexNormal(F,vt+1,tt,Qe,st),p.updateGlobeVertexNormal(F,vt+2,tt,Qe,st),p.updateGlobeVertexNormal(F,vt+3,tt,Qe,st)}const[it,Le,Ge]=Be.point;p.addDynamicAttributes(N,it,Le,Ge,Be.angle)};if(Se>1){const Be=Yp(ue,S,de,be,d,j,Y,g,k,C,ee,ie,!1,se,$,Q);if(!Be)return{notEnoughRoom:!0};if(_&&!d){let[it,Le,Ge]=Be.first.point,[tt,Qe,st]=Be.last.point;[it,Le]=_r(it,Le,Ge,D),[tt,Qe]=_r(tt,Qe,st,D);const vt=bi(Fe,ot,(tt-it)*re,Qe-Le);if(g.flipState=vt&&vt.needsFlipping?Vs.flipRequired:Vs.flipNotRequired,vt)return vt}Ze(Be.first);for(let it=we+1;it<we+Se-1;it++){const Le=Vr(ue*S.getoffsetX(it),de,be,d,j,Y,Ee,Me,Oe,k,C,ee,ie,!1,!1,se,$,Q);if(!Le)return N.length-=4*(it-we),{notEnoughRoom:!0};Ze(Le)}Ze(Be.last)}else{if(_&&!d){const it=_r(Y.x,Y.y,0,x),Le=Me+Ee+1,Ge=new p.Point(k.getx(Le),k.gety(Le)),tt=_r(Ge.x,Ge.y,0,x),Qe=tt[3]>0?tt:cn(Y,Ge,it,1,x,void 0,se,$.canonical),st=bi(Fe,ot,(Qe[0]-it[0])*re,Qe[1]-it[1]);if(g.flipState=st&&st.needsFlipping?Vs.flipRequired:Vs.flipNotRequired,st)return st}const Be=Vr(ue*S.getoffsetX(we),de,be,d,j,Y,Ee,Me,Oe,k,C,ee,ie,!1,!1,se,$,Q);if(!Be)return{notEnoughRoom:!0};Ze(Be)}return{}}function pt(g,l,d,_,x){const{x:C,y:D,z:S}=_.projectTilePoint(g.x,g.y,l);if(!x)return _r(C,D,S,d);const[k,N,F]=x(g);return _r(C+k,D+N,S+F,d)}function cn(g,l,d,_,x,C,D,S){const k=pt(g.sub(l)._unit()._add(g),S,x,D,C);return p.sub(k,d,k),p.normalize(k,k),p.scaleAndAdd(k,d,k,_)}function Vr(g,l,d,_,x,C,D,S,k,N,F,j,Y,ee,re,ie,se,$){const Q=_?g-l:g+l;let ue=Q>0?1:-1,de=0;_&&(ue*=-1,de=Math.PI),ue<0&&(de+=Math.PI);let be=S+D+(ue>0?0:1)|0,Me=x,we=x,Se=0,Ee=0;const Fe=Math.abs(Q),ot=[],Oe=[];let Ze=C,Be=Ze;const it=()=>cn(Be,Ze,we,Fe-Se+1,F,Y,ie,se.canonical);for(;Se+Ee<=Fe;){if(be+=ue,be<S||be>=k)return null;if(we=Me,Be=Ze,ot.push(we),ee&&Oe.push(Be),Ze=new p.Point(N.getx(be),N.gety(be)),Me=j[be],!Me){const At=pt(Ze,se.canonical,F,ie,Y);Me=At[3]>0?j[be]=At:it()}Se+=Ee,Ee=p.distance(we,Me)}re&&Y&&(j[be]&&(Me=it(),Ee=p.distance(we,Me)),j[be]=Me);const Le=(Fe-Se)/Ee,Ge=Ze.sub(Be)._mult(Le)._add(Be),tt=p.sub([],Me,we),Qe=p.scaleAndAdd([],we,tt,Le);let st=[0,0,1],vt=tt[0],Ht=tt[1];if($&&(st=ie.upVector(se.canonical,Ge.x,Ge.y),0!==st[0]||0!==st[1]||1!==st[2])){const At=[st[2],0,-st[0]],_n=p.cross([],st,At);p.normalize(At,At),p.normalize(_n,_n),vt=p.dot(tt,At),Ht=p.dot(tt,_n)}if(d){const At=p.cross([],st,tt);p.normalize(At,At),p.scaleAndAdd(Qe,Qe,At,d*ue)}const Et=de+Math.atan2(Ht,vt);return ot.push(Qe),ee&&Oe.push(Ge),{point:Qe,angle:Et,path:ot,tilePath:Oe,up:st}}function Ti(g,l){const d=l.length,_=d+4*g;l.resize(_),l.float32.fill(-1/0,4*d,4*_)}function gn(g,l,d){const _=l[0],x=l[1];return g[0]=d[0]*_+d[4]*x+d[12],g[1]=d[1]*_+d[5]*x+d[13],g[3]=d[3]*_+d[7]*x+d[15],g}const ro=100;class zn{constructor(l,d,_=new jo(l.width+200,l.height+200,25),x=new jo(l.width+200,l.height+200,25)){this.transform=l,this.grid=_,this.ignoredGrid=x,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+ro,this.screenBottomBoundary=l.height+ro,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.fogState=d}placeCollisionBox(l,d,_,x,C,D,S,k){let N=_.projectedAnchorX,F=_.projectedAnchorY,j=_.projectedAnchorZ;const Y=_.elevation,ee=_.tileID,re=l.getProjection();if(Y&&ee){const[Me,we,Se]=re.upVector(ee.canonical,_.tileAnchorX,_.tileAnchorY),Ee=re.upVectorScale(ee.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;N+=Me*Y*Ee,F+=we*Y*Ee,j+=Se*Y*Ee}const ie=this.projectAndGetPerspectiveRatio(S,N,F,j,_.tileID,"globe"===re.name||!!Y||this.transform.pitch>0,re),se=D*ie.perspectiveRatio,$=(_.x1*d+x.x-_.padding)*se+ie.point.x,Q=(_.y1*d+x.y-_.padding)*se+ie.point.y,ue=(_.x2*d+x.x+_.padding)*se+ie.point.x,de=(_.y2*d+x.y+_.padding)*se+ie.point.y,be=ie.perspectiveRatio<=.55||ie.occluded;return!this.isInsideGrid($,Q,ue,de)||!C&&this.grid.hitTest($,Q,ue,de,k)||be?{box:[],offscreen:!1,occluded:ie.occluded}:{box:[$,Q,ue,de],offscreen:this.isOffscreen($,Q,ue,de),occluded:!1}}placeCollisionCircles(l,d,_,x,C,D,S,k,N,F,j,Y,ee,re,ie){const se=[],$=this.transform.elevation,Q=l.getProjection(),ue=$?$.getAtTileOffsetFunc(ie,this.transform.center.lat,this.transform.worldSize,Q):null,de=new p.Point(_.tileAnchorX,_.tileAnchorY);let{x:be,y:Me,z:we}=Q.projectTilePoint(de.x,de.y,ie.canonical);if(ue){const[Ge,tt,Qe]=ue(de);be+=Ge,Me+=tt,we+=Qe}const Se="globe"===Q.name,Ee=this.projectAndGetPerspectiveRatio(S,be,Me,we,ie,Se||!!$||this.transform.pitch>0,Q),{perspectiveRatio:Fe}=Ee,ot=(j?D/Fe:D*Fe)/p.ONE_EM,Oe=_r(be,Me,we,k),Ze=Ee.signedDistanceFromCamera>0?Yp(ot,C,_.lineOffsetX*ot,_.lineOffsetY*ot,!1,Oe,de,_,x,k,{},$&&!j?ue:null,j&&!!$,Q,ie,j):null;let Be=!1,it=!1,Le=!0;if(Ze&&!Ee.occluded){const Ge=.5*ee*Fe+re,tt=new p.Point(-100,-100),Qe=new p.Point(this.screenRightBoundary,this.screenBottomBoundary),st=new Wu,{first:vt,last:Ht}=Ze,Et=vt.path.length;let At=[];for(let Pt=Et-1;Pt>=1;Pt--)At.push(vt.path[Pt]);for(let Pt=1;Pt<Ht.path.length;Pt++)At.push(Ht.path[Pt]);const _n=2.5*Ge;N&&(At=At.map(([Pt,dn,$n],Hn)=>(ue&&!Se&&($n=ue(Hn<Et-1?vt.tilePath[Et-1-Hn]:Ht.tilePath[Hn-Et+2])[2]),_r(Pt,dn,$n,N))),At.some(Pt=>Pt[3]<=0)&&(At=[]));let un=[];if(At.length>0){let Pt=1/0,dn=-1/0,$n=1/0,Hn=-1/0;for(const Gn of At)Pt=Math.min(Pt,Gn[0]),$n=Math.min($n,Gn[1]),dn=Math.max(dn,Gn[0]),Hn=Math.max(Hn,Gn[1]);dn>=tt.x&&Pt<=Qe.x&&Hn>=tt.y&&$n<=Qe.y&&(un=[At.map(Gn=>new p.Point(Gn[0],Gn[1]))],(Pt<tt.x||dn>Qe.x||$n<tt.y||Hn>Qe.y)&&(un=p.clipLine(un,tt.x,tt.y,Qe.x,Qe.y)))}for(const Pt of un){st.reset(Pt,.25*Ge);let dn=0;dn=st.length<=.5*Ge?1:Math.ceil(st.paddedLength/_n)+1;for(let $n=0;$n<dn;$n++){const Hn=$n/Math.max(dn-1,1),Gn=st.lerp(Hn),Ii=Gn.x+ro,dr=Gn.y+ro;se.push(Ii,dr,Ge,0);const So=Ii-Ge,Ko=dr-Ge,ai=Ii+Ge,Un=dr+Ge;if(Le=Le&&this.isOffscreen(So,Ko,ai,Un),it=it||this.isInsideGrid(So,Ko,ai,Un),!d&&this.grid.hitTestCircle(Ii,dr,Ge,Y)&&(Be=!0,!F))return{circles:[],offscreen:!1,collisionDetected:Be,occluded:!1}}}}return{circles:!F&&Be||!it?[]:se,offscreen:Le,collisionDetected:Be,occluded:Ee.occluded}}queryRenderedSymbols(l){if(0===l.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const d=[];let _=1/0,x=1/0,C=-1/0,D=-1/0;for(const F of l){const j=new p.Point(F.x+ro,F.y+ro);_=Math.min(_,j.x),x=Math.min(x,j.y),C=Math.max(C,j.x),D=Math.max(D,j.y),d.push(j)}const S=this.grid.query(_,x,C,D).concat(this.ignoredGrid.query(_,x,C,D)),k={},N={};for(const F of S){const j=F.key;if(void 0===k[j.bucketInstanceId]&&(k[j.bucketInstanceId]={}),k[j.bucketInstanceId][j.featureIndex])continue;const Y=[new p.Point(F.x1,F.y1),new p.Point(F.x2,F.y1),new p.Point(F.x2,F.y2),new p.Point(F.x1,F.y2)];p.polygonIntersectsPolygon(d,Y)&&(k[j.bucketInstanceId][j.featureIndex]=!0,void 0===N[j.bucketInstanceId]&&(N[j.bucketInstanceId]=[]),N[j.bucketInstanceId].push(j.featureIndex))}return N}insertCollisionBox(l,d,_,x,C){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:x,collisionGroupID:C},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,d,_,x,C){const D=d?this.ignoredGrid:this.grid,S={bucketInstanceId:_,featureIndex:x,collisionGroupID:C};for(let k=0;k<l.length;k+=4)D.insertCircle(S,l[k],l[k+1],l[k+2])}projectAndGetPerspectiveRatio(l,d,_,x,C,D,S){const k=[d,_,x,1];let N=!1;x||this.transform.pitch>0?(p.transformMat4$1(k,k,l),this.fogState&&C&&"globe"!==S.name&&(N=function(Y,ee,re,ie,se,$){const Q=$.calculateFogTileMatrix(se),ue=[ee,re,ie];return p.transformMat4(ue,ue,Q),Na(Y,ue,$.pitch,$._fov)}(this.fogState,d,_,x,C.toUnwrapped(),this.transform)>.9)):gn(k,k,l);const F=k[3];return{point:new p.Point((k[0]/F+1)/2*this.transform.width+ro,(-k[1]/F+1)/2*this.transform.height+ro),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(S)/F*.5,1.5),signedDistanceFromCamera:F,occluded:D&&k[2]>F||N}}isOffscreen(l,d,_,x){return _<ro||l>=this.screenRightBoundary||x<ro||d>this.screenBottomBoundary}isInsideGrid(l,d,_,x){return _>=0&&l<this.gridRightBoundary&&x>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const l=p.identity([]);return p.translate(l,l,[-100,-100,0]),l}}function _s(g,l,d){const _=l.createTileMatrix(g,g.worldSize,d.toUnwrapped());return p.multiply(new Float32Array(16),g.projMatrix,_)}function jn(g,l,d){if(l.projection.name===d.projection.name)return g.projMatrix;const _=d.clone();return _.setProjection(l.projection),_s(_,l.getProjection(),g)}function ti(g,l,d){return l.name===d.projection.name?g.projMatrix:_s(d,l,g)}class Kp{constructor(l,d,_,x){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?d:-d))):x&&_?1:0,this.placed=_}isHidden(){return 0===this.opacity&&!this.placed}}class Pn{constructor(l,d,_,x,C,D=!1){this.text=new Kp(l?l.text:null,d,_,C),this.icon=new Kp(l?l.icon:null,d,x,C),this.clipped=D}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Gt{constructor(l,d,_,x=!1){this.text=l,this.icon=d,this.skipFade=_,this.clipped=x}}class ja{constructor(){this.invProjMatrix=p.create(),this.viewportMatrix=p.create(),this.circles=[]}}class Nc{constructor(l,d,_,x,C){this.bucketInstanceId=l,this.featureIndex=d,this.sourceLayerIndex=_,this.bucketIndex=x,this.tileID=C}}class Sm{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const d=++this.maxGroupID;this.collisionGroups[l]={ID:d,predicate:_=>_.collisionGroupID===d}}return this.collisionGroups[l]}}function Rl(g,l,d,_,x){const{horizontalAlign:C,verticalAlign:D}=p.getAnchorAlignment(g),S=-(C-.5)*l,k=-(D-.5)*d,N=p.evaluateVariableOffset(g,_);return new p.Point(S+N[0]*x,k+N[1]*x)}function ut(g,l,d,_,x){const C=new p.Point(g,l);return d&&C._rotate(_?x:-x),C}class $a{constructor(l,d,_,x,C){this.transform=l.clone(),this.projection=l.projection.name,this.collisionIndex=new zn(this.transform,C),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new Sm(_),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,d,_,x){const C=_.getBucket(d),D=_.latestFeatureIndex;if(!C||!D||d.id!==C.layerIds[0])return;const S=C.layers[0].layout,k=_.collisionBoxArray,N=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),F=_.tileSize/p.EXTENT,j=_.tileID.toUnwrapped();this.transform.setProjection(C.projection);const Y=(ee=_.tileID,re=C.getProjection(),ie=this.transform,re.name===this.projection?ie.calculateProjMatrix(ee.toUnwrapped()):_s(ie,re,ee));var ee,re,ie;const se="map"===S.get("text-pitch-alignment"),$="map"===S.get("text-rotation-alignment");d.compileFilter();const Q=d.dynamicFilter(),ue=d.dynamicFilterNeedsFeature(),de=this.transform.calculatePixelsToTileUnitsMatrix(_),be=Us(Y,_.tileID.canonical,se,$,this.transform,C.getProjection(),de);let Me=null;if(se){const Ee=Hi(Y,_.tileID.canonical,se,$,this.transform,C.getProjection(),de);Me=p.multiply([],this.transform.labelPlaneMatrix,Ee)}let we=null;Q&&_.latestFeatureIndex&&(we={unwrappedTileID:j,dynamicFilter:Q,dynamicFilterNeedsFeature:ue,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[C.bucketInstanceId]=new Nc(C.bucketInstanceId,D,C.sourceLayerIndex,C.index,_.tileID);const Se={bucket:C,layout:S,posMatrix:Y,textLabelPlaneMatrix:be,labelToScreenMatrix:Me,clippingData:we,scale:N,textPixelRatio:F,holdingForFade:_.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(C.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:p.evaluateSizeForZoom(C.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(C.sourceID)};if(x)for(const Ee of C.sortKeyRanges){const{sortKey:Fe,symbolInstanceStart:ot,symbolInstanceEnd:Oe}=Ee;l.push({sortKey:Fe,symbolInstanceStart:ot,symbolInstanceEnd:Oe,parameters:Se})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:C.symbolInstances.length,parameters:Se})}attemptAnchorPlacement(l,d,_,x,C,D,S,k,N,F,j,Y,ee,re,ie,se,$,Q){const{textOffset0:ue,textOffset1:de,crossTileID:be}=Y,Me=[ue,de],we=Rl(l,_,x,Me,C),Se=this.collisionIndex.placeCollisionBox(re,C,d,ut(we.x,we.y,D,S,this.transform.angle),j,k,N,F.predicate);if(se){const Ee=re.getSymbolInstanceIconSize(Q,this.transform.zoom,Y.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(re,Ee,se,ut(we.x,we.y,D,S,this.transform.angle),j,k,N,F.predicate).box.length)return}if(Se.box.length>0){let Ee;return this.prevPlacement&&this.prevPlacement.variableOffsets[be]&&this.prevPlacement.placements[be]&&this.prevPlacement.placements[be].text&&(Ee=this.prevPlacement.variableOffsets[be].anchor),this.variableOffsets[be]={textOffset:Me,width:_,height:x,anchor:l,textScale:C,prevAnchor:Ee},this.markUsedJustification(re,l,Y,ie),re.allowVerticalPlacement&&(this.markUsedOrientation(re,ie,Y),this.placedOrientations[be]=ie),{shift:we,placedGlyphBoxes:Se}}}placeLayerBucketPart(l,d,_,x){const{bucket:C,layout:D,posMatrix:S,textLabelPlaneMatrix:k,labelToScreenMatrix:N,clippingData:F,textPixelRatio:j,holdingForFade:Y,collisionBoxArray:ee,partiallyEvaluatedTextSize:re,partiallyEvaluatedIconSize:ie,collisionGroup:se}=l.parameters,$=D.get("text-optional"),Q=D.get("icon-optional"),ue=D.get("text-allow-overlap"),de=D.get("icon-allow-overlap"),be="map"===D.get("text-rotation-alignment"),Me="map"===D.get("text-pitch-alignment"),we="none"!==D.get("icon-text-fit"),Se="viewport-y"===D.get("symbol-z-order");this.transform.setProjection(C.projection);let Ee=ue&&(de||!C.hasIconData()||Q),Fe=de&&(ue||!C.hasTextData()||$);!C.collisionArrays&&ee&&C.deserializeCollisionBoxes(ee),_&&x&&C.updateCollisionDebugBuffers(this.transform.zoom,ee);const ot=(Oe,Ze,Be)=>{const{crossTileID:it,numVerticalGlyphVertices:Le}=Oe;if(F){const ai={zoom:this.transform.zoom,pitch:this.transform.pitch};let Un=null;if(F.dynamicFilterNeedsFeature){const On=this.retainedQueryData[C.bucketInstanceId];Un=F.featureIndex.loadFeature({featureIndex:Oe.featureIndex,bucketIndex:On.bucketIndex,sourceLayerIndex:On.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,F.dynamicFilter)(ai,Un,this.retainedQueryData[C.bucketInstanceId].tileID.canonical,new p.Point(Oe.tileAnchorX,Oe.tileAnchorY),this.transform.calculateDistanceTileData(F.unwrappedTileID)))return this.placements[it]=new Gt(!1,!1,!1,!0),void d.add(it)}if(d.has(it))return;if(Y)return void(this.placements[it]=new Gt(!1,!1,!1));let Ge=!1,tt=!1,Qe=!0,st=!1,vt=!1,Ht=null,Et={box:null,offscreen:null,occluded:null},At={box:null,offscreen:null,occluded:null},_n=null,un=null,Pt=null,dn=0,$n=0,Hn=0;Be.textFeatureIndex?dn=Be.textFeatureIndex:Oe.useRuntimeCollisionCircles&&(dn=Oe.featureIndex),Be.verticalTextFeatureIndex&&($n=Be.verticalTextFeatureIndex);const Gn=ai=>{ai.tileID=this.retainedQueryData[C.bucketInstanceId].tileID;const Un=this.transform.elevation;(Un||ai.elevation)&&(ai.elevation=Un?Un.getAtTileOffset(ai.tileID,ai.tileAnchorX,ai.tileAnchorY):0)},Ii=Be.textBox;if(Ii){Gn(Ii);const ai=On=>{let Nt=p.WritingMode.horizontal;if(C.allowVerticalPlacement&&!On&&this.prevPlacement){const kr=this.prevPlacement.placedOrientations[it];kr&&(this.placedOrientations[it]=kr,Nt=kr,this.markUsedOrientation(C,Nt,Oe))}return Nt},Un=(On,Nt)=>{if(C.allowVerticalPlacement&&Le>0&&Be.verticalTextBox){for(const kr of C.writingModes)if(kr===p.WritingMode.vertical?(Et=Nt(),At=Et):Et=On(),Et&&Et.box&&Et.box.length)break}else Et=On()};if(D.get("text-variable-anchor")){let On=D.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[it]){const fi=this.prevPlacement.variableOffsets[it];On.indexOf(fi.anchor)>0&&(On=On.filter(Jr=>Jr!==fi.anchor),On.unshift(fi.anchor))}const Nt=(fi,Jr,hd)=>{const il=C.getSymbolInstanceTextSize(re,Oe,this.transform.zoom,Ze),tc=(fi.x2-fi.x1)*il+2*fi.padding,Qr=(fi.y2-fi.y1)*il+2*fi.padding,xa=we&&!de?Jr:null;xa&&Gn(xa);let rl={box:[],offscreen:!1,occluded:!1};const pd=ue?2*On.length:On.length;for(let iu=0;iu<pd;++iu){const zh=this.attemptAnchorPlacement(On[iu%On.length],fi,tc,Qr,il,be,Me,j,S,se,iu>=On.length,Oe,Ze,C,hd,xa,re,ie);if(zh&&(rl=zh.placedGlyphBoxes,rl&&rl.box&&rl.box.length)){Ge=!0,Ht=zh.shift;break}}return rl};Un(()=>Nt(Ii,Be.iconBox,p.WritingMode.horizontal),()=>{const fi=Be.verticalTextBox;return fi&&Gn(fi),C.allowVerticalPlacement&&!(Et&&Et.box&&Et.box.length)&&Le>0&&fi?Nt(fi,Be.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Et&&(Ge=Et.box,Qe=Et.offscreen,st=Et.occluded);const kr=ai(!(!Et||!Et.box));if(!Ge&&this.prevPlacement){const fi=this.prevPlacement.variableOffsets[it];fi&&(this.variableOffsets[it]=fi,this.markUsedJustification(C,fi.anchor,Oe,kr))}}else{const On=(Nt,kr)=>{const fi=C.getSymbolInstanceTextSize(re,Oe,this.transform.zoom,Ze),Jr=this.collisionIndex.placeCollisionBox(C,fi,Nt,new p.Point(0,0),ue,j,S,se.predicate);return Jr&&Jr.box&&Jr.box.length&&(this.markUsedOrientation(C,kr,Oe),this.placedOrientations[it]=kr),Jr};Un(()=>On(Ii,p.WritingMode.horizontal),()=>{const Nt=Be.verticalTextBox;return C.allowVerticalPlacement&&Le>0&&Nt?(Gn(Nt),On(Nt,p.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),ai(!!(Et&&Et.box&&Et.box.length))}}if(_n=Et,Ge=_n&&_n.box&&_n.box.length>0,Qe=_n&&_n.offscreen,st=_n&&_n.occluded,Oe.useRuntimeCollisionCircles){const ai=C.text.placedSymbolArray.get(Oe.centerJustifiedTextSymbolIndex>=0?Oe.centerJustifiedTextSymbolIndex:Oe.verticalPlacedTextSymbolIndex),Un=p.evaluateSizeForFeature(C.textSizeData,re,ai),On=D.get("text-padding");un=this.collisionIndex.placeCollisionCircles(C,ue,ai,C.lineVertexArray,C.glyphOffsetArray,Un,S,k,N,_,Me,se.predicate,Oe.collisionCircleDiameter*Un/p.ONE_EM,On,this.retainedQueryData[C.bucketInstanceId].tileID),Ge=ue||un.circles.length>0&&!un.collisionDetected,Qe=Qe&&un.offscreen,st=un.occluded}if(Be.iconFeatureIndex&&(Hn=Be.iconFeatureIndex),Be.iconBox){const ai=Un=>{Gn(Un);const On=we&&Ht?ut(Ht.x,Ht.y,be,Me,this.transform.angle):new p.Point(0,0),Nt=C.getSymbolInstanceIconSize(ie,this.transform.zoom,Oe.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(C,Nt,Un,On,de,j,S,se.predicate)};At&&At.box&&At.box.length&&Be.verticalIconBox?(Pt=ai(Be.verticalIconBox),tt=Pt.box.length>0):(Pt=ai(Be.iconBox),tt=Pt.box.length>0),Qe=Qe&&Pt.offscreen,vt=Pt.occluded}const dr=$||0===Oe.numHorizontalGlyphVertices&&0===Le,So=Q||0===Oe.numIconVertices;if(dr||So?So?dr||(tt=tt&&Ge):Ge=tt&&Ge:tt=Ge=tt&&Ge,Ge&&_n&&_n.box&&this.collisionIndex.insertCollisionBox(_n.box,D.get("text-ignore-placement"),C.bucketInstanceId,At&&At.box&&$n?$n:dn,se.ID),tt&&Pt&&this.collisionIndex.insertCollisionBox(Pt.box,D.get("icon-ignore-placement"),C.bucketInstanceId,Hn,se.ID),un&&(Ge&&this.collisionIndex.insertCollisionCircles(un.circles,D.get("text-ignore-placement"),C.bucketInstanceId,dn,se.ID),_)){const ai=C.bucketInstanceId;let Un=this.collisionCircleArrays[ai];void 0===Un&&(Un=this.collisionCircleArrays[ai]=new ja);for(let On=0;On<un.circles.length;On+=4)Un.circles.push(un.circles[On+0]),Un.circles.push(un.circles[On+1]),Un.circles.push(un.circles[On+2]),Un.circles.push(un.collisionDetected?1:0)}const Ko="globe"!==C.projection.name;Ee=Ee&&(Ko||!st),Fe=Fe&&(Ko||!vt),this.placements[it]=new Gt(Ge||Ee,tt||Fe,Qe||C.justReloaded),d.add(it)};if(Se){const Oe=C.getSortedSymbolIndexes(this.transform.angle);for(let Ze=Oe.length-1;Ze>=0;--Ze){const Be=Oe[Ze];ot(C.symbolInstances.get(Be),Be,C.collisionArrays[Be])}}else for(let Oe=l.symbolInstanceStart;Oe<l.symbolInstanceEnd;Oe++)ot(C.symbolInstances.get(Oe),Oe,C.collisionArrays[Oe]);if(_&&C.bucketInstanceId in this.collisionCircleArrays){const Oe=this.collisionCircleArrays[C.bucketInstanceId];p.invert(Oe.invProjMatrix,S),Oe.viewportMatrix=this.collisionIndex.getViewportMatrix()}C.justReloaded=!1}markUsedJustification(l,d,_,x){const{leftJustifiedTextSymbolIndex:C,centerJustifiedTextSymbolIndex:D,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:k,crossTileID:N}=_,F=p.getAnchorJustification(d),j=x===p.WritingMode.vertical?k:"left"===F?C:"center"===F?D:"right"===F?S:-1;C>=0&&(l.text.placedSymbolArray.get(C).crossTileID=j>=0&&C!==j?0:N),D>=0&&(l.text.placedSymbolArray.get(D).crossTileID=j>=0&&D!==j?0:N),S>=0&&(l.text.placedSymbolArray.get(S).crossTileID=j>=0&&S!==j?0:N),k>=0&&(l.text.placedSymbolArray.get(k).crossTileID=j>=0&&k!==j?0:N)}markUsedOrientation(l,d,_){const x=d===p.WritingMode.horizontal||d===p.WritingMode.horizontalOnly?d:0,C=d===p.WritingMode.vertical?d:0,{leftJustifiedTextSymbolIndex:D,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:N}=_,F=l.text.placedSymbolArray;D>=0&&(F.get(D).placedOrientation=x),S>=0&&(F.get(S).placedOrientation=x),k>=0&&(F.get(k).placedOrientation=x),N>=0&&(F.get(N).placedOrientation=C)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let _=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const x=d?d.symbolFadeChange(l):1,C=d?d.opacities:{},D=d?d.variableOffsets:{},S=d?d.placedOrientations:{};for(const k in this.placements){const N=this.placements[k],F=C[k];F?(this.opacities[k]=new Pn(F,x,N.text,N.icon,null,N.clipped),_=_||N.text!==F.text.placed||N.icon!==F.icon.placed):(this.opacities[k]=new Pn(null,x,N.text,N.icon,N.skipFade,N.clipped),_=_||N.text||N.icon)}for(const k in C){const N=C[k];if(!this.opacities[k]){const F=new Pn(N,x,!1,!1);F.isHidden()||(this.opacities[k]=F,_=_||N.text.placed||N.icon.placed)}}for(const k in D)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=D[k]);for(const k in S)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=S[k]);_?this.lastPlacementChangeTime=l:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:l)}updateLayerOpacities(l,d){const _=new Set;for(const x of d){const C=x.getBucket(l);C&&x.latestFeatureIndex&&l.id===C.layerIds[0]&&this.updateBucketOpacities(C,_,x.collisionBoxArray)}}updateBucketOpacities(l,d,_){l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const x=l.layers[0].layout,C=!!l.layers[0].dynamicFilter(),D=new Pn(null,0,!1,!1,!0),S=x.get("text-allow-overlap"),k=x.get("icon-allow-overlap"),N=x.get("text-variable-anchor"),F="map"===x.get("text-rotation-alignment"),j="map"===x.get("text-pitch-alignment"),Y="none"!==x.get("icon-text-fit"),ee=new Pn(null,0,S&&(k||!l.hasIconData()||x.get("icon-optional")),k&&(S||!l.hasTextData()||x.get("text-optional")),!0);!l.collisionArrays&&_&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(_);const re=(se,$,Q)=>{for(let ue=0;ue<$/4;ue++)se.opacityVertexArray.emplaceBack(Q)};let ie=0;for(let se=0;se<l.symbolInstances.length;se++){const $=l.symbolInstances.get(se),{numHorizontalGlyphVertices:Q,numVerticalGlyphVertices:ue,crossTileID:de,numIconVertices:be}=$,Me=d.has(de);let we=this.opacities[de];Me?we=D:we||(we=ee,this.opacities[de]=we),d.add(de);const Se=Q>0||ue>0,Ee=be>0,Fe=this.placedOrientations[de],ot=Fe===p.WritingMode.vertical,Oe=Fe===p.WritingMode.horizontal||Fe===p.WritingMode.horizontalOnly;if(!Se&&!Ee||we.isHidden()||ie++,Se){const Ze=zc(we.text);re(l.text,Q,ot?Li:Ze),re(l.text,ue,Oe?Li:Ze);const Be=we.text.isHidden(),{leftJustifiedTextSymbolIndex:it,centerJustifiedTextSymbolIndex:Le,rightJustifiedTextSymbolIndex:Ge,verticalPlacedTextSymbolIndex:tt}=$,Qe=l.text.placedSymbolArray,st=Be||ot?1:0;it>=0&&(Qe.get(it).hidden=st),Le>=0&&(Qe.get(Le).hidden=st),Ge>=0&&(Qe.get(Ge).hidden=st),tt>=0&&(Qe.get(tt).hidden=Be||Oe?1:0);const vt=this.variableOffsets[de];vt&&this.markUsedJustification(l,vt.anchor,$,Fe);const Ht=this.placedOrientations[de];Ht&&(this.markUsedJustification(l,"left",$,Ht),this.markUsedOrientation(l,Ht,$))}if(Ee){const Ze=zc(we.icon),{placedIconSymbolIndex:Be,verticalPlacedIconSymbolIndex:it}=$,Le=l.icon.placedSymbolArray,Ge=we.icon.isHidden()?1:0;Be>=0&&(re(l.icon,be,ot?Li:Ze),Le.get(Be).hidden=Ge),it>=0&&(re(l.icon,$.numVerticalIconVertices,Oe?Li:Ze),Le.get(it).hidden=Ge)}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const Ze=l.collisionArrays[se];if(Ze){let Be=new p.Point(0,0),it=!0;if(Ze.textBox||Ze.verticalTextBox){if(N){const Ge=this.variableOffsets[de];Ge?(Be=Rl(Ge.anchor,Ge.width,Ge.height,Ge.textOffset,Ge.textScale),F&&Be._rotate(j?this.transform.angle:-this.transform.angle)):it=!1}C&&(it=!we.clipped),Ze.textBox&&Zt(l.textCollisionBox.collisionVertexArray,we.text.placed,!it||ot,Be.x,Be.y),Ze.verticalTextBox&&Zt(l.textCollisionBox.collisionVertexArray,we.text.placed,!it||Oe,Be.x,Be.y)}const Le=it&&!(Oe||!Ze.verticalIconBox);Ze.iconBox&&Zt(l.iconCollisionBox.collisionVertexArray,we.icon.placed,Le,Y?Be.x:0,Y?Be.y:0),Ze.verticalIconBox&&Zt(l.iconCollisionBox.collisionVertexArray,we.icon.placed,!Le,Y?Be.x:0,Y?Be.y:0)}}}if(l.fullyClipped=0===ie,l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){const se=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=se.invProjMatrix,l.placementViewportMatrix=se.viewportMatrix,l.collisionCircleArray=se.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return 0===this.fadeDuration?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,d){const _=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*_>l}setStale(){this.stale=!0}}function Zt(g,l,d,_,x){g.emplaceBack(l?1:0,d?1:0,_||0,x||0),g.emplaceBack(l?1:0,d?1:0,_||0,x||0),g.emplaceBack(l?1:0,d?1:0,_||0,x||0),g.emplaceBack(l?1:0,d?1:0,_||0,x||0)}const mn=Math.pow(2,25),Oi=Math.pow(2,24),Jp=Math.pow(2,17),yh=Math.pow(2,16),Ir=Math.pow(2,9),wi=Math.pow(2,8),Im=Math.pow(2,1);function zc(g){if(0===g.opacity&&!g.placed)return 0;if(1===g.opacity&&g.placed)return 4294967295;const l=g.placed?1:0,d=Math.floor(127*g.opacity);return d*mn+l*Oi+d*Jp+l*yh+d*Ir+l*wi+d*Im+l}const Li=0;class Ho{constructor(l){this._sortAcrossTiles="viewport-y"!==l.layout.get("symbol-z-order")&&void 0!==l.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(l,d,_,x,C){const D=this._bucketParts;for(;this._currentTileIndex<l.length;)if(d.getBucketParts(D,x,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,C())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,D.sort((S,k)=>S.sortKey-k.sortKey));this._currentPartIndex<D.length;){const S=D[this._currentPartIndex];if(d.placeLayerBucketPart(S,this._seenCrossTileIDs,_,0===S.symbolInstanceStart),this._currentPartIndex++,C())return!0}return!1}}class Qp{constructor(l,d,_,x,C,D,S,k){this.placement=new $a(l,C,D,S,k),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(l,d,_){const x=p.exported.now(),C=()=>{const D=p.exported.now()-x;return!this._forceFullPlacement&&D>2};for(;this._currentPlacementIndex>=0;){const D=d[l[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if("symbol"===D.type&&(!D.minzoom||D.minzoom<=S)&&(!D.maxzoom||D.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new Ho(D)),this._inProgressLayer.continuePlacement(_[D.source],this.placement,this._showCollisionBoxes,D,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const Fl=512/p.EXTENT/2;class Ar{constructor(l,d,_){this.tileID=l,this.bucketInstanceId=_,this.index=new p.KDBush(d.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const x=l.canonical.x*p.EXTENT,C=l.canonical.y*p.EXTENT;for(let D=0;D<d.length;D++){const{key:S,crossTileID:k,tileAnchorX:N,tileAnchorY:F}=d.get(D),j=Math.floor((x+N)*Fl),Y=Math.floor((C+F)*Fl);this.index.add(j,Y),this.keys.push(S),this.crossTileIDs.push(k)}this.index.finish()}findMatches(l,d,_){const x=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),C=Fl/Math.pow(2,d.canonical.z-this.tileID.canonical.z),D=d.canonical.x*p.EXTENT,S=d.canonical.y*p.EXTENT;for(let k=0;k<l.length;k++){const N=l.get(k);if(N.crossTileID)continue;const{key:F,tileAnchorX:j,tileAnchorY:Y}=N,ee=Math.floor((D+j)*C),re=Math.floor((S+Y)*C),ie=this.index.range(ee-x,re-x,ee+x,re+x);for(const se of ie){const $=this.crossTileIDs[se];if(this.keys[se]===F&&!_.has($)){_.add($),N.crossTileID=$;break}}}}}class ef{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class xh{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const d=Math.round((l-this.lng)/360);if(0!==d)for(const _ in this.indexes){const x=this.indexes[_],C={};for(const D in x){const S=x[D];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+d),C[S.tileID.key]=S}this.indexes[_]=C}this.lng=l}addBucket(l,d,_){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let C=0;C<d.symbolInstances.length;C++)d.symbolInstances.get(C).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]=new Set);const x=this.usedCrossTileIDs[l.overscaledZ];for(const C in this.indexes){const D=this.indexes[C];if(Number(C)>l.overscaledZ)for(const S in D){const k=D[S];k.tileID.isChildOf(l)&&k.findMatches(d.symbolInstances,l,x)}else{const S=D[l.scaledTo(Number(C)).key];S&&S.findMatches(d.symbolInstances,l,x)}}for(let C=0;C<d.symbolInstances.length;C++){const D=d.symbolInstances.get(C);D.crossTileID||(D.crossTileID=_.generate(),x.add(D.crossTileID))}return void 0===this.indexes[l.overscaledZ]&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Ar(l,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(l,d){for(const _ of d.crossTileIDs)this.usedCrossTileIDs[l].delete(_)}removeStaleBuckets(l){let d=!1;for(const _ in this.indexes){const x=this.indexes[_];for(const C in x)l[x[C].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,x[C]),delete x[C],d=!0)}return d}}class ua{constructor(){this.layerIndexes={},this.crossTileIDs=new ef,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,d,_,x){let C=this.layerIndexes[l.id];void 0===C&&(C=this.layerIndexes[l.id]=new xh);let D=!1;const S={};"globe"!==x.name&&C.handleWrapJump(_);for(const k of d){const N=k.getBucket(l);N&&l.id===N.layerIds[0]&&(N.bucketInstanceId||(N.bucketInstanceId=++this.maxBucketInstanceId),C.addBucket(k.tileID,N,this.crossTileIDs)&&(D=!0),S[N.bucketInstanceId]=!0)}return C.removeStaleBuckets(S)&&(D=!0),D}pruneUnusedLayers(l){const d={};l.forEach(_=>{d[_]=!0});for(const _ in this.layerIndexes)d[_]||delete this.layerIndexes[_]}}const da=(g,l)=>p.emitValidationErrors(g,l&&l.filter(d=>"source.canvas"!==d.identifier)),bh=p.pick(Fn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),wo=p.pick(Fn,["setCenter","setZoom","setBearing","setPitch"]),Wt={version:8,layers:[],sources:{}},Bc={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class js extends p.Evented{constructor(l,d={}){super(),this.map=l,this.dispatcher=new xn(Ol(),this),this.imageManager=new Fa,this.imageManager.setEventedParent(this),this.glyphManager=new p.GlyphManager(l._requestManager,d.localFontFamily?p.LocalGlyphMode.all:d.localIdeographFontFamily?p.LocalGlyphMode.ideographs:p.LocalGlyphMode.none,d.localFontFamily||d.localIdeographFontFamily),this.crossTileSymbolIndex=new ua,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());const _=this;this._rtlTextPluginCallback=js.registerForPluginStateChange(x=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(C,D)=>{if(p.triggerPluginCompletionEvent(C),D&&D.every(S=>S))for(const S in _._sourceCaches){const k=_._sourceCaches[S],N=k.getSource().type;"vector"!==N&&"geojson"!==N||k.reload()}})}),this.on("data",x=>{if("source"!==x.dataType||"metadata"!==x.sourceDataType)return;const C=this.getSource(x.sourceId);if(C&&C.vectorLayerIds)for(const D in this._layers){const S=this._layers[D];S.source===C.id&&this._validateLayer(S)}})}loadURL(l,d={}){this.fire(new p.Event("dataloading",{dataType:"style"}));const _="boolean"==typeof d.validate?d.validate:!p.isMapboxURL(l);l=this.map._requestManager.normalizeStyleURL(l,d.accessToken);const x=this.map._requestManager.transformRequest(l,p.ResourceType.Style);this._request=p.getJSON(x,(C,D)=>{this._request=null,C?this.fire(new p.ErrorEvent(C)):D&&this._load(D,_)})}loadJSON(l,d={}){this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.exported.frame(()=>{this._request=null,this._load(l,!1!==d.validate)})}loadEmpty(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(Wt,!1)}_updateLayerCount(l,d){const _=d?1:-1;l.is3D()&&(this._num3DLayers+=_),"circle"===l.type&&(this._numCircleLayers+=_),"symbol"===l.type&&(this._numSymbolLayers+=_)}_load(l,d){if(d&&da(this,p.validateStyle(l)))return;this._loaded=!0,this.stylesheet=p.clone$1(l),this._updateMapProjection();for(const x in l.sources)this.addSource(x,l.sources[x],{validate:!1});this._changed=!1,l.sprite?this._loadSprite(l.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(l.glyphs);const _=ps(this.stylesheet.layers);this._order=_.map(x=>x.id),this._layers={},this._serializedLayers={};for(const x of _){const C=p.createStyleLayer(x);C.setEventedParent(this,{layer:{id:C.id}}),this._layers[C.id]=C,this._serializedLayers[C.id]=C.serialize(),this._updateLayerCount(C,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new gr(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(l){l?this.stylesheet.projection=l:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(l){this._spriteRequest=function(d,_,x){let C,D,S;const k=p.exported.devicePixelRatio>1?"@2x":"";let N=p.getJSON(_.transformRequest(_.normalizeSpriteURL(d,k,".json"),p.ResourceType.SpriteJSON),(Y,ee)=>{N=null,S||(S=Y,C=ee,j())}),F=p.getImage(_.transformRequest(_.normalizeSpriteURL(d,k,".png"),p.ResourceType.SpriteImage),(Y,ee)=>{F=null,S||(S=Y,D=ee,j())});function j(){if(S)x(S);else if(C&&D){const Y=p.exported.getImageData(D),ee={};for(const re in C){const{width:ie,height:se,x:$,y:Q,sdf:ue,pixelRatio:de,stretchX:be,stretchY:Me,content:we}=C[re],Se=new p.RGBAImage({width:ie,height:se});p.RGBAImage.copy(Y,Se,{x:$,y:Q},{x:0,y:0},{width:ie,height:se}),ee[re]={data:Se,pixelRatio:de,sdf:ue,stretchX:be,stretchY:Me,content:we}}x(null,ee)}}return{cancel(){N&&(N.cancel(),N=null),F&&(F.cancel(),F=null)}}}(l,this.map._requestManager,(d,_)=>{if(this._spriteRequest=null,d)this.fire(new p.ErrorEvent(d));else if(_)for(const x in _)this.imageManager.addImage(x,_[x]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new p.Event("data",{dataType:"style"}))})}_validateLayer(l){const d=this.getSource(l.source);if(!d)return;const _=l.sourceLayer;_&&("geojson"===d.type||d.vectorLayerIds&&-1===d.vectorLayerIds.indexOf(_))&&this.fire(new p.ErrorEvent(new Error(`Source layer "${_}" does not exist on source "${d.id}" as specified by style layer "${l.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const l in this._sourceCaches)if(!this._sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(l){const d=[];for(const _ of l){const x=this._layers[_];"custom"!==x.type&&d.push(x.serialize())}return d}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const l in this._sourceCaches)if(this._sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(l){return!!this.terrain&&("function"==typeof l.isLayerDraped?l.isLayerDraped():Bc[l.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(l){if(!this._loaded)return;const d=this._changed;if(this._changed){const x=Object.keys(this._updatedLayers),C=Object.keys(this._removedLayers);(x.length||C.length)&&this._updateWorkerLayers(x,C);for(const D in this._updatedSources){const S=this._updatedSources[D];"reload"===S?this._reloadSource(D):"clear"===S&&this._clearSource(D)}this._updateTilesForChangedImages();for(const D in this._updatedPaintProps)this._layers[D].updateTransitions(l);this.light.updateTransitions(l),this.fog&&this.fog.updateTransitions(l),this._resetUpdates()}const _={};for(const x in this._sourceCaches){const C=this._sourceCaches[x];_[x]=C.used,C.used=!1}for(const x of this._order){const C=this._layers[x];if(C.recalculate(l,this._availableImages),!C.isHidden(l.zoom)){const S=this._getLayerSourceCache(C);S&&(S.used=!0)}const D=this.map.painter;if(D){const S=C.getProgramIds();if(!S)continue;const k=C.getProgramConfiguration(l.zoom);for(const N of S)D.useProgram(N,k)}}for(const x in _){const C=this._sourceCaches[x];_[x]!==C.used&&C.getSource().fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:C.getSource().id}))}this.light.recalculate(l),this.terrain&&this.terrain.recalculate(l),this.fog&&this.fog.recalculate(l),this.z=l.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),d&&this.fire(new p.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=Object.keys(this._changedImages);if(l.length){for(const d in this._sourceCaches)this._sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}}_updateWorkerLayers(l,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(l),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(l){if(this._checkLoaded(),da(this,p.validateStyle(l)))return!1;(l=p.clone$1(l)).layers=ps(l.layers);const d=function(x,C){if(!x)return[{command:Fn.setStyle,args:[C]}];let D=[];try{if(!Je(x.version,C.version))return[{command:Fn.setStyle,args:[C]}];Je(x.center,C.center)||D.push({command:Fn.setCenter,args:[C.center]}),Je(x.zoom,C.zoom)||D.push({command:Fn.setZoom,args:[C.zoom]}),Je(x.bearing,C.bearing)||D.push({command:Fn.setBearing,args:[C.bearing]}),Je(x.pitch,C.pitch)||D.push({command:Fn.setPitch,args:[C.pitch]}),Je(x.sprite,C.sprite)||D.push({command:Fn.setSprite,args:[C.sprite]}),Je(x.glyphs,C.glyphs)||D.push({command:Fn.setGlyphs,args:[C.glyphs]}),Je(x.transition,C.transition)||D.push({command:Fn.setTransition,args:[C.transition]}),Je(x.light,C.light)||D.push({command:Fn.setLight,args:[C.light]}),Je(x.fog,C.fog)||D.push({command:Fn.setFog,args:[C.fog]}),Je(x.projection,C.projection)||D.push({command:Fn.setProjection,args:[C.projection]});const S={},k=[];!function(j,Y,ee,re){let ie;for(ie in Y=Y||{},j=j||{})j.hasOwnProperty(ie)&&(Y.hasOwnProperty(ie)||fs(ie,ee,re));for(ie in Y){if(!Y.hasOwnProperty(ie))continue;const se=Y[ie];j.hasOwnProperty(ie)?Je(j[ie],se)||("geojson"===j[ie].type&&"geojson"===se.type&&_h(j,Y,ie)?ee.push({command:Fn.setGeoJSONSourceData,args:[ie,se.data]}):bo(ie,Y,ee,re)):Ji(ie,Y,ee)}}(x.sources,C.sources,k,S);const N=[];x.layers&&x.layers.forEach(j=>{j.source&&S[j.source]?D.push({command:Fn.removeLayer,args:[j.id]}):N.push(j)});let F=x.terrain;F&&S[F.source]&&(D.push({command:Fn.setTerrain,args:[void 0]}),F=void 0),D=D.concat(k),Je(F,C.terrain)||D.push({command:Fn.setTerrain,args:[C.terrain]}),function(j,Y,ee){Y=Y||[];const re=(j=j||[]).map(ms),ie=Y.map(ms),se=j.reduce(Fc,{}),$=Y.reduce(Fc,{}),Q=re.slice(),ue=Object.create(null);let de,be,Me,we,Se,Ee,Fe;for(de=0,be=0;de<re.length;de++)Me=re[de],$.hasOwnProperty(Me)?be++:(ee.push({command:Fn.removeLayer,args:[Me]}),Q.splice(Q.indexOf(Me,be),1));for(de=0,be=0;de<ie.length;de++)Me=ie[ie.length-1-de],Q[Q.length-1-de]!==Me&&(se.hasOwnProperty(Me)?(ee.push({command:Fn.removeLayer,args:[Me]}),Q.splice(Q.lastIndexOf(Me,Q.length-be),1)):be++,Ee=Q[Q.length-de],ee.push({command:Fn.addLayer,args:[$[Me],Ee]}),Q.splice(Q.length-de,0,Me),ue[Me]=!0);for(de=0;de<ie.length;de++)if(Me=ie[de],we=se[Me],Se=$[Me],!ue[Me]&&!Je(we,Se))if(Je(we.source,Se.source)&&Je(we["source-layer"],Se["source-layer"])&&Je(we.type,Se.type)){for(Fe in gs(we.layout,Se.layout,ee,Me,null,Fn.setLayoutProperty),gs(we.paint,Se.paint,ee,Me,null,Fn.setPaintProperty),Je(we.filter,Se.filter)||ee.push({command:Fn.setFilter,args:[Me,Se.filter]}),Je(we.minzoom,Se.minzoom)&&Je(we.maxzoom,Se.maxzoom)||ee.push({command:Fn.setLayerZoomRange,args:[Me,Se.minzoom,Se.maxzoom]}),we)we.hasOwnProperty(Fe)&&"layout"!==Fe&&"paint"!==Fe&&"filter"!==Fe&&"metadata"!==Fe&&"minzoom"!==Fe&&"maxzoom"!==Fe&&(0===Fe.indexOf("paint.")?gs(we[Fe],Se[Fe],ee,Me,Fe.slice(6),Fn.setPaintProperty):Je(we[Fe],Se[Fe])||ee.push({command:Fn.setLayerProperty,args:[Me,Fe,Se[Fe]]}));for(Fe in Se)Se.hasOwnProperty(Fe)&&!we.hasOwnProperty(Fe)&&"layout"!==Fe&&"paint"!==Fe&&"filter"!==Fe&&"metadata"!==Fe&&"minzoom"!==Fe&&"maxzoom"!==Fe&&(0===Fe.indexOf("paint.")?gs(we[Fe],Se[Fe],ee,Me,Fe.slice(6),Fn.setPaintProperty):Je(we[Fe],Se[Fe])||ee.push({command:Fn.setLayerProperty,args:[Me,Fe,Se[Fe]]}))}else ee.push({command:Fn.removeLayer,args:[Me]}),Ee=Q[Q.lastIndexOf(Me)+1],ee.push({command:Fn.addLayer,args:[Se,Ee]})}(N,C.layers,D)}catch(S){console.warn("Unable to compute style diff:",S),D=[{command:Fn.setStyle,args:[C]}]}return D}(this.serialize(),l).filter(x=>!(x.command in wo));if(0===d.length)return!1;const _=d.filter(x=>!(x.command in bh));if(_.length>0)throw new Error(`Unimplemented: ${_.map(x=>x.command).join(", ")}.`);return d.forEach(x=>{"setTransition"!==x.command&&"setProjection"!==x.command&&this[x.command].apply(this,x.args)}),this.stylesheet=l,this._updateMapProjection(),!0}addImage(l,d){return this.getImage(l)?this.fire(new p.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(l,d),this._afterImageUpdated(l),this)}updateImage(l,d){this.imageManager.updateImage(l,d)}getImage(l){return this.imageManager.getImage(l)}removeImage(l){return this.getImage(l)?(this.imageManager.removeImage(l),this._afterImageUpdated(l),this):this.fire(new p.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(l,d,_={}){if(this._checkLoaded(),void 0!==this.getSource(l))throw new Error("There is already a source with this ID");if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(p.validateSource,`sources.${l}`,d,null,_))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const x=ln(l,d,this.dispatcher,this);x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(l),source:x.serialize(),sourceId:l}));const C=D=>{const S=(D?"symbol:":"other:")+l,k=this._sourceCaches[S]=new p.SourceCache(S,x,D);(D?this._symbolSourceCaches:this._otherSourceCaches)[l]=k,k.style=this,k.onAdd(this.map)};C(!1),"vector"!==d.type&&"geojson"!==d.type||C(!0),x.onAdd&&x.onAdd(this.map),this._changed=!0}removeSource(l){this._checkLoaded();const d=this.getSource(l);if(!d)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===l)return this.fire(new p.ErrorEvent(new Error(`Source "${l}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.get().source===l)return this.fire(new p.ErrorEvent(new Error(`Source "${l}" cannot be removed while terrain is using it.`)));const _=this._getSourceCaches(l);for(const x of _)delete this._sourceCaches[x.id],delete this._updatedSources[x.id],x.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles();return delete this._otherSourceCaches[l],delete this._symbolSourceCaches[l],d.setEventedParent(null),d.onRemove&&d.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(l,d){this._checkLoaded(),this.getSource(l).setData(d),this._changed=!0}getSource(l){const d=this._getSourceCache(l);return d&&d.getSource()}_getSources(){const l=[];for(const d in this._otherSourceCaches){const _=this._getSourceCache(d);_&&l.push(_.getSource())}return l}addLayer(l,d,_={}){this._checkLoaded();const x=l.id;if(this.getLayer(x))return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${x}" already exists on this map`)));let C;if("custom"===l.type){if(da(this,p.validateCustomStyleLayer(l)))return;C=p.createStyleLayer(l)}else{if("object"==typeof l.source&&(this.addSource(x,l.source),l=p.clone$1(l),l=p.extend(l,{source:x})),this._validate(p.validateLayer,`layers.${x}`,l,{arrayIndex:-1},_))return;C=p.createStyleLayer(l),this._validateLayer(C),C.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[C.id]=C.serialize(),this._updateLayerCount(C,!0)}const D=d?this._order.indexOf(d):this._order.length;if(d&&-1===D)return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${d}" does not exist on this map.`)));this._order.splice(D,0,x),this._layerOrderChanged=!0,this._layers[x]=C;const S=this._getLayerSourceCache(C);if(this._removedLayers[x]&&C.source&&S&&"custom"!==C.type){const k=this._removedLayers[x];delete this._removedLayers[x],k.type!==C.type?this._updatedSources[C.source]="clear":(this._updatedSources[C.source]="reload",S.pause())}this._updateLayer(C),C.onAdd&&C.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(l,d){if(this._checkLoaded(),this._changed=!0,!this._layers[l])return void this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be moved.`)));if(l===d)return;const _=this._order.indexOf(l);this._order.splice(_,1);const x=d?this._order.indexOf(d):this._order.length;d&&-1===x?this.fire(new p.ErrorEvent(new Error(`Layer with id "${d}" does not exist on this map.`))):(this._order.splice(x,0,l),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(l){this._checkLoaded();const d=this._layers[l];if(!d)return void this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be removed.`)));d.setEventedParent(null),this._updateLayerCount(d,!1);const _=this._order.indexOf(l);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=d,delete this._layers[l],delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],d.onRemove&&d.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(l){return this._layers[l]}hasLayer(l){return l in this._layers}hasLayerType(l){for(const d in this._layers)if(this._layers[d].type===l)return!0;return!1}setLayerZoomRange(l,d,_){this._checkLoaded();const x=this.getLayer(l);x?x.minzoom===d&&x.maxzoom===_||(null!=d&&(x.minzoom=d),null!=_&&(x.maxzoom=_),this._updateLayer(x)):this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(l,d,_={}){this._checkLoaded();const x=this.getLayer(l);if(x){if(!Je(x.filter,d))return null==d?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(p.validateFilter,`layers.${x.id}.filter`,d,{layerType:x.type},_)||(x.filter=p.clone$1(d),this._updateLayer(x)))}else this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be filtered.`)))}getFilter(l){const d=this.getLayer(l);return d&&p.clone$1(d.filter)}setLayoutProperty(l,d,_,x={}){this._checkLoaded();const C=this.getLayer(l);C?Je(C.getLayoutProperty(d),_)||(C.setLayoutProperty(d,_,x),this._updateLayer(C)):this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(l,d){const _=this.getLayer(l);if(_)return _.getLayoutProperty(d);this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style.`)))}setPaintProperty(l,d,_,x={}){this._checkLoaded();const C=this.getLayer(l);C?Je(C.getPaintProperty(d),_)||(C.setPaintProperty(d,_,x)&&this._updateLayer(C),this._changed=!0,this._updatedPaintProps[l]=!0):this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(l,d){const _=this.getLayer(l);return _&&_.getPaintProperty(d)}setFeatureState(l,d){this._checkLoaded();const _=l.source,x=l.sourceLayer,C=this.getSource(_);if(!C)return void this.fire(new p.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const D=C.type;if("geojson"===D&&x)return void this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===D&&!x)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===l.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided.")));const S=this._getSourceCaches(_);for(const k of S)k.setFeatureState(x,l.id,d)}removeFeatureState(l,d){this._checkLoaded();const _=l.source,x=this.getSource(_);if(!x)return void this.fire(new p.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const C=x.type,D="vector"===C?l.sourceLayer:void 0;if("vector"===C&&!D)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(d&&"string"!=typeof l.id&&"number"!=typeof l.id)return void this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const S=this._getSourceCaches(_);for(const k of S)k.removeFeatureState(D,l.id,d)}getFeatureState(l){this._checkLoaded();const d=l.source,_=l.sourceLayer,x=this.getSource(d);if(x){if("vector"!==x.type||_)return void 0===l.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(d)[0].getFeatureState(_,l.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const l={};for(const d in this._sourceCaches){const _=this._sourceCaches[d].getSource();l[_.id]||(l[_.id]=_.serialize())}return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:l,layers:this._serializeLayers(this._order)},d=>void 0!==d)}_updateLayer(l){this._updatedLayers[l.id]=!0;const d=this._getLayerSourceCache(l);l.source&&!this._updatedSources[l.source]&&d&&"raster"!==d.getSource().type&&(this._updatedSources[l.source]="reload",d.pause()),this._changed=!0,l.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(l){const d=D=>"fill-extrusion"===this._layers[D].type,_={},x=[];for(let D=this._order.length-1;D>=0;D--){const S=this._order[D];if(d(S)){_[S]=D;for(const k of l){const N=k[S];if(N)for(const F of N)x.push(F)}}}x.sort((D,S)=>S.intersectionZ-D.intersectionZ);const C=[];for(let D=this._order.length-1;D>=0;D--){const S=this._order[D];if(d(S))for(let k=x.length-1;k>=0;k--){const N=x[k].feature;if(_[N.layer.id]<D)break;C.push(N),x.pop()}else for(const k of l){const N=k[S];if(N)for(const F of N)C.push(F.feature)}}return C}queryRenderedFeatures(l,d,_){d&&d.filter&&this._validate(p.validateFilter,"queryRenderedFeatures.filter",d.filter,null,d);const x={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const k of d.layers){const N=this._layers[k];if(!N)return this.fire(new p.ErrorEvent(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];x[N.source]=!0}}const C=[];d.availableImages=this._availableImages;const D=d&&d.layers?d.layers.some(k=>{const N=this.getLayer(k);return N&&N.is3D()}):this.has3DLayers(),S=sa.createFromScreenPoints(l,_);for(const k in this._sourceCaches){const N=this._sourceCaches[k].getSource().id;d.layers&&!x[N]||C.push(di(this._sourceCaches[k],this._layers,this._serializedLayers,S,d,_,D,!!this.map._showQueryGeometry))}return this.placement&&C.push(function(k,N,F,j,Y,ee,re){const ie={},se=ee.queryRenderedSymbols(j),$=[];for(const Q of Object.keys(se).map(Number))$.push(re[Q]);$.sort(Dr);for(const Q of $){const ue=Q.featureIndex.lookupSymbolFeatures(se[Q.bucketInstanceId],N,Q.bucketIndex,Q.sourceLayerIndex,Y.filter,Y.layers,Y.availableImages,k);for(const de in ue){const be=ie[de]=ie[de]||[],Me=ue[de];Me.sort((we,Se)=>{const Ee=Q.featureSortOrder;if(Ee){const Fe=Ee.indexOf(we.featureIndex);return Ee.indexOf(Se.featureIndex)-Fe}return Se.featureIndex-we.featureIndex});for(const we of Me)be.push(we)}}for(const Q in ie)ie[Q].forEach(ue=>{const de=ue.feature,be=F(k[Q]);if(!be)return;const Me=be.getFeatureState(de.layer["source-layer"],de.id);de.source=de.layer.source,de.layer["source-layer"]&&(de.sourceLayer=de.layer["source-layer"]),de.state=Me});return ie}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),S.screenGeometry,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(C)}querySourceFeatures(l,d){d&&d.filter&&this._validate(p.validateFilter,"querySourceFeatures.filter",d.filter,null,d);const _=this._getSourceCaches(l);let x=[];for(const C of _)x=x.concat(An(C,d));return x}addSourceType(l,d,_){return js.getSourceType(l)?_(new Error(`A source type called "${l}" already exists.`)):(js.setSourceType(l,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:l,url:d.workerSourceURL},_):_(null,null))}getLight(){return this.light.getLight()}setLight(l,d={}){this._checkLoaded();const _=this.light.getLight();let x=!1;for(const D in l)if(!Je(l[D],_[D])){x=!0;break}if(!x)return;const C=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(l,d),this.light.updateTransitions(C)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(l,d=1){if(this._checkLoaded(),!l)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let _=l;if(1===d){if("object"==typeof _.source){const x="terrain-dem-src";this.addSource(x,_.source),_=p.clone$1(_),_=p.extend(_,{source:x})}if(this._validate(p.validateTerrain,"terrain",_))return}if(!this.terrain||this.terrain&&d!==this.terrain.drapeRenderMode){if(!_)return;this._createTerrain(_,d)}else{const x=this.terrain,C=x.get();for(const D of Object.keys(p.spec.terrain))!_.hasOwnProperty(D)&&p.spec.terrain[D].default&&(_[D]=p.spec.terrain[D].default);for(const D in _)if(!Je(_[D],C[D])){x.set(_),this.stylesheet.terrain=_;const S=this._setTransitionParameters({duration:0});x.updateTransitions(S);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(l){const d=this.fog=new za(l,this.map.transform);this.stylesheet.fog=l;const _=this._setTransitionParameters({duration:0});d.updateTransitions(_)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const l of this.map._markers)l._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(l){if(this._checkLoaded(),!l)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const d=this.fog,_=d.get();0===Object.keys(l).length&&d.set(l);for(const x in l)if(!Je(l[x],_[x])){d.set(l),this.stylesheet.fog=l;const C=this._setTransitionParameters({duration:0});d.updateTransitions(C);break}}else this._createFog(l);this._markersNeedUpdate=!0}_setTransitionParameters(l){return{now:p.exported.now(),transition:p.extend(l,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const l=this._order.filter(_=>this.isLayerDraped(this._layers[_])),d=this._order.filter(_=>!this.isLayerDraped(this._layers[_]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...l),this._drapedFirstOrder.push(...d)}_createTerrain(l,d){const _=this.terrain=new ju(l,d);this.stylesheet.terrain=l,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const x=this._setTransitionParameters({duration:0});_.updateTransitions(x)}_force3DLayerUpdate(){for(const l in this._layers){const d=this._layers[l];"fill-extrusion"===d.type&&this._updateLayer(d)}}_forceSymbolLayerUpdate(){for(const l in this._layers){const d=this._layers[l];"symbol"===d.type&&this._updateLayer(d)}}_validate(l,d,_,x,C={}){return(!C||!1!==C.validate)&&da(this,l.call(p.validateStyle,p.extend({key:d,style:this.serialize(),value:_,styleSpec:p.spec},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const l in this._layers)this._layers[l].setEventedParent(null);for(const l in this._sourceCaches)this._sourceCaches[l].clearTiles(),this._sourceCaches[l].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(l){const d=this._getSourceCaches(l);for(const _ of d)_.clearTiles()}_reloadSource(l){const d=this._getSourceCaches(l);for(const _ of d)_.resume(),_.reload()}_reloadSources(){for(const l of this._getSources())l.reload&&l.reload()}_updateSources(l){for(const d in this._sourceCaches)this._sourceCaches[d].update(l)}_generateCollisionBoxes(){for(const l in this._sourceCaches){const d=this._sourceCaches[l];d.resume(),d.reload()}}_updatePlacement(l,d,_,x,C=!1){let D=!1,S=!1;const k={};for(const N of this._order){const F=this._layers[N];if("symbol"!==F.type)continue;if(!k[F.source]){const Y=this._getLayerSourceCache(F);if(!Y)continue;k[F.source]=Y.getRenderableIds(!0).map(ee=>Y.getTileByID(ee)).sort((ee,re)=>re.tileID.overscaledZ-ee.tileID.overscaledZ||(ee.tileID.isLessThan(re.tileID)?-1:1))}const j=this.crossTileSymbolIndex.addLayer(F,k[F.source],l.center.lng,l.projection);D=D||j}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),C=C||this._layerOrderChanged||0===_,this._layerOrderChanged&&this.fire(new p.Event("neworder")),(C||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.exported.now(),l.zoom))&&(this.pauseablePlacement=new Qp(l,this._order,C,d,_,x,this.placement,this.fog&&l.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.exported.now()),S=!0),D&&this.pauseablePlacement.placement.setStale()),S||D)for(const N of this._order){const F=this._layers[N];"symbol"===F.type&&this.placement.updateLayerOpacities(F,k[F.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.exported.now())}_releaseSymbolFadeTiles(){for(const l in this._sourceCaches)this._sourceCaches[l].releaseSymbolFadeTiles()}getImages(l,d,_){this.imageManager.getImages(d.icons,_),this._updateTilesForChangedImages();const x=C=>{C&&C.setDependencies(d.tileID.key,d.type,d.icons)};x(this._otherSourceCaches[d.source]),x(this._symbolSourceCaches[d.source])}getGlyphs(l,d,_){this.glyphManager.getGlyphs(d.stacks,_)}getResource(l,d,_){return p.makeRequest(d,_)}_getSourceCache(l){return this._otherSourceCaches[l]}_getLayerSourceCache(l){return"symbol"===l.type?this._symbolSourceCaches[l.source]:this._otherSourceCaches[l.source]}_getSourceCaches(l){const d=[];return this._otherSourceCaches[l]&&d.push(this._otherSourceCaches[l]),this._symbolSourceCaches[l]&&d.push(this._symbolSourceCaches[l]),d}_isSourceCacheLoaded(l){const d=this._getSourceCaches(l);return 0===d.length?(this.fire(new p.ErrorEvent(new Error(`There is no source with ID '${l}'`))),!1):d.every(_=>_.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}js.getSourceType=function(g){return Kt[g]},js.setSourceType=function(g,l){Kt[g]=l},js.registerForPluginStateChange=p.registerForPluginStateChange;var tf="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",Lt="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ha="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",lr="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Co="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let Xu={},Ha={};const Vc=[];Nl(tf,Vc),Nl(ha,Vc),Nl(lr,Vc),Nl(Co,Vc),Xu=kt("",ha),Ha=kt(Co,lr);const Uc=kt("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Ga=tf,jc="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var Yu={background:kt("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:kt("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:kt("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:kt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:kt("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:kt("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:kt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:kt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:kt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:kt("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:kt("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:kt("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:kt("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:kt("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:kt("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:kt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:kt("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:kt("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:kt("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:kt("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:kt("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:kt("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:kt("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:kt("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:kt("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:kt("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Lt),skyboxGradient:kt("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Lt),skyboxCapture:kt("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:kt("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:kt("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function Nl(g,l){const d=g.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let _ of d)if(_=_.trim(),"#"===_[0]&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=_.split(" ");for(const C of x)l.includes(C)||l.push(C)}}function kt(g,l){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=l.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),x={},C=[...Vc];return Nl(g,C),Nl(l,C),{fragmentSource:g=g.replace(d,(D,S,k,N,F)=>(x[F]=!0,"define"===S?`\n#ifndef HAS_UNIFORM_u_${F}\nvarying ${k} ${N} ${F};\n#else\nuniform ${k} ${N} u_${F};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${F}\n    ${k} ${N} ${F} = u_${F};\n#endif\n`)),vertexSource:l=l.replace(d,(D,S,k,N,F)=>{const j="float"===N?"vec2":"vec4",Y=F.match(/color/)?"color":j;return x[F]?"define"===S?`\n#ifndef HAS_UNIFORM_u_${F}\nuniform lowp float u_${F}_t;\nattribute ${k} ${j} a_${F};\nvarying ${k} ${N} ${F};\n#else\nuniform ${k} ${N} u_${F};\n#endif\n`:"vec4"===Y?`\n#ifndef HAS_UNIFORM_u_${F}\n    ${F} = a_${F};\n#else\n    ${k} ${N} ${F} = u_${F};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${F}\n    ${F} = unpack_mix_${Y}(a_${F}, u_${F}_t);\n#else\n    ${k} ${N} ${F} = u_${F};\n#endif\n`:"define"===S?`\n#ifndef HAS_UNIFORM_u_${F}\nuniform lowp float u_${F}_t;\nattribute ${k} ${j} a_${F};\n#else\nuniform ${k} ${N} u_${F};\n#endif\n`:"vec4"===Y?`\n#ifndef HAS_UNIFORM_u_${F}\n    ${k} ${N} ${F} = a_${F};\n#else\n    ${k} ${N} ${F} = u_${F};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${F}\n    ${k} ${N} ${F} = unpack_mix_${Y}(a_${F}, u_${F}_t);\n#else\n    ${k} ${N} ${F} = u_${F};\n#endif\n`}),staticAttributes:_,usedDefines:C}}class wh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(l,d,_,x,C,D,S){this.context=l;let k=this.boundPaintVertexBuffers.length!==x.length;for(let F=0;!k&&F<x.length;F++)this.boundPaintVertexBuffers[F]!==x[F]&&(k=!0);let N=this.boundDynamicVertexBuffers.length!==S.length;for(let F=0;!N&&F<S.length;F++)this.boundDynamicVertexBuffers[F]!==S[F]&&(N=!0);if(!l.extVertexArrayObject||!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==_||k||N||this.boundIndexBuffer!==C||this.boundVertexOffset!==D)this.freshBind(d,_,x,C,D,S);else{l.bindVertexArrayOES.set(this.vao);for(const F of S)F&&F.bind();C&&C.dynamicDraw&&C.bind()}}freshBind(l,d,_,x,C,D){let S;const k=l.numAttributes,N=this.context,F=N.gl;if(N.extVertexArrayObject)this.vao&&this.destroy(),this.vao=N.extVertexArrayObject.createVertexArrayOES(),N.bindVertexArrayOES.set(this.vao),S=0,this.boundProgram=l,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=x,this.boundVertexOffset=C,this.boundDynamicVertexBuffers=D;else{S=N.currentNumAttributes||0;for(let j=k;j<S;j++)F.disableVertexAttribArray(j)}d.enableAttributes(F,l),d.bind(),d.setVertexAttribPointers(F,l,C);for(const j of _)j.enableAttributes(F,l),j.bind(),j.setVertexAttribPointers(F,l,C);for(const j of D)j&&(j.enableAttributes(F,l),j.bind(),j.setVertexAttribPointers(F,l,C));x&&x.bind(),N.currentNumAttributes=k}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Ku(g,l){const d=Math.pow(2,l.canonical.z),_=l.canonical.y;return[new p.MercatorCoordinate(0,_/d).toLngLat().lat,new p.MercatorCoordinate(0,(_+1)/d).toLngLat().lat]}function Ur(g,l,d,_,x,C,D){const S=g.context,k=S.gl,N=d.fbo;if(!N)return;g.prepareDrawTile();const F=g.useProgram("hillshade");S.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,N.colorAttachment.get());const j=((ie,se,$,Q)=>{const ue=$.paint.get("hillshade-shadow-color"),de=$.paint.get("hillshade-highlight-color"),be=$.paint.get("hillshade-accent-color");let Me=$.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===$.paint.get("hillshade-illumination-anchor")&&(Me-=ie.transform.angle);const we=!ie.options.moving;return{u_matrix:Q||ie.transform.calculateProjMatrix(se.tileID.toUnwrapped(),we),u_image:0,u_latrange:Ku(0,se.tileID),u_light:[$.paint.get("hillshade-exaggeration"),Me],u_shadow:ue,u_highlight:de,u_accent:be}})(g,d,_,g.terrain?l.projMatrix:null);g.prepareDrawProgram(S,F,l.toUnwrapped());const{tileBoundsBuffer:Y,tileBoundsIndexBuffer:ee,tileBoundsSegments:re}=g.getTileBoundsBuffers(d);F.draw(S,k.TRIANGLES,x,C,D,p.CullFaceMode.disabled,j,_.id,Y,ee,re)}function Ju(g,l,d){if(!l.needsDEMTextureUpload)return;const _=g.context,x=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||g.getTileTexture(d.stride);const C=d.getPixels();l.demTexture?l.demTexture.update(C,{premultiply:!1}):l.demTexture=new p.Texture(_,C,x.RGBA,{premultiply:!1}),l.needsDEMTextureUpload=!1}function Am(g,l,d,_,x,C){const D=g.context,S=D.gl;if(!l.dem)return;const k=l.dem;if(D.activeTexture.set(S.TEXTURE1),Ju(g,l,k),!l.demTexture)return;l.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);const N=k.dim;D.activeTexture.set(S.TEXTURE0);let F=l.fbo;if(!F){const re=new p.Texture(D,{width:N,height:N,data:null},S.RGBA);re.bind(S.LINEAR,S.CLAMP_TO_EDGE),F=l.fbo=D.createFramebuffer(N,N,!0),F.colorAttachment.set(re.texture)}D.bindFramebuffer.set(F.framebuffer),D.viewport.set([0,0,N,N]);const{tileBoundsBuffer:j,tileBoundsIndexBuffer:Y,tileBoundsSegments:ee}=g.getMercatorTileBoundsBuffers();g.useProgram("hillshadePrepare").draw(D,S.TRIANGLES,_,x,C,p.CullFaceMode.disabled,((re,ie)=>{const se=ie.stride,$=p.create();return p.ortho($,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate($,$,[0,-p.EXTENT,0]),{u_matrix:$,u_image:1,u_dimension:[se,se],u_zoom:re.overscaledZ,u_unpack:ie.unpackVector}})(l.tileID,k),d.id,j,Y,ee),l.needsHillshadePrepare=!1}const Kn=g=>({u_matrix:new p.UniformMatrix4f(g),u_image0:new p.Uniform1i(g),u_skirt_height:new p.Uniform1f(g)}),$c=(g,l)=>({u_matrix:g,u_image0:0,u_skirt_height:l}),Ch=(g,l,d,_,x,C,D,S,k,N,F,j,Y,ee,re)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:l,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:d,u_zoom_transition:x,u_merc_center:C,u_image0:0,u_frustum_tl:D,u_frustum_tr:S,u_frustum_br:k,u_frustum_bl:N,u_globe_pos:F,u_globe_radius:j,u_viewport:Y,u_grid_matrix:re?Float32Array.from(re):new Float32Array(9),u_skirt_height:ee});function pa(g,l){return null!=g&&null!=l&&!(!g.hasData()||!l.hasData())&&null!=g.demTexture&&null!=l.demTexture&&g.tileID.key!==l.tileID.key}const Go=new class{constructor(){this.operations={}}newMorphing(g,l,d,_,x){if(g in this.operations){const C=this.operations[g];C.to.tileID.key!==d.tileID.key&&(C.queued=d)}else this.operations[g]={startTime:_,phase:0,duration:x,from:l,to:d,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const l=this.operations[g];return{from:l.from,to:l.to,phase:l.phase}}update(g){for(const l in this.operations){const d=this.operations[l];for(d.phase=(g-d.startTime)/d.duration;d.phase>=1||!this._validOp(d);)if(!this._nextOp(d,g)){delete this.operations[l];break}}}_nextOp(g,l){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=l,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},fa={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function zl(g){return 6*Math.pow(1.5,22-g)}function nf(g,l){const d=1<<g.z;return!l&&(0===g.x||g.x===d-1)||0===g.y||g.y===d-1}const qa=g=>({u_matrix:g});function rf(g,l,d,_,x){if(x>0){const C=p.exported.now(),D=(C-g.timeAdded)/x,S=l?(C-l.timeAdded)/x:-1,k=d.getSource(),N=_.coveringZoomLevel({tileSize:k.tileSize,roundZoom:k.roundZoom}),F=!l||Math.abs(l.tileID.overscaledZ-N)>Math.abs(g.tileID.overscaledZ-N),j=F&&g.refreshedUponExpiration?1:p.clamp(F?D:1-S,0,1);return g.refreshedUponExpiration&&D>=1&&(g.refreshedUponExpiration=!1),l?{opacity:1,mix:1-j}:{opacity:j,mix:0}}return{opacity:1,mix:0}}class sf extends p.SourceCache{constructor(l){const d={type:"raster-dem",maxzoom:l.transform.maxZoom},_=new xn(Ol(),null),x=ln("mock-dem",d,_,l.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(l,d){l.state="loaded",d(null)}}class Mh extends p.SourceCache{constructor(l){const d=ln("proxy",{type:"geojson",maxzoom:l.transform.maxZoom},new xn(Ol(),null),l.style);super("proxy",d,!1),d.setEventedParent(this),this.map=this.getSource().map=l,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(l,d,_){if(l.freezeTileCoverage)return;this.transform=l;const x=l.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((C,D)=>{if(C[D.key]="",!this._tiles[D.key]){const S=new p.Tile(D,this._source.tileSize*D.overscaleFactor(),l.tileZoom);S.state="loaded",this._tiles[D.key]=S}return C},{});for(const C in this._tiles)C in x||(this.freeFBO(C),this._tiles[C].unloadVectorData(),delete this._tiles[C])}freeFBO(l){const d=this.proxyCachedFBO[l];if(void 0!==d){const _=Object.values(d);this.renderCachePool.push(..._),delete this.proxyCachedFBO[l]}}deallocRenderCache(){this.renderCache.forEach(l=>l.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Eh extends p.OverscaledTileID{constructor(l,d,_){super(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y),this.proxyTileKey=d,this.projMatrix=_}}class af extends p.Elevation{constructor(l,d){super(),this.painter=l,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,x,C]=function(k){const N=new p.StructArrayLayout2i4,F=new p.StructArrayLayout3ui6,j=131;N.reserve(17161),F.reserve(33800);const Y=p.EXTENT/128,ee=p.EXTENT+Y/2,re=ee+Y;for(let se=-Y;se<re;se+=Y)for(let $=-Y;$<re;$+=Y){const Q=$<0||$>ee||se<0||se>ee?24575:0,ue=p.clamp(Math.round($),0,p.EXTENT),de=p.clamp(Math.round(se),0,p.EXTENT);N.emplaceBack(ue+Q,de)}const ie=(se,$)=>{const Q=$*j+se;F.emplaceBack(Q+1,Q,Q+j),F.emplaceBack(Q+j,Q+j+1,Q+1)};for(let se=1;se<129;se++)for(let $=1;$<129;$++)ie($,se);return[0,129].forEach(se=>{for(let $=0;$<130;$++)ie($,se),ie(se,$)}),[N,F,32768]}(),D=l.context;this.gridBuffer=D.createVertexBuffer(_,p.posAttributes.members),this.gridIndexBuffer=D.createIndexBuffer(x),this.gridSegments=p.SegmentVector.simpleSegment(0,0,_.length,x.length),this.gridNoSkirtSegments=p.SegmentVector.simpleSegment(0,0,_.length,C),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Mh(d.map),this.orthoMatrix=p.create(),p.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,p.EXTENT,0,p.EXTENT,0,1);const S=D.gl;this._overlapStencilMode=new p.StencilMode({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=l.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=d,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new sf(d.map)}set style(l){l.on("data",this._onStyleDataEvent.bind(this)),l.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=l,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(l,d,_){if(l&&l.terrain){this._style!==l&&(this.style=l),this.enabled=!0;const x=l.terrain.properties;this.sourceCache=0===l.terrain.drapeRenderMode?this._mockSourceCache:l._getSourceCache(x.get("source")),this._exaggeration=x.get("exaggeration");const C=()=>{this.sourceCache.used&&p.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const D=this.getScaledDemTileSize();this.sourceCache.update(d,D,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,C(),this._initializing=!0),C(),d.updateElevation(!0,_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(d),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(l){this._findCoveringTileCache[l]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const l=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==l.efficiency&&p.warnOnce(`Terrain render cache efficiency is not optimal (${l.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${l.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(l){l.coord&&"source"===l.dataType?this._clearRenderCacheForTile(l.sourceCacheId,l.coord):"style"===l.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const l in this._style._sourceCaches)this._style._sourceCaches[l].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(l=>l.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const l=2*this.proxySourceCache.getSource().tileSize;return[l,l]}set useVertexMorphing(l){this._useVertexMorphing=l}updateTileBinding(l){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const d=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=0===_._centerAltitude&&-1===this.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(_.center),-1),this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=d.getIds().map(k=>{const N=d.getTileByID(k).tileID;return N.projMatrix=_.calculateProjMatrix(N.toUnwrapped()),N});(function(k,N){const F=N.transform.pointCoordinate(N.transform.getCameraPoint()),j=new p.Point(F.x,F.y);k.sort((Y,ee)=>{if(ee.overscaledZ-Y.overscaledZ)return ee.overscaledZ-Y.overscaledZ;const re=new p.Point(Y.canonical.x+(1<<Y.canonical.z)*Y.wrap,Y.canonical.y),ie=new p.Point(ee.canonical.x+(1<<ee.canonical.z)*ee.wrap,ee.canonical.y),se=j.mult(1<<Y.canonical.z);return se.x-=.5,se.y-=.5,se.distSqr(re)-se.distSqr(ie)})})(x,this.painter),this._previousZoom=_.zoom;const C=this.proxyToSource||{};this.proxyToSource={},x.forEach(k=>{this.proxyToSource[k.key]={}}),this.terrainTileForTile={};const D=this._style._sourceCaches;for(const k in D){const N=D[k];if(!N.used||(N!==this.sourceCache&&this.resetTileLookupCache(N.id),this._setupProxiedCoordsForOrtho(N,l[k],C),N.usedForTerrain))continue;const F=l[k];N.getSource().reparseOverscaled&&this._assignTerrainTiles(F)}this.proxiedCoords[d.id]=x.map(k=>new Eh(k,k.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(C),this.renderingToTexture=!1,this._updateTimestamp=p.exported.now();const S={};this._visibleDemTiles=[];for(const k of this.proxyCoords){const N=this.terrainTileForTile[k.key];if(!N)continue;const F=N.tileID.key;F in S||(this._visibleDemTiles.push(N),S[F]=F)}}_assignTerrainTiles(l){this._initializing||l.forEach(d=>{if(this.terrainTileForTile[d.key])return;const _=this._findTileCoveringTileID(d,this.sourceCache);_&&(this.terrainTileForTile[d.key]=_)})}_prepareDEMTextures(){const l=this.painter.context,d=l.gl;for(const _ in this.terrainTileForTile){const x=this.terrainTileForTile[_],C=x.dem;!C||x.demTexture&&!x.needsDEMTextureUpload||(l.activeTexture.set(d.TEXTURE1),Ju(this.painter,x,C))}}_prepareDemTileUniforms(l,d,_,x){if(!d||null==d.demTexture)return!1;const C=l.tileID.canonical,D=Math.pow(2,d.tileID.canonical.z-C.z),S=x||"";return _[`u_dem_tl${S}`]=[C.x*D%1,C.y*D%1],_[`u_dem_scale${S}`]=D,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const l=this.painter.context,d=l.gl;if(!this._emptyDepthBufferTexture){const _=new p.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new p.Texture(l,_,d.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let l=0;const d=this._visibleDemTiles.reduce((_,x)=>{if(!x.dem)return _;const C=x.dem.tree.minimums[0];return C>0&&l++,_+C},0);return l?d/l:0}_updateEmptyDEMTexture(){const l=this.painter.context,d=l.gl;l.activeTexture.set(d.TEXTURE2);const _=this._getLoadedAreaMinimum(),x=new p.RGBAImage({width:1,height:1},new Uint8Array(p.DEMData.pack(_,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let C=this._emptyDEMTexture;return C?C.update(x,{premultiply:!1}):C=this._emptyDEMTexture=new p.Texture(l,x,d.RGBA,{premultiply:!1}),C}setupElevationDraw(l,d,_){const x=this.painter.context,C=x.gl,D=(S=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:p.DEMData.getUnpackVector(S),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var S;D.u_dem_size=this.sourceCache.getSource().tileSize,D.u_exaggeration=this.exaggeration();let k=null,N=null,F=1;if(_&&_.morphing&&this._useVertexMorphing){const j=_.morphing.srcDemTile,Y=_.morphing.dstDemTile;F=_.morphing.phase,j&&Y&&(this._prepareDemTileUniforms(l,j,D,"_prev")&&(N=j),this._prepareDemTileUniforms(l,Y,D)&&(k=Y))}if(N&&k?(x.activeTexture.set(C.TEXTURE2),k.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE,C.NEAREST),x.activeTexture.set(C.TEXTURE4),N.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE,C.NEAREST),D.u_dem_lerp=F):(k=this.terrainTileForTile[l.tileID.key],x.activeTexture.set(C.TEXTURE2),(this._prepareDemTileUniforms(l,k,D)?k.demTexture:this.emptyDEMTexture).bind(C.NEAREST,C.CLAMP_TO_EDGE)),x.activeTexture.set(C.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),this._depthFBO&&(D.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),D.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&k){const j=(1<<k.tileID.canonical.z)*p.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;D.u_meter_to_dem=j}if(_&&_.labelPlaneMatrixInv&&(D.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),d.setTerrainUniformValues(x,D),"globe"===this.painter.transform.projection.name){const j=this.globeUniformValues(this.painter.transform,l.tileID.canonical,_&&_.useDenormalizedUpVectorScale);d.setGlobeUniformValues(x,j)}}globeUniformValues(l,d,_){const x=l.projection;return{u_tile_tl_up:x.upVector(d,0,0),u_tile_tr_up:x.upVector(d,p.EXTENT,0),u_tile_br_up:x.upVector(d,p.EXTENT,p.EXTENT),u_tile_bl_up:x.upVector(d,0,p.EXTENT),u_tile_up_scale:_?p.globeMetersToEcef(1):x.upVectorScale(d,l.center.lat,l.worldSize).metersToTile}}renderToBackBuffer(l){const d=this.painter,_=this.painter.context;0!==l.length&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,d.width,d.height]),d.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,C,D,S,k){if("globe"===x.transform.projection.name)!function(N,F,j,Y,ee){const re=N.context,ie=re.gl;let se,$;const Q=N.options.showTerrainWireframe?2:0,ue=N.transform,de=p.globeUseCustomAntiAliasing(N,re,ue),be=(it,Le)=>{if($===it)return;const Ge=[fa[it],"PROJECTION_GLOBE_VIEW"];de&&Ge.push("CUSTOM_ANTIALIASING"),Le&&Ge.push(fa[Q]),se=N.useProgram("globeRaster",null,Ge),$=it},Me=N.colorModeForRenderPass(),we=new p.DepthMode(ie.LEQUAL,p.DepthMode.ReadWrite,N.depthRangeFor3D);Go.update(ee);const Se=p.calculateGlobeMercatorMatrix(ue),Ee=[p.mercatorXfromLng(ue.center.lng),p.mercatorYfromLat(ue.center.lat)],Fe=Q?[!1,!0]:[!1],ot=N.globeSharedBuffers,Oe=[ue.width*p.exported.devicePixelRatio,ue.height*p.exported.devicePixelRatio],Ze=Float32Array.from(ue.globeMatrix),Be={useDenormalizedUpVectorScale:!0};if(Fe.forEach(it=>{const Le=N.transform,Ge=zl(Le.zoom)*F.exaggeration();$=-1;const tt=it?ie.LINES:ie.TRIANGLES;for(const Qe of Y){const st=j.getTile(Qe),vt=p.StencilMode.disabled,Ht=F.prevTerrainTileForTile[Qe.key],Et=F.terrainTileForTile[Qe.key];pa(Ht,Et)&&Go.newMorphing(Qe.key,Ht,Et,ee,250),re.activeTexture.set(ie.TEXTURE0),st.texture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE);const At=Go.getMorphValuesForProxy(Qe.key),_n=At?1:0;At&&p.extend$1(Be,{morphing:{srcDemTile:At.from,dstDemTile:At.to,phase:p.easeCubicInOut(At.phase)}});const un=p.tileCornersToBounds(Qe.canonical),Pt=p.getLatitudinalLod(un.getCenter().lat),dn=p.getGridMatrix(Qe.canonical,un,Pt,Le.worldSize/Le._pixelsPerMercatorPixel),$n=p.globeNormalizeECEF(p.globeTileBounds(Qe.canonical)),Hn=Ch(Le.projMatrix,Ze,Se,$n,p.globeToMercatorTransition(Le.zoom),Ee,Le.frustumCorners.TL,Le.frustumCorners.TR,Le.frustumCorners.BR,Le.frustumCorners.BL,Le.globeCenterInViewSpace,Le.globeRadius,Oe,Ge,dn);if(be(_n,it),F.setupElevationDraw(st,se,Be),N.prepareDrawProgram(re,se,Qe.toUnwrapped()),ot){const[Gn,Ii,dr]=it?ot.getWirefameBuffers(N.context,Pt):ot.getGridBuffers(Pt,0!==Ge);se.draw(re,tt,we,vt,Me,p.CullFaceMode.backCCW,Hn,"globe_raster",Gn,Ii,dr)}}}),ot){const it=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];de&&it.push("CUSTOM_ANTIALIASING"),se=N.useProgram("globeRaster",null,it);for(const Le of Y){const{x:Ge,y:tt,z:Qe}=Le.canonical,st=0===tt,vt=tt===(1<<Qe)-1,[Ht,Et,At,_n]=ot.getPoleBuffers(Qe);if(_n&&(st||vt)){const un=j.getTile(Le);re.activeTexture.set(ie.TEXTURE0),un.texture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE);let Pt=p.globePoleMatrixForTile(Qe,Ge,ue);const dn=p.globeNormalizeECEF(p.globeTileBounds(Le.canonical)),$n=(Hn,Gn)=>Hn.draw(re,ie.TRIANGLES,we,p.StencilMode.disabled,Me,p.CullFaceMode.disabled,Ch(ue.projMatrix,Pt,Pt,dn,0,Ee,ue.frustumCorners.TL,ue.frustumCorners.TR,ue.frustumCorners.BR,ue.frustumCorners.BL,ue.globeCenterInViewSpace,ue.globeRadius,Oe,0),"globe_pole_raster",Gn,At,_n);F.setupElevationDraw(un,se,Be),N.prepareDrawProgram(re,se,Le.toUnwrapped()),st&&$n(se,Ht),vt&&(Pt=p.scale(p.create(),Pt,[1,-1,1]),$n(se,Et))}}}}(x,C,D,S,k);else{const N=x.context,F=N.gl;let j,Y;const ee=x.options.showTerrainWireframe?2:0,re=(ue,de)=>{if(Y===ue)return;const be=[fa[ue]];de&&be.push(fa[ee]),j=x.useProgram("terrainRaster",null,be),Y=ue},ie=x.colorModeForRenderPass(),se=new p.DepthMode(F.LEQUAL,p.DepthMode.ReadWrite,x.depthRangeFor3D);Go.update(k);const $=x.transform,Q=zl($.zoom)*C.exaggeration();(ee?[!1,!0]:[!1]).forEach(ue=>{Y=-1;const de=ue?F.LINES:F.TRIANGLES,[be,Me]=ue?C.getWirefameBuffer():[C.gridIndexBuffer,C.gridSegments];for(const we of S){const Se=D.getTile(we),Ee=p.StencilMode.disabled,Fe=C.prevTerrainTileForTile[we.key],ot=C.terrainTileForTile[we.key];pa(Fe,ot)&&Go.newMorphing(we.key,Fe,ot,k,250),N.activeTexture.set(F.TEXTURE0),Se.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST);const Oe=Go.getMorphValuesForProxy(we.key),Ze=Oe?1:0;let Be;Oe&&(Be={morphing:{srcDemTile:Oe.from,dstDemTile:Oe.to,phase:p.easeCubicInOut(Oe.phase)}});const it=$c(we.projMatrix,nf(we.canonical,$.renderWorldCopies)?Q/10:Q);re(Ze,ue),C.setupElevationDraw(Se,j,Be),x.prepareDrawProgram(N,j,we.toUnwrapped()),j.draw(N,de,se,Ee,ie,p.CullFaceMode.backCCW,it,"terrain_raster",C.gridBuffer,be,Me)}})}}(d,this,this.proxySourceCache,l,this._updateTimestamp),this.renderingToTexture=!0,d.gpuTimingDeferredRenderEnd(),l.splice(0,l.length))}renderBatch(l){if(0===this._drapedRenderBatches.length)return l+1;this.renderingToTexture=!0;const d=this.painter,_=this.painter.context,x=this.proxySourceCache,C=this.proxiedCoords[x.id],D=this._drapedRenderBatches.shift(),S=[],k=d.style.order;let N=0;for(const F of C){const j=x.getTileByID(F.proxyTileKey),Y=x.proxyCachedFBO[F.key]?x.proxyCachedFBO[F.key][l]:void 0,ee=void 0!==Y?x.renderCache[Y]:this.pool[N++],re=void 0!==Y;if(j.texture=ee.tex,re&&!ee.dirty){S.push(j.tileID);continue}let ie;_.bindFramebuffer.set(ee.fb.framebuffer),this.renderedToTile=!1,ee.dirty&&(_.clear({color:p.Color.transparent,stencil:0}),ee.dirty=!1);for(let se=D.start;se<=D.end;++se){const $=d.style._layers[k[se]];if($.isHidden(d.transform.zoom))continue;const Q=d.style._getLayerSourceCache($),ue=Q?this.proxyToSource[F.key][Q.id]:[F];if(!ue)continue;const de=ue;_.viewport.set([0,0,ee.fb.width,ee.fb.height]),ie!==(Q?Q.id:null)&&(this._setupStencil(ee,ue,$,Q),ie=Q?Q.id:null),d.renderLayer(d,Q,$,de)}this.renderedToTile?(ee.dirty=!0,S.push(j.tileID)):re||--N,5===N&&(N=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,d.width,d.height]),D.end+1}postRender(){}renderCacheEfficiency(l){const d=l.order.length;if(0===d)return{efficiency:100};let _,x=0,C=0,D=!1;for(let S=0;S<d;++S){const k=l._layers[l.order[S]];this._style.isLayerDraped(k)?(D&&++x,++C):D||(D=!0,_=k.id)}return 0===C?{efficiency:100}:{efficiency:100*(1-x/C),firstUndrapedLayer:_}}getMinElevationBelowMSL(){let l=0;return this._visibleDemTiles.filter(d=>d.dem).forEach(d=>{l=Math.min(l,d.dem.tree.minimums[0])}),0===l?l:(l-30)*this._exaggeration}raycast(l,d,_){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(C=>C.dem).map(C=>{const D=C.tileID,S=1<<D.overscaledZ,{x:k,y:N}=D.canonical,F=k/S,j=(k+1)/S,Y=N/S,ee=(N+1)/S;return{minx:F,miny:Y,maxx:j,maxy:ee,t:C.dem.tree.raycastRoot(F,Y,j,ee,l,d,_),tile:C}});x.sort((C,D)=>(null!==C.t?C.t:Number.MAX_VALUE)-(null!==D.t?D.t:Number.MAX_VALUE));for(const C of x){if(null==C.t)return null;const D=C.tile.dem.tree.raycast(C.minx,C.miny,C.maxx,C.maxy,l,d,_);if(null!=D)return D}return null}_createFBO(){const l=this.painter.context,d=l.gl,_=this.drapeBufferSize;l.activeTexture.set(d.TEXTURE0);const x=new p.Texture(l,{width:_[0],height:_[1],data:null},d.RGBA);x.bind(d.LINEAR,d.CLAMP_TO_EDGE);const C=l.createFramebuffer(_[0],_[1],!1);return C.colorAttachment.set(x.texture),C.depthAttachment=new De(l,C.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=l.createRenderbuffer(l.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,C.depthAttachment.set(this._sharedDepthStencil),l.clear({stencil:0})):C.depthAttachment.set(this._sharedDepthStencil),l.extTextureFilterAnisotropic&&!l.extTextureFilterAnisotropicForceOff&&d.texParameterf(d.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax),{fb:C,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const l in this._style._sourceCaches)if(this._style._sourceCaches[l].hasTransition())return!0;return this._style.order.some(l=>{const d=this._style._layers[l],_=d.isHidden(this.painter.transform.zoom);return"custom"===d.type?!_&&d.shouldRedrape():!_&&d.hasTransition()})}_clearLineLayersFromRenderCache(){let l=!1;for(const _ of this._style._getSources())if(_ instanceof gt){l=!0;break}if(!l)return;const d={};for(let _=0;_<this._style.order.length;++_){const x=this._style._layers[this._style.order[_]],C=this._style._getLayerSourceCache(x);if(C&&!d[C.id]&&!x.isHidden(this.painter.transform.zoom)&&"line"===x.type&&x.widthExpression()instanceof p.ZoomDependentExpression){d[C.id]=!0;for(const D of this.proxyCoords){const S=this.proxyToSource[D.key][C.id];if(S)for(const k of S)this._clearRenderCacheForTile(C.id,k)}}}}_clearRasterLayersFromRenderCache(){let l=!1;for(const _ in this._style._sourceCaches)if(this._style._sourceCaches[_]._source instanceof at){l=!0;break}if(!l)return;const d={};for(let _=0;_<this._style.order.length;++_){const x=this._style._layers[this._style.order[_]],C=this._style._getLayerSourceCache(x);if(!C||d[C.id]||x.isHidden(this.painter.transform.zoom)||"raster"!==x.type)continue;const D=x.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const k=this.proxyToSource[S.key][C.id];if(k)for(const N of k){const F=rf(C.getTile(N),C.findLoadedParent(N,0),C,this.painter.transform,D);(1!==F.opacity||0!==F.mix)&&this._clearRenderCacheForTile(C.id,N)}}}}_setupDrapedRenderBatches(){const l=this._style.order,d=l.length;if(0===d)return;const _=[];let x,C=0,D=this._style._layers[l[C]];for(;!this._style.isLayerDraped(D)&&D.isHidden(this.painter.transform.zoom)&&++C<d;)D=this._style._layers[l[C]];for(;C<d;++C){const S=this._style._layers[l[C]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?void 0===x&&(x=C):void 0!==x&&(_.push({start:x,end:C-1}),x=void 0))}void 0!==x&&_.push({start:x,end:C-1}),this._drapedRenderBatches=_}_setupRenderCache(l){const d=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,d.renderCache.length>d.renderCachePool.length){const D=Object.values(d.proxyCachedFBO);d.proxyCachedFBO={};for(let S=0;S<D.length;++S){const k=Object.values(D[S]);d.renderCachePool.push(...k)}}return}this._clearRasterLayersFromRenderCache();const _=this.proxyCoords,x=this._tilesDirty;for(let D=_.length-1;D>=0;D--){const S=_[D];if(d.getTileByID(S.key),void 0!==d.proxyCachedFBO[S.key]){const k=l[S.key],N=this.proxyToSource[S.key];let F=0;for(const j in N){const Y=N[j],ee=k[j];if(!ee||ee.length!==Y.length||Y.some((re,ie)=>re!==ee[ie]||x[j]&&x[j].hasOwnProperty(re.key))){F=-1;break}++F}for(const j in d.proxyCachedFBO[S.key])d.renderCache[d.proxyCachedFBO[S.key][j]].dirty=F<0||F!==Object.values(k).length}}const C=[...this._drapedRenderBatches];C.sort((D,S)=>S.end-S.start-(D.end-D.start));for(const D of C)for(const S of _){if(d.proxyCachedFBO[S.key])continue;let k=d.renderCachePool.pop();void 0===k&&d.renderCache.length<50&&(k=d.renderCache.length,d.renderCache.push(this._createFBO())),void 0!==k&&(d.proxyCachedFBO[S.key]={},d.proxyCachedFBO[S.key][D.start]=k,d.renderCache[k].dirty=!0)}this._tilesDirty={}}_setupStencil(l,d,_,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const C=this.painter.context,D=C.gl;if(d.length<=1)return void(this._overlapStencilType=!1);let S;if(_.isTileClipped())S=d.length,this._overlapStencilMode.test={func:D.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(d[0].overscaledZ>d[d.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:D.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(C.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(d,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(l){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[l.key]),this._overlapStencilMode):p.StencilMode.disabled}_renderTileClippingMasks(l,d){const _=this.painter,x=this.painter.context,C=x.gl;_._tileClippingMaskIDs={},x.setColorMode(p.ColorMode.disabled),x.setDepthMode(p.DepthMode.disabled);const D=_.useProgram("clippingMask");for(const S of l){const k=_._tileClippingMaskIDs[S.key]=--d;D.draw(x,C.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:C.ALWAYS,mask:0},k,255,C.KEEP,C.KEEP,C.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,qa(S.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(l){const d=this.painter.transform;if(l.x<0||l.x>d.width||l.y<0||l.y>d.height)return null;const _=[l.x,l.y,1,1];p.transformMat4$1(_,_,d.pixelMatrixInverse),p.scale$1(_,_,1/_[3]),_[0]/=d.worldSize,_[1]/=d.worldSize;const x=d._camera.position,C=p.mercatorZfromAltitude(1,d.center.lat),D=[x[0],x[1],x[2]/C,0],S=p.subtract([],_.slice(0,3),D);p.normalize(S,S);const k=this.raycast(D,S,this._exaggeration);return null!==k&&k?(p.scaleAndAdd(D,D,S,k),D[3]=D[2],D[2]*=C,D):null}drawDepth(){const l=this.painter,d=l.context,_=this.proxySourceCache,x=Math.ceil(l.width),C=Math.ceil(l.height);if(!this._depthFBO||this._depthFBO.width===x&&this._depthFBO.height===C||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const D=d.gl,S=d.createFramebuffer(x,C,!0);d.activeTexture.set(D.TEXTURE0);const k=new p.Texture(d,{width:x,height:C,data:null},D.RGBA);k.bind(D.NEAREST,D.CLAMP_TO_EDGE),S.colorAttachment.set(k.texture);const N=d.createRenderbuffer(d.gl.DEPTH_COMPONENT16,x,C);S.depthAttachment.set(N),this._depthFBO=S,this._depthTexture=k}d.bindFramebuffer.set(this._depthFBO.framebuffer),d.viewport.set([0,0,x,C]),function(D,S,k,N){if("globe"===D.transform.projection.name)return;const F=D.context,j=F.gl;F.clear({depth:1});const Y=D.useProgram("terrainDepth"),ee=new p.DepthMode(j.LESS,p.DepthMode.ReadWrite,D.depthRangeFor3D);for(const re of N){const ie=k.getTile(re),se=$c(re.projMatrix,0);S.setupElevationDraw(ie,Y),Y.draw(F,j.TRIANGLES,ee,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.backCCW,se,"terrain_depth",S.gridBuffer,S.gridIndexBuffer,S.gridNoSkirtSegments)}}(l,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(l,d,_){if(l.getSource()instanceof hn)return this._setupProxiedCoordsForImageSource(l,d,_);this._findCoveringTileCache[l.id]=this._findCoveringTileCache[l.id]||{};const x=this.proxiedCoords[l.id]=[],C=this.proxyCoords;for(let S=0;S<C.length;S++){const k=C[S],N=this._findTileCoveringTileID(k,l);if(N){const F=this._createProxiedId(k,N,_[k.key]&&_[k.key][l.id]);x.push(F),this.proxyToSource[k.key][l.id]=[F]}}let D=!1;for(let S=0;S<d.length;S++){const k=l.getTile(d[S]);if(!k||!k.hasData())continue;const N=this._findTileCoveringTileID(k.tileID,this.proxySourceCache);if(N&&N.tileID.canonical.z!==k.tileID.canonical.z){const F=this.proxyToSource[N.tileID.key][l.id],j=this._createProxiedId(N.tileID,k,_[N.tileID.key]&&_[N.tileID.key][l.id]);F?F.splice(F.length-1,0,j):this.proxyToSource[N.tileID.key][l.id]=[j],x.push(j),D=!0}}this._sourceTilesOverlap[l.id]=D}_setupProxiedCoordsForImageSource(l,d,_){if(!l.getSource().loaded())return;const x=this.proxiedCoords[l.id]=[],C=this.proxyCoords,D=l.getSource(),S=new p.Point(D.tileID.x,D.tileID.y)._div(1<<D.tileID.z),k=D.coordinates.map(p.MercatorCoordinate.fromLngLat).reduce((F,j)=>(F.min.x=Math.min(F.min.x,j.x-S.x),F.min.y=Math.min(F.min.y,j.y-S.y),F.max.x=Math.max(F.max.x,j.x-S.x),F.max.y=Math.max(F.max.y,j.y-S.y),F),{min:new p.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new p.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),N=(F,j)=>{const Y=F.wrap+F.canonical.x/(1<<F.canonical.z),ee=F.canonical.y/(1<<F.canonical.z),re=p.EXTENT/(1<<F.canonical.z),ie=j.wrap+j.canonical.x/(1<<j.canonical.z),se=j.canonical.y/(1<<j.canonical.z);return Y+re<ie+k.min.x||Y>ie+k.max.x||ee+re<se+k.min.y||ee>se+k.max.y};for(let F=0;F<C.length;F++){const j=C[F];for(let Y=0;Y<d.length;Y++){const ee=l.getTile(d[Y]);if(!ee||!ee.hasData()||N(j,ee.tileID))continue;const re=this._createProxiedId(j,ee,_[j.key]&&_[j.key][l.id]),ie=this.proxyToSource[j.key][l.id];ie?ie.push(re):this.proxyToSource[j.key][l.id]=[re],x.push(re)}}}_createProxiedId(l,d,_){let x=this.orthoMatrix;if(_){const C=_.find(D=>D.key===d.tileID.key);if(C)return C}if(d.tileID.key!==l.key){const C=l.canonical.z-d.tileID.canonical.z;let D,S,k;x=p.create();const N=d.tileID.wrap-l.wrap<<l.overscaledZ;C>0?(D=p.EXTENT>>C,S=D*((d.tileID.canonical.x<<C)-l.canonical.x+N),k=D*((d.tileID.canonical.y<<C)-l.canonical.y)):(D=p.EXTENT<<-C,S=p.EXTENT*(d.tileID.canonical.x-(l.canonical.x+N<<-C)),k=p.EXTENT*(d.tileID.canonical.y-(l.canonical.y<<-C))),p.ortho(x,0,D,0,D,0,1),p.translate(x,x,[S,k,0])}return new Eh(d.tileID,l.key,x)}_findTileCoveringTileID(l,d){let _=d.getTile(l);if(_&&_.hasData())return _;const x=this._findCoveringTileCache[d.id],C=x[l.key];if(_=C?d.getTileByID(C):null,_&&_.hasData()||null===C)return _;let D=_?_.tileID:l,S=D.overscaledZ;const k=d.getSource().minzoom,N=[];if(!C){const j=d.getSource().maxzoom;if(l.canonical.z>=j){const Y=l.canonical.z-j;d.getSource().reparseOverscaled?(S=Math.max(l.canonical.z+2,d.transform.tileZoom),D=new p.OverscaledTileID(S,l.wrap,j,l.canonical.x>>Y,l.canonical.y>>Y)):0!==Y&&(S=j,D=new p.OverscaledTileID(S,l.wrap,j,l.canonical.x>>Y,l.canonical.y>>Y))}D.key!==l.key&&(N.push(D.key),_=d.getTile(D))}const F=j=>{N.forEach(Y=>{x[Y]=j}),N.length=0};for(S-=1;S>=k&&(!_||!_.hasData());S--){_&&F(_.tileID.key);const j=D.calculateScaledKey(S);if(_=d.getTileByID(j),_&&_.hasData())break;const Y=x[j];if(null===Y)break;void 0===Y?N.push(j):_=d.getTileByID(Y)}return F(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(l){return this.enabled?this._findTileCoveringTileID(l,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(l,d){let _=this._tilesDirty[l];_||(_=this._tilesDirty[l]={}),_[d.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const l=function(d){let _=0;const x=new p.StructArrayLayout2ui4,C=131;for(let D=1;D<129;D++){for(let S=1;S<129;S++)_=D*C+S,x.emplaceBack(_,_+1),x.emplaceBack(_,_+C),x.emplaceBack(_+1,_+C),128===D&&x.emplaceBack(_+C,_+C+1);x.emplaceBack(_+1,_+1+C)}return x}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(l),this.wireframeSegments=p.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,l.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class wn{static cacheKey(l,d,_,x){let C=`${d}${x?x.cacheKey:""}`;for(const D of _)l.usedDefines.includes(D)&&(C+=`/${D}`);return C}constructor(l,d,_,x,C,D){const S=l.gl;this.program=S.createProgram();const k=function($){const Q=[];for(let ue=0;ue<$.length;ue++){if(null===$[ue])continue;const de=$[ue].split(" ");Q.push(de.pop())}return Q}(_.staticAttributes),N=x?x.getBinderAttributes():[],F=k.concat(N);let j=x?x.defines():[];j=j.concat(D.map($=>`#define ${$}`));const Y=l.isWebGL2?"#version 300 es\n":"",ee=Y+j.concat(l.extStandardDerivatives&&0===Y.length?"#extension GL_OES_standard_derivatives : enable\n".concat(jc):jc,jc,Ga,Uc.fragmentSource,Ha.fragmentSource,_.fragmentSource).join("\n"),re=Y+j.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Ga,Uc.vertexSource,Ha.vertexSource,Xu.vertexSource,_.vertexSource).join("\n"),ie=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(ie,ee),S.compileShader(ie),S.attachShader(this.program,ie);const se=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())this.failedToCreate=!0;else{S.shaderSource(se,re),S.compileShader(se),S.attachShader(this.program,se),this.attributes={},this.numAttributes=F.length;for(let $=0;$<this.numAttributes;$++)F[$]&&(S.bindAttribLocation(this.program,$,F[$]),this.attributes[F[$]]=$);S.linkProgram(this.program),S.deleteShader(se),S.deleteShader(ie),this.fixedUniforms=C(l),this.binderUniforms=x?x.getUniforms(l):[],D.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new p.Uniform1i($=l),u_dem_prev:new p.Uniform1i($),u_dem_unpack:new p.Uniform4f($),u_dem_tl:new p.Uniform2f($),u_dem_scale:new p.Uniform1f($),u_dem_tl_prev:new p.Uniform2f($),u_dem_scale_prev:new p.Uniform1f($),u_dem_size:new p.Uniform1f($),u_dem_lerp:new p.Uniform1f($),u_exaggeration:new p.Uniform1f($),u_depth:new p.Uniform1i($),u_depth_size_inv:new p.Uniform2f($),u_meter_to_dem:new p.Uniform1f($),u_label_plane_matrix_inv:new p.UniformMatrix4f($)}),D.includes("GLOBE")&&(this.globeUniforms=($=>({u_tile_tl_up:new p.Uniform3f($),u_tile_tr_up:new p.Uniform3f($),u_tile_br_up:new p.Uniform3f($),u_tile_bl_up:new p.Uniform3f($),u_tile_up_scale:new p.Uniform1f($)}))(l)),D.includes("FOG")&&(this.fogUniforms=($=>({u_fog_matrix:new p.UniformMatrix4f($),u_fog_range:new p.Uniform2f($),u_fog_color:new p.Uniform4f($),u_fog_horizon_blend:new p.Uniform1f($),u_fog_temporal_offset:new p.Uniform1f($),u_frustum_tl:new p.Uniform3f($),u_frustum_tr:new p.Uniform3f($),u_frustum_br:new p.Uniform3f($),u_frustum_bl:new p.Uniform3f($),u_globe_pos:new p.Uniform3f($),u_globe_radius:new p.Uniform1f($),u_globe_transition:new p.Uniform1f($),u_is_globe:new p.Uniform1i($),u_viewport:new p.Uniform2f($)}))(l))}var $}setTerrainUniformValues(l,d){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const x in d)_[x]&&_[x].set(this.program,x,d[x])}}setGlobeUniformValues(l,d){if(!this.globeUniforms)return;const _=this.globeUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const x in d)_[x]&&_[x].set(this.program,x,d[x])}}setFogUniformValues(l,d){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const x in d)_[x].set(this.program,x,d[x])}}draw(l,d,_,x,C,D,S,k,N,F,j,Y,ee,re,ie){const se=l.gl;if(this.failedToCreate)return;l.program.set(this.program),l.setDepthMode(_),l.setStencilMode(x),l.setColorMode(C),l.setCullFace(D);for(const Q of Object.keys(this.fixedUniforms))this.fixedUniforms[Q].set(this.program,Q,S[Q]);re&&re.setUniforms(this.program,l,this.binderUniforms,Y,{zoom:ee});const $={[se.LINES]:2,[se.TRIANGLES]:3,[se.LINE_STRIP]:1}[d];for(const Q of j.get()){const ue=Q.vaos||(Q.vaos={});(ue[k]||(ue[k]=new wh)).bind(l,this,N,re?re.getPaintVertexBuffers():[],F,Q.vertexOffset,ie||[]),se.drawElements(d,Q.primitiveLength*$,se.UNSIGNED_SHORT,Q.primitiveOffset*$*2)}}}function Za(g,l){const d=Math.pow(2,l.tileID.overscaledZ),_=l.tileSize*Math.pow(2,g.transform.tileZoom)/d,x=_*(l.tileID.canonical.x+l.tileID.wrap*d),C=_*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_tile_units_to_pixels:1/sr(l,1,g.transform.tileZoom),u_pixel_coord_upper:[x>>16,C>>16],u_pixel_coord_lower:[65535&x,65535&C]}}const Hc=p.create(),Th=(g,l,d,_,x,C,D,S,k,N,F)=>{const j=l.style.light,Y=j.properties.get("position"),ee=[Y.x,Y.y,Y.z],re=p.create$1();"viewport"===j.properties.get("anchor")&&(p.fromRotation(re,-l.transform.angle),p.transformMat3(ee,ee,re));const ie=j.properties.get("color"),se=l.transform,$={u_matrix:g,u_lightpos:ee,u_lightintensity:j.properties.get("intensity"),u_lightcolor:[ie.r,ie.g,ie.b],u_vertical_gradient:+d,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Hc,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:x,u_edge_radius:C};return"globe"===se.projection.name&&($.u_tile_id=[D.canonical.x,D.canonical.y,1<<D.canonical.z],$.u_zoom_transition=k,$.u_inv_rot_matrix=F,$.u_merc_center=N,$.u_up_dir=se.projection.upVector(new p.CanonicalTileID(0,0,0),N[0]*p.EXTENT,N[1]*p.EXTENT),$.u_height_lift=S),$},lf=(g,l,d,_,x,C,D,S,k,N,F,j)=>{const Y=Th(g,l,d,_,x,C,D,k,N,F,j),ee={u_height_factor:-Math.pow(2,D.overscaledZ)/S.tileSize/8};return p.extend(Y,Za(l,S),ee)},Wa=g=>({u_matrix:g}),Qu=(g,l,d)=>p.extend(Wa(g),Za(l,d)),Bl=(g,l)=>({u_matrix:g,u_world:l}),Pm=(g,l,d,_)=>p.extend(Qu(g,l,d),{u_world:_}),ga=p.create(),Dh=(g,l,d,_,x,C)=>{const D=g.transform,S="globe"===D.projection.name;let k;if("map"===C.paint.get("circle-pitch-alignment"))if(S){const F=p.globePixelsToTileUnits(D.zoom,l.canonical)*D._pixelsPerMercatorPixel;k=Float32Array.from([F,0,0,F])}else k=D.calculatePixelsToTileUnitsMatrix(d);else k=new Float32Array([D.pixelsToGLUnits[0],0,0,D.pixelsToGLUnits[1]]);const N={u_camera_to_center_distance:D.cameraToCenterDistance,u_matrix:g.translatePosMatrix(l.projMatrix,d,C.paint.get("circle-translate"),C.paint.get("circle-translate-anchor")),u_device_pixel_ratio:p.exported.devicePixelRatio,u_extrude_scale:k,u_inv_rot_matrix:ga,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(S){N.u_inv_rot_matrix=_,N.u_merc_center=x,N.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],N.u_zoom_transition=p.globeToMercatorTransition(D.zoom);const F=x[0]*p.EXTENT,j=x[1]*p.EXTENT;N.u_up_dir=D.projection.upVector(new p.CanonicalTileID(0,0,0),F,j)}return N},Ft=g=>{const l=[];return"map"===g.paint.get("circle-pitch-alignment")&&l.push("PITCH_WITH_MAP"),"map"===g.paint.get("circle-pitch-scale")&&l.push("SCALE_WITH_MAP"),l},ed=(g,l,d,_)=>{const x=p.EXTENT/d.tileSize;return{u_matrix:g,u_camera_to_center_distance:l.getCameraToCenterDistance(_),u_extrude_scale:[l.pixelsToGLUnits[0]/x,l.pixelsToGLUnits[1]/x]}},It=(g,l,d=1)=>({u_matrix:g,u_color:l,u_overlay:0,u_overlay_scale:d}),Gc=p.create(),td=(g,l,d,_,x,C,D)=>{const S=g.transform,k="globe"===S.projection.name,N=k?p.globePixelsToTileUnits(S.zoom,l.canonical)*S._pixelsPerMercatorPixel:sr(d,1,C),F={u_matrix:l.projMatrix,u_extrude_scale:N,u_intensity:D,u_inv_rot_matrix:Gc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(k){F.u_inv_rot_matrix=_,F.u_merc_center=x,F.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],F.u_zoom_transition=p.globeToMercatorTransition(S.zoom);const j=x[0]*p.EXTENT,Y=x[1]*p.EXTENT;F.u_up_dir=S.projection.upVector(new p.CanonicalTileID(0,0,0),j,Y)}return F},qc=(g,l,d,_,x,C,D)=>{const S=g.transform,k=S.calculatePixelsToTileUnitsMatrix(l);return{u_matrix:Sh(g,l,d,_),u_pixels_to_tile_units:k,u_device_pixel_ratio:C,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:x,u_texsize:oo(d)?l.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Vl(l,g.transform),u_alpha_discard_threshold:0,u_trim_offset:D}},Zc=(g,l,d,_,x)=>{const C=g.transform;return{u_matrix:Sh(g,l,d,_),u_texsize:l.imageAtlasTexture.size,u_pixels_to_tile_units:C.calculatePixelsToTileUnitsMatrix(l),u_device_pixel_ratio:x,u_image:0,u_tile_units_to_pixels:Vl(l,C),u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Vl(g,l){return 1/sr(g,1,l.tileZoom)}function Sh(g,l,d,_){return g.translatePosMatrix(_||l.tileID.projMatrix,l,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}function oo(g){const l=g.paint.get("line-dasharray").value;return l.value||"constant"!==l.kind}const Ul=(g,l,d,_,x,C)=>{return{u_matrix:g,u_tl_parent:l,u_scale_parent:d,u_fade_t:_.mix,u_opacity:_.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(S=x.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(D=x.paint.get("raster-contrast"),D>0?1/(1-D):1+D),u_spin_weights:Qi(x.paint.get("raster-hue-rotate")),u_perspective_transform:C};var D,S};function Qi(g){g*=Math.PI/180;const l=Math.sin(g),d=Math.cos(g);return[(2*d+1)/3,(-Math.sqrt(3)*l-d+1)/3,(Math.sqrt(3)*l-d+1)/3]}const so=p.create(),Nn=(g,l,d,_,x,C,D,S,k,N,F,j,Y,ee,re,ie)=>{const se=x.transform,$={u_is_size_zoom_constant:+("constant"===g||"source"===g),u_is_size_feature_constant:+("constant"===g||"camera"===g),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:se.cameraToCenterDistance,u_rotate_symbol:+d,u_aspect_ratio:se.width/se.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:D,u_coord_matrix:S,u_is_text:+k,u_pitch_with_map:+_,u_texsize:N,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:so,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:so,u_up_vector:[0,-1,0]};return"globe"===ie.name&&($.u_tile_id=[F.canonical.x,F.canonical.y,1<<F.canonical.z],$.u_zoom_transition=j,$.u_inv_rot_matrix=ee,$.u_merc_center=Y,$.u_camera_forward=se._camera.forward(),$.u_ecef_origin=p.globeECEFOrigin(se.globeMatrix,F.toUnwrapped()),$.u_tile_matrix=Float32Array.from(se.globeMatrix),$.u_up_vector=re),$},Xa=(g,l,d,_,x,C,D,S,k,N,F,j,Y,ee,re,ie,se)=>p.extend(Nn(g,l,d,_,x,C,D,S,k,N,j,Y,ee,re,ie,se),{u_gamma_scale:_?x.transform.cameraToCenterDistance*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:p.exported.devicePixelRatio,u_is_halo:+F}),nd=(g,l,d,_,x,C,D,S,k,N,F,j,Y,ee,re,ie)=>p.extend(Xa(g,l,d,_,x,C,D,S,!0,k,!0,F,j,Y,ee,re,ie),{u_texsize_icon:N,u_texture_icon:1}),Wc=(g,l,d)=>({u_matrix:g,u_opacity:l,u_color:d}),cf=(g,l,d,_,x)=>p.extend(function(C,D,S){const k=D.imageManager.getPattern(C.toString()),{width:N,height:F}=D.imageManager.getPixelSize(),j=Math.pow(2,S.tileID.overscaledZ),Y=S.tileSize*Math.pow(2,D.transform.tileZoom)/j,ee=Y*(S.tileID.canonical.x+S.tileID.wrap*j),re=Y*S.tileID.canonical.y;return{u_image:0,u_pattern_tl:k.tl,u_pattern_br:k.br,u_texsize:[N,F],u_pattern_size:k.displaySize,u_tile_units_to_pixels:1/sr(S,1,D.transform.tileZoom),u_pixel_coord_upper:[ee>>16,re>>16],u_pixel_coord_lower:[65535&ee,65535&re]}}(_,d,x),{u_matrix:g,u_opacity:l}),qo={fillExtrusion:g=>({u_matrix:new p.UniformMatrix4f(g),u_lightpos:new p.Uniform3f(g),u_lightintensity:new p.Uniform1f(g),u_lightcolor:new p.Uniform3f(g),u_vertical_gradient:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g),u_edge_radius:new p.Uniform1f(g),u_ao:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_up_dir:new p.Uniform3f(g),u_height_lift:new p.Uniform1f(g)}),fillExtrusionPattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_lightpos:new p.Uniform3f(g),u_lightintensity:new p.Uniform1f(g),u_lightcolor:new p.Uniform3f(g),u_vertical_gradient:new p.Uniform1f(g),u_height_factor:new p.Uniform1f(g),u_edge_radius:new p.Uniform1f(g),u_ao:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_up_dir:new p.Uniform3f(g),u_height_lift:new p.Uniform1f(g),u_image:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g)}),fill:g=>({u_matrix:new p.UniformMatrix4f(g)}),fillPattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_image:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g)}),fillOutline:g=>({u_matrix:new p.UniformMatrix4f(g),u_world:new p.Uniform2f(g)}),fillOutlinePattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_world:new p.Uniform2f(g),u_image:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g)}),circle:g=>({u_camera_to_center_distance:new p.Uniform1f(g),u_extrude_scale:new p.UniformMatrix2f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_up_dir:new p.Uniform3f(g)}),collisionBox:g=>({u_matrix:new p.UniformMatrix4f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_extrude_scale:new p.Uniform2f(g)}),collisionCircle:g=>({u_matrix:new p.UniformMatrix4f(g),u_inv_matrix:new p.UniformMatrix4f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_viewport_size:new p.Uniform2f(g)}),debug:g=>({u_color:new p.UniformColor(g),u_matrix:new p.UniformMatrix4f(g),u_overlay:new p.Uniform1i(g),u_overlay_scale:new p.Uniform1f(g)}),clippingMask:g=>({u_matrix:new p.UniformMatrix4f(g)}),heatmap:g=>({u_extrude_scale:new p.Uniform1f(g),u_intensity:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_up_dir:new p.Uniform3f(g)}),heatmapTexture:g=>({u_image:new p.Uniform1i(g),u_color_ramp:new p.Uniform1i(g),u_opacity:new p.Uniform1f(g)}),hillshade:g=>({u_matrix:new p.UniformMatrix4f(g),u_image:new p.Uniform1i(g),u_latrange:new p.Uniform2f(g),u_light:new p.Uniform2f(g),u_shadow:new p.UniformColor(g),u_highlight:new p.UniformColor(g),u_accent:new p.UniformColor(g)}),hillshadePrepare:g=>({u_matrix:new p.UniformMatrix4f(g),u_image:new p.Uniform1i(g),u_dimension:new p.Uniform2f(g),u_zoom:new p.Uniform1f(g),u_unpack:new p.Uniform4f(g)}),line:g=>({u_matrix:new p.UniformMatrix4f(g),u_pixels_to_tile_units:new p.UniformMatrix2f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_units_to_pixels:new p.Uniform2f(g),u_dash_image:new p.Uniform1i(g),u_gradient_image:new p.Uniform1i(g),u_image_height:new p.Uniform1f(g),u_texsize:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g),u_alpha_discard_threshold:new p.Uniform1f(g),u_trim_offset:new p.Uniform2f(g)}),linePattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_texsize:new p.Uniform2f(g),u_pixels_to_tile_units:new p.UniformMatrix2f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_image:new p.Uniform1i(g),u_units_to_pixels:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g),u_alpha_discard_threshold:new p.Uniform1f(g)}),raster:g=>({u_matrix:new p.UniformMatrix4f(g),u_tl_parent:new p.Uniform2f(g),u_scale_parent:new p.Uniform1f(g),u_fade_t:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g),u_image0:new p.Uniform1i(g),u_image1:new p.Uniform1i(g),u_brightness_low:new p.Uniform1f(g),u_brightness_high:new p.Uniform1f(g),u_saturation_factor:new p.Uniform1f(g),u_contrast_factor:new p.Uniform1f(g),u_spin_weights:new p.Uniform3f(g),u_perspective_transform:new p.Uniform2f(g)}),symbolIcon:g=>({u_is_size_zoom_constant:new p.Uniform1i(g),u_is_size_feature_constant:new p.Uniform1i(g),u_size_t:new p.Uniform1f(g),u_size:new p.Uniform1f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_rotate_symbol:new p.Uniform1i(g),u_aspect_ratio:new p.Uniform1f(g),u_fade_change:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_label_plane_matrix:new p.UniformMatrix4f(g),u_coord_matrix:new p.UniformMatrix4f(g),u_is_text:new p.Uniform1i(g),u_pitch_with_map:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_camera_forward:new p.Uniform3f(g),u_tile_matrix:new p.UniformMatrix4f(g),u_up_vector:new p.Uniform3f(g),u_ecef_origin:new p.Uniform3f(g),u_texture:new p.Uniform1i(g)}),symbolSDF:g=>({u_is_size_zoom_constant:new p.Uniform1i(g),u_is_size_feature_constant:new p.Uniform1i(g),u_size_t:new p.Uniform1f(g),u_size:new p.Uniform1f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_rotate_symbol:new p.Uniform1i(g),u_aspect_ratio:new p.Uniform1f(g),u_fade_change:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_label_plane_matrix:new p.UniformMatrix4f(g),u_coord_matrix:new p.UniformMatrix4f(g),u_is_text:new p.Uniform1i(g),u_pitch_with_map:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_texture:new p.Uniform1i(g),u_gamma_scale:new p.Uniform1f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_tile_id:new p.Uniform3f(g),u_zoom_transition:new p.Uniform1f(g),u_inv_rot_matrix:new p.UniformMatrix4f(g),u_merc_center:new p.Uniform2f(g),u_camera_forward:new p.Uniform3f(g),u_tile_matrix:new p.UniformMatrix4f(g),u_up_vector:new p.Uniform3f(g),u_ecef_origin:new p.Uniform3f(g),u_is_halo:new p.Uniform1i(g)}),symbolTextAndIcon:g=>({u_is_size_zoom_constant:new p.Uniform1i(g),u_is_size_feature_constant:new p.Uniform1i(g),u_size_t:new p.Uniform1f(g),u_size:new p.Uniform1f(g),u_camera_to_center_distance:new p.Uniform1f(g),u_rotate_symbol:new p.Uniform1i(g),u_aspect_ratio:new p.Uniform1f(g),u_fade_change:new p.Uniform1f(g),u_matrix:new p.UniformMatrix4f(g),u_label_plane_matrix:new p.UniformMatrix4f(g),u_coord_matrix:new p.UniformMatrix4f(g),u_is_text:new p.Uniform1i(g),u_pitch_with_map:new p.Uniform1i(g),u_texsize:new p.Uniform2f(g),u_texsize_icon:new p.Uniform2f(g),u_texture:new p.Uniform1i(g),u_texture_icon:new p.Uniform1i(g),u_gamma_scale:new p.Uniform1f(g),u_device_pixel_ratio:new p.Uniform1f(g),u_is_halo:new p.Uniform1i(g)}),background:g=>({u_matrix:new p.UniformMatrix4f(g),u_opacity:new p.Uniform1f(g),u_color:new p.UniformColor(g)}),backgroundPattern:g=>({u_matrix:new p.UniformMatrix4f(g),u_opacity:new p.Uniform1f(g),u_image:new p.Uniform1i(g),u_pattern_tl:new p.Uniform2f(g),u_pattern_br:new p.Uniform2f(g),u_texsize:new p.Uniform2f(g),u_pattern_size:new p.Uniform2f(g),u_pixel_coord_upper:new p.Uniform2f(g),u_pixel_coord_lower:new p.Uniform2f(g),u_tile_units_to_pixels:new p.Uniform1f(g)}),terrainRaster:Kn,terrainDepth:Kn,skybox:g=>({u_matrix:new p.UniformMatrix4f(g),u_sun_direction:new p.Uniform3f(g),u_cubemap:new p.Uniform1i(g),u_opacity:new p.Uniform1f(g),u_temporal_offset:new p.Uniform1f(g)}),skyboxGradient:g=>({u_matrix:new p.UniformMatrix4f(g),u_color_ramp:new p.Uniform1i(g),u_center_direction:new p.Uniform3f(g),u_radius:new p.Uniform1f(g),u_opacity:new p.Uniform1f(g),u_temporal_offset:new p.Uniform1f(g)}),skyboxCapture:g=>({u_matrix_3f:new p.UniformMatrix3f(g),u_sun_direction:new p.Uniform3f(g),u_sun_intensity:new p.Uniform1f(g),u_color_tint_r:new p.Uniform4f(g),u_color_tint_m:new p.Uniform4f(g),u_luminance:new p.Uniform1f(g)}),globeRaster:g=>({u_proj_matrix:new p.UniformMatrix4f(g),u_globe_matrix:new p.UniformMatrix4f(g),u_normalize_matrix:new p.UniformMatrix4f(g),u_merc_matrix:new p.UniformMatrix4f(g),u_zoom_transition:new p.Uniform1f(g),u_merc_center:new p.Uniform2f(g),u_image0:new p.Uniform1i(g),u_grid_matrix:new p.UniformMatrix3f(g),u_skirt_height:new p.Uniform1f(g),u_frustum_tl:new p.Uniform3f(g),u_frustum_tr:new p.Uniform3f(g),u_frustum_br:new p.Uniform3f(g),u_frustum_bl:new p.Uniform3f(g),u_globe_pos:new p.Uniform3f(g),u_globe_radius:new p.Uniform1f(g),u_viewport:new p.Uniform2f(g)}),globeAtmosphere:g=>({u_frustum_tl:new p.Uniform3f(g),u_frustum_tr:new p.Uniform3f(g),u_frustum_br:new p.Uniform3f(g),u_frustum_bl:new p.Uniform3f(g),u_horizon:new p.Uniform1f(g),u_transition:new p.Uniform1f(g),u_fadeout_range:new p.Uniform1f(g),u_color:new p.Uniform4f(g),u_high_color:new p.Uniform4f(g),u_space_color:new p.Uniform4f(g),u_star_intensity:new p.Uniform1f(g),u_star_density:new p.Uniform1f(g),u_star_size:new p.Uniform1f(g),u_temporal_offset:new p.Uniform1f(g),u_horizon_angle:new p.Uniform1f(g),u_rotation_matrix:new p.UniformMatrix4f(g)})};let ma;function jl(g,l,d,_,x,C,D){const S=g.context,k=S.gl,N=g.transform,F=g.useProgram("collisionBox"),j=[];let Y=0,ee=0;for(let de=0;de<_.length;de++){const be=_[de],Me=l.getTile(be),we=Me.getBucket(d);if(!we)continue;const Se=jn(be,we,N);let Ee=Se;0===x[0]&&0===x[1]||(Ee=g.translatePosMatrix(Se,Me,x,C));const Fe=D?we.textCollisionBox:we.iconCollisionBox,ot=we.collisionCircleArray;if(ot.length>0){const Oe=p.create(),Ze=Ee;p.mul(Oe,we.placementInvProjMatrix,N.glCoordMatrix),p.mul(Oe,Oe,we.placementViewportMatrix),j.push({circleArray:ot,circleOffset:ee,transform:Ze,invTransform:Oe,projection:we.getProjection()}),Y+=ot.length/4,ee=Y}Fe&&(g.terrain&&g.terrain.setupElevationDraw(Me,F),F.draw(S,k.LINES,p.DepthMode.disabled,p.StencilMode.disabled,g.colorModeForRenderPass(),p.CullFaceMode.disabled,ed(Ee,N,Me,we.getProjection()),d.id,Fe.layoutVertexBuffer,Fe.indexBuffer,Fe.segments,null,N.zoom,null,[Fe.collisionVertexBuffer,Fe.collisionVertexBufferExt]))}if(!D||!j.length)return;const re=g.useProgram("collisionCircle"),ie=new p.StructArrayLayout2f1f2i16;ie.resize(4*Y),ie._trim();let se=0;for(const de of j)for(let be=0;be<de.circleArray.length/4;be++){const Me=4*be,we=de.circleArray[Me+0],Se=de.circleArray[Me+1],Ee=de.circleArray[Me+2],Fe=de.circleArray[Me+3];ie.emplace(se++,we,Se,Ee,Fe,0),ie.emplace(se++,we,Se,Ee,Fe,1),ie.emplace(se++,we,Se,Ee,Fe,2),ie.emplace(se++,we,Se,Ee,Fe,3)}(!ma||ma.length<2*Y)&&(ma=function(de){const be=2*de,Me=new p.StructArrayLayout3ui6;Me.resize(be),Me._trim();for(let we=0;we<be;we++){const Se=6*we;Me.uint16[Se+0]=4*we+0,Me.uint16[Se+1]=4*we+1,Me.uint16[Se+2]=4*we+2,Me.uint16[Se+3]=4*we+2,Me.uint16[Se+4]=4*we+3,Me.uint16[Se+5]=4*we+0}return Me}(Y));const $=S.createIndexBuffer(ma,!0),Q=S.createVertexBuffer(ie,p.collisionCircleLayout.members,!0);for(const de of j){const be={u_matrix:de.transform,u_inv_matrix:de.invTransform,u_camera_to_center_distance:(ue=N).getCameraToCenterDistance(de.projection),u_viewport_size:[ue.width,ue.height]};re.draw(S,k.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,g.colorModeForRenderPass(),p.CullFaceMode.disabled,be,d.id,Q,$,p.SegmentVector.simpleSegment(0,2*de.circleOffset,de.circleArray.length,de.circleArray.length/2),null,N.zoom)}var ue;Q.destroy(),$.destroy()}const Ih=p.create();function Xc({width:g,height:l,anchor:d,textOffset:_,textScale:x},C){const{horizontalAlign:D,verticalAlign:S}=p.getAnchorAlignment(d),k=-(D-.5)*g,N=-(S-.5)*l,F=p.evaluateVariableOffset(d,_);return new p.Point((k/x+F[0])*C,(N/x+F[1])*C)}function uf(g,l,d,_,x,C,D,S,k,N,F){const j=g.text.placedSymbolArray,Y=g.text.dynamicLayoutVertexArray,ee=g.icon.dynamicLayoutVertexArray,re={},ie=g.getProjection(),se=ti(S,ie,C),$=C.elevation,Q=ie.upVectorScale(S.canonical,C.center.lat,C.worldSize).metersToTile;Y.clear();for(let ue=0;ue<j.length;ue++){const de=j.get(ue),{tileAnchorX:be,tileAnchorY:Me,numGlyphs:we}=de,Se=de.hidden||!de.crossTileID||g.allowVerticalPlacement&&!de.placedOrientation?null:_[de.crossTileID];if(Se){let Ee=0,Fe=0,ot=0;if($){const st=$?$.getAtTileOffset(S,be,Me):0,[vt,Ht,Et]=ie.upVector(S.canonical,be,Me);Ee=st*vt*Q,Fe=st*Ht*Q,ot=st*Et*Q}let[Oe,Ze,Be,it]=_r(de.projectedAnchorX+Ee,de.projectedAnchorY+Fe,de.projectedAnchorZ+ot,d?se:D);const Le=Xp(C.getCameraToCenterDistance(ie),it);let Ge=x.evaluateSizeForFeature(g.textSizeData,N,de)*Le/p.ONE_EM;d&&(Ge*=g.tilePixelRatio/k);const tt=Xc(Se,Ge);d?(({x:Oe,y:Ze,z:Be}=ie.projectTilePoint(be+tt.x,Me+tt.y,S.canonical)),[Oe,Ze,Be]=_r(Oe+Ee,Ze+Fe,Be+ot,D)):(l&&tt._rotate(-C.angle),Oe+=tt.x,Ze+=tt.y,Be=0);const Qe=g.allowVerticalPlacement&&de.placedOrientation===p.WritingMode.vertical?Math.PI/2:0;for(let st=0;st<we;st++)p.addDynamicAttributes(Y,Oe,Ze,Be,Qe);F&&de.associatedIconIndex>=0&&(re[de.associatedIconIndex]={x:Oe,y:Ze,z:Be,angle:Qe})}else Ti(we,Y)}if(F){ee.clear();const ue=g.icon.placedSymbolArray;for(let de=0;de<ue.length;de++){const be=ue.get(de),{numGlyphs:Me}=be,we=re[de];if(be.hidden||!we)Ti(Me,ee);else{const{x:Se,y:Ee,z:Fe,angle:ot}=we;for(let Oe=0;Oe<Me;Oe++)p.addDynamicAttributes(ee,Se,Ee,Fe,ot)}}g.icon.dynamicLayoutVertexBuffer.updateData(ee)}g.text.dynamicLayoutVertexBuffer.updateData(Y)}function id(g,l,d){return d.iconsInText&&l?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function $l(g,l,d,_,x,C,D,S,k,N,F,j){const Y=g.context,ee=Y.gl,re=g.transform,ie="map"===S,se="map"===k,$=ie&&"point"!==d.layout.get("symbol-placement"),Q=ie&&!se&&!$,ue=void 0!==d.layout.get("symbol-sort-key").constantOr(1);let de=!1;const be=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),Me=[p.mercatorXfromLng(re.center.lng),p.mercatorYfromLat(re.center.lat)],we=d.layout.get("text-variable-anchor"),Se="globe"===re.projection.name,Ee=[],Fe=[0,-1,0];let ot=Fe;!Se&&!re.mercatorFromTransition||ie||(ot=function(Oe){const Ze=Oe._camera.getWorldToCamera(Oe.worldSize,1),Be=p.multiply([],Ze,Oe.globeMatrix);p.invert(Be,Be);const it=[0,0,0],Le=[0,1,0,0];return p.transformMat4$1(Le,Le,Be),it[0]=Le[0],it[1]=Le[1],it[2]=Le[2],p.normalize(it,it),it}(re));for(const Oe of _){const Ze=l.getTile(Oe),Be=Ze.getBucket(d);if(!Be||"mercator"===Be.projection.name&&Se)continue;const it=x?Be.text:Be.icon;if(!it||Be.fullyClipped||!it.segments.get().length)continue;const Le=it.programConfigurations.get(d.id),Ge=x||Be.sdfIcons,tt=x?Be.textSizeData:Be.iconSizeData,Qe=se||0!==re.pitch,st=p.evaluateSizeForZoom(tt,re.zoom);let vt,Ht,Et,At,_n=[0,0],un=null;if(x)Ht=Ze.glyphAtlasTexture,Et=ee.LINEAR,vt=Ze.glyphAtlasTexture.size,Be.iconsInText&&(_n=Ze.imageAtlasTexture.size,un=Ze.imageAtlasTexture,At=Qe||g.options.rotating||g.options.zooming||"composite"===tt.kind||"camera"===tt.kind?ee.LINEAR:ee.NEAREST);else{const Qr=1!==d.layout.get("icon-size").constantOr(0)||Be.iconsNeedLinear;Ht=Ze.imageAtlasTexture,Et=Ge||g.options.rotating||g.options.zooming||Qr||Qe?ee.LINEAR:ee.NEAREST,vt=Ze.imageAtlasTexture.size}const Pt="globe"===Be.projection.name,dn=Pt?ot:Fe,$n=Pt?p.globeToMercatorTransition(re.zoom):0,Hn=ti(Oe,Be.getProjection(),re),Gn=re.calculatePixelsToTileUnitsMatrix(Ze),Ii=je(Hn,Ze.tileID.canonical,se,ie,re,Be.getProjection(),Gn),dr=g.terrain&&se&&$?p.invert(p.create(),Ii):Ih,So=Hi(Hn,Ze.tileID.canonical,se,ie,re,Be.getProjection(),Gn),Ko=we&&Be.hasTextData(),ai="none"!==d.layout.get("icon-text-fit")&&Ko&&Be.hasIconData();if($){const Qr=re.elevation,xa=Qr?Qr.getAtTileOffsetFunc(Oe,re.center.lat,re.worldSize,Be.getProjection()):null,rl=Us(Hn,Ze.tileID.canonical,se,ie,re,Be.getProjection(),Gn);vh(Be,Hn,g,x,rl,So,se,N,xa,Oe)}const Un=$||x&&we||ai,On=g.translatePosMatrix(Hn,Ze,C,D),Nt=Un?Ih:Ii,kr=g.translatePosMatrix(So,Ze,C,D,!0),fi=Be.getProjection().createInversionMatrix(re,Oe.canonical),Jr=[];g.terrainRenderModeElevated()&&se&&Jr.push("PITCH_WITH_MAP_TERRAIN"),Pt&&Jr.push("PROJECTION_GLOBE_VIEW"),Un&&Jr.push("PROJECTED_POS_ON_VIEWPORT");const hd=Ge&&0!==d.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1);let il;il=Ge?Be.iconsInText?nd(tt.kind,st,Q,se,g,On,Nt,kr,vt,_n,Oe,$n,Me,fi,dn,Be.getProjection()):Xa(tt.kind,st,Q,se,g,On,Nt,kr,x,vt,!0,Oe,$n,Me,fi,dn,Be.getProjection()):Nn(tt.kind,st,Q,se,g,On,Nt,kr,x,vt,Oe,$n,Me,fi,dn,Be.getProjection());const tc={program:g.useProgram(id(Ge,x,Be),Le,Jr),buffers:it,uniformValues:il,atlasTexture:Ht,atlasTextureIcon:un,atlasInterpolation:Et,atlasInterpolationIcon:At,isSDF:Ge,hasHalo:hd,tile:Ze,labelPlaneMatrixInv:dr};if(ue&&Be.canOverlap){de=!0;const Qr=it.segments.get();for(const xa of Qr)Ee.push({segments:new p.SegmentVector([xa]),sortKey:xa.sortKey,state:tc})}else Ee.push({segments:it.segments,sortKey:0,state:tc})}de&&Ee.sort((Oe,Ze)=>Oe.sortKey-Ze.sortKey);for(const Oe of Ee){const Ze=Oe.state;if(g.terrain&&g.terrain.setupElevationDraw(Ze.tile,Ze.program,{useDepthForOcclusion:!Se,labelPlaneMatrixInv:Ze.labelPlaneMatrixInv}),Y.activeTexture.set(ee.TEXTURE0),Ze.atlasTexture.bind(Ze.atlasInterpolation,ee.CLAMP_TO_EDGE),Ze.atlasTextureIcon&&(Y.activeTexture.set(ee.TEXTURE1),Ze.atlasTextureIcon&&Ze.atlasTextureIcon.bind(Ze.atlasInterpolationIcon,ee.CLAMP_TO_EDGE)),Ze.isSDF){const Be=Ze.uniformValues;Ze.hasHalo&&(Be.u_is_halo=1,Hl(Ze.buffers,Oe.segments,d,g,Ze.program,be,F,j,Be)),Be.u_is_halo=0}Hl(Ze.buffers,Oe.segments,d,g,Ze.program,be,F,j,Ze.uniformValues)}}function Hl(g,l,d,_,x,C,D,S,k){const N=_.context,F=[g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer,g.globeExtVertexBuffer];x.draw(N,N.gl.TRIANGLES,C,D,S,p.CullFaceMode.disabled,k,d.id,g.layoutVertexBuffer,g.indexBuffer,l,d.paint,_.transform.zoom,g.programConfigurations.get(d.id),F)}function Ah(g,l,d,_,x,C,D){const S=g.context.gl,k=d.paint.get("fill-pattern"),N=k&&k.constantOr(1);let F,j,Y,ee,re;D?(j=N&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=S.LINES):(j=N?"fillPattern":"fill",F=S.TRIANGLES);for(const ie of _){const se=l.getTile(ie);if(N&&!se.patternsLoaded())continue;const $=se.getBucket(d);if(!$)continue;g.prepareDrawTile();const Q=$.programConfigurations.get(d.id),ue=g.useProgram(j,Q);N&&(g.context.activeTexture.set(S.TEXTURE0),se.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),Q.updatePaintBuffers());const de=k.constantOr(null);if(de&&se.imageAtlas){const Me=se.imageAtlas.patternPositions[de.toString()];Me&&Q.setConstantPatternPositions(Me)}const be=g.translatePosMatrix(ie.projMatrix,se,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(D){ee=$.indexBuffer2,re=$.segments2;const Me=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[S.drawingBufferWidth,S.drawingBufferHeight];Y="fillOutlinePattern"===j&&N?Pm(be,g,se,Me):Bl(be,Me)}else ee=$.indexBuffer,re=$.segments,Y=N?Qu(be,g,se):Wa(be);g.prepareDrawProgram(g.context,ue,ie.toUnwrapped()),ue.draw(g.context,F,x,g.stencilModeForClipping(ie),C,p.CullFaceMode.disabled,Y,d.id,$.layoutVertexBuffer,ee,re,d.paint,g.transform.zoom,Q)}}function rd(g,l,d,_,x,C,D){const S=g.context,k=S.gl,N=g.transform,F=d.paint.get("fill-extrusion-pattern"),j=F.constantOr(1),Y=d.paint.get("fill-extrusion-opacity"),ee=[d.paint.get("fill-extrusion-ambient-occlusion-intensity"),d.paint.get("fill-extrusion-ambient-occlusion-radius")],re=d.layout.get("fill-extrusion-edge-radius"),ie=re>0&&!d.paint.get("fill-extrusion-rounded-roof"),se=ie?0:re,$="globe"===N.projection.name?p.fillExtrusionHeightLift():0,Q="globe"===N.projection.name,ue=Q?p.globeToMercatorTransition(N.zoom):0,de=[p.mercatorXfromLng(N.center.lng),p.mercatorYfromLat(N.center.lat)],be=[];Q&&be.push("PROJECTION_GLOBE_VIEW"),ee[0]>0&&be.push("FAUX_AO"),ie&&be.push("ZERO_ROOF_RADIUS");for(const Me of _){const we=l.getTile(Me),Se=we.getBucket(d);if(!Se||Se.projection.name!==N.projection.name)continue;const Ee=Se.programConfigurations.get(d.id),Fe=g.useProgram(j?"fillExtrusionPattern":"fillExtrusion",Ee,be);if(g.terrain){const Ge=g.terrain;if(g.style.terrainSetForDrapingOnly())Ge.setupElevationDraw(we,Fe,{useMeterToDem:!0});else{if(!Se.enableTerrain)continue;if(Ge.setupElevationDraw(we,Fe,{useMeterToDem:!0}),Ph(S,l,Me,Se,d,Ge),!Se.centroidVertexBuffer){const tt=Fe.attributes.a_centroid_pos;void 0!==tt&&k.vertexAttrib2f(tt,0,0)}}}j&&(g.context.activeTexture.set(k.TEXTURE0),we.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),Ee.updatePaintBuffers());const ot=F.constantOr(null);if(ot&&we.imageAtlas){const Ge=we.imageAtlas.patternPositions[ot.toString()];Ge&&Ee.setConstantPatternPositions(Ge)}const Oe=g.translatePosMatrix(Me.projMatrix,we,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Ze=N.projection.createInversionMatrix(N,Me.canonical),Be=d.paint.get("fill-extrusion-vertical-gradient"),it=j?lf(Oe,g,Be,Y,ee,se,Me,we,$,ue,de,Ze):Th(Oe,g,Be,Y,ee,se,Me,$,ue,de,Ze);g.prepareDrawProgram(S,Fe,Me.toUnwrapped());const Le=[];g.terrain&&Le.push(Se.centroidVertexBuffer),Q&&Le.push(Se.layoutVertexExtBuffer),Fe.draw(S,S.gl.TRIANGLES,x,C,D,p.CullFaceMode.backCCW,it,d.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segments,d.paint,g.transform.zoom,Ee,Le)}}function Ph(g,l,d,_,x,C){const D=[$=>{let Q=$.canonical.x-1,ue=$.wrap;return Q<0&&(Q=(1<<$.canonical.z)-1,ue--),new p.OverscaledTileID($.overscaledZ,ue,$.canonical.z,Q,$.canonical.y)},$=>{let Q=$.canonical.x+1,ue=$.wrap;return Q===1<<$.canonical.z&&(Q=0,ue++),new p.OverscaledTileID($.overscaledZ,ue,$.canonical.z,Q,$.canonical.y)},$=>new p.OverscaledTileID($.overscaledZ,$.wrap,$.canonical.z,$.canonical.x,(0===$.canonical.y?1<<$.canonical.z:$.canonical.y)-1),$=>new p.OverscaledTileID($.overscaledZ,$.wrap,$.canonical.z,$.canonical.x,$.canonical.y===(1<<$.canonical.z)-1?0:$.canonical.y+1)],S=$=>{const Q=l.getSource().minzoom,ue=be=>{const Me=l.getTileByID(be);if(Me&&Me.hasData())return Me.getBucket(x)},de=[0,-1,1];for(const be of de){if($.overscaledZ+be<Q)continue;const Me=ue($.calculateScaledKey($.overscaledZ+be));if(Me)return Me}},k=[0,0,0],N=($,Q)=>(k[0]=Math.min($.min.y,Q.min.y),k[1]=Math.max($.max.y,Q.max.y),k[2]=p.EXTENT-Q.min.x>$.max.x?Q.min.x-p.EXTENT:$.max.x,k),F=($,Q)=>(k[0]=Math.min($.min.x,Q.min.x),k[1]=Math.max($.max.x,Q.max.x),k[2]=p.EXTENT-Q.min.y>$.max.y?Q.min.y-p.EXTENT:$.max.y,k),j=[($,Q)=>N($,Q),($,Q)=>N(Q,$),($,Q)=>F($,Q),($,Q)=>F(Q,$)],Y=new p.Point(0,0);let ee,re,ie;const se=($,Q,ue,de,be)=>{const Me=[[de?ue:$,de?$:ue,0],[de?ue:Q,de?Q:ue,0]],we=be<0?p.EXTENT+be:be,Se=[de?we:($+Q)/2,de?($+Q)/2:we,0];return 0===ue&&be<0||0!==ue&&be>0?C.getForTilePoints(ie,[Se],!0,re):Me.push(Se),C.getForTilePoints(d,Me,!0,ee),Math.max(Me[0][2],Me[1][2],Se[2])/C.exaggeration()};for(let $=0;$<4;$++){const Q=($<2?1:5)-$,ue=_.borders[$];if(0===ue.length)continue;const de=ie=D[$](d),be=S(de);if(!(be&&be instanceof p.FillExtrusionBucket&&be.enableTerrain)||_.borderDoneWithNeighborZ[$]===be.canonical.z&&be.borderDoneWithNeighborZ[Q]===_.canonical.z||(re=C.findDEMTileFor(de),!re||!re.dem))continue;if(!ee){const Ee=C.findDEMTileFor(d);if(!Ee||!Ee.dem)return;ee=Ee}const Me=be.borders[Q];let we=0;const Se=be.borderDoneWithNeighborZ[Q]!==_.canonical.z;if(_.canonical.z===be.canonical.z){for(let Ee=0;Ee<ue.length;Ee++){const Fe=_.featuresOnBorder[ue[Ee]],ot=Fe.borders[$];let Oe;for(;we<Me.length&&(Oe=be.featuresOnBorder[Me[we]],!(Oe.borders[Q][1]>ot[0]+3));)Se&&be.encodeCentroid(void 0,Oe,!1),we++;if(Oe&&we<Me.length){const Ze=we;let Be=0;for(;!(Oe.borders[Q][0]>ot[1]-3)&&(Be++,++we!==Me.length);)Oe=be.featuresOnBorder[Me[we]];if(Oe=be.featuresOnBorder[Me[Ze]],Fe.intersectsCount()>1||Oe.intersectsCount()>1||1!==Be){1!==Be&&(we=Ze),_.encodeCentroid(void 0,Fe,!1),Se&&be.encodeCentroid(void 0,Oe,!1);continue}const it=j[$](Fe,Oe),Le=$%2?p.EXTENT-1:0;Y.x=se(it[0],Math.min(p.EXTENT-1,it[1]),Le,$<2,it[2]),Y.y=0,_.encodeCentroid(Y,Fe,!1),Se&&be.encodeCentroid(Y,Oe,!1)}else _.encodeCentroid(void 0,Fe,!1)}_.borderDoneWithNeighborZ[$]=be.canonical.z,_.needsCentroidUpdate=!0,Se&&(be.borderDoneWithNeighborZ[Q]=_.canonical.z,be.needsCentroidUpdate=!0)}else{for(const Ee of ue)_.encodeCentroid(void 0,_.featuresOnBorder[Ee],!1);if(Se){for(const Ee of Me)be.encodeCentroid(void 0,be.featuresOnBorder[Ee],!1);be.borderDoneWithNeighborZ[Q]=_.canonical.z,be.needsCentroidUpdate=!0}_.borderDoneWithNeighborZ[$]=be.canonical.z,_.needsCentroidUpdate=!0}}(_.needsCentroidUpdate||!_.centroidVertexBuffer&&0!==_.centroidVertexArray.length)&&_.uploadCentroid(g)}const Gl=new p.Color(1,0,0,1),km=new p.Color(0,1,0,1),Zo=new p.Color(0,0,1,1),Om=new p.Color(1,0,1,1),df=new p.Color(0,1,1,1);function Lm(g,l,d){const _=g.context,x=g.transform,C=_.gl,D="globe"===x.projection.name,S=D?["PROJECTION_GLOBE_VIEW"]:null;let k=d.projMatrix;if(D&&p.globeToMercatorTransition(x.zoom)>0){const Fe=p.transitionTileAABBinECEF(d.canonical,x),ot=p.globeDenormalizeECEF(Fe);k=p.multiply(new Float32Array(16),x.globeMatrix,ot),p.multiply(k,x.projMatrix,k)}const N=g.useProgram("debug",null,S),F=l.getTileByID(d.key);g.terrain&&g.terrain.setupElevationDraw(F,N);const j=p.DepthMode.disabled,Y=p.StencilMode.disabled,ee=g.colorModeForRenderPass();_.activeTexture.set(C.TEXTURE0),g.emptyTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),D?F._makeGlobeTileDebugBuffers(g.context,x):F._makeDebugTileBoundsBuffers(g.context,x.projection);const ie=F._tileDebugBuffer||g.debugBuffer,se=F._tileDebugIndexBuffer||g.debugIndexBuffer,$=F._tileDebugSegments||g.debugSegments;N.draw(_,C.LINE_STRIP,j,Y,ee,p.CullFaceMode.disabled,It(k,p.Color.red),"$debug",ie,se,$,null,null,null,[F._globeTileDebugBorderBuffer]);const Q=F.latestRawTileData,ue=Math.floor((Q&&Q.byteLength||0)/1024),de=l.getTile(d).tileSize,be=512/Math.min(de,512)*(d.overscaledZ/x.zoom)*.5;let Me=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(Me+=` => ${d.overscaledZ}`),Me+=` ${ue}kb`,function(Fe,ot){Fe.initDebugOverlayCanvas();const Oe=Fe.debugOverlayCanvas,Ze=Fe.context.gl,Be=Fe.debugOverlayCanvas.getContext("2d");Be.clearRect(0,0,Oe.width,Oe.height),Be.shadowColor="white",Be.shadowBlur=2,Be.lineWidth=1.5,Be.strokeStyle="white",Be.textBaseline="top",Be.font="bold 36px Open Sans, sans-serif",Be.fillText(ot,5,5),Be.strokeText(ot,5,5),Fe.debugOverlayTexture.update(Oe),Fe.debugOverlayTexture.bind(Ze.LINEAR,Ze.CLAMP_TO_EDGE)}(g,Me);const we=F._tileDebugTextBuffer||g.debugBuffer,Se=F._tileDebugTextIndexBuffer||g.quadTriangleIndexBuffer,Ee=F._tileDebugTextSegments||g.debugSegments;N.draw(_,C.TRIANGLES,j,Y,p.ColorMode.alphaBlended,p.CullFaceMode.disabled,It(k,p.Color.transparent,be),"$debug",we,Se,Ee,null,null,null,[F._globeTileDebugTextBuffer])}function hf(g,l,d,_){ql(g,0,l+d/2,g.transform.width,d,_)}function od(g,l,d,_){ql(g,l-d/2,0,d,g.transform.height,_)}function ql(g,l,d,_,x,C){const D=g.context,S=D.gl;S.enable(S.SCISSOR_TEST),S.scissor(l*p.exported.devicePixelRatio,d*p.exported.devicePixelRatio,_*p.exported.devicePixelRatio,x*p.exported.devicePixelRatio),D.clear({color:C}),S.disable(S.SCISSOR_TEST)}const kh=p.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:pf}=kh;function $s(g,l,d,_){g.emplaceBack(l,d,_)}class sd{constructor(l){this.vertexArray=new p.StructArrayLayout3f12,this.indices=new p.StructArrayLayout3ui6,$s(this.vertexArray,-1,-1,1),$s(this.vertexArray,1,-1,1),$s(this.vertexArray,-1,1,1),$s(this.vertexArray,1,1,1),$s(this.vertexArray,-1,-1,-1),$s(this.vertexArray,1,-1,-1),$s(this.vertexArray,-1,1,-1),$s(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=l.createVertexBuffer(this.vertexArray,pf),this.indexBuffer=l.createIndexBuffer(this.indices),this.segment=p.SegmentVector.simpleSegment(0,0,36,12)}}function mi(g,l,d,_,x,C){const D=g.gl,S=l.paint.get("sky-atmosphere-color"),k=l.paint.get("sky-atmosphere-halo-color"),N=l.paint.get("sky-atmosphere-sun-intensity"),F={u_matrix_3f:p.fromMat4(p.create$1(),_),u_sun_direction:x,u_sun_intensity:N,u_color_tint_r:[(re=S).r,re.g,re.b,re.a],u_color_tint_m:[(ie=k).r,ie.g,ie.b,ie.a],u_luminance:5e-5};var re,ie;D.framebufferTexture2D(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,D.TEXTURE_CUBE_MAP_POSITIVE_X+C,l.skyboxTexture,0),d.draw(g,D.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.frontCW,F,"skyboxCapture",l.skyboxGeometry.vertexBuffer,l.skyboxGeometry.indexBuffer,l.skyboxGeometry.segment)}const Yc=p.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class ff{constructor(l){const d=new p.StructArrayLayout5f20;d.emplaceBack(-1,1,1,0,0),d.emplaceBack(1,1,1,1,0),d.emplaceBack(1,-1,1,1,1),d.emplaceBack(-1,-1,1,0,1);const _=new p.StructArrayLayout3ui6;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=l.createVertexBuffer(d,Yc.members),this.indexBuffer=l.createIndexBuffer(_),this.segments=p.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Ya={symbol:function(g,l,d,_,x){if("translucent"!==g.renderPass)return;const C=p.StencilMode.disabled,D=g.colorModeForRenderPass();d.layout.get("text-variable-anchor")&&function(S,k,N,F,j,Y,ee){const re=k.transform,ie="map"===j,se="map"===Y;for(const $ of S){const Q=F.getTile($),ue=Q.getBucket(N);if(!ue||!ue.text||!ue.text.segments.get().length)continue;const de=p.evaluateSizeForZoom(ue.textSizeData,re.zoom),be=ti($,ue.getProjection(),re),Me=re.calculatePixelsToTileUnitsMatrix(Q),we=je(be,Q.tileID.canonical,se,ie,re,ue.getProjection(),Me),Se="none"!==N.layout.get("icon-text-fit")&&ue.hasIconData();if(de){const Ee=Math.pow(2,re.zoom-Q.tileID.overscaledZ);uf(ue,ie,se,ee,p.symbolSize,re,we,$,Ee,de,Se)}}}(_,g,d,l,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),x),0!==d.paint.get("icon-opacity").constantOr(1)&&$l(g,l,d,_,!1,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),d.layout.get("icon-rotation-alignment"),d.layout.get("icon-pitch-alignment"),d.layout.get("icon-keep-upright"),C,D),0!==d.paint.get("text-opacity").constantOr(1)&&$l(g,l,d,_,!0,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),d.layout.get("text-keep-upright"),C,D),l.map.showCollisionBoxes&&(jl(g,l,d,_,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),jl(g,l,d,_,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))},circle:function(g,l,d,_){if("translucent"!==g.renderPass)return;const x=d.paint.get("circle-opacity"),C=d.paint.get("circle-stroke-width"),D=d.paint.get("circle-stroke-opacity"),S=void 0!==d.layout.get("circle-sort-key").constantOr(1);if(0===x.constantOr(1)&&(0===C.constantOr(1)||0===D.constantOr(1)))return;const k=g.context,N=k.gl,F=g.transform,j=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),Y=p.StencilMode.disabled,ee=g.colorModeForRenderPass(),re="globe"===F.projection.name,ie=[p.mercatorXfromLng(F.center.lng),p.mercatorYfromLat(F.center.lat)],se=[];for(let Q=0;Q<_.length;Q++){const ue=_[Q],de=l.getTile(ue),be=de.getBucket(d);if(!be||be.projection.name!==F.projection.name)continue;const Me=be.programConfigurations.get(d.id),we=Ft(d);re&&we.push("PROJECTION_GLOBE_VIEW");const Se=g.useProgram("circle",Me,we),Ee=be.layoutVertexBuffer,Fe=be.globeExtVertexBuffer,ot=be.indexBuffer,Oe=F.projection.createInversionMatrix(F,ue.canonical),Ze={programConfiguration:Me,program:Se,layoutVertexBuffer:Ee,globeExtVertexBuffer:Fe,indexBuffer:ot,uniformValues:Dh(g,ue,de,Oe,ie,d),tile:de};if(S){const Be=be.segments.get();for(const it of Be)se.push({segments:new p.SegmentVector([it]),sortKey:it.sortKey,state:Ze})}else se.push({segments:be.segments,sortKey:0,state:Ze})}S&&se.sort((Q,ue)=>Q.sortKey-ue.sortKey);const $={useDepthForOcclusion:!re};for(const Q of se){const{programConfiguration:ue,program:de,layoutVertexBuffer:be,globeExtVertexBuffer:Me,indexBuffer:we,uniformValues:Se,tile:Ee}=Q.state,Fe=Q.segments;g.terrain&&g.terrain.setupElevationDraw(Ee,de,$),g.prepareDrawProgram(k,de,Ee.tileID.toUnwrapped()),de.draw(k,N.TRIANGLES,j,Y,ee,p.CullFaceMode.disabled,Se,d.id,be,we,Fe,d.paint,F.zoom,ue,[Me])}},heatmap:function(g,l,d,_){if(0!==d.paint.get("heatmap-opacity"))if("offscreen"===g.renderPass){const x=g.context,C=x.gl,D=p.StencilMode.disabled,S=new p.ColorMode([C.ONE,C.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(ee,re,ie,se){const $=ee.gl,Q=re.width*se,ue=re.height*se;ee.activeTexture.set($.TEXTURE1),ee.viewport.set([0,0,Q,ue]);let de=ie.heatmapFbo;if(!de||de&&(de.width!==Q||de.height!==ue)){de&&de.destroy();const be=$.createTexture();$.bindTexture($.TEXTURE_2D,be),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MIN_FILTER,$.LINEAR),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MAG_FILTER,$.LINEAR),de=ie.heatmapFbo=ee.createFramebuffer(Q,ue,!1),function(Me,we,Se,Ee,Fe,ot){const Oe=Me.gl;Oe.texImage2D(Oe.TEXTURE_2D,0,Me.isWebGL2&&Me.extRenderToTextureHalfFloat?Oe.RGBA16F:Oe.RGBA,Fe,ot,0,Oe.RGBA,Me.extRenderToTextureHalfFloat?Me.isWebGL2?Oe.HALF_FLOAT:Me.extTextureHalfFloat.HALF_FLOAT_OES:Oe.UNSIGNED_BYTE,null),Ee.colorAttachment.set(Se)}(ee,0,be,de,Q,ue)}else $.bindTexture($.TEXTURE_2D,de.colorAttachment.get()),ee.bindFramebuffer.set(de.framebuffer)})(x,g,d,"globe"===g.transform.projection.name?.5:.25),x.clear({color:p.Color.transparent});const k=g.transform,N="globe"===k.projection.name,F=N?["PROJECTION_GLOBE_VIEW"]:null,j=N?p.CullFaceMode.frontCCW:p.CullFaceMode.disabled,Y=[p.mercatorXfromLng(k.center.lng),p.mercatorYfromLat(k.center.lat)];for(let ee=0;ee<_.length;ee++){const re=_[ee];if(l.hasRenderableParent(re))continue;const ie=l.getTile(re),se=ie.getBucket(d);if(!se||se.projection.name!==k.projection.name)continue;const $=se.programConfigurations.get(d.id),Q=g.useProgram("heatmap",$,F),{zoom:ue}=g.transform;g.terrain&&g.terrain.setupElevationDraw(ie,Q),g.prepareDrawProgram(x,Q,re.toUnwrapped());const de=k.projection.createInversionMatrix(k,re.canonical);Q.draw(x,C.TRIANGLES,p.DepthMode.disabled,D,S,j,td(g,re,ie,de,Y,ue,d.paint.get("heatmap-intensity")),d.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,d.paint,g.transform.zoom,$,N?[se.globeExtVertexBuffer]:null)}x.viewport.set([0,0,g.width,g.height])}else"translucent"===g.renderPass&&(g.context.setColorMode(g.colorModeForRenderPass()),function(x,C){const D=x.context,S=D.gl,k=C.heatmapFbo;if(!k)return;D.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,k.colorAttachment.get()),D.activeTexture.set(S.TEXTURE1);let N=C.colorRampTexture;N||(N=C.colorRampTexture=new p.Texture(D,C.colorRamp,S.RGBA)),N.bind(S.LINEAR,S.CLAMP_TO_EDGE),x.useProgram("heatmapTexture").draw(D,S.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,x.colorModeForRenderPass(),p.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:C.paint.get("heatmap-opacity")},C.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,C.paint,x.transform.zoom)}(g,d))},line:function(g,l,d,_){if("translucent"!==g.renderPass)return;const x=d.paint.get("line-opacity"),C=d.paint.get("line-width");if(0===x.constantOr(1)||0===C.constantOr(1))return;const D=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),S=g.colorModeForRenderPass(),k=g.terrain&&g.terrain.renderingToTexture?1:p.exported.devicePixelRatio,N=d.paint.get("line-dasharray"),F=N.constantOr(1),j=d.layout.get("line-cap"),Y=d.paint.get("line-pattern"),ee=Y.constantOr(1),re=d.paint.get("line-gradient"),ie=ee?"linePattern":"line",se=g.context,$=se.gl,Q=(de=>{const be=[];oo(de)&&be.push("RENDER_LINE_DASH"),de.paint.get("line-gradient")&&be.push("RENDER_LINE_GRADIENT");const Me=de.paint.get("line-trim-offset");0===Me[0]&&0===Me[1]||be.push("RENDER_LINE_TRIM_OFFSET");const we=de.paint.get("line-pattern").constantOr(1),Se=1!==de.paint.get("line-opacity").constantOr(1);return!we&&Se&&be.push("RENDER_LINE_ALPHA_DISCARD"),be})(d);let ue=Q.includes("RENDER_LINE_ALPHA_DISCARD");g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&(ue=!1);for(const de of _){const be=l.getTile(de);if(ee&&!be.patternsLoaded())continue;const Me=be.getBucket(d);if(!Me)continue;g.prepareDrawTile();const we=Me.programConfigurations.get(d.id),Se=g.useProgram(ie,we,Q),Ee=Y.constantOr(null);if(Ee&&be.imageAtlas){const Ge=be.imageAtlas.patternPositions[Ee.toString()];Ge&&we.setConstantPatternPositions(Ge)}const Fe=N.constantOr(null),ot=j.constantOr(null);if(!ee&&Fe&&ot&&be.lineAtlas){const Ge=be.lineAtlas.getDash(Fe,ot);Ge&&we.setConstantPatternPositions(Ge)}let[Oe,Ze]=d.paint.get("line-trim-offset");("round"===ot||"square"===ot)&&Oe!==Ze&&(0===Oe&&(Oe-=1),1===Ze&&(Ze+=1));const Be=g.terrain?de.projMatrix:null,it=ee?Zc(g,be,d,Be,k):qc(g,be,d,Be,Me.lineClipsArray.length,k,[Oe,Ze]);if(re){const Ge=Me.gradients[d.id];let tt=Ge.texture;if(d.gradientVersion!==Ge.version){let Qe=256;if(d.stepInterpolant){const st=l.getSource().maxzoom,vt=de.canonical.z===st?Math.ceil(1<<g.transform.maxZoom-de.canonical.z):1;Qe=p.clamp(p.nextPowerOfTwo(Me.maxLineLength/p.EXTENT*1024*vt),256,se.maxTextureSize)}Ge.gradient=p.renderColorRamp({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:Qe,image:Ge.gradient||void 0,clips:Me.lineClipsArray}),Ge.texture?Ge.texture.update(Ge.gradient):Ge.texture=new p.Texture(se,Ge.gradient,$.RGBA),Ge.version=d.gradientVersion,tt=Ge.texture}se.activeTexture.set($.TEXTURE1),tt.bind(d.stepInterpolant?$.NEAREST:$.LINEAR,$.CLAMP_TO_EDGE)}F&&(se.activeTexture.set($.TEXTURE0),be.lineAtlasTexture.bind($.LINEAR,$.REPEAT),we.updatePaintBuffers()),ee&&(se.activeTexture.set($.TEXTURE0),be.imageAtlasTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),we.updatePaintBuffers()),g.prepareDrawProgram(se,Se,de.toUnwrapped());const Le=Ge=>{Se.draw(se,$.TRIANGLES,D,Ge,S,p.CullFaceMode.disabled,it,d.id,Me.layoutVertexBuffer,Me.indexBuffer,Me.segments,d.paint,g.transform.zoom,we,[Me.layoutVertexBuffer2])};if(ue){const Ge=g.stencilModeForClipping(de).ref;0===Ge&&g.terrain&&se.clear({stencil:0});const tt={func:$.EQUAL,mask:255};it.u_alpha_discard_threshold=.8,Le(new p.StencilMode(tt,Ge,255,$.KEEP,$.KEEP,$.INVERT)),it.u_alpha_discard_threshold=0,Le(new p.StencilMode(tt,Ge,255,$.KEEP,$.KEEP,$.KEEP))}else Le(g.stencilModeForClipping(de))}ue&&(g.resetStencilClippingMasks(),g.terrain&&se.clear({stencil:0}))},fill:function(g,l,d,_){const x=d.paint.get("fill-color"),C=d.paint.get("fill-opacity");if(0===C.constantOr(1))return;const D=g.colorModeForRenderPass(),S=d.paint.get("fill-pattern"),k=g.opaquePassEnabledForLayer()&&!S.constantOr(1)&&1===x.constantOr(p.Color.transparent).a&&1===C.constantOr(0)?"opaque":"translucent";if(g.renderPass===k){const N=g.depthModeForSublayer(1,"opaque"===g.renderPass?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly);Ah(g,l,d,_,N,D,!1)}if("translucent"===g.renderPass&&d.paint.get("fill-antialias")){const N=g.depthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,p.DepthMode.ReadOnly);Ah(g,l,d,_,N,D,!0)}},"fill-extrusion":function(g,l,d,_){const x=d.paint.get("fill-extrusion-opacity");if(0!==x&&"translucent"===g.renderPass){const C=new p.DepthMode(g.context.gl.LEQUAL,p.DepthMode.ReadWrite,g.depthRangeFor3D);if(1!==x||d.paint.get("fill-extrusion-pattern").constantOr(1))rd(g,l,d,_,C,p.StencilMode.disabled,p.ColorMode.disabled),rd(g,l,d,_,C,g.stencilModeFor3D(),g.colorModeForRenderPass()),g.resetStencilClippingMasks();else{const D=g.colorModeForRenderPass();rd(g,l,d,_,C,p.StencilMode.disabled,D)}}},hillshade:function(g,l,d,_){if("offscreen"!==g.renderPass&&"translucent"!==g.renderPass)return;const x=g.context,C=g.depthModeForSublayer(0,p.DepthMode.ReadOnly),D=g.colorModeForRenderPass(),S=g.terrain&&g.terrain.renderingToTexture,[k,N]="translucent"!==g.renderPass||S?[{},_]:g.stencilConfigForOverlap(_);for(const F of N){const j=l.getTile(F);if(j.needsHillshadePrepare&&"offscreen"===g.renderPass)Am(g,j,d,C,p.StencilMode.disabled,D);else if("translucent"===g.renderPass){const Y=S&&g.terrain?g.terrain.stencilModeForRTTOverlap(F):k[F.overscaledZ];Ur(g,F,j,d,C,Y,D)}}x.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,l,d,_,x,C){if("translucent"!==g.renderPass||0===d.paint.get("raster-opacity")||!_.length)return;const D=g.context,S=D.gl,k=l.getSource(),N=g.useProgram("raster"),F=g.colorModeForRenderPass(),j=g.terrain&&g.terrain.renderingToTexture,[Y,ee]=k instanceof hn||j?[{},_]:g.stencilConfigForOverlap(_),re=ee[ee.length-1].overscaledZ,ie=!g.options.moving;for(const se of ee){const $=j?p.DepthMode.disabled:g.depthModeForSublayer(se.overscaledZ-re,1===d.paint.get("raster-opacity")?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly,S.LESS),Q=se.toUnwrapped(),ue=l.getTile(se);if(j&&(!ue||!ue.hasData()))continue;const de=j?se.projMatrix:g.transform.calculateProjMatrix(Q,ie),be=g.terrain&&j?g.terrain.stencilModeForRTTOverlap(se):Y[se.overscaledZ],Me=C?0:d.paint.get("raster-fade-duration");ue.registerFadeDuration(Me);const we=l.findLoadedParent(se,0),Se=rf(ue,we,l,g.transform,Me);let Ee,Fe;g.terrain&&g.terrain.prepareDrawTile();const ot="nearest"===d.paint.get("raster-resampling")?S.NEAREST:S.LINEAR;D.activeTexture.set(S.TEXTURE0),ue.texture.bind(ot,S.CLAMP_TO_EDGE),D.activeTexture.set(S.TEXTURE1),we?(we.texture.bind(ot,S.CLAMP_TO_EDGE),Ee=Math.pow(2,we.tileID.overscaledZ-ue.tileID.overscaledZ),Fe=[ue.tileID.canonical.x*Ee%1,ue.tileID.canonical.y*Ee%1]):ue.texture.bind(ot,S.CLAMP_TO_EDGE),ue.texture.useMipmap&&D.extTextureFilterAnisotropic&&g.transform.pitch>20&&S.texParameterf(S.TEXTURE_2D,D.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,D.extTextureFilterAnisotropicMax);const Oe=Ul(de,Fe||[0,0],Ee||1,Se,d,k instanceof hn?k.perspectiveTransform:[0,0]);if(g.prepareDrawProgram(D,N,Q),k instanceof hn)k.boundsBuffer&&k.boundsSegments&&N.draw(D,S.TRIANGLES,$,p.StencilMode.disabled,F,p.CullFaceMode.disabled,Oe,d.id,k.boundsBuffer,g.quadTriangleIndexBuffer,k.boundsSegments);else{const{tileBoundsBuffer:Ze,tileBoundsIndexBuffer:Be,tileBoundsSegments:it}=g.getTileBoundsBuffers(ue);N.draw(D,S.TRIANGLES,$,be,F,p.CullFaceMode.disabled,Oe,d.id,Ze,Be,it)}}g.resetStencilClippingMasks()},background:function(g,l,d,_){const x=d.paint.get("background-color"),C=d.paint.get("background-opacity");if(0===C)return;const D=g.context,S=D.gl,k=g.transform,N=k.tileSize,F=d.paint.get("background-pattern");if(g.isPatternMissing(F))return;const j=!F&&1===x.a&&1===C&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==j)return;const Y=p.StencilMode.disabled,ee=g.depthModeForSublayer(0,"opaque"===j?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly),re=g.colorModeForRenderPass(),ie=g.useProgram(F?"backgroundPattern":"background");let se,$=_;$||(se=g.getBackgroundTiles(),$=Object.values(se).map(Q=>Q.tileID)),F&&(D.activeTexture.set(S.TEXTURE0),g.imageManager.bind(g.context));for(const Q of $){const ue=Q.toUnwrapped(),de=_?Q.projMatrix:g.transform.calculateProjMatrix(ue);g.prepareDrawTile();const be=l?l.getTile(Q):se?se[Q.key]:new p.Tile(Q,N,k.zoom,g),Me=F?cf(de,C,g,F,{tileID:Q,tileSize:N}):Wc(de,C,x);g.prepareDrawProgram(D,ie,ue);const{tileBoundsBuffer:we,tileBoundsIndexBuffer:Se,tileBoundsSegments:Ee}=g.getTileBoundsBuffers(be);ie.draw(D,S.TRIANGLES,ee,Y,re,p.CullFaceMode.disabled,Me,d.id,we,Se,Ee)}},sky:function(g,l,d){const _=g.transform,x="mercator"===_.projection.name||"globe"===_.projection.name?1:p.smoothstep(7,8,_.zoom),C=d.paint.get("sky-opacity")*x;if(0===C)return;const D=g.context,S=d.paint.get("sky-type"),k=new p.DepthMode(D.gl.LEQUAL,p.DepthMode.ReadOnly,[0,1]),N=g.frameCounter/1e3%1;"atmosphere"===S?"offscreen"===g.renderPass?d.needsSkyboxCapture(g)&&(function(F,j,Y,ee){const re=F.context,ie=re.gl;let se=j.skyboxFbo;if(!se){se=j.skyboxFbo=re.createFramebuffer(32,32,!1),j.skyboxGeometry=new sd(re),j.skyboxTexture=re.gl.createTexture(),ie.bindTexture(ie.TEXTURE_CUBE_MAP,j.skyboxTexture),ie.texParameteri(ie.TEXTURE_CUBE_MAP,ie.TEXTURE_WRAP_S,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_CUBE_MAP,ie.TEXTURE_WRAP_T,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_CUBE_MAP,ie.TEXTURE_MIN_FILTER,ie.LINEAR),ie.texParameteri(ie.TEXTURE_CUBE_MAP,ie.TEXTURE_MAG_FILTER,ie.LINEAR);for(let de=0;de<6;++de)ie.texImage2D(ie.TEXTURE_CUBE_MAP_POSITIVE_X+de,0,ie.RGBA,32,32,0,ie.RGBA,ie.UNSIGNED_BYTE,null)}re.bindFramebuffer.set(se.framebuffer),re.viewport.set([0,0,32,32]);const $=j.getCenter(F,!0),Q=F.useProgram("skyboxCapture"),ue=new Float64Array(16);p.identity(ue),p.rotateY(ue,ue,.5*-Math.PI),mi(re,j,Q,ue,$,0),p.identity(ue),p.rotateY(ue,ue,.5*Math.PI),mi(re,j,Q,ue,$,1),p.identity(ue),p.rotateX(ue,ue,.5*-Math.PI),mi(re,j,Q,ue,$,2),p.identity(ue),p.rotateX(ue,ue,.5*Math.PI),mi(re,j,Q,ue,$,3),p.identity(ue),mi(re,j,Q,ue,$,4),p.identity(ue),p.rotateY(ue,ue,Math.PI),mi(re,j,Q,ue,$,5),re.viewport.set([0,0,F.width,F.height])}(g,d),d.markSkyboxValid(g)):"sky"===g.renderPass&&function(F,j,Y,ee,re){const ie=F.context,se=ie.gl,$=F.transform,Q=F.useProgram("skybox");ie.activeTexture.set(se.TEXTURE0),se.bindTexture(se.TEXTURE_CUBE_MAP,j.skyboxTexture);const ue={u_matrix:$.skyboxMatrix,u_sun_direction:j.getCenter(F,!1),u_cubemap:0,u_opacity:ee,u_temporal_offset:re};F.prepareDrawProgram(ie,Q),Q.draw(ie,se.TRIANGLES,Y,p.StencilMode.disabled,F.colorModeForRenderPass(),p.CullFaceMode.backCW,ue,"skybox",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(g,d,k,C,N):"gradient"===S&&"sky"===g.renderPass&&function(F,j,Y,ee,re){const ie=F.context,se=ie.gl,$=F.transform,Q=F.useProgram("skyboxGradient");j.skyboxGeometry||(j.skyboxGeometry=new sd(ie)),ie.activeTexture.set(se.TEXTURE0);let ue=j.colorRampTexture;ue||(ue=j.colorRampTexture=new p.Texture(ie,j.colorRamp,se.RGBA)),ue.bind(se.LINEAR,se.CLAMP_TO_EDGE);const de=(be=$.skyboxMatrix,Me=j.getCenter(F,!1),we=j.paint.get("sky-gradient-radius"),Se=ee,Ee=re,{u_matrix:be,u_color_ramp:0,u_center_direction:Me,u_radius:p.degToRad(we),u_opacity:Se,u_temporal_offset:Ee});var be,Me,we,Se,Ee;F.prepareDrawProgram(ie,Q),Q.draw(ie,se.TRIANGLES,Y,p.StencilMode.disabled,F.colorModeForRenderPass(),p.CullFaceMode.backCW,de,"skyboxGradient",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(g,d,k,C,N)},debug:function(g,l,d){for(let _=0;_<d.length;_++)Lm(g,l,d[_])},custom:function(g,l,d,_){const x=g.context,C=d.implementation;if(!g.transform.projection.unsupportedLayers||!g.transform.projection.unsupportedLayers.includes("custom")||g.terrain&&(g.terrain.renderingToTexture||"offscreen"===g.renderPass)&&d.isLayerDraped()){if("offscreen"===g.renderPass){const D=C.prerender;if(D){if(g.setCustomLayerDefaults(),x.setColorMode(g.colorModeForRenderPass()),"globe"===g.transform.projection.name){const S=g.transform.pointMerc;D.call(C,x.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),p.globeToMercatorTransition(g.transform.zoom),[S.x,S.y],g.transform.pixelsPerMeterRatio)}else D.call(C,x.gl,g.transform.customLayerMatrix());x.setDirty(),g.setBaseState()}}else if("translucent"===g.renderPass){if(g.terrain&&g.terrain.renderingToTexture){const S=C.renderToTile;if(S){const k=_[0].canonical,N=new p.MercatorCoordinate(k.x+_[0].wrap*(1<<k.z),k.y,k.z);x.setDepthMode(p.DepthMode.disabled),x.setStencilMode(p.StencilMode.disabled),x.setColorMode(g.colorModeForRenderPass()),g.setCustomLayerDefaults(),S.call(C,x.gl,N),x.setDirty(),g.setBaseState()}return}g.setCustomLayerDefaults(),x.setColorMode(g.colorModeForRenderPass()),x.setStencilMode(p.StencilMode.disabled);const D="3d"===C.renderingMode?new p.DepthMode(g.context.gl.LEQUAL,p.DepthMode.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,p.DepthMode.ReadOnly);if(x.setDepthMode(D),"globe"===g.transform.projection.name){const S=g.transform.pointMerc;C.render(x.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),p.globeToMercatorTransition(g.transform.zoom),[S.x,S.y],g.transform.pixelsPerMeterRatio)}else C.render(x.gl,g.transform.customLayerMatrix());x.setDirty(),g.setBaseState(),x.bindFramebuffer.set(null)}}else p.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class cr{constructor(l,d,_=!1){this.context=new ht(l,_),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=p.SourceCache.maxUnderzooming+p.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(l,d){const _=!!l&&!!l.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new af(this,l));const x=this._terrain;this.transform.elevation=_?x:null,x.update(l,this.transform,d)}_updateFog(l){const d=l.fog;if(!d||"globe"===this.transform.projection.name||d.getOpacity(this.transform.pitch)<1||d.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,x]=d.getFovAdjustedRange(this.transform._fov);if(_>x)return void(this.transform.fogCullDistSq=null);const C=_+.78*(x-_);this.transform.fogCullDistSq=C*C}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(l,d){if(this.width=l*p.exported.devicePixelRatio,this.height=d*p.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._layers[_].resize()}setup(){const l=this.context,d=new p.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(p.EXTENT,0),d.emplaceBack(0,p.EXTENT),d.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(d,p.posAttributes.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);const _=new p.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(p.EXTENT,0),_.emplaceBack(0,p.EXTENT),_.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=l.createVertexBuffer(_,p.posAttributes.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);const x=new p.StructArrayLayout2i4;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(x,p.posAttributes.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);const C=new p.StructArrayLayout4i8;C.emplaceBack(0,0,0,0),C.emplaceBack(p.EXTENT,0,p.EXTENT,0),C.emplaceBack(0,p.EXTENT,0,p.EXTENT),C.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.mercatorBoundsBuffer=l.createVertexBuffer(C,p.boundsAttributes.members),this.mercatorBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);const D=new p.StructArrayLayout3ui6;D.emplaceBack(0,1,2),D.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(D);const S=new p.StructArrayLayout1ui2;for(const N of[0,1,3,2,0])S.emplaceBack(N);this.debugIndexBuffer=l.createIndexBuffer(S),this.emptyTexture=new p.Texture(l,new p.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),l.gl.RGBA),this.identityMat=p.create();const k=this.context.gl;this.stencilClearMode=new p.StencilMode({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO),this.loadTimeStamps.push(p.window.performance.now()),this.atmosphereBuffer=new ff(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(l){return l._makeTileBoundsBuffers(this.context,this.transform.projection),l._tileBoundsBuffer?{tileBoundsBuffer:l._tileBoundsBuffer,tileBoundsIndexBuffer:l._tileBoundsIndexBuffer,tileBoundsSegments:l._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const l=this.context,d=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(l,d.TRIANGLES,p.DepthMode.disabled,this.stencilClearMode,p.ColorMode.disabled,p.CullFaceMode.disabled,qa(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(l,d,_){if(!d||this.currentStencilSource===d.id||!l.isTileClipped()||!_||0===_.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let S=!1;for(const k of _)if(void 0===this._tileClippingMaskIDs[k.key]){S=!0;break}if(!S)return}this.currentStencilSource=d.id;const x=this.context,C=x.gl;this.nextStencilID+_.length>256&&this.clearStencil(),x.setColorMode(p.ColorMode.disabled),x.setDepthMode(p.DepthMode.disabled);const D=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of _){const k=d.getTile(S),N=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:F,tileBoundsIndexBuffer:j,tileBoundsSegments:Y}=this.getTileBoundsBuffers(k);D.draw(x,C.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:C.ALWAYS,mask:0},N,255,C.KEEP,C.KEEP,C.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,qa(S.projMatrix),"$clipping",F,j,Y)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,d=this.context.gl;return new p.StencilMode({func:d.NOTEQUAL,mask:255},l,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(l){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(l);const d=this.context.gl;return new p.StencilMode({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(l){const d=this.context.gl,_=l.sort((D,S)=>S.overscaledZ-D.overscaledZ),x=_[_.length-1].overscaledZ,C=_[0].overscaledZ-x+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();const D={};for(let S=0;S<C;S++)D[S+x]=new p.StencilMode({func:d.GEQUAL,mask:255},S+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=C,[D,_]}return[{[x]:p.StencilMode.disabled},_]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new p.ColorMode([l.CONSTANT_COLOR,l.ONE],new p.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?p.ColorMode.unblended:p.ColorMode.alphaBlended}depthModeForSublayer(l,d,_){if(!this.opaquePassEnabledForLayer())return p.DepthMode.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new p.DepthMode(_||this.context.gl.LEQUAL,d,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,d){this.style=l,this.options=d,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(p.exported.now()),this.imageManager.beginFrame();const _=this.style.order,x=this.style._sourceCaches;for(const N in x){const F=x[N];F.used&&F.prepare(this.context)}const C={},D={},S={};for(const N in x){const F=x[N];C[N]=F.getVisibleCoordinates(),D[N]=C[N].slice().reverse(),S[N]=F.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let N=0;N<_.length;N++)if(this.style._layers[_[N]].is3D()){this.opaquePassCutoff=N;break}if(this.terrain&&(this.terrain.updateTileBinding(S),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new p.GlobeSharedBuffers(this.context)),!p.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const N of _){const F=this.style._layers[N],j=l._getLayerSourceCache(F);if(!F.hasOffscreenPass()||F.isHidden(this.transform.zoom))continue;const Y=j?D[j.id]:void 0;("custom"===F.type||F.isSky()||Y&&Y.length)&&this.renderLayer(this,j,F,Y)}this.depthRangeFor3D=[0,1-(l.order.length+2)*this.numSublayers*this.depthEpsilon];const k=this.terrain;if(k&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&k.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:d.showOverdrawInspector?p.Color.black:p.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const N=this.style._layers[_[this.currentLayer]],F=l._getLayerSourceCache(N);if(N.isSky())continue;const j=F?D[F.id]:void 0;this._renderTileClippingMasks(N,F,j),this.renderLayer(this,F,N,j)}if(this.style.fog&&this.transform.projection.supportsFog&&function(N,F){const j=N.context,Y=j.gl,ee=N.transform,re=new p.DepthMode(Y.LEQUAL,p.DepthMode.ReadOnly,[0,1]),ie=N.useProgram("globeAtmosphere",null,"globe"===ee.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),se=p.globeToMercatorTransition(ee.zoom),$=F.properties.get("color").toArray01(),Q=F.properties.get("high-color").toArray01(),ue=F.properties.get("space-color").toArray01PremultipliedAlpha(),de=p.identity$1([]);p.rotateY$1(de,de,-p.degToRad(ee._center.lng)),p.rotateX$1(de,de,p.degToRad(ee._center.lat)),p.rotateZ$1(de,de,ee.angle),p.rotateX$1(de,de,-ee._pitch);const be=p.fromQuat(new Float32Array(16),de),Me=p.mapValue(F.properties.get("star-intensity"),0,1,0,.25),Se=p.mapValue(F.properties.get("horizon-blend"),0,1,5e-4,.25),Ee=p.globeUseCustomAntiAliasing(N,j,ee)&&5e-4===Se?ee.worldSize/(2*Math.PI*1.025)-1:ee.globeRadius,Fe=N.frameCounter/1e3%1,ot=p.length(ee.globeCenterInViewSpace),Oe=Math.sqrt(Math.pow(ot,2)-Math.pow(Ee,2)),Ze=Math.acos(Oe/ot),Be={u_frustum_tl:ee.frustumCorners.TL,u_frustum_tr:ee.frustumCorners.TR,u_frustum_br:ee.frustumCorners.BR,u_frustum_bl:ee.frustumCorners.BL,u_horizon:ee.frustumCorners.horizon,u_transition:se,u_fadeout_range:Se,u_color:$,u_high_color:Q,u_space_color:ue,u_star_intensity:Me,u_star_size:5*p.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Fe,u_horizon_angle:Ze,u_rotation_matrix:be};N.prepareDrawProgram(j,ie);const it=N.atmosphereBuffer;it&&ie.draw(j,Y.TRIANGLES,re,p.StencilMode.disabled,p.ColorMode.alphaBlended,p.CullFaceMode.backCW,Be,"skybox",it.vertexBuffer,it.indexBuffer,it.segments)}(this,this.style.fog),this.renderPass="sky",(p.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const N=this.style._layers[_[this.currentLayer]],F=l._getLayerSourceCache(N);N.isSky()&&this.renderLayer(this,F,N,F?D[F.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;){const N=this.style._layers[_[this.currentLayer]],F=l._getLayerSourceCache(N);if(N.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(N)){if(N.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const j=F?("symbol"===N.type?S:D)[F.id]:void 0;this._renderTileClippingMasks(N,F,F?C[F.id]:void 0),this.renderLayer(this,F,N,j),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let N=null;p.values(this.style._layers).forEach(F=>{const j=l._getLayerSourceCache(F);j&&!F.isHidden(this.transform.zoom)&&(!N||N.getSource().maxzoom<j.getSource().maxzoom)&&(N=j)}),N&&this.options.showTileBoundaries&&Ya.debug(this,N,N.getVisibleCoordinates())}this.options.showPadding&&function(N){const F=N.transform.padding;hf(N,N.transform.height-(F.top||0),3,Gl),hf(N,F.bottom||0,3,km),od(N,F.left||0,3,Zo),od(N,N.transform.width-(F.right||0),3,Om);const j=N.transform.centerPoint;var Y,ee,re,ie;ql(Y=N,(ee=j.x)-1,(re=N.transform.height-j.y)-10,2,20,ie=df),ql(Y,ee-10,re-1,20,2,ie)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(p.window.performance.now()),this.saveCanvasCopy())}renderLayer(l,d,_,x){_.isHidden(this.transform.zoom)||("background"===_.type||"sky"===_.type||"custom"===_.type||x&&x.length)&&(this.id=_.id,this.gpuTimingStart(_),(!l.transform.projection.unsupportedLayers||!l.transform.projection.unsupportedLayers.includes(_.type)||l.terrain&&"custom"===_.type)&&Ya[_.type](l,d,_,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(l){if(!this.options.gpuTiming)return;const d=this.context.extTimerQuery;let _=this.gpuTimers[l.id];_||(_=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),_.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const l=this.context.extTimerQuery,d=l.createQueryEXT();this.deferredRenderGpuTimeQueries.push(d),l.beginQueryEXT(l.TIME_ELAPSED_EXT,d)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}collectGpuTimers(){const l=this.gpuTimers;return this.gpuTimers={},l}collectDeferredRenderGpuQueries(){const l=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],l}queryGpuTimers(l){const d={};for(const _ in l){const x=l[_],C=this.context.extTimerQuery,D=C.getQueryObjectEXT(x.query,C.QUERY_RESULT_EXT)/1e6;C.deleteQueryEXT(x.query),d[_]=D}return d}queryGpuTimeDeferredRender(l){if(!this.options.gpuTimingDeferredRender)return 0;const d=this.context.extTimerQuery;let _=0;for(const x of l)_+=d.getQueryObjectEXT(x,d.QUERY_RESULT_EXT)/1e6,d.deleteQueryEXT(x);return _}translatePosMatrix(l,d,_,x,C){if(!_[0]&&!_[1])return l;const D=C?"map"===x?this.transform.angle:0:"viewport"===x?-this.transform.angle:0;if(D){const N=Math.sin(D),F=Math.cos(D);_=[_[0]*F-_[1]*N,_[0]*N+_[1]*F]}const S=[C?_[0]:sr(d,_[0],this.transform.zoom),C?_[1]:sr(d,_[1],this.transform.zoom),0],k=new Float32Array(16);return p.translate(k,l,S),k}saveTileTexture(l){const d=this._tileTextures[l.size[0]];d?d.push(l):this._tileTextures[l.size[0]]=[l]}getTileTexture(l){const d=this._tileTextures[l];return d&&d.length>0?d.pop():null}isPatternMissing(l){return null===l||void 0!==l&&!this.imageManager.getPattern(l.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const l=this.terrain&&this.terrain.renderingToTexture,d=this.terrain&&0===this.terrain.exaggeration(),_=this.style&&this.style.fog,x=[];return this.terrainRenderModeElevated()&&x.push("TERRAIN"),"globe"===this.transform.projection.name&&x.push("GLOBE"),d&&x.push("ZERO_EXAGGERATION"),_&&!l&&0!==_.getOpacity(this.transform.pitch)&&x.push("FOG"),l&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}useProgram(l,d,_){this.cache=this.cache||{};const x=_||[],C=this.currentGlobalDefines().concat(x),D=wn.cacheKey(Yu[l],l,C,d);return this.cache[D]||(this.cache[D]=new wn(this.context,l,Yu[l],d,qo[l],C)),this.cache[D]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(l,d,_){if(this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const C=x.getOpacity(this.transform.pitch),D=((S,k,N,F,j,Y,ee,re,ie,se,$)=>{const Q=S.transform,ue=k.properties.get("color").toArray01();ue[3]=F;const de=S.frameCounter/1e3%1;return{u_fog_matrix:N?Q.calculateFogTileMatrix(N):S.identityMat,u_fog_range:k.getFovAdjustedRange(Q._fov),u_fog_color:ue,u_fog_horizon_blend:k.properties.get("horizon-blend"),u_fog_temporal_offset:de,u_frustum_tl:j,u_frustum_tr:Y,u_frustum_br:ee,u_frustum_bl:re,u_globe_pos:ie,u_globe_radius:se,u_viewport:$,u_globe_transition:p.globeToMercatorTransition(Q.zoom),u_is_globe:+("globe"===Q.projection.name)}})(this,x,_,C,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*p.exported.devicePixelRatio,this.transform.height*p.exported.devicePixelRatio]);d.setFogUniformValues(l,D)}}setTileLoadedFlag(l){this.tileLoaded=l}saveCanvasCopy(){const l=this.canvasCopy();l&&(this.frameCopies.push(l),this.tileLoaded=!1)}canvasCopy(){const l=this.context.gl,d=l.createTexture();return l.bindTexture(l.TEXTURE_2D,d),l.copyTexImage2D(l.TEXTURE_2D,0,l.RGBA,0,0,l.drawingBufferWidth,l.drawingBufferHeight,0),d}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const l=this.style&&this.style.fog;return!!l&&0!==l.getOpacity(this.transform.pitch)}getBackgroundTiles(){const l=this._backgroundTiles,d=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const x of _)d[x.key]=l[x.key]||new p.Tile(x,512,this.transform.tileZoom,this);return d}clearBackgroundTiles(){this._backgroundTiles={}}}class ad{constructor(l=0,d=0,_=0,x=0){if(isNaN(l)||l<0||isNaN(d)||d<0||isNaN(_)||_<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=d,this.left=_,this.right=x}interpolate(l,d,_){return null!=d.top&&null!=l.top&&(this.top=p.number(l.top,d.top,_)),null!=d.bottom&&null!=l.bottom&&(this.bottom=p.number(l.bottom,d.bottom,_)),null!=d.left&&null!=l.left&&(this.left=p.number(l.left,d.left,_)),null!=d.right&&null!=l.right&&(this.right=p.number(l.right,d.right,_)),this}getCenter(l,d){const _=p.clamp((this.left+l-this.right)/2,0,l),x=p.clamp((this.top+d-this.bottom)/2,0,d);return new p.Point(_,x)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new ad(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Kc(g,l){const d=p.getColumn(g,3);p.fromQuat(g,l),p.setColumn(g,3,d)}function mt(g,l){const d=p.identity$1([]);return p.rotateZ$1(d,d,-l),p.rotateX$1(d,d,-g),d}function ur(g,l){const d=[g[0],g[1],0],_=[l[0],l[1],0];if(p.length(d)>=1e-15){const D=p.normalize([],d);p.scale$2(_,D,p.dot(_,D)),l[0]=_[0],l[1]=_[1]}const x=p.cross([],l,g);if(p.len(x)<1e-15)return null;const C=Math.atan2(-x[1],x[0]);return mt(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),C)}class kn{constructor(l,d){this.position=l,this.orientation=d}get position(){return this._position}set position(l){if(l){const d=l instanceof p.MercatorCoordinate?l:new p.MercatorCoordinate(l[0],l[1],l[2]);this._renderWorldCopies&&(d.x=p.wrap(d.x,0,1)),this._position=d}else this._position=null}lookAtPoint(l,d){if(this.orientation=null,!this.position)return;const _=this.position,x=this._elevation?this._elevation.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(l)):0,C=p.MercatorCoordinate.fromLngLat(l,x),D=[C.x-_.x,C.y-_.y,C.z-_.z];d||(d=[0,0,1]),d[2]=Math.abs(d[2]),this.orientation=ur(D,d)}setPitchBearing(l,d){this.orientation=mt(p.degToRad(l),p.degToRad(-d))}}class er{constructor(l,d){this._transform=p.identity([]),this.orientation=d,this.position=l}get mercatorPosition(){const l=this.position;return new p.MercatorCoordinate(l[0],l[1],l[2])}get position(){const l=p.getColumn(this._transform,3);return[l[0],l[1],l[2]]}set position(l){var d;l&&p.setColumn(this._transform,3,[(d=l)[0],d[1],d[2],1])}get orientation(){return this._orientation}set orientation(l){this._orientation=l||p.identity$1([]),l&&Kc(this._transform,this._orientation)}getPitchBearing(){const l=this.forward(),d=this.right();return{bearing:Math.atan2(-d[1],d[0]),pitch:Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2])}}setPitchBearing(l,d){this._orientation=mt(l,d),Kc(this._transform,this._orientation)}forward(){const l=p.getColumn(this._transform,2);return[-l[0],-l[1],-l[2]]}up(){const l=p.getColumn(this._transform,1);return[-l[0],-l[1],-l[2]]}right(){const l=p.getColumn(this._transform,0);return[l[0],l[1],l[2]]}getCameraToWorld(l,d){const _=new Float64Array(16);return p.invert(_,this.getWorldToCamera(l,d)),_}getWorldToCameraPosition(l,d,_){const x=this.position;p.scale$2(x,x,-l);const C=new Float64Array(16);return p.fromScaling(C,[_,_,_]),p.translate(C,C,x),C[10]*=d,C}getWorldToCamera(l,d){const _=new Float64Array(16),x=new Float64Array(4),C=this.position;return p.conjugate(x,this._orientation),p.scale$2(C,C,-l),p.fromQuat(_,x),p.translate(_,_,C),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=d,_[9]*=d,_[10]*=d,_[11]*=d,_}getCameraToClipPerspective(l,d,_,x){const C=new Float64Array(16);return p.perspective(C,l,d,_,x),C}getDistanceToElevation(l,d=!1){const _=0===l?0:p.mercatorZfromAltitude(l,d?p.latFromMercatorY(this.position[1]):this.position[1]),x=this.forward();return(_-this.position[2])/x[2]}clone(){return new er([...this.position],[...this.orientation])}}function tr(g,l){const d=Pr(g.projection,g.zoom,g.width,g.height),_=function(C,D,S,k,N){const F=new p.LngLat(S.lng-180*vs,S.lat),j=new p.LngLat(S.lng+180*vs,S.lat),Y=C.project(F.lng,F.lat),ee=C.project(j.lng,j.lat),re=-Math.atan2(ee.y-Y.y,ee.x-Y.x),ie=p.MercatorCoordinate.fromLngLat(S);ie.y=p.clamp(ie.y,-1+vs,1-vs);const se=ie.toLngLat(),$=C.project(se.lng,se.lat),Q=p.MercatorCoordinate.fromLngLat(se);Q.x+=vs;const ue=Q.toLngLat(),de=C.project(ue.lng,ue.lat),be=Ja(de.x-$.x,de.y-$.y,re),Me=p.MercatorCoordinate.fromLngLat(se);Me.y+=vs;const we=Me.toLngLat(),Se=C.project(we.lng,we.lat),Ee=Ja(Se.x-$.x,Se.y-$.y,re),Fe=Math.abs(be.x)/Math.abs(Ee.y),ot=p.identity([]);p.rotateZ(ot,ot,-re*(1-(N?0:k)));const Oe=p.identity([]);return p.scale(Oe,Oe,[1,1-(1-Fe)*k,1]),Oe[4]=-Ee.x/Ee.y*k,p.rotateZ(Oe,Oe,re),p.multiply(Oe,ot,Oe),Oe}(g.projection,0,g.center,d,l),x=Ka(g);return p.scale(_,_,[x,x,1]),_}function Ka(g){const l=g.projection,d=Pr(g.projection,g.zoom,g.width,g.height),_=Oh(l,g.center),x=Oh(l,p.LngLat.convert(l.center));return Math.pow(2,_*d+(1-d)*x)}function Pr(g,l,d,_,x=1/0){const C=g.range;if(!C)return 0;const D=Math.min(x,Math.max(d,_)),S=Math.log(D/1024)/Math.LN2;return p.smoothstep(C[0]+S,C[1]+S,l)}const vs=1/4e4;function Oh(g,l){const d=p.clamp(l.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),_=new p.LngLat(l.lng-180*vs,d),x=new p.LngLat(l.lng+180*vs,d),C=g.project(_.lng,d),D=g.project(x.lng,d),S=p.MercatorCoordinate.fromLngLat(_),k=p.MercatorCoordinate.fromLngLat(x),N=D.x-C.x,F=D.y-C.y,j=k.x-S.x,Y=k.y-S.y,ee=Math.sqrt((j*j+Y*Y)/(N*N+F*F));return Math.log(ee)/Math.LN2}function Ja(g,l,d){const _=Math.cos(d),x=Math.sin(d);return{x:g*_-l*x,y:g*x+l*_}}class Zl{constructor(l,d,_,x,C,D,S){this.tileSize=512,this._renderWorldCopies=void 0===C||C,this._minZoom=l||0,this._maxZoom=d||22,this._minPitch=_??0,this._maxPitch=x??60,this.setProjection(D),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ad,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new er,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const l=new Zl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return l._elevation=this._elevation,l._centerAltitude=this._centerAltitude,l._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,l.tileSize=this.tileSize,l.mercatorFromTransition=this.mercatorFromTransition,l.width=this.width,l.height=this.height,l.cameraElevationReference=this.cameraElevationReference,l._center=this._center,l._setZoom(this.zoom),l._seaLevelZoom=this._seaLevelZoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._nearZ=this._nearZ,l._farZ=this._farZ,l._averageElevation=this._averageElevation,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._camera=this._camera.clone(),l._calcMatrices(),l.freezeTileCoverage=this.freezeTileCoverage,l.frustumCorners=this.frustumCorners,l}get elevation(){return this._elevation}set elevation(l){this._elevation!==l&&(this._elevation=l,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(l,d=!1){const _=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||_)&&this._updateCameraOnTerrain(),(l||_)&&this._constrainCamera(d),this._calcMatrices()}getProjection(){return p.pick(this.projection,["name","center","parallels"])}setProjection(l){this.projectionOptions=l||{name:"mercator"};const d=this.projection?this.getProjection():void 0;this.projection=p.getProjection(this.projectionOptions);const _=!Je(d,this.getProjection());return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setMercatorFromTransition(){const l=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=p.getProjection({name:"mercator"});const d=l!==this.projection.name;return d&&this._calcMatrices(),d}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(l){void 0===l?l=!0:null===l&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get cameraWorldSize(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return p.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new p.Point(this.width,this.height)}get bearing(){return p.wrap(this.rotation,-180,180)}set bearing(l){this.rotation=l}get rotation(){return-this.angle/Math.PI*180}set rotation(l){const d=-l*Math.PI/180;var _,x,C,D,S,k,N,F,j,Y;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=(_=new p.ARRAY_TYPE(4),p.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_),x=this.rotationMatrix,D=this.angle,S=(C=this.rotationMatrix)[0],k=C[1],N=C[2],F=C[3],j=Math.sin(D),Y=Math.cos(D),x[0]=S*Y+N*j,x[1]=k*Y+F*j,x[2]=S*-j+N*Y,x[3]=k*-j+F*Y)}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const d=p.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const l=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/l)}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=p.degToRad(l),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(l){this._averageElevation=l,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(l){const d=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._setZoom(d),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(l){this._zoom=l,this.scale=this.zoomScale(l),this.tileZoom=Math.floor(l),this.zoomFraction=l-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const l=this._elevation;this._centerAltitude=l.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=l.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const l=this._elevation,d=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let x=0,C=0;for(let D=0;D<d.length;D++){const S=new p.Point(d[D][0]*this.width,_+d[D][1]*(this.height-_)),k=l.pointCoordinate(S);if(!k)continue;const N=1/Math.hypot(k[0]-this._camera.position[0],k[1]-this._camera.position[1]);x+=k[3]*N,C+=N}return 0===C?NaN:x/C}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const l=this._seaLevelZoom,d=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*d,x=this._mercatorZfromZoom(l),C=this._mercatorZfromZoom(this._maxZoom),D=Math.max(x-_,C);this._setZoom(this._zoomFromMercatorZ(D))}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}computeZoomRelativeTo(l){const d=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,l.toAltitude()));let _;_=l.z<this._camera.position[2]?[d.x,d.y,d.z]:[l.x,l.y,l.z];const x=p.length(p.sub([],this._camera.position,_));return p.clamp(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(l){if(!this.height||!l.position&&!l.orientation)return;this._updateCameraState();let d=!1;if(l.orientation&&!p.exactEquals(l.orientation,this._camera.orientation)&&(d=this._setCameraOrientation(l.orientation)),l.position){const _=[l.position.x,l.position.y,l.position.z];p.exactEquals$1(_,this._camera.position)||(this._setCameraPosition(_),d=!0)}d&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const l=this._camera.position,d=new kn;return d.position=new p.MercatorCoordinate(l[0],l[1],l[2]),d.orientation=this._camera.orientation,d._elevation=this.elevation,d._renderWorldCopies=this.renderWorldCopies,d}_setCameraOrientation(l){if(!p.length$1(l))return!1;p.normalize$1(l,l);const d=p.transformQuat([],[0,0,-1],l),_=p.transformQuat([],[0,-1,0],l);if(_[2]<0)return!1;const x=ur(d,_);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(l){const d=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;l[2]=p.clamp(l[2],x/_,x/d),this._camera.position=l}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,d,_){this._unmodified=!1,this._edgeInsets.interpolate(l,d,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const d=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(l){const d=[new p.UnwrappedTileID(0,l)];if(this.renderWorldCopies){const _=this.pointCoordinate(new p.Point(0,0)),x=this.pointCoordinate(new p.Point(this.width,0)),C=this.pointCoordinate(new p.Point(this.width,this.height)),D=this.pointCoordinate(new p.Point(0,this.height)),S=Math.floor(Math.min(_.x,x.x,C.x,D.x)),k=Math.floor(Math.max(_.x,x.x,C.x,D.x)),N=1;for(let F=S-N;F<=k+N;F++)0!==F&&d.push(new p.UnwrappedTileID(F,l))}return d}coveringTiles(l){let d=this.coveringZoomLevel(l);const _=d,x=this.elevation&&!l.isTerrainDEM,C="mercator"===this.projection.name;if(void 0!==l.minzoom&&d<l.minzoom)return[];void 0!==l.maxzoom&&d>l.maxzoom&&(d=l.maxzoom);const D=this.locationCoordinate(this.center),S=this.center.lat,k=1<<d,N=[k*D.x,k*D.y,0],F="globe"===this.projection.name,j=!F,Y=p.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d,j),ee=F?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),re=k*p.mercatorZfromAltitude(1,this.center.lat),ie=this._camera.position[2]/p.mercatorZfromAltitude(1,this.center.lat),se=[k*ee.x,k*ee.y,ie*(j?1:re)],$=this.cameraToCenterDistance/l.tileSize*(l.roundZoom?1:.502),Q=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?d:0,ue=l.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,de=l.isTerrainDEM?-ue:this._elevation?this._elevation.getMinElevationBelowMSL():0,be=this.projection.isReprojectedInTileSpace?Ka(this):1,Me=Le=>{const tt=new p.MercatorCoordinate(Le.x+25e-6,Le.y,Le.z),Qe=new p.MercatorCoordinate(Le.x,Le.y+25e-6,Le.z),st=Le.toLngLat(),vt=tt.toLngLat(),Ht=Qe.toLngLat(),Et=this.locationCoordinate(st),At=this.locationCoordinate(vt),_n=this.locationCoordinate(Ht),un=Math.hypot(At.x-Et.x,At.y-Et.y),Pt=Math.hypot(_n.x-Et.x,_n.y-Et.y);return Math.sqrt(un*Pt)*be/25e-6},we=Le=>{const Ge=ue,tt=de;return{aabb:p.tileAABB(this,k,0,0,0,Le,tt,Ge,this.projection),zoom:0,x:0,y:0,minZ:tt,maxZ:Ge,wrap:Le,fullyVisible:!1}},Se=[];let Ee=[];const Fe=d,ot=l.reparseOverscaled?_:d,Oe=Le=>Le*Le,Ze=Oe((ie-this._centerAltitude)*re),Be=Le=>{if(!this._elevation||!Le.tileID||!C)return;const Ge=this._elevation.getMinMaxForTile(Le.tileID),tt=Le.aabb;Ge?(tt.min[2]=Ge.min,tt.max[2]=Ge.max,tt.center[2]=(tt.min[2]+tt.max[2])/2):(Le.shouldSplit=it(Le),Le.shouldSplit||(tt.min[2]=tt.max[2]=tt.center[2]=this._centerAltitude))},it=Le=>{if(Le.zoom<Q)return!0;if(Le.zoom===Fe)return!1;if(null!=Le.shouldSplit)return Le.shouldSplit;const Ge=Le.aabb.distanceX(se),tt=Le.aabb.distanceY(se);let Qe=Ze,st=1;if(F){Qe=Oe(Le.aabb.distanceZ(se));const Et=Math.pow(2,Le.zoom),At=p.latFromMercatorY((Le.y+1)/Et),_n=p.latFromMercatorY(Le.y/Et),un=Math.min(Math.max(S,At),_n),Pt=p.circumferenceAtLatitude(un)/p.circumferenceAtLatitude(S);if(st=un===S?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Pt/this._mercatorScaleRatio),this.zoom<=p.GLOBE_ZOOM_THRESHOLD_MIN&&Le.zoom===Fe-1&&Pt>=.9)return!0}else if(x&&(Qe=Oe(Le.aabb.distanceZ(se)*re)),this.projection.isReprojectedInTileSpace&&_<=5){const Et=Math.pow(2,Le.zoom),At=Me(new p.MercatorCoordinate((Le.x+.5)/Et,(Le.y+.5)/Et));st=At>.85?1:At}const vt=Ge*Ge+tt*tt+Qe;return vt<Oe((1<<Fe-Le.zoom)*$*st*((Et,At)=>{if(At*Oe(.707)<Et)return 1;const _n=Math.sqrt(At/Et);return _n/(1.4144271570014144+(Math.pow(1.1,_n-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Qe,Ze),vt))};if(this.renderWorldCopies)for(let Le=1;Le<=3;Le++)Se.push(we(-Le)),Se.push(we(Le));for(Se.push(we(0));Se.length>0;){const Le=Se.pop(),Ge=Le.x,tt=Le.y;let Qe=Le.fullyVisible;if(!Qe){const st=Le.aabb.intersects(Y);if(0===st)continue;Qe=2===st}if(Le.zoom!==Fe&&it(Le))for(let st=0;st<4;st++){const vt=(Ge<<1)+st%2,Ht=(tt<<1)+(st>>1),Et={aabb:C?Le.aabb.quadrant(st):p.tileAABB(this,k,Le.zoom+1,vt,Ht,Le.wrap,Le.minZ,Le.maxZ,this.projection),zoom:Le.zoom+1,x:vt,y:Ht,wrap:Le.wrap,fullyVisible:Qe,tileID:void 0,shouldSplit:void 0,minZ:Le.minZ,maxZ:Le.maxZ};x&&!F&&(Et.tileID=new p.OverscaledTileID(Le.zoom+1===Fe?ot:Le.zoom+1,Le.wrap,Le.zoom+1,vt,Ht),Be(Et)),Se.push(Et)}else{const st=Le.zoom===Fe?ot:Le.zoom;if(l.minzoom&&l.minzoom>st)continue;const vt=N[0]-(.5+Ge+(Le.wrap<<Le.zoom))*(1<<d-Le.zoom),Ht=N[1]-.5-tt,Et=Le.tileID?Le.tileID:new p.OverscaledTileID(st,Le.wrap,Le.zoom,Ge,tt);Ee.push({tileID:Et,distanceSq:vt*vt+Ht*Ht})}}if(this.fogCullDistSq){const Le=this.fogCullDistSq,Ge=this.horizonLineFromTop();Ee=Ee.filter(tt=>{const Qe=[0,0,0,1],st=[p.EXTENT,p.EXTENT,0,1],vt=this.calculateFogTileMatrix(tt.tileID.toUnwrapped());p.transformMat4$1(Qe,Qe,vt),p.transformMat4$1(st,st,vt);const Ht=p.getAABBPointSquareDist(Qe,st);if(0===Ht)return!0;let Et=!1;const At=this._elevation;if(At&&Ht>Le&&0!==Ge){const _n=this.calculateProjMatrix(tt.tileID.toUnwrapped());let un;l.isTerrainDEM||(un=At.getMinMaxForTile(tt.tileID)),un||(un={min:de,max:ue});const Pt=p.furthestTileCorner(this.rotation),dn=[Pt[0]*p.EXTENT,Pt[1]*p.EXTENT,un.max];p.transformMat4(dn,dn,_n),Et=(1-dn[1])*this.height*.5<Ge}return Ht<Le||Et})}return Ee.sort((Le,Ge)=>Le.distanceSq-Ge.distanceSq).map(Le=>Le.tileID)}resize(l,d){this.width=l,this.height=d,this.pixelsToGLUnits=[2/l,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const d=p.clamp(l.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),_=this.projection.project(l.lng,d);return new p.Point(_.x*this.worldSize,_.y*this.worldSize)}unproject(l){return this.projection.unproject(l.x/this.worldSize,l.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/p.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(l,d){let _,x;const C=this.centerPoint;if("globe"===this.projection.name){const S=this.worldSize;_=(d.x-C.x)/S,x=(d.y-C.y)/S}else{const S=this.pointCoordinate(d),k=this.pointCoordinate(C);_=S.x-k.x,x=S.y-k.y}const D=this.locationCoordinate(l);this.setLocation(new p.MercatorCoordinate(D.x-_,D.y-x))}setLocation(l){this.center=this.coordinateLocation(l),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(l){return this.projection.locationPoint(this,l)}locationPoint3D(l){return this.projection.locationPoint(this,l,!0)}pointLocation(l){return this.coordinateLocation(this.pointCoordinate(l))}pointLocation3D(l){return this.coordinateLocation(this.pointCoordinate3D(l))}locationCoordinate(l,d){const _=d?p.mercatorZfromAltitude(d,l.lat):void 0,x=this.projection.project(l.lng,l.lat);return new p.MercatorCoordinate(x.x,x.y,_)}coordinateLocation(l){return this.projection.unproject(l.x,l.y)}pointRayIntersection(l,d){const _=d??this._centerAltitude,x=[l.x,l.y,0,1],C=[l.x,l.y,1,1];p.transformMat4$1(x,x,this.pixelMatrixInverse),p.transformMat4$1(C,C,this.pixelMatrixInverse);const D=C[3];p.scale$1(x,x,1/x[3]),p.scale$1(C,C,1/D);const S=x[2],k=C[2];return{p0:x,p1:C,t:S===k?0:(_-S)/(k-S)}}screenPointToMercatorRay(l){const d=[l.x,l.y,0,1],_=[l.x,l.y,1,1];return p.transformMat4$1(d,d,this.pixelMatrixInverse),p.transformMat4$1(_,_,this.pixelMatrixInverse),p.scale$1(d,d,1/d[3]),p.scale$1(_,_,1/_[3]),d[2]=p.mercatorZfromAltitude(d[2],this._center.lat)*this.worldSize,_[2]=p.mercatorZfromAltitude(_[2],this._center.lat)*this.worldSize,p.scale$1(d,d,1/this.worldSize),p.scale$1(_,_,1/this.worldSize),new p.Ray([d[0],d[1],d[2]],p.normalize([],p.sub([],_,d)))}rayIntersectionCoordinate(l){const{p0:d,p1:_,t:x}=l,C=p.mercatorZfromAltitude(d[2],this._center.lat),D=p.mercatorZfromAltitude(_[2],this._center.lat);return new p.MercatorCoordinate(p.number(d[0],_[0],x)/this.worldSize,p.number(d[1],_[1],x)/this.worldSize,p.number(C,D,x))}pointCoordinate(l,d=this._centerAltitude){return this.projection.pointCoordinate(this,l.x,l.y,d)}pointCoordinate3D(l){if(!this.elevation)return this.pointCoordinate(l);let d=this.projection.pointCoordinate3D(this,l.x,l.y);if(d)return new p.MercatorCoordinate(d[0],d[1],d[2]);let _=0,x=this.horizonLineFromTop();if(l.y>x)return this.pointCoordinate(l);const C=.02*x,D=l.clone();for(let S=0;S<10&&x-_>C;S++){D.y=p.number(_,x,.66);const k=this.projection.pointCoordinate3D(this,D.x,D.y);k?(x=D.y,d=k):_=D.y}return d?new p.MercatorCoordinate(d[0],d[1],d[2]):this.pointCoordinate(l)}isPointAboveHorizon(l){return this.projection.isPointAboveHorizon(this,l)}isPointOnSurface(l){if(l.y<0||l.y>this.height||l.x<0||l.x>this.width)return!1;if(this.elevation||this.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(l);const d=this.pointCoordinate(l);return d.y>=0&&d.y<=1}_coordinatePoint(l,d){const _=d&&this.elevation?this.elevation.getAtPointOrZero(l,this._centerAltitude):this._centerAltitude,x=[l.x*this.worldSize,l.y*this.worldSize,_+l.toAltitude(),1];return p.transformMat4$1(x,x,this.pixelMatrix),x[3]>0?new p.Point(x[0]/x[3],x[1]/x[3]):new p.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:l,left:d}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,C=this.pointLocation3D(new p.Point(d,l)),D=this.pointLocation3D(new p.Point(x,l)),S=this.pointLocation3D(new p.Point(x,_)),k=this.pointLocation3D(new p.Point(d,_));let N=Math.min(C.lng,D.lng,S.lng,k.lng),F=Math.max(C.lng,D.lng,S.lng,k.lng),j=Math.min(C.lat,D.lat,S.lat,k.lat),Y=Math.max(C.lat,D.lat,S.lat,k.lat);const ee=Math.pow(2,-this.zoom)/16*270,re="globe"===this.projection.name?1:4,ie=(se,$,Q,ue,de)=>{const be=(se+Q)/2,Me=($+ue)/2,we=new p.Point(be,Me),{lng:Se,lat:Ee}=this.pointLocation3D(we),Fe=Math.max(0,N-Se,j-Ee,Se-F,Ee-Y);N=Math.min(N,Se),F=Math.max(F,Se),j=Math.min(j,Ee),Y=Math.max(Y,Ee),(de<re||Fe>ee)&&(ie(se,$,be,Me,de+1),ie(be,Me,Q,ue,de+1))};if(ie(d,l,x,l,1),ie(x,l,x,_,1),ie(x,_,d,_,1),ie(d,_,d,l,1),"globe"===this.projection.name){const[se,$]=p.polesInViewport(this);se?(Y=90,F=180,N=-180):$&&(j=-90,F=180,N=-180)}return new p.LngLatBounds(new p.LngLat(N,j),new p.LngLat(F,Y))}_getBoundsRectangular(l,d){const{top:_,left:x}=this._edgeInsets,C=this.height-this._edgeInsets.bottom,D=this.width-this._edgeInsets.right,S=new p.Point(x,_),k=new p.Point(D,_),N=new p.Point(D,C),F=new p.Point(x,C);let j=this.pointCoordinate(S,l),Y=this.pointCoordinate(k,l);const ee=this.pointCoordinate(N,d),re=this.pointCoordinate(F,d),ie=(se,$)=>($.y-se.y)/($.x-se.x);return j.y>1&&Y.y>=0?j=new p.MercatorCoordinate((1-re.y)/ie(re,j)+re.x,1):j.y<0&&Y.y<=1&&(j=new p.MercatorCoordinate(-re.y/ie(re,j)+re.x,0)),Y.y>1&&j.y>=0?Y=new p.MercatorCoordinate((1-ee.y)/ie(ee,Y)+ee.x,1):Y.y<0&&j.y<=1&&(Y=new p.MercatorCoordinate(-ee.y/ie(ee,Y)+ee.x,0)),(new p.LngLatBounds).extend(this.coordinateLocation(j)).extend(this.coordinateLocation(Y)).extend(this.coordinateLocation(re)).extend(this.coordinateLocation(ee))}_getBoundsRectangularTerrain(){const l=this.elevation;if(!l.visibleDemTiles.length||l.isUsingMockSource())return this._getBoundsRectangular(0,0);const d=l.visibleDemTiles.reduce((_,x)=>{if(x.dem){const C=x.dem.tree;_.min=Math.min(_.min,C.minimums[0]),_.max=Math.max(_.max,C.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(d.min*l.exaggeration(),d.max*l.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(l=!0){const d=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,_=this.height/2-d*(1-this._horizonShift);return l?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(l){this.maxBounds=l,this.minLat=-p.MAX_MERCATOR_LATITUDE,this.maxLat=p.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,l&&(this.minLat=l.getSouth(),this.maxLat=l.getNorth(),this.minLng=l.getWest(),this.maxLng=l.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=p.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=p.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=p.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=p.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(l,d){return this.projection.createTileMatrix(this,d,l)}calculateDistanceTileData(l){const d=l.key,_=this._distanceTileDataCache;if(_[d])return _[d];const x=l.canonical,C=1/this.height,D=this.cameraWorldSize,S=D/this.zoomScale(x.z),k=(x.x+Math.pow(2,x.z)*l.wrap)*S,N=x.y*S,F=this.point;F.x*=D/this.worldSize,F.y*=D/this.worldSize;const j=this.angle,Y=Math.sin(-j),ee=-Math.cos(-j);return _[d]={bearing:[Y,ee],center:[(F.x-k)*C,(F.y-N)*C],scale:S/p.EXTENT*C},_[d]}calculateFogTileMatrix(l){const d=l.key,_=this._fogTileMatrixCache;if(_[d])return _[d];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,l);return p.multiply(x,this.worldToFogMatrix,x),_[d]=new Float32Array(x),_[d]}calculateProjMatrix(l,d=!1){const _=l.key,x=d?this._alignedProjMatrixCache:this._projMatrixCache;if(x[_])return x[_];const C=this.calculatePosMatrix(l,this.worldSize);return p.multiply(C,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.alignedProjMatrix:this.projMatrix,C),x[_]=new Float32Array(C),x[_]}calculatePixelsToTileUnitsMatrix(l){const d=l.tileID.key,_=this._pixelsToTileUnitsCache;if(_[d])return _[d];const x=function(C,D){const{scale:S}=C.tileTransform,k=S*p.EXTENT/(C.tileSize*Math.pow(2,D.zoom-C.tileID.overscaledZ+C.tileID.canonical.z));return N=new Float32Array(4),Y=(F=D.inverseAdjustmentMatrix)[1],ee=F[2],re=F[3],se=(j=[k,k])[1],N[0]=F[0]*(ie=j[0]),N[1]=Y*ie,N[2]=ee*se,N[3]=re*se,N;var N,F,j,Y,ee,re,ie,se}(l,this);return _[d]=x,_[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const l=1/this.worldSize,d=p.fromScaling([],[l,l,l]);return p.multiply(d,d,this.globeMatrix),d}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const l=this._elevation;this._updateCameraState();const d=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(d),x=this._camera.forward(),C=p.mercatorZfromAltitude(1,this._center.lat);_[2]/=C,x[2]/=C,p.normalize(x,x);const D=l.raycast(_,x,l.exaggeration());if(D){const S=p.scaleAndAdd([],_,x,D),k=new p.MercatorCoordinate(S[0],S[1],p.mercatorZfromAltitude(S[2],p.latFromMercatorY(S[1]))),N=(k.z+p.length([k.x-_[0],k.y-_[1],k.z-_[2]*C]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(N),this._centerAltitude=k.toAltitude(),this._center=this.coordinateLocation(k),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(l=!1){if(!this._elevation)return;const d=this._elevation,_=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(_),C=d.getAtPointOrZero(new p.MercatorCoordinate(...x)),D=this.pixelsPerMeter/this.worldSize*C,S=this._minimumHeightOverTerrain(),k=x[2]-D;if(k<=S)if(k<0||l){const N=this.locationCoordinate(this._center,this._centerAltitude),F=[x[0],x[1],N.z-x[2]],j=p.length(F);F[2]-=(S-k)/this._pixelsPerMercatorPixel;const Y=p.length(F);if(0===Y)return;p.scale$2(F,F,j/Y*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],N.z*this._pixelsPerMercatorPixel-F[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const l="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||l){const Y=this.center;return Y.lat=p.clamp(Y.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!l)&&(Y.lng=p.clamp(Y.lng,this.minLng,this.maxLng)),this.center=Y,void(this._constraining=!1)}const d=this._unmodified,{x:_,y:x}=this.point;let C=0,D=_,S=x;const k=this.width/2,N=this.height/2,F=this.worldMinY*this.scale,j=this.worldMaxY*this.scale;if(x-N<F&&(S=F+N),x+N>j&&(S=j-N),j-F<this.height&&(C=Math.max(C,this.height/(j-F)),S=(j+F)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Y=this.worldMinX*this.scale,ee=this.worldMaxX*this.scale,re=this.worldSize/2-(Y+ee)/2;D=(_+re+this.worldSize)%this.worldSize-re,D-k<Y&&(D=Y+k),D+k>ee&&(D=ee-k),ee-Y<this.width&&(C=Math.max(C,this.width/(ee-Y)),D=(ee+Y)/2)}D===_&&S===x||(this.center=this.unproject(new p.Point(D,S))),C&&(this.zoom+=this.scaleZoom(C)),this._constrainCamera(),this._unmodified=d,this._constraining=!1}_minZoomForBounds(){let l=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(l=Math.max(l,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),l}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,d=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=p.mercatorZfromAltitude(1,this.center.lat)/p.mercatorZfromAltitude(1,p.GLOBE_SCALE_MATCH_LATITUDE));const _=Pr(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x="meters"===this.projection.zAxisUnit?d:1,C=this._camera.getWorldToCamera(this.worldSize,x),D=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);D[8]=2*-l.x/this.width,D[9]=2*l.y/this.height;let S=p.mul([],D,C);if(this.projection.isReprojectedInTileSpace){const Me=this.locationCoordinate(this.center),we=p.identity([]);p.translate(we,we,[Me.x*this.worldSize,Me.y*this.worldSize,0]),p.multiply(we,we,tr(this)),p.translate(we,we,[-Me.x*this.worldSize,-Me.y*this.worldSize,0]),p.multiply(S,S,we),this.inverseAdjustmentMatrix=function(Se){const Ee=tr(Se,!0);return _t([],[Ee[0],Ee[1],Ee[4],Ee[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=p.scale([],S,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=S,this.invProjMatrix=p.invert(new Float64Array(16),this.projMatrix);const k=p.invert([],D);this.frustumCorners=p.FrustumCorners.fromInvProjectionMatrix(k,this.horizonLineFromTop(),this.height);const N=new Float32Array(16);p.identity(N),p.scale(N,N,[1,-1,1]),p.rotateX(N,N,this._pitch),p.rotateZ(N,N,this.angle);const F=p.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),j=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;F[8]=2*-l.x/this.width,F[9]=2*(l.y+j)/this.height,this.skyboxMatrix=p.multiply(N,F,N);const Y=this.point,ee=Y.x,re=Y.y,ie=this.width%2/2,se=this.height%2/2,$=Math.cos(this.angle),Q=Math.sin(this.angle),ue=ee-Math.round(ee)+$*ie+Q*se,de=re-Math.round(re)+$*se+Q*ie,be=new Float64Array(S);if(p.translate(be,be,[ue>.5?ue-1:ue,de>.5?de-1:de,0]),this.alignedProjMatrix=be,S=p.create(),p.scale(S,S,[this.width/2,-this.height/2,1]),p.translate(S,S,[1,-1,0]),this.labelPlaneMatrix=S,S=p.create(),p.scale(S,S,[1,-1,1]),p.translate(S,S,[-1,-1,0]),p.scale(S,S,[2/this.width,2/this.height,1]),this.glCoordMatrix=S,this.pixelMatrix=p.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},S=p.invert(new Float64Array(16),this.pixelMatrix),!S)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=S,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=p.calculateGlobeMatrix(this);const Me=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=p.transformMat4(Me,Me,C),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=S;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const l=this.cameraWorldSizeForFog,d=this.cameraPixelsPerMeter,_=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,C=[l,l,d];p.scale$2(C,C,x),p.scale$2(_,_,-1),p.multiply$2(_,_,C);const D=p.create();p.translate(D,D,_),p.scale(D,D,C),this.mercatorFogMatrix=D,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(l,d,x)}_computeCameraPosition(l){const d=(l=l||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),x=this.point,C=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*d-l/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-_[0]*C,x.y/this.worldSize-_[1]*C,l/this.worldSize*this._centerAltitude-_[2]*C]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(l){const d=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],x=l[2];let C=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(C=Math.min((d-_)/x,1)),this._camera.position=p.scaleAndAdd([],this._camera.position,l,C),this._updateStateFromCamera()}_updateStateFromCamera(){const l=this._camera.position,d=this._camera.forward(),{pitch:_,bearing:x}=this._camera.getPitchBearing(),C=p.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,D=this._mercatorZfromZoom(this._maxZoom)*Math.cos(p.degToRad(this._maxPitch)),S=Math.max((l[2]-C)/Math.cos(_),D),k=this._zoomFromMercatorZ(S);p.scaleAndAdd(l,l,d,S),this._pitch=p.clamp(_,p.degToRad(this.minPitch),p.degToRad(this.maxPitch)),this.angle=p.wrap(x,-Math.PI,Math.PI),this._setZoom(p.clamp(k,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new p.MercatorCoordinate(l[0],l[1],l[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(l){return Math.pow(2,l)*this.tileSize}_mercatorZfromZoom(l){return this.cameraToCenterDistance/this._worldSizeFromZoom(l)}_minimumHeightOverTerrain(){const l=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(l)}_zoomFromMercatorZ(l){return this.scaleZoom(this.cameraToCenterDistance/(l*this.tileSize))}zoomFromMercatorZAdjusted(l){let d=0,_=p.GLOBE_ZOOM_THRESHOLD_MAX,x=0,C=1/0;for(;_-d>1e-6&&_>d;){const D=d+.5*(_-d),S=this.tileSize*Math.pow(2,D),k=this.getCameraToCenterDistance(this.projection,D,S),N=this.scaleZoom(k/(l*this.tileSize)),F=Math.abs(D-N);F<C&&(C=F,x=D),D<N?d=D:_=D}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(p.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(l,d){const _=Math.min(l.x,d.x),x=Math.max(l.x,d.x),C=Math.min(l.y,d.y),D=Math.max(l.y,d.y);if(C<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const S=[new p.Point(_,C),new p.Point(x,D),new p.Point(_,D),new p.Point(x,C)],k=this.renderWorldCopies?-3:0,N=this.renderWorldCopies?4:1;for(const F of S){const j=this.pointRayIntersection(F);if(j.t<0)return!0;const Y=this.rayIntersectionCoordinate(j);if(Y.x<k||Y.y<0||Y.x>N||Y.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+p.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new p.Point(0,0),new p.Point(this.width,this.height))}zoomDeltaToMovement(l,d){const _=p.length(p.sub([],this._camera.position,l)),x=this._zoomFromMercatorZ(_)+d;return _-this._mercatorZfromZoom(x)}getCameraPoint(){if("globe"===this.projection.name){const l=function([d,_,x],C){const D=[d,_,x,1];p.transformMat4$1(D,D,C);const S=D[3]=Math.max(D[3],1e-6);return D[0]/=S,D[1]/=S,D[2]/=S,D}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new p.Point(l[0],l[1])}{const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.Point(0,l))}}getCameraToCenterDistance(l,d=this.zoom,_=this.worldSize){const x=Pr(l,d,this.width,this.height,1024),C=l.pixelSpaceConversion(this.center.lat,_,x);return.5/Math.tan(.5*this._fov)*this.height*C}getWorldToCameraMatrix(){const l=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&p.multiply(l,l,this.globeMatrix),l}}function Wl(g,l){let d=!1,_=null;const x=()=>{_=null,d&&(g(),_=setTimeout(x,l),d=!1)};return()=>(d=!0,_||x(),_)}class Di{constructor(l){this._hashName=l&&encodeURIComponent(l),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Wl(this._updateHashUnthrottled.bind(this),300)}addTo(l){return this._map=l,p.window.addEventListener("hashchange",this._onHashChange,!1),l.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),p.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const l=this._map;if(!l)return"";const d=Dt(l);if(this._hashName){const _=this._hashName;let x=!1;const C=p.window.location.hash.slice(1).split("&").map(D=>{const S=D.split("=")[0];return S===_?(x=!0,`${S}=${d}`):D}).filter(D=>D);return x||C.push(`${_}=${d}`),`#${C.join("&")}`}return`#${d}`}_getCurrentHash(){const l=p.window.location.hash.replace("#","");if(this._hashName){let d;return l.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(d=_)}),(d&&d[1]||"").split("/")}return l.split("/")}_onHashChange(){const l=this._map;if(!l)return!1;const d=this._getCurrentHash();if(d.length>=3&&!d.some(_=>isNaN(_))){const _=l.dragRotate.isEnabled()&&l.touchZoomRotate.isEnabled()?+(d[3]||0):l.getBearing();return l.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:_,pitch:+(d[4]||0)}),!0}return!1}_updateHashUnthrottled(){const l=p.window.location.href.replace(/(#.+)?$/,this.getHashString());p.window.history.replaceState(p.window.history.state,null,l)}}function Dt(g,l){const d=g.getCenter(),_=Math.round(100*g.getZoom())/100,x=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),C=Math.pow(10,x),D=Math.round(d.lng*C)/C,S=Math.round(d.lat*C)/C,k=g.getBearing(),N=g.getPitch();let F=l?`/${D}/${S}/${_}`:`${_}/${S}/${D}`;return(k||N)&&(F+="/"+Math.round(10*k)/10),N&&(F+=`/${Math.round(N)}`),F}const nn={linearity:.3,easing:p.bezier(0,0,.3,1)},si=p.extend({deceleration:2500,maxSpeed:1400},nn),Yr=p.extend({deceleration:20,maxSpeed:1400},nn),wt=p.extend({deceleration:1e3,maxSpeed:360},nn),hi=p.extend({deceleration:1e3,maxSpeed:90},nn);class Qa{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.exported.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,d=p.exported.now();for(;l.length>0&&d-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const d={zoom:0,bearing:0,pitch:0,pan:new p.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:C}of this._inertiaBuffer)d.zoom+=C.zoomDelta||0,d.bearing+=C.bearingDelta||0,d.pitch+=C.pitchDelta||0,C.panDelta&&d.pan._add(C.panDelta),C.around&&(d.around=C.around),C.pinchAround&&(d.pinchAround=C.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(d.pan.mag()){const C=Mo(d.pan.mag(),_,p.extend({},si,l||{}));x.offset=d.pan.mult(C.amount/d.pan.mag()),x.center=this._map.transform.center,_i(x,C)}if(d.zoom){const C=Mo(d.zoom,_,Yr);x.zoom=this._map.transform.zoom+C.amount,_i(x,C)}if(d.bearing){const C=Mo(d.bearing,_,wt);x.bearing=this._map.transform.bearing+p.clamp(C.amount,-179,179),_i(x,C)}if(d.pitch){const C=Mo(d.pitch,_,hi);x.pitch=this._map.transform.pitch+C.amount,_i(x,C)}if(x.zoom||x.bearing){const C=void 0===d.pinchAround?d.around:d.pinchAround;x.around=C?this._map.unproject(C):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function _i(g,l){(!g.duration||g.duration<l.duration)&&(g.duration=l.duration,g.easing=l.easing)}function Mo(g,l,d){const{maxSpeed:_,linearity:x,deceleration:C}=d,D=p.clamp(g*x/(l/1e3),-_,_),S=Math.abs(D)/(C*x);return{easing:d.easing,duration:1e3*S,amount:D*(S/2)}}class Si extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,_,x={}){const C=Wr(d.getCanvasContainer(),_),D=d.unproject(C);super(l,p.extend({point:C,lngLat:D,originalEvent:_},x)),this._defaultPrevented=!1,this.target=d}}class Jt extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,_){const x="touchend"===l?_.changedTouches:_.touches,C=Ra(d.getCanvasContainer(),x),D=C.map(k=>d.unproject(k)),S=C.reduce((k,N,F,j)=>k.add(N.div(j.length)),new p.Point(0,0));super(l,{points:C,point:S,lngLats:D,lngLat:d.unproject(S),originalEvent:_}),this._defaultPrevented=!1}}class _a extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,d,_){super(l,{originalEvent:_}),this._defaultPrevented=!1}}class ld{constructor(l,d){this._map=l,this._clickTolerance=d.clickTolerance}reset(){this._mousedownPos=void 0}wheel(l){return this._firePreventable(new _a(l.type,this._map,l))}mousedown(l,d){return this._mousedownPos=d,this._firePreventable(new Si(l.type,this._map,l))}mouseup(l){this._map.fire(new Si(l.type,this._map,l))}preclick(l){const d=p.extend({},l);d.type="preclick",this._map.fire(new Si(d.type,this._map,d))}click(l,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||(this.preclick(l),this._map.fire(new Si(l.type,this._map,l)))}dblclick(l){return this._firePreventable(new Si(l.type,this._map,l))}mouseover(l){this._map.fire(new Si(l.type,this._map,l))}mouseout(l){this._map.fire(new Si(l.type,this._map,l))}touchstart(l){return this._firePreventable(new Jt(l.type,this._map,l))}touchmove(l){this._map.fire(new Jt(l.type,this._map,l))}touchend(l){this._map.fire(new Jt(l.type,this._map,l))}touchcancel(l){this._map.fire(new Jt(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hs{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(l){this._map.fire(new Si(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Si("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new Si(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ri{constructor(l,d){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,d){this.isEnabled()&&l.shiftKey&&0===l.button&&(Ac(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(l,d){if(!this._active)return;const _=d,x=this._startPos,C=this._lastPos;if(!x||!C||C.equals(_)||!this._box&&_.dist(x)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=on("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));const D=Math.min(x.x,_.x),S=Math.max(x.x,_.x),k=Math.min(x.y,_.y),N=Math.max(x.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${D}px,${k}px)`,this._box.style.width=S-D+"px",this._box.style.height=N-k+"px")})}mouseupWindow(l,d){if(!this._active)return;const _=this._startPos,x=d;if(_&&0===l.button){if(this.reset(),_o(),_.x!==x.x||_.y!==x.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:C=>C.fitScreenCoordinates(_,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",l)}}keydown(l){this._active&&27===l.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",l))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Sl(),delete this._startPos,delete this._lastPos}_fireEvent(l,d){return this._map.fire(new p.Event(l,{originalEvent:d}))}}function va(g,l){const d={};for(let _=0;_<g.length;_++)d[g[_].identifier]=l[_];return d}class Wo{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(l,d,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=l.timeStamp),_.length===this.numTouches&&(this.centroid=function(x){const C=new p.Point(0,0);for(const D of x)C._add(D);return C.div(x.length)}(d),this.touches=va(_,d)))}touchmove(l,d,_){if(this.aborted||!this.centroid)return;const x=va(_,d);for(const C in this.touches){const D=x[C];(!D||D.dist(this.touches[C])>30)&&(this.aborted=!0)}}touchend(l,d,_){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),0===_.length){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class Eo{constructor(l){this.singleTap=new Wo(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(l,d,_){this.singleTap.touchstart(l,d,_)}touchmove(l,d,_){this.singleTap.touchmove(l,d,_)}touchend(l,d,_){const x=this.singleTap.touchend(l,d,_);if(x){const C=l.timeStamp-this.lastTime<500,D=!this.lastTap||this.lastTap.dist(x)<30;if(C&&D||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class Jc{constructor(){this._zoomIn=new Eo({numTouches:1,numTaps:2}),this._zoomOut=new Eo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,d,_){this._zoomIn.touchstart(l,d,_),this._zoomOut.touchstart(l,d,_)}touchmove(l,d,_){this._zoomIn.touchmove(l,d,_),this._zoomOut.touchmove(l,d,_)}touchend(l,d,_){const x=this._zoomIn.touchend(l,d,_),C=this._zoomOut.touchend(l,d,_);return x?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:D.getZoom()+1,around:D.unproject(x)},{originalEvent:l})}):C?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:D.getZoom()-1,around:D.unproject(C)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Lh={0:1,2:2};class ao{constructor(l){this.reset(),this._clickTolerance=l.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(l,d){return!1}_move(l,d){return{}}mousedown(l,d){if(this._lastPoint)return;const _=Fs(l);this._correctButton(l,_)&&(this._lastPoint=d,this._eventButton=_)}mousemoveWindow(l,d){const _=this._lastPoint;if(_)if(l.preventDefault(),null!=this._eventButton&&function(x,C){const D=Lh[C];return void 0===x.buttons||(x.buttons&D)!==D}(l,this._eventButton))this.reset();else if(this._moved||!(d.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(_,d)}mouseupWindow(l){this._lastPoint&&Fs(l)===this._eventButton&&(this._moved&&_o(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xo extends ao{mousedown(l,d){super.mousedown(l,d),this._lastPoint&&(this._active=!0)}_correctButton(l,d){return 0===d&&!l.ctrlKey}_move(l,d){return{around:d,panDelta:d.sub(l)}}}class Xl extends ao{_correctButton(l,d){return 0===d&&l.ctrlKey||2===d}_move(l,d){const _=.8*(d.x-l.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(l){l.preventDefault()}}class Yl extends ao{_correctButton(l,d){return 0===d&&l.ctrlKey||2===d}_move(l,d){const _=-.5*(d.y-l.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(l){l.preventDefault()}}class Mn{constructor(l,d){this._map=l,this._el=l.getCanvasContainer(),this._minTouches=1,this._clickTolerance=d.clickTolerance||1,this.reset(),p.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new p.Point(0,0)}touchstart(l,d,_){return this._calculateTransform(l,d,_)}touchmove(l,d,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===_.length&&!p.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return l.cancelable&&l.preventDefault(),this._calculateTransform(l,d,_)}}touchend(l,d,_){this._calculateTransform(l,d,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,d,_){_.length>0&&(this._active=!0);const x=va(_,d),C=new p.Point(0,0),D=new p.Point(0,0);let S=0;for(const N in x){const F=x[N],j=this._touches[N];j&&(C._add(F),D._add(F.sub(j)),S++,x[N]=F)}if(this._touches=x,S<this._minTouches||!D.mag())return;const k=D.div(S);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:C.div(S),panDelta:k}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=on("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class cd{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(l){}_move(l,d,_){return{}}touchstart(l,d,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([d[0],d[1]]))}touchmove(l,d,_){const x=this._firstTwoTouches;if(!x)return;l.preventDefault();const[C,D]=x,S=el(_,d,C),k=el(_,d,D);if(!S||!k)return;const N=this._aroundCenter?null:S.add(k).div(2);return this._move([S,k],N,l)}touchend(l,d,_){if(!this._firstTwoTouches)return;const[x,C]=this._firstTwoTouches,D=el(_,d,x),S=el(_,d,C);D&&S||(this._active&&_o(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&"center"===l.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function el(g,l,d){for(let _=0;_<g.length;_++)if(g[_].identifier===d)return l[_]}function ud(g,l){return Math.log(g/l)/Math.LN2}class Yo extends cd{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,d){const _=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(ud(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ud(this._distance,_),pinchAround:d}}}function Kl(g,l){return 180*g.angleWith(l)/Math.PI}class tl extends cd{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,d){const _=this._vector;if(this._vector=l[0].sub(l[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Kl(this._vector,_),pinchAround:d}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const d=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;const x=Kl(l,_);return Math.abs(x)<d}}function To(g){return Math.abs(g.y)>Math.abs(g.x)}class vr extends cd{constructor(l){super(),this._map=l}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(l){this._lastPoints=l,To(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,d,_){const x=this._lastPoints;if(!x)return;const C=l[0].sub(x[0]),D=l[1].sub(x[1]);return this._map._cooperativeGestures&&!p.isFullscreen()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(C,D,_.timeStamp),!this._valid)?void 0:(this._lastPoints=l,this._active=!0,{pitchDelta:(C.y+D.y)/2*-.5})}gestureBeginsVertically(l,d,_){if(void 0!==this._valid)return this._valid;const x=l.mag()>=2,C=d.mag()>=2;if(!x&&!C)return;if(!x||!C)return null==this._firstMove&&(this._firstMove=_),_-this._firstMove<100&&void 0;const D=l.y>0==d.y>0;return To(l)&&To(d)&&D}}const Rm={panStep:100,bearingStep:15,pitchStep:10};class Kr{constructor(){const l=Rm;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let d=0,_=0,x=0,C=0,D=0;switch(l.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:l.shiftKey?_=-1:(l.preventDefault(),C=-1);break;case 39:l.shiftKey?_=1:(l.preventDefault(),C=1);break;case 38:l.shiftKey?x=1:(l.preventDefault(),D=-1);break;case 40:l.shiftKey?x=-1:(l.preventDefault(),D=1);break;default:return}return this._rotationDisabled&&(_=0,x=0),{cameraAnimation:S=>{const k=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:jr,zoom:d?Math.round(k)+d*(l.shiftKey?2:1):k,bearing:S.getBearing()+_*this._bearingStep,pitch:S.getPitch()+x*this._pitchStep,offset:[-C*this._panStep,-D*this._panStep],center:S.getCenter()},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function jr(g){return g*(2-g)}const Qc=4.000244140625;class ya{constructor(l,d){this._map=l,this._el=l.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,p.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&"center"===l.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(l){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(l.ctrlKey||l.metaKey||this.isZooming()||p.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let d=l.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const _=p.exported.now(),x=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,0!==d&&d%Qc==0?this._type="wheel":0!==d&&Math.abs(d)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(x*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),l.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=l,this._delta-=d,this._active||this._start(l)),l.preventDefault()}_onTimeout(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=Wr(this._el,l);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:d,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._map.transform;"wheel"===this._type&&l.projection.wrap&&(l._center.lng>=180||l._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const d=()=>l._terrainEnabled()&&this._aroundCoord?l.computeZoomRelativeTo(this._aroundCoord):l.zoom;if(0!==this._delta){const k="wheel"===this._type&&Math.abs(this._delta)>Qc?this._wheelZoomRate:this._defaultZoomRate;let N=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&0!==N&&(N=1/N);const F=d(),j=Math.pow(2,F),Y="number"==typeof this._targetZoom?l.zoomScale(this._targetZoom):j;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(Y*N))),"wheel"===this._type&&(this._startZoom=F,this._easing=this._smoothOutEasing(200)),this._delta=0}const _="number"==typeof this._targetZoom?this._targetZoom:d(),x=this._startZoom,C=this._easing;let D,S=!1;if("wheel"===this._type&&x&&C){const k=Math.min((p.exported.now()-this._lastWheelEventTime)/200,1),N=C(k);D=p.number(x,_,N),k<1?this._frameId||(this._frameId=!0):S=!0}else D=_,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:D-d(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let d=p.ease;if(this._prevEase){const _=this._prevEase,x=(p.exported.now()-_.start)/_.duration,C=_.easing(x+.01)-_.easing(x),D=.27/Math.sqrt(C*C+1e-4)*.01,S=Math.sqrt(.0729-D*D);d=p.bezier(D,S,.25,1)}return this._prevEase={start:p.exported.now(),duration:l,easing:d},d}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=on("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(p.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class eu{constructor(l,d){this._clickZoom=l,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class pi{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(l,d){return l.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(l.shiftKey?-1:1),around:_.unproject(d)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Rh{constructor(){this._tap=new Eo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(l,d,_){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=d[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(l,d,_))}touchmove(l,d,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const x=d[0],C=x.y-this._swipePoint.y;return this._swipePoint=x,l.preventDefault(),this._active=!0,{zoomDelta:C/128}}}else this._tap.touchmove(l,d,_)}touchend(l,d,_){this._tapTime?this._swipePoint&&0===_.length&&this.reset():this._tap.touchend(l,d,_)&&(this._tapTime=l.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gf{constructor(l,d,_){this._el=l,this._mousePan=d,this._touchPan=_}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Fm{constructor(l,d,_){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=d,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class d1{constructor(l,d,_,x){this._el=l,this._touchZoom=d,this._touchRotate=_,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Do=g=>g.zoom||g.drag||g.pitch||g.rotate;class mf extends p.Event{}class h1{constructor(){this.constants=[1,1,.01],this.radius=0}setup(l,d){const _=p.sub([],d,l);this.radius=p.length(_[2]<0?p.div([],_,this.constants):[_[0],_[1],0])}projectRay(l){p.div(l,l,this.constants),p.normalize(l,l),p.mul$1(l,l,this.constants);const d=p.scale$2([],l,this.radius);if(d[2]>0){const _=p.scale$2([],[0,0,1],p.dot(d,[0,0,1])),x=p.scale$2([],p.normalize([],[d[0],d[1],0]),this.radius),C=p.add([],d,p.scale$2([],p.sub([],p.add([],x,_),d),2));d[0]=C[0],d[1]=C[1]}return d}}function ys(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class Gs{constructor(l,d){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Qa(l),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new h1,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(d),p.bindAll(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[p.window,"blur",void 0]];for(const[x,C,D]of this._listeners)x.addEventListener(C,x===p.window.document?this.handleWindowEvent:this.handleEvent,D)}destroy(){for(const[l,d,_]of this._listeners)l.removeEventListener(d,l===p.window.document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(l){const d=this._map,_=d.getCanvasContainer();this._add("mapEvent",new ld(d,l));const x=d.boxZoom=new Ri(d,l);this._add("boxZoom",x);const C=new Jc,D=new pi;d.doubleClickZoom=new eu(D,C),this._add("tapZoom",C),this._add("clickZoom",D);const S=new Rh;this._add("tapDragZoom",S);const k=d.touchPitch=new vr(d);this._add("touchPitch",k);const N=new Xl(l),F=new Yl(l);d.dragRotate=new Fm(l,N,F),this._add("mouseRotate",N,["mousePitch"]),this._add("mousePitch",F,["mouseRotate"]);const j=new Xo(l),Y=new Mn(d,l);d.dragPan=new gf(_,j,Y),this._add("mousePan",j),this._add("touchPan",Y,["touchZoom","touchRotate"]);const ee=new tl,re=new Yo;d.touchZoomRotate=new d1(_,re,ee,S),this._add("touchRotate",ee,["touchPan","touchZoom"]),this._add("touchZoom",re,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Hs(d));const ie=d.scrollZoom=new ya(d,this);this._add("scrollZoom",ie,["mousePan"]);const se=d.keyboard=new Kr;this._add("keyboard",se);for(const $ of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])l.interactive&&l[$]&&d[$].enable(l[$])}_add(l,d,_){this._handlers.push({handlerName:l,handler:d,allowed:_}),this._handlersById[l]=d}stop(l){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Do(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(l,d,_){for(const x in l)if(x!==_&&(!d||d.indexOf(x)<0))return!0;return!1}handleWindowEvent(l){this.handleEvent(l,`${l.type}Window`)}_getMapTouches(l){const d=[];for(const _ of l)this._el.contains(_.target)&&d.push(_);return d}handleEvent(l,d){this._updatingCamera=!0;const _="renderFrame"===l.type,x=_?void 0:l,C={needsRenderFrame:!1},D={},S={},k=l.touches?this._getMapTouches(l.touches):void 0,N=k?Ra(this._el,k):_?void 0:Wr(this._el,l);for(const{handlerName:Y,handler:ee,allowed:re}of this._handlers){if(!ee.isEnabled())continue;let ie;this._blockedByActive(S,re,Y)?ee.reset():ee[d||l.type]&&(ie=ee[d||l.type](l,N,k),this.mergeHandlerResult(C,D,ie,Y,x),ie&&ie.needsRenderFrame&&this._triggerRenderFrame()),(ie||ee.isActive())&&(S[Y]=ee)}const F={};for(const Y in this._previousActiveHandlers)S[Y]||(F[Y]=x);this._previousActiveHandlers=S,(Object.keys(F).length||ys(C))&&(this._changes.push([C,D,F]),this._triggerRenderFrame()),(Object.keys(S).length||ys(C))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:j}=C;j&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],j(this._map))}mergeHandlerResult(l,d,_,x,C){if(!_)return;p.extend(l,_);const D={handlerName:x,originalEvent:_.originalEvent||C};void 0!==_.zoomDelta&&(d.zoom=D),void 0!==_.panDelta&&(d.drag=D),void 0!==_.pitchDelta&&(d.pitch=D),void 0!==_.bearingDelta&&(d.rotate=D)}_applyChanges(){const l={},d={},_={};for(const[x,C,D]of this._changes)x.panDelta&&(l.panDelta=(l.panDelta||new p.Point(0,0))._add(x.panDelta)),x.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+x.pitchDelta),void 0!==x.around&&(l.around=x.around),void 0!==x.aroundCoord&&(l.aroundCoord=x.aroundCoord),void 0!==x.pinchAround&&(l.pinchAround=x.pinchAround),x.noInertia&&(l.noInertia=x.noInertia),p.extend(d,C),p.extend(_,D);this._updateMapTransform(l,d,_),this._changes=[]}_updateMapTransform(l,d,_){const x=this._map,C=x.transform,D=Q=>[Q.x,Q.y,Q.z];if((Q=>{const ue=this._eventsInProgress.drag;return ue&&!this._handlersById[ue.handlerName].isActive()})()&&!ys(l)){const Q=C.zoom;C.cameraElevationReference="sea",C.recenterOnTerrain(),C.cameraElevationReference="ground",Q!==C.zoom&&this._map._update(!0)}if(C._isCameraConstrained&&x._stop(!0),!ys(l))return void this._fireEvents(d,_,!0);let{panDelta:S,zoomDelta:k,bearingDelta:N,pitchDelta:F,around:j,aroundCoord:Y,pinchAround:ee}=l;C._isCameraConstrained&&(k>0&&(k=0),C._isCameraConstrained=!1),void 0!==ee&&(j=ee),(k||(Q=>d[Q]&&!this._eventsInProgress[Q])("drag"))&&j&&(this._dragOrigin=D(C.pointCoordinate3D(j)),this._trackingEllipsoid.setup(C._camera.position,this._dragOrigin)),C.cameraElevationReference="sea",x._stop(!0),j=j||x.transform.centerPoint,N&&(C.bearing+=N),F&&(C.pitch+=F),C._updateCameraState();const re=[0,0,0];if(S)if("mercator"===C.projection.name){const Q=this._trackingEllipsoid.projectRay(C.screenPointToMercatorRay(j).dir),ue=this._trackingEllipsoid.projectRay(C.screenPointToMercatorRay(j.sub(S)).dir);re[0]=ue[0]-Q[0],re[1]=ue[1]-Q[1]}else{const Q=C.pointCoordinate(j);if("globe"===C.projection.name){S=S.rotate(-C.angle);const ue=C._pixelsPerMercatorPixel/C.worldSize;re[0]=-S.x*p.mercatorScale(p.latFromMercatorY(Q.y))*ue,re[1]=-S.y*p.mercatorScale(C.center.lat)*ue}else{const ue=C.pointCoordinate(j.sub(S));Q&&ue&&(re[0]=ue.x-Q.x,re[1]=ue.y-Q.y)}}const ie=C.zoom,se=[0,0,0];if(k){const Q=D(Y||C.pointCoordinate3D(j)),ue={dir:p.normalize([],p.sub([],Q,C._camera.position))};if(ue.dir[2]<0){const de=C.zoomDeltaToMovement(Q,k);p.scale$2(se,ue.dir,de)}}const $=p.add(re,re,se);C._translateCameraConstrained($),k&&Math.abs(C.zoom-ie)>1e-4&&C.recenterOnTerrain(),C.cameraElevationReference="ground",this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(d,_,!0)}_fireEvents(l,d,_){const x=Do(this._eventsInProgress),C=Do(l),D={};for(const F in l){const{originalEvent:j}=l[F];this._eventsInProgress[F]||(D[`${F}start`]=j),this._eventsInProgress[F]=l[F]}!x&&C&&this._fireEvent("movestart",C.originalEvent);for(const F in D)this._fireEvent(F,D[F]);C&&this._fireEvent("move",C.originalEvent);for(const F in l){const{originalEvent:j}=l[F];this._fireEvent(F,j)}const S={};let k;for(const F in this._eventsInProgress){const{handlerName:j,originalEvent:Y}=this._eventsInProgress[F];this._handlersById[j].isActive()||(delete this._eventsInProgress[F],k=d[j]||Y,S[`${F}end`]=k)}for(const F in S)this._fireEvent(F,S[F]);const N=Do(this._eventsInProgress);if(_&&(x||C)&&!N){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),j=Y=>0!==Y&&-this._bearingSnap<Y&&Y<this._bearingSnap;F?(j(F.bearing||this._map.getBearing())&&(F.bearing=0),this._map.easeTo(F,{originalEvent:k})):(this._map.fire(new p.Event("moveend",{originalEvent:k})),j(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(l,d){this._map.fire(new p.Event(l,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{this._frameId=void 0,this.handleEvent(new mf("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Jl="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Fh extends p.Evented{constructor(l,d){super(),this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=d.bearingSnap,this._respectPrefersReducedMotion=!1!==d.respectPrefersReducedMotion,p.bindAll(["_renderFrameCallback"],this)}getCenter(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(l,d){return this.jumpTo({center:l},d)}panBy(l,d,_){return l=p.Point.convert(l).mult(-1),this.panTo(this.transform.center,p.extend({offset:l},d),_)}panTo(l,d,_){return this.easeTo(p.extend({center:l},d),_)}getZoom(){return this.transform.zoom}setZoom(l,d){return this.jumpTo({zoom:l},d),this}zoomTo(l,d,_){return this.easeTo(p.extend({zoom:l},d),_)}zoomIn(l,d){return this.zoomTo(this.getZoom()+1,l,d),this}zoomOut(l,d){return this.zoomTo(this.getZoom()-1,l,d),this}getBearing(){return this.transform.bearing}setBearing(l,d){return this.jumpTo({bearing:l},d),this}getPadding(){return this.transform.padding}setPadding(l,d){return this.jumpTo({padding:l},d),this}rotateTo(l,d,_){return this.easeTo(p.extend({bearing:l},d),_)}resetNorth(l,d){return this.rotateTo(0,p.extend({duration:1e3},l),d),this}resetNorthPitch(l,d){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},l),d),this}snapToNorth(l,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,d):this}getPitch(){return this.transform.pitch}setPitch(l,d){return this.jumpTo({pitch:l},d),this}cameraForBounds(l,d){l=p.LngLatBounds.convert(l);const _=d&&d.bearing||0,x=d&&d.pitch||0,C=l.getNorthWest(),D=l.getSouthEast();return this._cameraForBounds(this.transform,C,D,_,x,d)}_extendCameraOptions(l){const d={top:0,bottom:0,right:0,left:0};if("number"==typeof(l=p.extend({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding){const _=l.padding;l.padding={top:_,bottom:_,right:_,left:_}}return l.padding=p.extend(d,l.padding),l}_minimumAABBFrustumDistance(l,d){const _=d.max[0]-d.min[0],x=d.max[1]-d.min[1];return _/x>l.aspect?_/(2*Math.tan(.5*l.fovX)*l.aspect):x/(2*Math.tan(.5*l.fovY)*l.aspect)}_cameraForBoundsOnGlobe(l,d,_,x,C,D){const S=l.clone(),k=this._extendCameraOptions(D);S.bearing=x,S.pitch=C;const N=p.LngLat.convert(d),F=p.LngLat.convert(_),j=.5*(N.lat+F.lat),Y=.5*(N.lng+F.lng),ee=p.latLngToECEF(j,Y),re=p.normalize([],ee),ie=p.normalize([],p.cross([],re,[0,1,0])),se=p.cross([],ie,re),$=[ie[0],ie[1],ie[2],0,se[0],se[1],se[2],0,re[0],re[1],re[2],0,0,0,0,1],Q=[ee,p.latLngToECEF(N.lat,N.lng),p.latLngToECEF(F.lat,N.lng),p.latLngToECEF(F.lat,F.lng),p.latLngToECEF(N.lat,F.lng),p.latLngToECEF(j,N.lng),p.latLngToECEF(j,F.lng),p.latLngToECEF(N.lat,Y),p.latLngToECEF(F.lat,Y)];let ue=p.Aabb.fromPoints(Q.map(Qe=>[p.dot(ie,Qe),p.dot(se,Qe),p.dot(re,Qe)]));const de=p.transformMat4([],ue.center,$);0===p.squaredLength(de)&&p.set(de,0,0,1),p.normalize(de,de),p.scale$2(de,de,p.GLOBE_RADIUS),S.center=p.ecefToLatLng(de);const be=S.getWorldToCameraMatrix(),Me=p.invert(new Float64Array(16),be);ue=p.Aabb.applyTransform(ue,p.multiply([],be,$)),p.transformMat4(de,de,be);const we=.5*(ue.max[2]-ue.min[2]),Se=this._minimumAABBFrustumDistance(S,ue),Ee=p.scale$2([],[0,0,1],we),Fe=p.add(Ee,de,Ee),ot=Se+(0===S.pitch?0:p.distance(de,Fe)),Oe=S.globeCenterInViewSpace,Ze=p.sub([],de,[Oe[0],Oe[1],Oe[2]]);p.normalize(Ze,Ze),p.scale$2(Ze,Ze,ot);const Be=p.add([],de,Ze);p.transformMat4(Be,Be,Me);const it=p.earthRadius/p.GLOBE_RADIUS,Le=p.length(Be),Ge=p.mercatorZfromAltitude(Math.max(Le*it-p.earthRadius,Number.EPSILON),0),tt=Math.min(S.zoomFromMercatorZAdjusted(Ge),k.maxZoom);return tt>.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(S.setProjection({name:"mercator"}),S.zoom=tt,this._cameraForBounds(S,d,_,x,C,D)):{center:S.center,zoom:tt,bearing:x,pitch:C}}queryTerrainElevation(l,d){const _=this.transform.elevation;return _?(d=p.extend({},{exaggerated:!0},d),_.getAtPoint(p.MercatorCoordinate.fromLngLat(l),null,d.exaggerated)):null}_cameraForBounds(l,d,_,x,C,D){if("globe"===l.projection.name)return this._cameraForBoundsOnGlobe(l,d,_,x,C,D);const S=l.clone(),k=this._extendCameraOptions(D),N=S.padding;S.bearing=x,S.pitch=C;const F=p.LngLat.convert(d),j=p.LngLat.convert(_),Y=new p.LngLat(F.lng,j.lat),ee=new p.LngLat(j.lng,F.lat),re=S.project(F),ie=S.project(j),se=this.queryTerrainElevation(F),$=this.queryTerrainElevation(j),Q=this.queryTerrainElevation(Y),ue=this.queryTerrainElevation(ee),de=[[re.x,re.y,Math.min(se||0,$||0,Q||0,ue||0)],[ie.x,ie.y,Math.max(se||0,$||0,Q||0,ue||0)]];let be=p.Aabb.fromPoints(de);const Me=S.getWorldToCameraMatrix(),we=p.invert(new Float64Array(16),Me);be=p.Aabb.applyTransform(be,Me);const Se=p.sub([],be.max,be.min),Ee=N.left||0,Fe=N.right||0,ot=N.bottom||0,Oe=N.top||0,{left:Ze,right:Be,top:it,bottom:Le}=k.padding,Ge=.5*(Ee+Fe),tt=.5*(Oe+ot),Qe=Math.min(S.scaleZoom(S.scale*Math.min((S.width-(Ee+Fe+Ze+Be))/Se[0],(S.height-(ot+Oe+Le+it))/Se[1])),k.maxZoom),st=S.scale/S.zoomScale(Qe);be=new p.Aabb([be.min[0]-(Ze+Ge)*st,be.min[1]-(Le+tt)*st,be.min[2]],[be.max[0]+(Be+Ge)*st,be.max[1]+(it+tt)*st,be.max[2]]);const vt=.5*Se[2],Ht=this._minimumAABBFrustumDistance(S,be),Et=[0,0,1,0];p.transformMat4$1(Et,Et,Me),p.normalize$2(Et,Et);const At=p.scale$2([],Et,Ht+vt),_n=p.add([],be.center,At),un=("number"==typeof k.offset.x&&"number"==typeof k.offset.y?new p.Point(k.offset.x,k.offset.y):p.Point.convert(k.offset)).rotate(-p.degToRad(x));be.center[0]-=un.x*st,be.center[1]+=un.y*st,p.transformMat4(be.center,be.center,we),p.transformMat4(_n,_n,we);const Pt=[be.center[0],be.center[1],_n[2]*S.pixelsPerMeter];p.scale$2(Pt,Pt,1/S.worldSize);const dn=p.lngFromMercatorX(Pt[0]),$n=p.latFromMercatorY(Pt[1]),Hn=Math.min(S._zoomFromMercatorZ(Pt[2]),k.maxZoom),Gn=new p.LngLat(dn,$n);return S.mercatorFromTransition&&Hn<.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(S.setProjection({name:"globe"}),S.zoom=Hn,this._cameraForBounds(S,d,_,x,C,D)):{center:Gn,zoom:Hn,bearing:x,pitch:C}}fitBounds(l,d,_){const x=this.cameraForBounds(l,d);return this._fitInternal(x,d,_)}fitScreenCoordinates(l,d,_,x,C){const D=p.Point.convert(l),S=p.Point.convert(d),k=new p.Point(Math.min(D.x,S.x),Math.min(D.y,S.y)),N=new p.Point(Math.max(D.x,S.x),Math.max(D.y,S.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(D,S))return this;const F=this.transform.pointLocation3D(k),j=this.transform.pointLocation3D(N),Y=this.transform.pointLocation3D(new p.Point(k.x,N.y)),ee=this.transform.pointLocation3D(new p.Point(N.x,k.y)),re=[Math.min(F.lng,j.lng,Y.lng,ee.lng),Math.min(F.lat,j.lat,Y.lat,ee.lat)],ie=[Math.max(F.lng,j.lng,Y.lng,ee.lng),Math.max(F.lat,j.lat,Y.lat,ee.lat)],se=x&&x.pitch?x.pitch:this.getPitch(),$=this._cameraForBounds(this.transform,re,ie,_,se,x);return this._fitInternal($,x,C)}_fitInternal(l,d,_){return l?(delete(d=p.extend(l,d)).padding,d.linear?this.easeTo(d,_):this.flyTo(d,_)):this}jumpTo(l,d){this.stop();const _=l.preloadOnly?this.transform.clone():this.transform;let x=!1,C=!1,D=!1;return"zoom"in l&&_.zoom!==+l.zoom&&(x=!0,_.zoom=+l.zoom),void 0!==l.center&&(_.center=p.LngLat.convert(l.center)),"bearing"in l&&_.bearing!==+l.bearing&&(C=!0,_.bearing=+l.bearing),"pitch"in l&&_.pitch!==+l.pitch&&(D=!0,_.pitch=+l.pitch),null==l.padding||_.isPaddingEqual(l.padding)||(_.padding=l.padding),l.preloadOnly?(this._preloadTiles(_),this):(this.fire(new p.Event("movestart",d)).fire(new p.Event("move",d)),x&&this.fire(new p.Event("zoomstart",d)).fire(new p.Event("zoom",d)).fire(new p.Event("zoomend",d)),C&&this.fire(new p.Event("rotatestart",d)).fire(new p.Event("rotate",d)).fire(new p.Event("rotateend",d)),D&&this.fire(new p.Event("pitchstart",d)).fire(new p.Event("pitch",d)).fire(new p.Event("pitchend",d)),this.fire(new p.Event("moveend",d)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||p.warnOnce(Jl),this.transform.getFreeCameraOptions()}setFreeCameraOptions(l,d){const _=this.transform;if(!_.projection.supportsFreeCamera)return p.warnOnce(Jl),this;this.stop();const x=_.zoom,C=_.pitch,D=_.bearing;_.setFreeCameraOptions(l);const S=x!==_.zoom,k=C!==_.pitch,N=D!==_.bearing;return this.fire(new p.Event("movestart",d)).fire(new p.Event("move",d)),S&&this.fire(new p.Event("zoomstart",d)).fire(new p.Event("zoom",d)).fire(new p.Event("zoomend",d)),N&&this.fire(new p.Event("rotatestart",d)).fire(new p.Event("rotate",d)).fire(new p.Event("rotateend",d)),k&&this.fire(new p.Event("pitchstart",d)).fire(new p.Event("pitch",d)).fire(new p.Event("pitchend",d)),this.fire(new p.Event("moveend",d)),this}easeTo(l,d){this._stop(!1,l.easeId),(!1===(l=p.extend({offset:[0,0],duration:500,easing:p.ease},l)).animate||this._prefersReducedMotion(l))&&(l.duration=0);const _=this.transform,x=this.getZoom(),C=this.getBearing(),D=this.getPitch(),S=this.getPadding(),k="zoom"in l?+l.zoom:x,N="bearing"in l?this._normalizeBearing(l.bearing,C):C,F="pitch"in l?+l.pitch:D,j="padding"in l?l.padding:_.padding,Y=p.Point.convert(l.offset);let ee,re,ie;if("globe"===_.projection.name){const Ee=p.MercatorCoordinate.fromLngLat(_.center),Fe=Y.rotate(-_.angle);Ee.x+=Fe.x/_.worldSize,Ee.y+=Fe.y/_.worldSize;const ot=Ee.toLngLat(),Oe=p.LngLat.convert(l.center||ot);this._normalizeCenter(Oe),ee=_.centerPoint.add(Fe),re=new p.Point(Ee.x,Ee.y).mult(_.worldSize),ie=new p.Point(p.mercatorXfromLng(Oe.lng),p.mercatorYfromLat(Oe.lat)).mult(_.worldSize).sub(re)}else{ee=_.centerPoint.add(Y);const Ee=_.pointLocation(ee),Fe=p.LngLat.convert(l.center||Ee);this._normalizeCenter(Fe),re=_.project(Ee),ie=_.project(Fe).sub(re)}const se=_.zoomScale(k-x);let $,Q;l.around&&($=p.LngLat.convert(l.around),Q=_.locationPoint($));const ue=this._zooming||k!==x,de=this._rotating||C!==N,be=this._pitching||F!==D,Me=!_.isPaddingEqual(j),we=Ee=>Fe=>{if(ue&&(Ee.zoom=p.number(x,k,Fe)),de&&(Ee.bearing=p.number(C,N,Fe)),be&&(Ee.pitch=p.number(D,F,Fe)),Me&&(Ee.interpolatePadding(S,j,Fe),ee=Ee.centerPoint.add(Y)),$)Ee.setLocationAtPoint($,Q);else{const ot=Ee.zoomScale(Ee.zoom-x),Oe=k>x?Math.min(2,se):Math.max(.5,se),Ze=Math.pow(Oe,1-Fe),Be=Ee.unproject(re.add(ie.mult(Fe*Ze)).mult(ot));Ee.setLocationAtPoint(Ee.renderWorldCopies?Be.wrap():Be,ee)}return l.preloadOnly||this._fireMoveEvents(d),Ee};if(l.preloadOnly){const Ee=this._emulate(we,l.duration,_);return this._preloadTiles(Ee),this}const Se={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ue,this._rotating=de,this._pitching=be,this._padding=Me,this._easeId=l.easeId,this._prepareEase(d,l.noMoveStart,Se),this._ease(we(_),Ee=>{_.recenterOnTerrain(),this._afterEase(d,Ee)},l),this}_prepareEase(l,d,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",d||_.moving||this.fire(new p.Event("movestart",l)),this._zooming&&!_.zooming&&this.fire(new p.Event("zoomstart",l)),this._rotating&&!_.rotating&&this.fire(new p.Event("rotatestart",l)),this._pitching&&!_.pitching&&this.fire(new p.Event("pitchstart",l))}_fireMoveEvents(l){this.fire(new p.Event("move",l)),this._zooming&&this.fire(new p.Event("zoom",l)),this._rotating&&this.fire(new p.Event("rotate",l)),this._pitching&&this.fire(new p.Event("pitch",l))}_afterEase(l,d){if(this._easeId&&d&&this._easeId===d)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,x=this._rotating,C=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new p.Event("zoomend",l)),x&&this.fire(new p.Event("rotateend",l)),C&&this.fire(new p.Event("pitchend",l)),this.fire(new p.Event("moveend",l))}flyTo(l,d){if(this._prefersReducedMotion(l)){const Qe=p.pick(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Qe,d)}this.stop(),l=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},l);const _=this.transform,x=this.getZoom(),C=this.getBearing(),D=this.getPitch(),S=this.getPadding(),k="zoom"in l?p.clamp(+l.zoom,_.minZoom,_.maxZoom):x,N="bearing"in l?this._normalizeBearing(l.bearing,C):C,F="pitch"in l?+l.pitch:D,j="padding"in l?l.padding:_.padding,Y=_.zoomScale(k-x),ee=p.Point.convert(l.offset);let re=_.centerPoint.add(ee);const ie=_.pointLocation(re),se=p.LngLat.convert(l.center||ie);this._normalizeCenter(se);const $=_.project(ie),Q=_.project(se).sub($);let ue=l.curve;const de=Math.max(_.width,_.height),be=de/Y,Me=Q.mag();if("minZoom"in l){const Qe=p.clamp(Math.min(l.minZoom,x,k),_.minZoom,_.maxZoom),st=de/_.zoomScale(Qe-x);ue=Math.sqrt(st/Me*2)}const we=ue*ue;function Se(Qe){const st=(be*be-de*de+(Qe?-1:1)*we*we*Me*Me)/(2*(Qe?be:de)*we*Me);return Math.log(Math.sqrt(st*st+1)-st)}function Ee(Qe){return(Math.exp(Qe)-Math.exp(-Qe))/2}function Fe(Qe){return(Math.exp(Qe)+Math.exp(-Qe))/2}const ot=Se(0);let Oe=function(Qe){return Fe(ot)/Fe(ot+ue*Qe)},Ze=function(Qe){return de*((Fe(ot)*(Ee(st=ot+ue*Qe)/Fe(st))-Ee(ot))/we)/Me;var st},Be=(Se(1)-ot)/ue;if(Math.abs(Me)<1e-6||!isFinite(Be)){if(Math.abs(de-be)<1e-6)return this.easeTo(l,d);const Qe=be<de?-1:1;Be=Math.abs(Math.log(be/de))/ue,Ze=function(){return 0},Oe=function(st){return Math.exp(Qe*ue*st)}}l.duration="duration"in l?+l.duration:1e3*Be/("screenSpeed"in l?+l.screenSpeed/ue:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0);const it=C!==N,Le=F!==D,Ge=!_.isPaddingEqual(j),tt=Qe=>st=>{const vt=st*Be,Ht=1/Oe(vt);Qe.zoom=1===st?k:x+Qe.scaleZoom(Ht),it&&(Qe.bearing=p.number(C,N,st)),Le&&(Qe.pitch=p.number(D,F,st)),Ge&&(Qe.interpolatePadding(S,j,st),re=Qe.centerPoint.add(ee));const Et=1===st?se:Qe.unproject($.add(Q.mult(Ze(vt))).mult(Ht));return Qe.setLocationAtPoint(Qe.renderWorldCopies?Et.wrap():Et,re),Qe._updateCameraOnTerrain(),l.preloadOnly||this._fireMoveEvents(d),Qe};if(l.preloadOnly){const Qe=this._emulate(tt,l.duration,_);return this._preloadTiles(Qe),this}return this._zooming=!0,this._rotating=it,this._pitching=Le,this._padding=Ge,this._prepareEase(d,!1),this._ease(tt(_),()=>this._afterEase(d),l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,d)}if(!l){const _=this.handlers;_&&_.stop(!1)}return this}_ease(l,d,_){!1===_.animate||0===_.duration?(l(1),d()):(this._easeStart=p.exported.now(),this._easeOptions=_,this._onEaseFrame=l,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const l=Math.min((p.exported.now()-this._easeStart)/this._easeOptions.duration,1),d=this._onEaseFrame;d&&d(this._easeOptions.easing(l)),l<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(l,d){l=p.wrap(l,-180,180);const _=Math.abs(l-d);return Math.abs(l-360-d)<_&&(l-=360),Math.abs(l+360-d)<_&&(l+=360),l}_normalizeCenter(l){const d=this.transform;if(!d.renderWorldCopies||d.maxBounds)return;const _=l.lng-d.center.lng;l.lng+=_>180?-360:_<-180?360:0}_prefersReducedMotion(l){return this._respectPrefersReducedMotion&&p.exported.prefersReducedMotion&&!(l&&l.essential)}_emulate(l,d,_){const x=Math.ceil(15*d/1e3),C=[],D=l(_.clone());for(let S=0;S<=x;S++){const k=D(S/x);C.push(k.clone())}return C}}class Tt{constructor(l={}){this.options=l,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(l){const d=this.options&&this.options.compact;return this._map=l,this._container=on("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=on("button","mapboxgl-ctrl-attrib-button",this._container),on("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=on("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===d&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(l,d){const _=this._map._getUIString(`AttributionControl.${d}`);l.setAttribute("aria-label",_),l.removeAttribute("title"),l.firstElementChild&&l.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));const d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(l){const _=d.reduce((x,C,D)=>(C.value&&(x+=`${C.key}=${C.value}${D<d.length-1?"&":""}`),x),"?");l.href=`${p.config.FEEDBACK_URL}/${_}#${Dt(this._map,!0)}`,l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}}_updateData(l){!l||"metadata"!==l.sourceDataType&&"visibility"!==l.sourceDataType&&"style"!==l.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let l=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const d=this._map.style._sourceCaches;for(const x in d){const C=d[x];if(C.used){const D=C.getSource();D.attribution&&l.indexOf(D.attribution)<0&&l.push(D.attribution)}}l.sort((x,C)=>x.length-C.length),l=l.filter((x,C)=>{for(let D=C+1;D<l.length;D++)if(l[D].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=[...this.options.customAttribution,...l]:l.unshift(this.options.customAttribution));const _=l.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,l.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class _f{constructor(){p.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(l){this._map=l,this._container=on("div","mapboxgl-ctrl");const d=on("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(l){l&&"metadata"!==l.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const l=this._map.style._sourceCaches;if(0===Object.entries(l).length)return!0;for(const d in l){const _=l[d].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const l=this._container.children;if(l.length){const d=l[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}}}class vf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const d=++this._id;return this._queue.push({callback:l,id:d,cancelled:!1}),d}remove(l){const d=this._currentlyRunning,_=d?this._queue.concat(d):this._queue;for(const x of _)if(x.id===l)return void(x.cancelled=!0)}run(l=0){const d=this._currentlyRunning=this._queue;this._queue=[];for(const _ of d)if(!_.cancelled&&(_.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function tu(g,l,d){if(g=new p.LngLat(g.lng,g.lat),l){const _=new p.LngLat(g.lng-360,g.lat),x=new p.LngLat(g.lng+360,g.lat),C=360*Math.ceil(Math.abs(g.lng-d.center.lng)/360),D=d.locationPoint(g).distSqr(l),S=l.x<0||l.y<0||l.x>d.width||l.y>d.height;d.locationPoint(_).distSqr(l)<D&&(S||Math.abs(_.lng-d.center.lng)<C)?g=_:d.locationPoint(x).distSqr(l)<D&&(S||Math.abs(x.lng-d.center.lng)<C)&&(g=x)}for(;Math.abs(g.lng-d.center.lng)>180;){const _=d.locationPoint(g);if(_.x>=0&&_.y>=0&&_.x<=d.width&&_.y<=d.height)break;g.lng>d.center.lng?g.lng-=360:g.lng+=360}return g}const Ql={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Mt extends p.Evented{constructor(l,d){if(super(),(l instanceof p.window.HTMLElement||d)&&(l=p.extend({element:l},d)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=l&&l.occludedOpacity||.2,l&&l.element)this._element=l.element,this._offset=p.Point.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=on("div");const x=41,C=27,D=or("svg",{display:"block",height:x*this._scale+"px",width:C*this._scale+"px",viewBox:`0 0 ${C} ${x}`},this._element),S=or("radialGradient",{id:"shadowGradient"},or("defs",{},D));or("stop",{offset:"10%","stop-opacity":.4},S),or("stop",{offset:"100%","stop-opacity":.05},S),or("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},D),or("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},D),or("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},D),or("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},D),this._offset=p.Point.convert(l&&l.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});const _=this._element.classList;for(const x in Ql)_.remove(`mapboxgl-marker-anchor-${x}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(l){return l===this._map||(this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._updateMoving),l.on("moveend",this._update),l.on("remove",this._clearFadeTimer),l._addMarker(this),this.setDraggable(this._draggable),this._update(),l.on("click",this._onMapClick)),this}remove(){const l=this._map;return l&&(l.off("click",this._onMapClick),l.off("move",this._updateMoving),l.off("moveend",this._update),l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler),l.off("mouseup",this._onUp),l.off("touchend",this._onUp),l.off("mousemove",this._onMove),l.off("touchmove",this._onMove),l.off("remove",this._clearFadeTimer),l._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=p.LngLat.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(24.6+x)],"bottom-right":[-x,-1*(24.6+x)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=l,l._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(l){const d=l.code,_=l.charCode||l.keyCode;"Space"!==d&&"Enter"!==d&&32!==_&&13!==_||this.togglePopup()}_onMapClick(l){const d=l.originalEvent.target,_=this._element;this._popup&&(d===_||_.contains(d))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const l=this._popup;return l?(l.isOpen()?(l.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(l.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const l=this._map,d=this._pos;if(!l||!d)return!1;const _=l.unproject(d),x=l.getFreeCameraOptions();if(!x.position)return!1;const C=x.position.toLngLat();return C.distanceTo(_)<.9*C.distanceTo(this._lngLat)}_evaluateOpacity(){const l=this._map;if(!l)return;const d=this._pos;if(!d||d.x<0||d.x>l.transform.width||d.y<0||d.y>l.transform.height)return void this._clearFadeTimer();const _=l.unproject(d);let x;l._showingGlobe()&&p.isLngLatBehindGlobe(l.transform,this._lngLat)?x=0:(x=1-l._queryFogOpacity(_),l.transform._terrainEnabled()&&l.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const l=this._pos;if(!l||!this._map)return;const d=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${l.x}px,${l.y}px)\n            ${Ql[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${d.x}px,${d.y}px)\n        `}_calculateXYTransform(){const l=this._pos,d=this._map,_=this.getPitchAlignment();if(!d||!l||"map"!==_)return"";if(!d._showingGlobe()){const k=d.getPitch();return k?`rotateX(${k}deg)`:""}const x=p.radToDeg(p.globeTiltAtLngLat(d.transform,this._lngLat)),C=l.sub(p.globeCenterToScreenPoint(d.transform)),D=Math.abs(C.x)+Math.abs(C.y);if(0===D)return"";const S=x/D;return`rotateX(${-C.y*S}deg) rotateY(${C.x*S}deg)`}_calculateZTransform(){const l=this._pos,d=this._map;if(!d||!l)return"";let _=0;const x=this.getRotationAlignment();if("map"===x)if(d._showingGlobe()){const C=d.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),D=d.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(C);_=p.radToDeg(Math.atan2(D.y,D.x))-90}else _=-d.getBearing();else if("horizon"===x){const C=p.smoothstep(4,6,d.getZoom()),D=p.globeCenterToScreenPoint(d.transform);D.y+=C*d.transform.height;const S=l.sub(D),k=p.radToDeg(Math.atan2(S.y,S.x));_=(k>90?k-270:k+90)*(1-C)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(l){p.window.cancelAnimationFrame(this._updateFrameId);const d=this._map;d&&(d.transform.renderWorldCopies&&(this._lngLat=tu(this._lngLat,this._pos,d.transform)),this._pos=d.project(this._lngLat),!0===l?this._updateFrameId=p.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),d._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(d._showingGlobe()||d.getTerrain()||d.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(l){return this._offset=p.Point.convert(l),this._update(),this}_onMove(l){const d=this._map;if(!d)return;const _=this._pointerdownPos,x=this._positionDelta;if(_&&x){if(!this._isDragging){const C=this._clickTolerance||d._clickTolerance;if(l.point.dist(_)<C)return;this._isDragging=!0}this._pos=l.point.sub(x),this._lngLat=d.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const l=this._map;l&&(l.off("mousemove",this._onMove),l.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new p.Event("dragend")),this._state="inactive"}_addDragHandler(l){const d=this._map,_=this._pos;d&&_&&this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(_),this._pointerdownPos=l.point,this._state="pending",d.on("mousemove",this._onMove),d.on("touchmove",this._onMove),d.once("mouseup",this._onUp),d.once("touchend",this._onUp))}setDraggable(l){this._draggable=!!l;const d=this._map;return d&&(l?(d.on("mousedown",this._addDragHandler),d.on("touchstart",this._addDragHandler)):(d.off("mousedown",this._addDragHandler),d.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(l){return this._occludedOpacity=l||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const yf={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},xf=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Nh(g=new p.Point(0,0),l="bottom"){if("number"==typeof g){const d=Math.round(Math.sqrt(.5*Math.pow(g,2)));switch(l){case"top":return new p.Point(0,g);case"top-left":return new p.Point(d,d);case"top-right":return new p.Point(-d,d);case"bottom":return new p.Point(0,-g);case"bottom-left":return new p.Point(d,-d);case"bottom-right":return new p.Point(-d,-d);case"left":return new p.Point(g,0);case"right":return new p.Point(-g,0)}return new p.Point(0,0)}return g instanceof p.Point||Array.isArray(g)?p.Point.convert(g):p.Point.convert(g[l]||[0,0])}class bf{constructor(l){this.jumpTo(l)}getValue(l){if(l<=this._startTime)return this._start;if(l>=this._endTime)return this._end;const d=p.easeCubicInOut((l-this._startTime)/(this._endTime-this._startTime));return this._start*(1-d)+this._end*d}isEasing(l){return l>=this._startTime&&l<=this._endTime}jumpTo(l){this._startTime=-1/0,this._endTime=-1/0,this._start=l,this._end=l}easeTo(l,d,_){this._start=this.getValue(d),this._end=l,this._startTime=d,this._endTime=d+_}}const Nm={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},zm={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},nl={showCompass:!0,showZoom:!0,visualizePitch:!1};class wf{constructor(l,d,_=!1){this._clickTolerance=10,this.element=d,this.mouseRotate=new Xl({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,_&&(this.mousePitch=new Yl({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),d.addEventListener("mousedown",this.mousedown),d.addEventListener("touchstart",this.touchstart,{passive:!1}),d.addEventListener("touchmove",this.touchmove),d.addEventListener("touchend",this.touchend),d.addEventListener("touchcancel",this.reset)}down(l,d){this.mouseRotate.mousedown(l,d),this.mousePitch&&this.mousePitch.mousedown(l,d),Ac()}move(l,d){const _=this.map,x=this.mouseRotate.mousemoveWindow(l,d),C=x&&x.bearingDelta;if(C&&_.setBearing(_.getBearing()+C),this.mousePitch){const D=this.mousePitch.mousemoveWindow(l,d),S=D&&D.pitchDelta;S&&_.setPitch(_.getPitch()+S)}}off(){const l=this.element;l.removeEventListener("mousedown",this.mousedown),l.removeEventListener("touchstart",this.touchstart,{passive:!1}),l.removeEventListener("touchmove",this.touchmove),l.removeEventListener("touchend",this.touchend),l.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Sl(),p.window.removeEventListener("mousemove",this.mousemove),p.window.removeEventListener("mouseup",this.mouseup)}mousedown(l){this.down(p.extend({},l,{ctrlKey:!0,preventDefault:()=>l.preventDefault()}),Wr(this.element,l)),p.window.addEventListener("mousemove",this.mousemove),p.window.addEventListener("mouseup",this.mouseup)}mousemove(l){this.move(l,Wr(this.element,l))}mouseup(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()}touchstart(l){1!==l.targetTouches.length?this.reset():(this._startPos=this._lastPos=Ra(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>l.preventDefault()},this._startPos))}touchmove(l){1!==l.targetTouches.length?this.reset():(this._lastPos=Ra(this.element,l.targetTouches)[0],this.move({preventDefault:()=>l.preventDefault()},this._lastPos))}touchend(l){0===l.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Cf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},nu={maxWidth:100,unit:"metric"},dd={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},ec={version:p.version,supported:us,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:class extends Fh{constructor(g){if(p.LivePerformanceUtils.mark(p.PerformanceMarkers.create),null!=(g=p.extend({},zm,g)).minZoom&&null!=g.maxZoom&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=g.minPitch&&null!=g.maxPitch&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=g.minPitch&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=g.maxPitch&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(g.antialias&&p.isSafariWithAntialiasingBug(p.window)&&(g.antialias=!1,p.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Zl(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),g),this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._useWebGL2=g.useWebGL2,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._collectResourceTiming=g.collectResourceTiming,this._optimizeForTerrain=g.optimizeForTerrain,this._language=this._parseLanguage(g.language),this._worldview=g.worldview,this._renderTaskQueue=new vf,this._domRenderTaskQueue=new vf,this._controls=[],this._markers=[],this._popups=[],this._mapId=p.uniqueId(),this._locale=p.extend({},Nm,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._performanceMetricsCollection=g.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new bf(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new p.RequestManager(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,"string"==typeof g.container){if(this._container=p.window.document.getElementById(g.container),!this._container)throw new Error(`Container '${g.container}' not found.`)}else{if(!(g.container instanceof p.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&p.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==p.window&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1),p.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Gs(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),this._hash=g.hash&&new Di("string"==typeof g.hash&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,p.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),g.attributionControl&&this.addControl(new Tt({customAttribution:g.customAttribution})),this._logoControl=new _f,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",l=>{this._update("style"===l.dataType),this.fire(new p.Event(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new p.Event(`${l.dataType}dataloading`,l))})}_getMapId(){return this._mapId}addControl(g,l){if(void 0===l&&(l=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=g.onAdd(this);this._controls.push(g);const _=this._controlPositions[l];return-1!==l.indexOf("bottom")?_.insertBefore(d,_.firstChild):_.appendChild(d),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(g);return l>-1&&this._controls.splice(l,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const l=!this._moving;return l&&this.fire(new p.Event("movestart",g)).fire(new p.Event("move",g)),this.fire(new p.Event("resize",g)),l&&this.fire(new p.Event("moveend",g)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(p.LngLatBounds.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(g){return"auto"===g?p.window.navigator.language:Array.isArray(g)?0===g.length?void 0:g.map(l=>"auto"===l?p.window.navigator.language:l):g}setLanguage(g){const l=this._parseLanguage(g);if(!this.style||l===this._language)return this;this._language=l,this.style._reloadSources();for(const d of this._controls)d._setLanguage&&d._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(g){return this.style&&g!==this._worldview?(this._worldview=g,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(g){return this._lazyInitEmptyStyle(),g?"string"==typeof g&&(g={name:g}):g=null,this._useExplicitProjection=!!g,this._prioritizeAndUpdateProjection(g,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const g=this.transform,l=g.projection.name;let d;"globe"===l&&g.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?(g.setMercatorFromTransition(),d=!0):"mercator"===l&&g.zoom<p.GLOBE_ZOOM_THRESHOLD_MAX&&(g.setProjection({name:"globe"}),d=!0),d&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(g,l){return this._updateProjection(g||l||{name:"mercator"})}_updateProjection(g){let l;if(l="globe"===g.name&&this.transform.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(g),this.style.applyProjectionUpdate(),l){this.painter.clearBackgroundTiles();for(const d in this.style._sourceCaches)this.style._sourceCaches[d].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(g){return this.transform.locationPoint3D(p.LngLat.convert(g))}unproject(g){return this.transform.pointLocation3D(p.Point.convert(g))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(g,l,d){if("mouseenter"===g||"mouseover"===g){let _=!1;const x=D=>{const S=l.filter(N=>this.getLayer(N)),k=S.length?this.queryRenderedFeatures(D.point,{layers:S}):[];k.length?_||(_=!0,d.call(this,new Si(g,this,D.originalEvent,{features:k}))):_=!1},C=()=>{_=!1};return{layers:new Set(l),listener:d,delegates:{mousemove:x,mouseout:C}}}if("mouseleave"===g||"mouseout"===g){let _=!1;const x=D=>{const S=l.filter(k=>this.getLayer(k));(S.length?this.queryRenderedFeatures(D.point,{layers:S}):[]).length?_=!0:_&&(_=!1,d.call(this,new Si(g,this,D.originalEvent)))},C=D=>{_&&(_=!1,d.call(this,new Si(g,this,D.originalEvent)))};return{layers:new Set(l),listener:d,delegates:{mousemove:x,mouseout:C}}}{const _=x=>{const C=l.filter(S=>this.getLayer(S)),D=C.length?this.queryRenderedFeatures(x.point,{layers:C}):[];D.length&&(x.features=D,d.call(this,x),delete x.features)};return{layers:new Set(l),listener:d,delegates:{[g]:_}}}}on(g,l,d){if(void 0===d)return super.on(g,l);Array.isArray(l)||(l=[l]);const _=this._createDelegatedListener(g,l,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(_);for(const x in _.delegates)this.on(x,_.delegates[x]);return this}once(g,l,d){if(void 0===d)return super.once(g,l);Array.isArray(l)||(l=[l]);const _=this._createDelegatedListener(g,l,d);for(const x in _.delegates)this.once(x,_.delegates[x]);return this}off(g,l,d){if(void 0===d)return super.off(g,l);l=new Set(Array.isArray(l)?l:[l]);const _=(C,D)=>{if(C.size!==D.size)return!1;for(const S of C)if(!D.has(S))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[g]:void 0;return x&&(C=>{for(let D=0;D<C.length;D++){const S=C[D];if(S.listener===d&&_(S.layers,l)){for(const k in S.delegates)this.off(k,S.delegates[k]);return C.splice(D,1),this}}})(x),this}queryRenderedFeatures(g,l){return this.style?(void 0!==l||void 0===g||g instanceof p.Point||Array.isArray(g)||(l=g,g=void 0),this.style.queryRenderedFeatures(g=g||[[0,0],[this.transform.width,this.transform.height]],l=l||{},this.transform)):[]}querySourceFeatures(g,l){return this.style.querySourceFeatures(g,l)}isPointOnSurface(g){const{name:l}=this.transform.projection;return"globe"!==l&&"mercator"!==l&&p.warnOnce(`${l} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(p.Point.convert(g))}setStyle(g,l){return!1!==(l=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},l)).diff&&l.localIdeographFontFamily===this._localIdeographFontFamily&&l.localFontFamily===this._localFontFamily&&this.style&&g?(this._diffStyle(g,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._localFontFamily=l.localFontFamily,this._updateStyle(g,l))}_getUIString(g){const l=this._locale[g];if(null==l)throw new Error(`Missing UI string '${g}'`);return l}_updateStyle(g,l){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),g&&(this.style=new js(this,l||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof g?this.style.loadURL(g):this.style.loadJSON(g)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new js(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,l){if("string"==typeof g){const d=this._requestManager.normalizeStyleURL(g),_=this._requestManager.transformRequest(d,p.ResourceType.Style);p.getJSON(_,(x,C)=>{x?this.fire(new p.ErrorEvent(x)):C&&this._updateDiff(C,l)})}else"object"==typeof g&&this._updateDiff(g,l)}_updateDiff(g,l){try{this.style.setState(g)&&this._update(!0)}catch(d){p.warnOnce(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(g,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(p.warnOnce("There is no style added to the map."),!1)}addSource(g,l){return this._lazyInitEmptyStyle(),this.style.addSource(g,l),this._update(!0)}isSourceLoaded(g){return!!this.style&&this.style._isSourceCacheLoaded(g)}areTilesLoaded(){const g=this.style&&this.style._sourceCaches;for(const l in g){const d=g[l]._tiles;for(const _ in d){const x=d[_];if("loaded"!==x.state&&"errored"!==x.state)return!1}}return!0}addSourceType(g,l,d){this._lazyInitEmptyStyle(),this.style.addSourceType(g,l,d)}removeSource(g){return this.style.removeSource(g),this._updateTerrain(),this._update(!0)}getSource(g){return this.style.getSource(g)}addImage(g,l,{pixelRatio:d=1,sdf:_=!1,stretchX:x,stretchY:C,content:D}={}){if(this._lazyInitEmptyStyle(),l instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&l instanceof p.window.ImageBitmap){const{width:S,height:k,data:N}=p.exported.getImageData(l);this.style.addImage(g,{data:new p.RGBAImage({width:S,height:k},N),pixelRatio:d,stretchX:x,stretchY:C,content:D,sdf:_,version:0})}else if(void 0===l.width||void 0===l.height)this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:S,height:k}=l,N=l;this.style.addImage(g,{data:new p.RGBAImage({width:S,height:k},new Uint8Array(N.data)),pixelRatio:d,stretchX:x,stretchY:C,content:D,sdf:_,version:0,userImage:N}),N.onAdd&&N.onAdd(this,g)}}updateImage(g,l){const d=this.style.getImage(g);if(!d)return void this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=l instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&l instanceof p.window.ImageBitmap?p.exported.getImageData(l):l,{width:x,height:C}=_;void 0!==x&&void 0!==C?x===d.data.width&&C===d.data.height?(d.data.replace(_.data,!(l instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&l instanceof p.window.ImageBitmap)),this.style.updateImage(g,d)):this.fire(new p.ErrorEvent(new Error(`The width and height of the updated image (${x}, ${C})\n                must be that same as the previous version of the image\n                (${d.data.width}, ${d.data.height})`))):this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g,l){p.getImage(this._requestManager.transformRequest(g,p.ResourceType.Image),(d,_)=>{l(d,_ instanceof p.window.HTMLImageElement?p.exported.getImageData(_):_)})}listImages(){return this.style.listImages()}addLayer(g,l){return this._lazyInitEmptyStyle(),this.style.addLayer(g,l),this._update(!0)}moveLayer(g,l){return this.style.moveLayer(g,l),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}setLayerZoomRange(g,l,d){return this.style.setLayerZoomRange(g,l,d),this._update(!0)}setFilter(g,l,d={}){return this.style.setFilter(g,l,d),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,l,d,_={}){return this.style.setPaintProperty(g,l,d,_),this._update(!0)}getPaintProperty(g,l){return this.style.getPaintProperty(g,l)}setLayoutProperty(g,l,d,_={}){return this.style.setLayoutProperty(g,l,d,_),this._update(!0)}getLayoutProperty(g,l){return this.style.getLayoutProperty(g,l)}setLight(g,l={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,l),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(p.LngLat.convert(g),this.transform):0}setFeatureState(g,l){return this.style.setFeatureState(g,l),this._update()}removeFeatureState(g,l){return this.style.removeFeatureState(g,l),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}_updateContainerDimensions(){if(!this._container)return;const g=this._container.getBoundingClientRect().width||400,l=this._container.getBoundingClientRect().height||300;let d,_,x,C=this._container;for(;C&&(!_||!x);){const D=p.window.getComputedStyle(C).transform;D&&"none"!==D&&(d=D.match(/matrix.*\((.+)\)/)[1].split(", "),d[0]&&"0"!==d[0]&&"1"!==d[0]&&(_=d[0]),d[3]&&"0"!==d[3]&&"1"!==d[3]&&(x=d[3])),C=C.parentElement}this._containerWidth=_?Math.abs(g/_):g,this._containerHeight=x?Math.abs(l/x):l}_detectMissingCSS(){"rgb(250, 128, 114)"!==p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=on("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const l=this._canvasContainer=on("div","mapboxgl-canvas-container",g);this._interactive&&l.classList.add("mapboxgl-interactive"),this._canvas=on("canvas","mapboxgl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const d=this._controlContainer=on("div","mapboxgl-control-container",g),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{_[x]=on("div",`mapboxgl-ctrl-${x}`,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,l){const d=p.exported.devicePixelRatio||1;this._canvas.width=d*Math.ceil(g),this._canvas.height=d*Math.ceil(l),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${l}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const l=this._markers.indexOf(g);-1!==l&&this._markers.splice(l,1)}_addPopup(g){this._popups.push(g)}_removePopup(g){const l=this._popups.indexOf(g);-1!==l&&this._popups.splice(l,1)}_setupPainter(){const g=p.extend({},us.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),l=this._useWebGL2&&this._canvas.getContext("webgl2",g),d=l||this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);d?(this._useWebGL2&&!l&&p.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),p.storeAuthState(d,!0),this.painter=new cr(d,this.transform,!!l),this.on("data",_=>{"source"===_.dataType&&this.painter.setTileLoadedFlag(!0)}),p.exported$1.testSupport(d)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let l;const d=this.painter.context.extTimerQuery,_=p.exported.now();if(this.listens("gpu-timing-frame")&&(l=d.createQueryEXT(),d.beginQueryEXT(d.TIME_ELAPSED_EXT,l)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],p.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],p.window.performance.now())),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;this._updateProjectionTransition();const x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const S=this.transform.zoom,k=this.transform.pitch,N=p.exported.now(),F=new p.EvaluationParameters(S,{now:N,fadeDuration:x,pitch:k,transition:this.style.getTransition()});this.style.update(F)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let C=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),C=this._updateAverageElevation(_),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):C=this._updateAverageElevation(_),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),l){const S=p.exported.now()-_;d.endQueryEXT(d.TIME_ELAPSED_EXT,l),setTimeout(()=>{const k=d.getQueryObjectEXT(l,d.QUERY_RESULT_EXT)/1e6;d.deleteQueryEXT(l),this.fire(new p.Event("gpu-timing-frame",{cpuTime:S,gpuTime:k})),p.window.performance.mark("frame-gpu",{startTime:_,detail:{gpuTime:k}})},50)}if(this.listens("gpu-timing-layer")){const S=this.painter.collectGpuTimers();setTimeout(()=>{const k=this.painter.queryGpuTimers(S);this.fire(new p.Event("gpu-timing-layer",{layerTimes:k}))},50)}if(this.listens("gpu-timing-deferred-render")){const S=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const k=this.painter.queryGpuTimeDeferredRender(S);this.fire(new p.Event("gpu-timing-deferred-render",{gpuTime:k}))},50)}const D=this._sourcesDirty||this._styleDirty||this._placementDirty||C;if(D||this._repaint)this.triggerRepaint();else{const S=!this.isMoving()&&this.loaded();if(S&&(C=this._updateAverageElevation(_,!0)),C)this.triggerRepaint();else if(this._triggerFrame(!1),S&&(this.fire(new p.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const k=this._calculateSpeedIndex();this.fire(new p.Event("speedindexcompleted",{speedIndex:k})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||D||(this._fullyLoaded=!0,p.LivePerformanceUtils.mark(p.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&p.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(g){for(const l of this._markers)g&&!this.getRenderWorldCopies()&&(l._lngLat=l._lngLat.wrap()),l._update();for(const l of this._popups)!g||this.getRenderWorldCopies()||l._trackPointer||(l._lngLat=l._lngLat.wrap()),l._update()}_updateAverageElevation(g,l=!1){const d=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&d(0);if((l||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const _=this.transform.averageElevation;let x=this.transform.sampleAverageElevation(),C=!1;this.transform.elevation&&(C=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=g;const D=Math.abs(_-x);if(D>1){if(this._isInitialLoad||C)return this._averageElevation.jumpTo(x),d(x);this._averageElevation.easeTo(x,g,300)}else if(D>1e-4)return this._averageElevation.jumpTo(x),d(x)}return!!this._averageElevation.isEasing(g)&&d(this._averageElevation.getValue(g))}_authenticate(){p.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,g=>{if(g&&(g.message===p.AUTH_ERR_MSG||401===g.status)){const l=this.painter.context.gl;p.storeAuthState(l,!1),this._logoControl instanceof _f&&this._logoControl._updateLogo(),l&&l.clear(l.DEPTH_BUFFER_BIT|l.COLOR_BUFFER_BIT|l.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new p.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),p.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const g=this._isDragging();this.painter.updateTerrain(this.style,g)}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),l=this.painter.getCanvasCopiesAndTimestamps();l.timeStamps.push(performance.now());const d=this.painter.context.gl,_=d.createFramebuffer();function x(C){d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,C,0);const D=new Uint8Array(d.drawingBufferWidth*d.drawingBufferHeight*4);return d.readPixels(0,0,d.drawingBufferWidth,d.drawingBufferHeight,d.RGBA,d.UNSIGNED_BYTE,D),D}return d.bindFramebuffer(d.FRAMEBUFFER,_),this._canvasPixelComparison(x(g),l.canvasCopies.map(x),l.timeStamps)}_canvasPixelComparison(g,l,d){let _=d[1]-d[0];const x=g.length/4;for(let C=0;C<l.length;C++){const D=l[C];let S=0;for(let k=0;k<D.length;k+=4)D[k]===g[k]&&D[k+1]===g[k+1]&&D[k+2]===g[k+2]&&D[k+3]===g[k+3]&&(S+=1);_+=(d[C+2]-d[C+1])*(1-S/x)}return _}remove(){this._hash&&this._hash.remove();for(const l of this._controls)l.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==p.window&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1),p.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),p.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new p.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=p.exported.frame(l=>{const d=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,d&&this._render(l)}))}_preloadTiles(g){const l=this.style?Object.values(this.style._sourceCaches):[];return p.asyncAll(l,(d,_)=>d._preloadTiles(g,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}_onVisibilityChange(){"hidden"===p.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(g){this._showTileAABBs!==g&&(this._showTileAABBs=g,g&&this._update())}_setCacheLimits(g,l){p.setCacheLimits(g,l)}get version(){return p.version}},NavigationControl:class{constructor(g){this.options=p.extend({},nl,g),this._container=on("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",l=>{this._map&&this._map.zoomIn({},{originalEvent:l})}),on("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",l=>{this._map&&this._map.zoomOut({},{originalEvent:l})}),on("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",l=>{const d=this._map;d&&(this.options.visualizePitch?d.resetNorthPitch({},{originalEvent:l}):d.resetNorth({},{originalEvent:l}))}),this._compassIcon=on("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map;if(!g)return;const l=g.getZoom(),d=l===g.getMaxZoom(),_=l===g.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const g=this._map;if(!g)return;const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(g.transform.pitch*(Math.PI/180)),.5)}) rotateX(${g.transform.pitch}deg) rotateZ(${g.transform.angle*(180/Math.PI)}deg)`:`rotate(${g.transform.angle*(180/Math.PI)}deg)`;g._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=l)})}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),g.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&g.on("pitch",this._rotateCompassArrow),g.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new wf(g,this._compass,this.options.visualizePitch)),this._container}onRemove(){const g=this._map;g&&(this._container.remove(),this.options.showZoom&&g.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&g.off("pitch",this._rotateCompassArrow),g.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(g,l){const d=on("button",g,this._container);return d.type="button",d.addEventListener("click",l),d}_setButtonTitle(g,l){if(!this._map)return;const d=this._map._getUIString(`NavigationControl.${l}`);g.setAttribute("aria-label",d),g.firstElementChild&&g.firstElementChild.setAttribute("title",d)}},GeolocateControl:class extends p.Evented{constructor(g){super(),this.options=p.extend({geolocation:p.window.navigator.geolocation},Cf,g),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Wl(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(g){return this._map=g,this._container=on("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(g){const l=(d=!!this.options.geolocation)=>{this._supportsGeolocation=d,g(d)};void 0!==this._supportsGeolocation?g(this._supportsGeolocation):void 0!==p.window.navigator.permissions?p.window.navigator.permissions.query({name:"geolocation"}).then(d=>l("denied"!==d.state)).catch(()=>l()):l()}_isOutOfMapMaxBounds(g){const l=this._map.getMaxBounds(),d=g.coords;return!!l&&(d.longitude<l.getWest()||d.longitude>l.getEast()||d.latitude<l.getSouth()||d.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(g),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(g),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",g)),this._finish()}}_updateCamera(g){const l=new p.LngLat(g.coords.longitude,g.coords.latitude),d=g.coords.accuracy,_=this._map.getBearing(),x=p.extend({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(l.toBounds(d),x,{geolocateSource:!0})}_updateMarker(g){if(g){const l=new p.LngLat(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map.transform,l=p.mercatorZfromAltitude(1,g._center.lat)*g.worldSize,d=Math.ceil(2*this._accuracy*l);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(1===g.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===g.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",l=>l.preventDefault()),this._geolocateButton=on("button","mapboxgl-ctrl-geolocate",this._container),on("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===g){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}else{const l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=on("div","mapboxgl-user-location"),this._dotElement.appendChild(on("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(on("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Mt({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=on("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Mt({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{l.geolocateSource||"ACTIVE_LOCK"!==this._watchState||l.originalEvent&&"resize"===l.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new p.Event("trackuserlocationend")))})}}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:!0===g.absolute&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(g={maximumAge:6e5,timeout:0},this._noTimeout=!0):(g=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const g=()=>{p.window.addEventListener("ondeviceorientationabsolute"in p.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==p.window.DeviceMotionEvent&&"function"==typeof p.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(l=>{"granted"===l&&g()}).catch(console.error):g()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),p.window.removeEventListener("deviceorientation",this._onDeviceOrientation),p.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Tt,ScaleControl:class{constructor(g){this.options=p.extend({},nu,g),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),p.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const g=this.options.maxWidth||100,l=this._map,d=l._containerHeight/2,_=l._containerWidth/2-g/2,x=l.unproject([_,d]),C=l.unproject([_+g,d]),D=x.distanceTo(C);if("imperial"===this.options.unit){const S=3.2808*D;S>5280?this._setScale(g,S/5280,"mile"):this._setScale(g,S,"foot")}else"nautical"===this.options.unit?this._setScale(g,D/1852,"nautical-mile"):D>=1e3?this._setScale(g,D/1e3,"kilometer"):this._setScale(g,D,"meter")}_setScale(g,l,d){this._map._requestDomTask(()=>{const _=function(C){const D=Math.pow(10,`${Math.floor(C)}`.length-1);let S=C/D;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(k){const N=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*N)/N}(S),D*S}(l),x=_/l;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==d?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:d}).format(_):`${_}&nbsp;${dd[d]}`,this._container.style.width=g*x+"px"})}onAdd(g){return this._map=g,this._language=g.getLanguage(),this._container=on("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(g){this._language=g,this._update()}setUnit(g){this.options.unit=g,this._update()}},FullscreenControl:class{constructor(g){this._fullscreen=!1,g&&g.container&&(g.container instanceof p.window.HTMLElement?this._container=g.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in p.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=on("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!p.window.document.fullscreenEnabled&&!p.window.document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=on("button","mapboxgl-ctrl-fullscreen",this._controlContainer);on("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(p.window.document.fullscreenElement||p.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends p.Evented{constructor(g){super(),this.options=p.extend(Object.create(yf),g),p.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&g.on("preclick",this._onClose),this.options.closeOnMove&&g.on("move",this._onClose),g.on("remove",this.remove),this._update(),g._addPopup(this),this._focusFirstElement(),this._trackPointer?(g.on("mousemove",this._onMouseEvent),g.on("mouseup",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")):g.on("move",this._update),this.fire(new p.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const g=this._map;return g&&(g.off("move",this._update),g.off("move",this._onClose),g.off("preclick",this._onClose),g.off("click",this._onClose),g.off("remove",this.remove),g.off("mousemove",this._onMouseEvent),g.off("mouseup",this._onMouseEvent),g.off("drag",this._onMouseEvent),g._canvasContainer&&g._canvasContainer.classList.remove("mapboxgl-track-pointer"),g._removePopup(this),this._map=void 0),this.fire(new p.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(g){this._lngLat=p.LngLat.convert(g),this._pos=null,this._trackPointer=!1,this._update();const l=this._map;return l&&(l.on("move",this._update),l.off("mousemove",this._onMouseEvent),l._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const g=this._map;return g&&(g.off("move",this._update),g.on("mousemove",this._onMouseEvent),g.on("drag",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(p.window.document.createTextNode(g))}setHTML(g){const l=p.window.document.createDocumentFragment(),d=p.window.document.createElement("body");let _;for(d.innerHTML=g;_=d.firstChild,_;)l.appendChild(_);return this.setDOMContent(l)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){let l=this._content;if(l)for(;l.hasChildNodes();)l.firstChild&&l.removeChild(l.firstChild);else l=this._content=on("div","mapboxgl-popup-content",this._container||void 0);if(l.appendChild(g),this.options.closeButton){const d=this._closeButton=on("button","mapboxgl-popup-close-button",l);d.type="button",d.setAttribute("aria-label","Close popup"),d.setAttribute("aria-hidden","true"),d.innerHTML="&#215;",d.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let l;return this._classList.delete(g)?l=!1:(this._classList.add(g),l=!0),this._updateClassList(),l}_onMouseEvent(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const l=this._map,d=this._container,_=this._pos;if(!l||!d||!_)return"bottom";const x=d.offsetWidth,C=d.offsetHeight,D=_.x<x/2,S=_.x>l.transform.width-x/2;if(_.y+g<C)return D?"top-left":S?"top-right":"top";if(_.y>l.transform.height-C){if(D)return"bottom-left";if(S)return"bottom-right"}return D?"left":S?"right":"bottom"}_updateClassList(){const g=this._container;if(!g)return;const l=[...this._classList];l.push("mapboxgl-popup"),this._anchor&&l.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&l.push("mapboxgl-popup-track-pointer"),g.className=l.join(" ")}_update(g){const l=this._map,d=this._content;if(!l||!this._lngLat&&!this._trackPointer||!d)return;let _=this._container;if(_||(_=this._container=on("div","mapboxgl-popup",l.getContainer()),this._tip=on("div","mapboxgl-popup-tip",_),_.appendChild(d)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),l.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=tu(this._lngLat,this._pos,l.transform)),!this._trackPointer||g){const x=this._pos=this._trackPointer&&g?g:l.project(this._lngLat),C=Nh(this.options.offset),D=this._anchor=this._getAnchor(C.y),S=Nh(this.options.offset,D),k=x.add(S).round();l._requestDomTask(()=>{this._container&&D&&(this._container.style.transform=`${Ql[D]} translate(${k.x}px,${k.y}px)`)})}if(!this._marker&&l._showingGlobe()){const x=p.isLngLatBehindGlobe(l.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(xf);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._container&&(this._container.style.opacity=`${g}`),this._content&&(this._content.style.pointerEvents=g?"auto":"none")}},Marker:Mt,Style:js,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.Point,MercatorCoordinate:p.MercatorCoordinate,FreeCameraOptions:kn,Evented:p.Evented,config:p.config,prewarm:function(){Ol().acquire(hs)},clearPrewarmedResources:function(){const g=Sr;g&&(g.isPreloaded()&&1===g.numActive()?(g.release(hs),Sr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(g){p.config.ACCESS_TOKEN=g},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(g){p.config.API_URL=g},get workerCount(){return mr.workerCount},set workerCount(g){mr.workerCount=g},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){p.config.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){p.clearTileCache(g)},workerUrl:"",workerClass:null,setNow:p.exported.setNow,restoreNow:p.exported.restoreNow};return ec}),Rn}()}},Em=>{Em(Em.s=497)}]);